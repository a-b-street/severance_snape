var w1=Object.defineProperty;var S1=(s,i,o)=>i in s?w1(s,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[i]=o;var Sn=(s,i,o)=>S1(s,typeof i!="symbol"?i+"":i,o);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))a(h);new MutationObserver(h=>{for(const g of h)if(g.type==="childList")for(const m of g.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function o(h){const g={};return h.integrity&&(g.integrity=h.integrity),h.referrerPolicy&&(g.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?g.credentials="include":h.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function a(h){if(h.ep)return;h.ep=!0;const g=o(h);fetch(h.href,g)}})();function Tt(){}function k1(s,i){for(const o in i)s[o]=i[o];return s}function B_(s){return s()}function xm(){return Object.create(null)}function xn(s){s.forEach(B_)}function sc(s){return typeof s=="function"}function Nt(s,i){return s!=s?i==i:s!==i||s&&typeof s=="object"||typeof s=="function"}let ph;function sr(s,i){return s===i?!0:(ph||(ph=document.createElement("a")),ph.href=i,s===ph.href)}function T1(s){return Object.keys(s).length===0}function Td(s,...i){if(s==null){for(const a of i)a(void 0);return Tt}const o=s.subscribe(...i);return o.unsubscribe?()=>o.unsubscribe():o}function F_(s){let i;return Td(s,o=>i=o)(),i}function Pt(s,i,o){s.$$.on_destroy.push(Td(i,o))}function on(s,i,o,a){if(s){const h=O_(s,i,o,a);return s[0](h)}}function O_(s,i,o,a){return s[1]&&a?k1(o.ctx.slice(),s[1](a(i))):o.ctx}function an(s,i,o,a){if(s[2]&&a){const h=s[2](a(o));if(i.dirty===void 0)return h;if(typeof h=="object"){const g=[],m=Math.max(i.dirty.length,h.length);for(let u=0;u<m;u+=1)g[u]=i.dirty[u]|h[u];return g}return i.dirty|h}return i.dirty}function ln(s,i,o,a,h,g){if(h){const m=O_(i,o,a,g);s.p(m,h)}}function un(s){if(s.ctx.length>32){const i=[],o=s.ctx.length/32;for(let a=0;a<o;a++)i[a]=-1;return i}return-1}function C1(s){const i={};for(const o in s)i[o]=!0;return i}function Il(s){return s??""}function xi(s,i,o){return s.set(o),i}function ld(s){return s&&sc(s.destroy)?s.destroy:Tt}const I1=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function oe(s,i){s.appendChild(i)}function ke(s,i,o){s.insertBefore(i,o||null)}function Se(s){s.parentNode&&s.parentNode.removeChild(s)}function Cs(s,i){for(let o=0;o<s.length;o+=1)s[o]&&s[o].d(i)}function ge(s){return document.createElement(s)}function Xs(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function ft(s){return document.createTextNode(s)}function He(){return ft(" ")}function Kn(){return ft("")}function At(s,i,o,a){return s.addEventListener(i,o,a),()=>s.removeEventListener(i,o,a)}function N_(s){return function(i){return i.preventDefault(),s.call(this,i)}}function Th(s){return function(i){return i.stopPropagation(),s.call(this,i)}}function te(s,i,o){o==null?s.removeAttribute(i):s.getAttribute(i)!==o&&s.setAttribute(i,o)}function E1(s){let i;return{p(...o){i=o,i.forEach(a=>s.push(a))},r(){i.forEach(o=>s.splice(s.indexOf(o),1))}}}function Gr(s){return s===""?null:+s}function M1(s){return Array.from(s.childNodes)}function rn(s,i){i=""+i,s.data!==i&&(s.data=i)}function Ui(s,i){s.value=i??""}function Bi(s,i,o,a){o==null?s.style.removeProperty(i):s.style.setProperty(i,o,"")}function El(s,i,o){for(let a=0;a<s.options.length;a+=1){const h=s.options[a];if(h.__value===i){h.selected=!0;return}}(!o||i!==void 0)&&(s.selectedIndex=-1)}function Cd(s){const i=s.querySelector(":checked");return i&&i.__value}function rr(s,i,o){s.classList.toggle(i,!!o)}function L1(s,i,{bubbles:o=!1,cancelable:a=!1}={}){return new CustomEvent(s,{detail:i,bubbles:o,cancelable:a})}let $u;function Xu(s){$u=s}function oc(){if(!$u)throw new Error("Function called outside component initialization");return $u}function ac(s){oc().$$.on_mount.push(s)}function mr(s){oc().$$.on_destroy.push(s)}function Ys(){const s=oc();return(i,o,{cancelable:a=!1}={})=>{const h=s.$$.callbacks[i];if(h){const g=L1(i,o,{cancelable:a});return h.slice().forEach(m=>{m.call(s,g)}),!g.defaultPrevented}return!0}}function Id(s,i){return oc().$$.context.set(s,i),i}function V_(s){return oc().$$.context.get(s)}function hi(s,i){const o=s.$$.callbacks[i.type];o&&o.slice().forEach(a=>a.call(this,i))}const yl=[],gi=[];let Tl=[];const ud=[],j_=Promise.resolve();let cd=!1;function U_(){cd||(cd=!0,j_.then(Z_))}function q_(){return U_(),j_}function Ml(s){Tl.push(s)}function cn(s){ud.push(s)}const ed=new Set;let pl=0;function Z_(){if(pl!==0)return;const s=$u;do{try{for(;pl<yl.length;){const i=yl[pl];pl++,Xu(i),P1(i.$$)}}catch(i){throw yl.length=0,pl=0,i}for(Xu(null),yl.length=0,pl=0;gi.length;)gi.pop()();for(let i=0;i<Tl.length;i+=1){const o=Tl[i];ed.has(o)||(ed.add(o),o())}Tl.length=0}while(yl.length);for(;ud.length;)ud.pop()();cd=!1,ed.clear(),Xu(s)}function P1(s){if(s.fragment!==null){s.update(),xn(s.before_update);const i=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,i),s.after_update.forEach(Ml)}}function A1(s){const i=[],o=[];Tl.forEach(a=>s.indexOf(a)===-1?i.push(a):o.push(a)),o.forEach(a=>a()),Tl=i}const Ch=new Set;let pa;function ki(){pa={r:0,c:[],p:pa}}function Ti(){pa.r||xn(pa.c),pa=pa.p}function be(s,i){s&&s.i&&(Ch.delete(s),s.i(i))}function Le(s,i,o,a){if(s&&s.o){if(Ch.has(s))return;Ch.add(s),pa.c.push(()=>{Ch.delete(s),a&&(o&&s.d(1),a())}),s.o(i)}else a&&a()}function bn(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function z1(s,i){Le(s,1,1,()=>{i.delete(s.key)})}function D1(s,i,o,a,h,g,m,u,w,I,E,C){let P=s.length,H=g.length,U=P;const ie={};for(;U--;)ie[s[U].key]=U;const se=[],ae=new Map,$=new Map,Te=[];for(U=H;U--;){const Ae=C(h,g,U),B=o(Ae);let Z=m.get(B);Z?Te.push(()=>Z.p(Ae,i)):(Z=I(B,Ae),Z.c()),ae.set(B,se[U]=Z),B in ie&&$.set(B,Math.abs(U-ie[B]))}const Pe=new Set,ve=new Set;function De(Ae){be(Ae,1),Ae.m(u,E),m.set(Ae.key,Ae),E=Ae.first,H--}for(;P&&H;){const Ae=se[H-1],B=s[P-1],Z=Ae.key,Q=B.key;Ae===B?(E=Ae.first,P--,H--):ae.has(Q)?!m.has(Z)||Pe.has(Z)?De(Ae):ve.has(Q)?P--:$.get(Z)>$.get(Q)?(ve.add(Z),De(Ae)):(Pe.add(Q),P--):(w(B,m),P--)}for(;P--;){const Ae=s[P];ae.has(Ae.key)||w(Ae,m)}for(;H;)De(se[H-1]);return xn(Te),se}function hn(s,i,o){const a=s.$$.props[i];a!==void 0&&(s.$$.bound[a]=o,o(s.$$.ctx[a]))}function it(s){s&&s.c()}function et(s,i,o){const{fragment:a,after_update:h}=s.$$;a&&a.m(i,o),Ml(()=>{const g=s.$$.on_mount.map(B_).filter(sc);s.$$.on_destroy?s.$$.on_destroy.push(...g):xn(g),s.$$.on_mount=[]}),h.forEach(Ml)}function tt(s,i){const o=s.$$;o.fragment!==null&&(A1(o.after_update),xn(o.on_destroy),o.fragment&&o.fragment.d(i),o.on_destroy=o.fragment=null,o.ctx=[])}function R1(s,i){s.$$.dirty[0]===-1&&(yl.push(s),U_(),s.$$.dirty.fill(0)),s.$$.dirty[i/31|0]|=1<<i%31}function Gt(s,i,o,a,h,g,m=null,u=[-1]){const w=$u;Xu(s);const I=s.$$={fragment:null,ctx:[],props:g,update:Tt,not_equal:h,bound:xm(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(w?w.$$.context:[])),callbacks:xm(),dirty:u,skip_bound:!1,root:i.target||w.$$.root};m&&m(I.root);let E=!1;if(I.ctx=o?o(s,i.props||{},(C,P,...H)=>{const U=H.length?H[0]:P;return I.ctx&&h(I.ctx[C],I.ctx[C]=U)&&(!I.skip_bound&&I.bound[C]&&I.bound[C](U),E&&R1(s,C)),P}):[],I.update(),E=!0,xn(I.before_update),I.fragment=a?a(I.ctx):!1,i.target){if(i.hydrate){const C=M1(i.target);I.fragment&&I.fragment.l(C),C.forEach(Se)}else I.fragment&&I.fragment.c();i.intro&&be(s.$$.fragment),et(s,i.target,i.anchor),Z_()}Xu(w)}class Wt{constructor(){Sn(this,"$$");Sn(this,"$$set")}$destroy(){tt(this,1),this.$destroy=Tt}$on(i,o){if(!sc(o))return Tt;const a=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return a.push(o),()=>{const h=a.indexOf(o);h!==-1&&a.splice(h,1)}}$set(i){this.$$set&&!T1(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const B1="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(B1);const G_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAm0lEQVRIS+2U0Q2AIAxEYQM30Q3UDXQy3UhHkE0cweuHHxKTXpuQaALJ/cE9eoXGUHjFwv6hAtSEPxFRh2su0Ayd6pWzDUwFO8700AGNVggDaGAqkNYDYQBStBvCAtwQC8AF8QA2kORlJWjQmm4BSB9M5lIyC3CZswC3OQu4PxqVef7TmYikoSs0aQ19GyMMwDp+HvsrQI3v/xFduXoiGbi1DtQAAAAASUVORK5CYII=";let ai;function wl(s){const i=ai.__externref_table_alloc();return ai.__wbindgen_export_2.set(i,s),i}function wm(s,i){try{return s.apply(this,i)}catch(o){const a=wl(o);ai.__wbindgen_exn_store(a)}}const W_=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&W_.decode();let Zu=null;function Ku(){return(Zu===null||Zu.byteLength===0)&&(Zu=new Uint8Array(ai.memory.buffer)),Zu}function qr(s,i){return s=s>>>0,W_.decode(Ku().subarray(s,s+i))}let Ks=0;const Ih=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},F1=typeof Ih.encodeInto=="function"?function(s,i){return Ih.encodeInto(s,i)}:function(s,i){const o=Ih.encode(s);return i.set(o),{read:s.length,written:o.length}};function td(s,i,o){if(o===void 0){const u=Ih.encode(s),w=i(u.length,1)>>>0;return Ku().subarray(w,w+u.length).set(u),Ks=u.length,w}let a=s.length,h=i(a,1)>>>0;const g=Ku();let m=0;for(;m<a;m++){const u=s.charCodeAt(m);if(u>127)break;g[h+m]=u}if(m!==a){m!==0&&(s=s.slice(m)),h=o(h,a,a=m+s.length*3,1)>>>0;const u=Ku().subarray(h+m,h+a),w=F1(s,u);m+=w.written,h=o(h,a,m,1)>>>0}return Ks=m,h}let fa=null;function hs(){return(fa===null||fa.buffer.detached===!0||fa.buffer.detached===void 0&&fa.buffer!==ai.memory.buffer)&&(fa=new DataView(ai.memory.buffer)),fa}function qs(s){return s==null}function hd(s){const i=typeof s;if(i=="number"||i=="boolean"||s==null)return`${s}`;if(i=="string")return`"${s}"`;if(i=="symbol"){const h=s.description;return h==null?"Symbol":`Symbol(${h})`}if(i=="function"){const h=s.name;return typeof h=="string"&&h.length>0?`Function(${h})`:"Function"}if(Array.isArray(s)){const h=s.length;let g="[";h>0&&(g+=hd(s[0]));for(let m=1;m<h;m++)g+=", "+hd(s[m]);return g+="]",g}const o=/\[object ([^\]]+)\]/.exec(toString.call(s));let a;if(o&&o.length>1)a=o[1];else return toString.call(s);if(a=="Object")try{return"Object("+JSON.stringify(s)+")"}catch{return"Object"}return s instanceof Error?`${s.name}: ${s.message}
${s.stack}`:a}function O1(s,i){const o=i(s.length*1,1)>>>0;return Ku().set(s,o/1),Ks=s.length,o}function Zs(s){const i=ai.__wbindgen_export_2.get(s);return ai.__externref_table_dealloc(s),i}function N1(s,i){const o=i(s.length*4,4)>>>0;for(let a=0;a<s.length;a++){const h=wl(s[a]);hs().setUint32(o+4*a,h,!0)}return Ks=s.length,o}let Gu=null;function V1(){return(Gu===null||Gu.byteLength===0)&&(Gu=new Float64Array(ai.memory.buffer)),Gu}function j1(s,i){return s=s>>>0,V1().subarray(s/8,s/8+i)}const Sm=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>ai.__wbg_mapmodel_free(s>>>0,1));class km{__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,Sm.unregister(this),i}free(){const i=this.__destroy_into_raw();ai.__wbg_mapmodel_free(i,0)}constructor(i,o,a){const h=O1(o,ai.__wbindgen_malloc),g=Ks,m=ai.mapmodel_new(i,h,g,a);if(m[2])throw Zs(m[1]);return this.__wbg_ptr=m[0]>>>0,Sm.register(this,this.__wbg_ptr,this),this}render(){let i,o;try{const g=ai.mapmodel_render(this.__wbg_ptr);var a=g[0],h=g[1];if(g[3])throw a=0,h=0,Zs(g[2]);return i=a,o=h,qr(a,h)}finally{ai.__wbindgen_free(i,o,1)}}getCrossings(){let i,o;try{const g=ai.mapmodel_getCrossings(this.__wbg_ptr);var a=g[0],h=g[1];if(g[3])throw a=0,h=0,Zs(g[2]);return i=a,o=h,qr(a,h)}finally{ai.__wbindgen_free(i,o,1)}}getCrossingDistances(i){let o,a;try{const m=N1(i,ai.__wbindgen_malloc),u=Ks,w=ai.mapmodel_getCrossingDistances(this.__wbg_ptr,m,u);var h=w[0],g=w[1];if(w[3])throw h=0,g=0,Zs(w[2]);return o=h,a=g,qr(h,g)}finally{ai.__wbindgen_free(o,a,1)}}compareRoute(i){let o,a;try{const m=ai.mapmodel_compareRoute(this.__wbg_ptr,i);var h=m[0],g=m[1];if(m[3])throw h=0,g=0,Zs(m[2]);return o=h,a=g,qr(h,g)}finally{ai.__wbindgen_free(o,a,1)}}isochrone(i){let o,a;try{const m=ai.mapmodel_isochrone(this.__wbg_ptr,i);var h=m[0],g=m[1];if(m[3])throw h=0,g=0,Zs(m[2]);return o=h,a=g,qr(h,g)}finally{ai.__wbindgen_free(o,a,1)}}scoreDetours(){let i,o;try{const g=ai.mapmodel_scoreDetours(this.__wbg_ptr);var a=g[0],h=g[1];if(g[3])throw a=0,h=0,Zs(g[2]);return i=a,o=h,qr(a,h)}finally{ai.__wbindgen_free(i,o,1)}}getInvertedBoundary(){let i,o;try{const g=ai.mapmodel_getInvertedBoundary(this.__wbg_ptr);var a=g[0],h=g[1];if(g[3])throw a=0,h=0,Zs(g[2]);return i=a,o=h,qr(a,h)}finally{ai.__wbindgen_free(i,o,1)}}getBounds(){const i=ai.mapmodel_getBounds(this.__wbg_ptr);var o=j1(i[0],i[1]).slice();return ai.__wbindgen_free(i[0],i[1]*8,8),o}findConnectedComponents(){let i,o;try{const g=ai.mapmodel_findConnectedComponents(this.__wbg_ptr);var a=g[0],h=g[1];if(g[3])throw a=0,h=0,Zs(g[2]);return i=a,o=h,qr(a,h)}finally{ai.__wbindgen_free(i,o,1)}}}async function U1(s,i){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,i)}catch(a){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",a);else throw a}const o=await s.arrayBuffer();return await WebAssembly.instantiate(o,i)}else{const o=await WebAssembly.instantiate(s,i);return o instanceof WebAssembly.Instance?{instance:o,module:s}:o}}function q1(){const s={};return s.wbg={},s.wbg.__wbg_buffer_609cc3eee51ed158=function(i){return i.buffer},s.wbg.__wbg_call_672a4d21634d4a24=function(){return wm(function(i,o){return i.call(o)},arguments)},s.wbg.__wbg_call_7cccdd69e0791ae2=function(){return wm(function(i,o,a){return i.call(o,a)},arguments)},s.wbg.__wbg_debug_3cb59063b29f58c1=function(i){console.debug(i)},s.wbg.__wbg_entries_3265d4158b33e5dc=function(i){return Object.entries(i)},s.wbg.__wbg_error_524f506f44df1645=function(i){console.error(i)},s.wbg.__wbg_error_7534b8e9a36f1ab4=function(i,o){let a,h;try{a=i,h=o,console.error(qr(i,o))}finally{ai.__wbindgen_free(a,h,1)}},s.wbg.__wbg_get_b9b93047fe3cf45b=function(i,o){return i[o>>>0]},s.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(i,o){return i[o]},s.wbg.__wbg_info_3daf2e093e091b66=function(i){console.info(i)},s.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(i){let o;try{o=i instanceof ArrayBuffer}catch{o=!1}return o},s.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(i){let o;try{o=i instanceof Uint8Array}catch{o=!1}return o},s.wbg.__wbg_isSafeInteger_343e2beeeece1bb0=function(i){return Number.isSafeInteger(i)},s.wbg.__wbg_length_a446193dc22c12f8=function(i){return i.length},s.wbg.__wbg_length_e2d2a49132c1b256=function(i){return i.length},s.wbg.__wbg_log_c222819a41e063d3=function(i){console.log(i)},s.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},s.wbg.__wbg_new_a12002a7f91c75be=function(i){return new Uint8Array(i)},s.wbg.__wbg_newnoargs_105ed471475aaf50=function(i,o){return new Function(qr(i,o))},s.wbg.__wbg_now_2c95c9de01293173=function(i){return i.now()},s.wbg.__wbg_performance_7a3ffd0b17f663ad=function(i){return i.performance},s.wbg.__wbg_set_65595bdd868b3009=function(i,o,a){i.set(o,a>>>0)},s.wbg.__wbg_stack_0ed75d68575b0f3c=function(i,o){const a=o.stack,h=td(a,ai.__wbindgen_malloc,ai.__wbindgen_realloc),g=Ks;hs().setInt32(i+4*1,g,!0),hs().setInt32(i+4*0,h,!0)},s.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const i=typeof global>"u"?null:global;return qs(i)?0:wl(i)},s.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const i=typeof globalThis>"u"?null:globalThis;return qs(i)?0:wl(i)},s.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const i=typeof self>"u"?null:self;return qs(i)?0:wl(i)},s.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const i=typeof window>"u"?null:window;return qs(i)?0:wl(i)},s.wbg.__wbg_warn_4ca3906c248c47c4=function(i){console.warn(i)},s.wbg.__wbindgen_as_number=function(i){return+i},s.wbg.__wbindgen_bigint_from_u64=function(i){return BigInt.asUintN(64,i)},s.wbg.__wbindgen_bigint_get_as_i64=function(i,o){const a=o,h=typeof a=="bigint"?a:void 0;hs().setBigInt64(i+8*1,qs(h)?BigInt(0):h,!0),hs().setInt32(i+4*0,!qs(h),!0)},s.wbg.__wbindgen_boolean_get=function(i){const o=i;return typeof o=="boolean"?o?1:0:2},s.wbg.__wbindgen_debug_string=function(i,o){const a=hd(o),h=td(a,ai.__wbindgen_malloc,ai.__wbindgen_realloc),g=Ks;hs().setInt32(i+4*1,g,!0),hs().setInt32(i+4*0,h,!0)},s.wbg.__wbindgen_error_new=function(i,o){return new Error(qr(i,o))},s.wbg.__wbindgen_in=function(i,o){return i in o},s.wbg.__wbindgen_init_externref_table=function(){const i=ai.__wbindgen_export_2,o=i.grow(4);i.set(0,void 0),i.set(o+0,void 0),i.set(o+1,null),i.set(o+2,!0),i.set(o+3,!1)},s.wbg.__wbindgen_is_bigint=function(i){return typeof i=="bigint"},s.wbg.__wbindgen_is_object=function(i){const o=i;return typeof o=="object"&&o!==null},s.wbg.__wbindgen_is_string=function(i){return typeof i=="string"},s.wbg.__wbindgen_is_undefined=function(i){return i===void 0},s.wbg.__wbindgen_jsval_eq=function(i,o){return i===o},s.wbg.__wbindgen_jsval_loose_eq=function(i,o){return i==o},s.wbg.__wbindgen_memory=function(){return ai.memory},s.wbg.__wbindgen_number_get=function(i,o){const a=o,h=typeof a=="number"?a:void 0;hs().setFloat64(i+8*1,qs(h)?0:h,!0),hs().setInt32(i+4*0,!qs(h),!0)},s.wbg.__wbindgen_string_get=function(i,o){const a=o,h=typeof a=="string"?a:void 0;var g=qs(h)?0:td(h,ai.__wbindgen_malloc,ai.__wbindgen_realloc),m=Ks;hs().setInt32(i+4*1,m,!0),hs().setInt32(i+4*0,g,!0)},s.wbg.__wbindgen_string_new=function(i,o){return qr(i,o)},s.wbg.__wbindgen_throw=function(i,o){throw new Error(qr(i,o))},s}function Z1(s,i){return ai=s.exports,H_.__wbindgen_wasm_module=i,fa=null,Gu=null,Zu=null,ai.__wbindgen_start(),ai}async function H_(s){if(ai!==void 0)return ai;typeof s<"u"&&(Object.getPrototypeOf(s)===Object.prototype?{module_or_path:s}=s:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof s>"u"&&(s=new URL("/severance_snape/assets/backend_bg-FZGdOrRF.wasm",import.meta.url));const i=q1();(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:o,module:a}=await U1(await s,i);return Z1(o,a)}const ml=[];function id(s,i){return{subscribe:qi(s,i).subscribe}}function qi(s,i=Tt){let o;const a=new Set;function h(u){if(Nt(s,u)&&(s=u,o)){const w=!ml.length;for(const I of a)I[1](),ml.push(I,s);if(w){for(let I=0;I<ml.length;I+=2)ml[I][0](ml[I+1]);ml.length=0}}}function g(u){h(u(s))}function m(u,w=Tt){const I=[u,w];return a.add(I),a.size===1&&(o=i(h,g)||Tt),u(s),()=>{a.delete(I),a.size===0&&o&&(o(),o=null)}}return{set:h,update:g,subscribe:m}}let G1=Date.now();function Pl(s){return`${s}-${G1++}`}const Ed=Symbol.for("svelte-maplibre");function Do(){return V_(Ed)}function W1(s){let i=new WeakMap;return o=>{var m;let a=i.get(o.originalEvent);if(a!==void 0)return a;let g=(m=o.target.queryRenderedFeatures(o.point).find(u=>{var w;return(w=s.get(u.layer.id))==null?void 0:w.interactive}))==null?void 0:m.layer.id;return i.set(o.originalEvent,g),g}}function H1(){let s=new Map;return Id(Ed,{map:qi(null),source:id(null),layer:id(null),popupTarget:id(null),cluster:qi(),loadedImages:qi(new Set),minzoom:qi(0),maxzoom:qi(24),layerEvent:qi(null),layerInfo:s,eventTopMost:W1(s),markerClickManager:new Q1})}function Tm(s){return{subscribe:s.subscribe}}function Md({key:s,setPopupTarget:i=!1,setCluster:o=!1,setMouseEvent:a=!1}){let h=Do(),g=qi(null),m=Tm(g),u={...h,[s]:Tm(g)};if(i&&(u.popupTarget=m),a){let w=qi(null);u.layerEvent=w,h.layerEvent=w}return o&&(u.cluster=qi()),Id(Ed,u),{...h,self:g}}function X1(){return Md({key:"source",setCluster:!0})}function K1(s=!0){return Md({key:"layer",setPopupTarget:s,setMouseEvent:s})}function J1(){return Md({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function Y1(s){return"layerType"in s&&s.layerType==="deckgl"}class Q1{constructor(){Sn(this,"_handlers",new Set)}add(i){this._handlers.add(i)}remove(i){this._handlers.delete(i)}handleClick(i){for(const o of this._handlers)o(i)}}var $1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ev(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var X_={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(s,i){(function(o,a){s.exports=a()})($1,function(){var o={},a={};function h(m,u,w){if(a[m]=w,m==="index"){var I="var sharedModule = {}; ("+a.shared+")(sharedModule); ("+a.worker+")(sharedModule);",E={};return a.shared(E),a.index(o,E),typeof window<"u"&&o.setWorkerUrl(window.URL.createObjectURL(new Blob([I],{type:"text/javascript"}))),o}}h("shared",["exports"],function(m){function u(n,t,r,c){return new(r||(r=Promise))(function(p,v){function b(L){try{k(c.next(L))}catch(A){v(A)}}function x(L){try{k(c.throw(L))}catch(A){v(A)}}function k(L){var A;L.done?p(L.value):(A=L.value,A instanceof r?A:new r(function(R){R(A)})).then(b,x)}k((c=c.apply(n,t||[])).next())})}function w(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var I=E;function E(n,t){this.x=n,this.y=t}E.prototype={clone:function(){return new E(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),r=Math.sin(n),c=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=c,this},_rotateAround:function(n,t){var r=Math.cos(n),c=Math.sin(n),p=t.y+c*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-c*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},E.convert=function(n){return n instanceof E?n:Array.isArray(n)?new E(n[0],n[1]):n};var C=w(I),P=H;function H(n,t,r,c){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=c}H.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,c=0;c<8;c++){var p=this.sampleCurveX(r)-n;if(Math.abs(p)<t)return r;var v=this.sampleCurveDerivativeX(r);if(Math.abs(v)<1e-6)break;r-=p/v}var b=0,x=1;for(r=n,c=0;c<20&&(p=this.sampleCurveX(r),!(Math.abs(p-n)<t));c++)n>p?b=r:x=r,r=.5*(x-b)+b;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var U=w(P);let ie,se;function ae(){return ie==null&&(ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ie}function $(){if(se==null&&(se=!1,ae())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<5*5;c++){const p=4*c;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&r[c]!==c){se=!0;break}}}return se||!1}function Te(n,t,r,c){const p=new U(n,t,r,c);return v=>p.solve(v)}const Pe=Te(.25,.1,.25,1);function ve(n,t,r){return Math.min(r,Math.max(t,n))}function De(n,t,r){const c=r-t,p=((n-t)%c+c)%c+t;return p===t?r:p}function Ae(n,...t){for(const r of t)for(const c in r)n[c]=r[c];return n}let B=1;function Z(n,t,r){const c={};for(const p in n)c[p]=t.call(this,n[p],p,n);return c}function Q(n,t,r){const c={};for(const p in n)t.call(this,n[p],p,n)&&(c[p]=n[p]);return c}function D(n){return Array.isArray(n)?n.map(D):typeof n=="object"&&n?Z(n,D):n}const N={};function ee(n){N[n]||(typeof console<"u"&&console.warn(n),N[n]=!0)}function me(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function ne(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let pe=null;function Ce(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function qe(n,t,r,c,p){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(n,{timestamp:0});try{const b=v==null?void 0:v.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const x=b.startsWith("BGR"),k=new Uint8ClampedArray(c*p*4);if(yield v.copyTo(k,function(L,A,R,V,G){const X=4*Math.max(-A,0),K=(Math.max(0,R)-R)*V*4+X,ce=4*V,_e=Math.max(0,A),Ue=Math.max(0,R);return{rect:{x:_e,y:Ue,width:Math.min(L.width,A+V)-_e,height:Math.min(L.height,R+G)-Ue},layout:[{offset:K,stride:ce}]}}(n,t,r,c,p)),x)for(let L=0;L<k.length;L+=4){const A=k[L];k[L]=k[L+2],k[L+2]=A}return k}finally{v.close()}})}let nt,lt;const at="AbortError";function ut(){return new Error(at)}const St={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function It(n){return St.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const st="global-dispatcher";class Lt extends Error{constructor(t,r,c,p){super(`AJAXError: ${r} (${t}): ${c}`),this.status=t,this.statusText=r,this.url=c,this.body=p}}const wi=()=>ne(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Di=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const c=It(n.url);if(c)return c(n,t);if(ne(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:st},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(wi())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(c,p){return u(this,void 0,void 0,function*(){const v=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:wi(),signal:p.signal});c.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");const b=yield fetch(v);if(!b.ok){const L=yield b.blob();throw new Lt(b.status,b.statusText,c.url,L)}let x;x=c.type==="arrayBuffer"||c.type==="image"?b.arrayBuffer():c.type==="json"?b.json():b.text();const k=yield x;if(p.signal.aborted)throw ut();return{data:k,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(n,t);if(ne(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:st},t)}var r;return function(c,p){return new Promise((v,b)=>{var x;const k=new XMLHttpRequest;k.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(k.responseType="arraybuffer");for(const L in c.headers)k.setRequestHeader(L,c.headers[L]);c.type==="json"&&(k.responseType="text",!((x=c.headers)===null||x===void 0)&&x.Accept||k.setRequestHeader("Accept","application/json")),k.withCredentials=c.credentials==="include",k.onerror=()=>{b(new Error(k.statusText))},k.onload=()=>{if(!p.signal.aborted)if((k.status>=200&&k.status<300||k.status===0)&&k.response!==null){let L=k.response;if(c.type==="json")try{L=JSON.parse(k.response)}catch(A){return void b(A)}v({data:L,cacheControl:k.getResponseHeader("Cache-Control"),expires:k.getResponseHeader("Expires")})}else{const L=new Blob([k.response],{type:k.getResponseHeader("Content-Type")});b(new Lt(k.status,k.statusText,c.url,L))}},p.signal.addEventListener("abort",()=>{k.abort(),b(ut())}),k.send(c.body)})}(n,t)};function Zi(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function _i(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function Si(n,t,r){if(r&&r[n]){const c=r[n].indexOf(t);c!==-1&&r[n].splice(c,1)}}class Ne{constructor(t,r={}){Ae(this,r),this.type=t}}class yt extends Ne{constructor(t,r={}){super("error",Ae({error:t},r))}}class Qt{on(t,r){return this._listeners=this._listeners||{},_i(t,r,this._listeners),this}off(t,r){return Si(t,r,this._listeners),Si(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},_i(t,r,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,r){typeof t=="string"&&(t=new Ne(t,r||{}));const c=t.type;if(this.listens(c)){t.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of p)x.call(this,t);const v=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of v)Si(c,x,this._oneTimeListeners),x.call(this,t);const b=this._eventedParent;b&&(Ae(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(t))}else t instanceof yt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var je={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const $e=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ei(n,t){const r={};for(const c in n)c!=="ref"&&(r[c]=n[c]);return $e.forEach(c=>{c in t&&(r[c]=t[c])}),r}function Ge(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!Ge(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!Ge(n[r],t[r]))return!1;return!0}return n===t}function Vt(n,t){n.push(t)}function Ri(n,t,r){Vt(r,{command:"addSource",args:[n,t[n]]})}function jn(n,t,r){Vt(t,{command:"removeSource",args:[n]}),r[n]=!0}function Ir(n,t,r,c){jn(n,r,c),Ri(n,t,r)}function si(n,t,r){let c;for(c in n[r])if(Object.prototype.hasOwnProperty.call(n[r],c)&&c!=="data"&&!Ge(n[r][c],t[r][c]))return!1;for(c in t[r])if(Object.prototype.hasOwnProperty.call(t[r],c)&&c!=="data"&&!Ge(n[r][c],t[r][c]))return!1;return!0}function Mi(n,t,r,c,p,v){n=n||{},t=t||{};for(const b in n)Object.prototype.hasOwnProperty.call(n,b)&&(Ge(n[b],t[b])||r.push({command:v,args:[c,b,t[b],p]}));for(const b in t)Object.prototype.hasOwnProperty.call(t,b)&&!Object.prototype.hasOwnProperty.call(n,b)&&(Ge(n[b],t[b])||r.push({command:v,args:[c,b,t[b],p]}))}function Ut(n){return n.id}function ps(n,t){return n[t.id]=t,n}class ot{constructor(t,r,c,p){this.message=(t?`${t}: `:"")+c,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function fi(n,...t){for(const r of t)for(const c in r)n[c]=r[c];return n}class Hi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Un{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[c,p]of r)this.bindings[c]=p}concat(t){return new Un(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Pn={kind:"null"},ht={kind:"number"},ii={kind:"string"},Ht={kind:"boolean"},tn={kind:"color"},or={kind:"object"},Xt={kind:"value"},ar={kind:"collator"},lr={kind:"formatted"},gr={kind:"padding"},_r={kind:"resolvedImage"},de={kind:"variableAnchorOffsetCollection"};function j(n,t){return{kind:"array",itemType:n,N:t}}function q(n){if(n.kind==="array"){const t=q(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const J=[Pn,ht,ii,Ht,tn,lr,or,j(Xt),gr,_r,de];function le(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!le(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of J)if(!le(r,t))return null}}return`Expected ${q(n)} but found ${q(t)} instead.`}function Ee(n,t){return t.some(r=>r.kind===n.kind)}function Re(n,t){return t.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function Ve(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const we=.96422,Ke=.82521,Qe=4/29,We=6/29,dt=3*We*We,Ft=We*We*We,jt=Math.PI/180,yi=180/Math.PI;function ni(n){return(n%=360)<0&&(n+=360),n}function vi([n,t,r,c]){let p,v;const b=fn((.2225045*(n=li(n))+.7168786*(t=li(t))+.0606169*(r=li(r)))/1);n===t&&t===r?p=v=b:(p=fn((.4360747*n+.3850649*t+.1430804*r)/we),v=fn((.0139322*n+.0971045*t+.7141733*r)/Ke));const x=116*b-16;return[x<0?0:x,500*(p-b),200*(b-v),c]}function li(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function fn(n){return n>Ft?Math.pow(n,1/3):n/dt+Qe}function en([n,t,r,c]){let p=(n+16)/116,v=isNaN(t)?p:p+t/500,b=isNaN(r)?p:p-r/200;return p=1*Yt(p),v=we*Yt(v),b=Ke*Yt(b),[Be(3.1338561*v-1.6168667*p-.4906146*b),Be(-.9787684*v+1.9161415*p+.033454*b),Be(.0719453*v-.2289914*p+1.4052427*b),c]}function Be(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Yt(n){return n>We?n*n*n:dt*(n-Qe)}function ri(n){return parseInt(n.padEnd(2,n),16)/255}function Pi(n,t){return zi(t?n/100:n,0,1)}function zi(n,t,r){return Math.min(Math.max(t,n),r)}function Xi(n){return!n.some(Number.isNaN)}const qn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qt{constructor(t,r,c,p=1,v=!0){this.r=t,this.g=r,this.b=c,this.a=p,v||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,r,c,p]))}static parse(t){if(t instanceof qt)return t;if(typeof t!="string")return;const r=function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=qn[c];if(p){const[b,x,k]=p;return[b/255,x/255,k/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const b=c.length<6?1:2;let x=1;return[ri(c.slice(x,x+=b)),ri(c.slice(x,x+=b)),ri(c.slice(x,x+=b)),ri(c.slice(x,x+b)||"ff")]}if(c.startsWith("rgb")){const b=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[x,k,L,A,R,V,G,X,K,ce,_e,Ue]=b,Me=[A||" ",G||" ",ce].join("");if(Me==="  "||Me==="  /"||Me===",,"||Me===",,,"){const Oe=[L,V,K].join(""),Xe=Oe==="%%%"?100:Oe===""?255:0;if(Xe){const rt=[zi(+k/Xe,0,1),zi(+R/Xe,0,1),zi(+X/Xe,0,1),_e?Pi(+_e,Ue):1];if(Xi(rt))return rt}}return}}const v=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[b,x,k,L,A,R,V,G,X]=v,K=[k||" ",A||" ",V].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const ce=[+x,zi(+L,0,100),zi(+R,0,100),G?Pi(+G,X):1];if(Xi(ce))return function([_e,Ue,Me,Oe]){function Xe(rt){const wt=(rt+_e/30)%12,Zt=Ue*Math.min(Me,1-Me);return Me-Zt*Math.max(-1,Math.min(wt-3,9-wt,1))}return _e=ni(_e),Ue/=100,Me/=100,[Xe(0),Xe(8),Xe(4),Oe]}(ce)}}}(t);return r?new qt(...r,!1):void 0}get rgb(){const{r:t,g:r,b:c,a:p}=this,v=p||1/0;return this.overwriteGetter("rgb",[t/v,r/v,c/v,p])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,c,p,v]=vi(t),b=Math.sqrt(c*c+p*p);return[Math.round(1e4*b)?ni(Math.atan2(p,c)*yi):NaN,b,r,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",vi(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,c,p]=this.rgb;return`rgba(${[t,r,c].map(v=>Math.round(255*v)).join(",")},${p})`}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class rs{constructor(t,r,c){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class An{constructor(t,r,c,p,v){this.text=t,this.image=r,this.scale=c,this.fontStack=p,this.textColor=v}}class En{constructor(t){this.sections=t}static fromString(t){return new En([new An(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof En?t:En.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class nn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof nn)return t;if(typeof t=="number")return new nn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new nn(t)}}toString(){return JSON.stringify(this.values)}}const va=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class kn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof kn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const c=t[r],p=t[r+1];if(typeof c!="string"||!va.has(c)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new kn(t)}}toString(){return JSON.stringify(this.values)}}class Zn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Zn({name:t,available:!1}):null}}function Er(n,t,r,c){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[n,t,r,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[n,t,r,c]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ur(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof qt||n instanceof rs||n instanceof En||n instanceof nn||n instanceof kn||n instanceof Zn)return!0;if(Array.isArray(n)){for(const t of n)if(!ur(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!ur(n[t]))return!1;return!0}return!1}function bi(n){if(n===null)return Pn;if(typeof n=="string")return ii;if(typeof n=="boolean")return Ht;if(typeof n=="number")return ht;if(n instanceof qt)return tn;if(n instanceof rs)return ar;if(n instanceof En)return lr;if(n instanceof nn)return gr;if(n instanceof kn)return de;if(n instanceof Zn)return _r;if(Array.isArray(n)){const t=n.length;let r;for(const c of n){const p=bi(c);if(r){if(r===p)continue;r=Xt;break}r=p}return j(r||Xt,t)}return or}function Bo(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof qt||n instanceof En||n instanceof nn||n instanceof kn||n instanceof Zn?n.toString():JSON.stringify(n)}class Mr{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ur(t[1]))return r.error("invalid value");const c=t[1];let p=bi(c);const v=r.expectedType;return p.kind!=="array"||p.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(p=v),new Mr(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class gn{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ba={string:ii,number:ht,boolean:Ht,object:or};class Lr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c,p=1;const v=t[0];if(v==="array"){let x,k;if(t.length>2){const L=t[1];if(typeof L!="string"||!(L in ba)||L==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=ba[L],p++}else x=Xt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);k=t[2],p++}c=j(x,k)}else{if(!ba[v])throw new Error(`Types doesn't contain name = ${v}`);c=ba[v]}const b=[];for(;p<t.length;p++){const x=r.parse(t[p],p,Xt);if(!x)return null;b.push(x)}return new Lr(c,b)}evaluate(t){for(let r=0;r<this.args.length;r++){const c=this.args[r].evaluate(t);if(!le(this.type,bi(c)))return c;if(r===this.args.length-1)throw new gn(`Expected value to be of type ${q(this.type)}, but found ${q(bi(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const zl={"to-boolean":Ht,"to-color":tn,"to-number":ht,"to-string":ii};class Pr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[0];if(!zl[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return r.error("Expected one argument.");const p=zl[c],v=[];for(let b=1;b<t.length;b++){const x=r.parse(t[b],b,Xt);if(!x)return null;v.push(x)}return new Pr(p,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,c;for(const p of this.args){if(r=p.evaluate(t),c=null,r instanceof qt)return r;if(typeof r=="string"){const v=t.parseColor(r);if(v)return v}else if(Array.isArray(r)&&(c=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Er(r[0],r[1],r[2],r[3]),!c))return new qt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new gn(c||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const c of this.args){r=c.evaluate(t);const p=nn.parse(r);if(p)return p}throw new gn(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const c of this.args){r=c.evaluate(t);const p=kn.parse(r);if(p)return p}throw new gn(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const c of this.args){if(r=c.evaluate(t),r===null)return 0;const p=Number(r);if(!isNaN(p))return p}throw new gn(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return En.fromString(Bo(this.args[0].evaluate(t)));case"resolvedImage":return Zn.fromString(Bo(this.args[0].evaluate(t)));default:return Bo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Nh=["Unknown","Point","LineString","Polygon"];class xa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Nh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=qt.parse(t)),r}}class Is{constructor(t,r,c=[],p,v=new Un,b=[]){this.registry=t,this.path=c,this.key=c.map(x=>`[${x}]`).join(""),this.scope=v,this.errors=b,this.expectedType=p,this._isConstant=r}parse(t,r,c,p,v={}){return r?this.concat(r,c,p)._parse(t,v):this._parse(t,v)}_parse(t,r){function c(p,v,b){return b==="assert"?new Lr(v,[p]):b==="coerce"?new Pr(v,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[p];if(v){let b=v.parse(t,this);if(!b)return null;if(this.expectedType){const x=this.expectedType,k=b.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||k.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(x.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array")if(x.kind!=="variableAnchorOffsetCollection"||k.kind!=="value"&&k.kind!=="array"){if(this.checkSubtype(x,k))return null}else b=c(b,x,r.typeAnnotation||"coerce");else b=c(b,x,r.typeAnnotation||"coerce");else b=c(b,x,r.typeAnnotation||"coerce");else b=c(b,x,r.typeAnnotation||"assert")}if(!(b instanceof Mr)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const x=new xa;try{b=new Mr(b.type,b.evaluate(x))}catch(k){return this.error(k.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,c){const p=typeof t=="number"?this.path.concat(t):this.path,v=c?this.scope.concat(c):this.scope;return new Is(this.registry,this._isConstant,p,r||null,v,this.errors)}error(t,...r){const c=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new Hi(c,t))}checkSubtype(t,r){const c=le(t,r);return c&&this.error(c),c}}class ms{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let v=1;v<t.length-1;v+=2){const b=t[v];if(typeof b!="string")return r.error(`Expected string, but found ${typeof b} instead.`,v);if(/[^a-zA-Z0-9_]/.test(b))return r.error("Variable names must contain only alphanumeric characters or '_'.",v);const x=r.parse(t[v+1],v+1);if(!x)return null;c.push([b,x])}const p=r.parse(t[t.length-1],t.length-1,r.expectedType,c);return p?new ms(c,p):null}outputDefined(){return this.result.outputDefined()}}class Li{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const c=t[1];return r.scope.has(c)?new Li(c,r.scope.get(c)):r.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Dl{constructor(t,r,c){this.type=t,this.index=r,this.input=c}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,ht),p=r.parse(t[2],2,j(r.expectedType||Xt));return c&&p?new Dl(p.type.itemType,c,p):null}evaluate(t){const r=this.index.evaluate(t),c=this.input.evaluate(t);if(r<0)throw new gn(`Array index out of bounds: ${r} < 0.`);if(r>=c.length)throw new gn(`Array index out of bounds: ${r} > ${c.length-1}.`);if(r!==Math.floor(r))throw new gn(`Array index must be an integer, but found ${r} instead.`);return c[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Rl{constructor(t,r){this.type=Ht,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Xt),p=r.parse(t[2],2,Xt);return c&&p?Ee(c.type,[Ht,ii,ht,Pn,Xt])?new Rl(c,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${q(c.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!Re(r,["boolean","string","number","null"]))throw new gn(`Expected first argument to be of type boolean, string, number or null, but found ${q(bi(r))} instead.`);if(!Re(c,["string","array"]))throw new gn(`Expected second argument to be of type array or string, but found ${q(bi(c))} instead.`);return c.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Qs{constructor(t,r,c){this.type=ht,this.needle=t,this.haystack=r,this.fromIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Xt),p=r.parse(t[2],2,Xt);if(!c||!p)return null;if(!Ee(c.type,[Ht,ii,ht,Pn,Xt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${q(c.type)} instead`);if(t.length===4){const v=r.parse(t[3],3,ht);return v?new Qs(c,p,v):null}return new Qs(c,p)}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Re(r,["boolean","string","number","null"]))throw new gn(`Expected first argument to be of type boolean, string, number or null, but found ${q(bi(r))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(t)),Re(c,["string"])){const v=c.indexOf(r,p);return v===-1?-1:[...c.slice(0,v)].length}if(Re(c,["array"]))return c.indexOf(r,p);throw new gn(`Expected second argument to be of type array or string, but found ${q(bi(c))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Bl{constructor(t,r,c,p,v,b){this.inputType=t,this.type=r,this.input=c,this.cases=p,this.outputs=v,this.otherwise=b}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let c,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);const v={},b=[];for(let L=2;L<t.length-1;L+=2){let A=t[L];const R=t[L+1];Array.isArray(A)||(A=[A]);const V=r.concat(L);if(A.length===0)return V.error("Expected at least one branch label.");for(const X of A){if(typeof X!="number"&&typeof X!="string")return V.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return V.error("Numeric branch labels must be integer values.");if(c){if(V.checkSubtype(c,bi(X)))return null}else c=bi(X);if(v[String(X)]!==void 0)return V.error("Branch labels must be unique.");v[String(X)]=b.length}const G=r.parse(R,L,p);if(!G)return null;p=p||G.type,b.push(G)}const x=r.parse(t[1],1,Xt);if(!x)return null;const k=r.parse(t[t.length-1],t.length-1,p);return k?x.type.kind!=="value"&&r.concat(1).checkSubtype(c,x.type)?null:new Bl(c,p,x,v,b,k):null}evaluate(t){const r=this.input.evaluate(t);return(bi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class wa{constructor(t,r,c){this.type=t,this.branches=r,this.otherwise=c}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const p=[];for(let b=1;b<t.length-1;b+=2){const x=r.parse(t[b],b,Ht);if(!x)return null;const k=r.parse(t[b+1],b+1,c);if(!k)return null;p.push([x,k]),c=c||k.type}const v=r.parse(t[t.length-1],t.length-1,c);if(!v)return null;if(!c)throw new Error("Can't infer output type");return new wa(c,p,v)}evaluate(t){for(const[r,c]of this.branches)if(r.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,c]of this.branches)t(r),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Fo{constructor(t,r,c,p){this.type=t,this.input=r,this.beginIndex=c,this.endIndex=p}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Xt),p=r.parse(t[2],2,ht);if(!c||!p)return null;if(!Ee(c.type,[j(Xt),ii,Xt]))return r.error(`Expected first argument to be of type array or string, but found ${q(c.type)} instead`);if(t.length===4){const v=r.parse(t[3],3,ht);return v?new Fo(c.type,c,p,v):null}return new Fo(c.type,c,p)}evaluate(t){const r=this.input.evaluate(t),c=this.beginIndex.evaluate(t);let p;if(this.endIndex&&(p=this.endIndex.evaluate(t)),Re(r,["string"]))return[...r].slice(c,p).join("");if(Re(r,["array"]))return r.slice(c,p);throw new gn(`Expected first argument to be of type array or string, but found ${q(bi(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Sa(n,t){const r=n.length-1;let c,p,v=0,b=r,x=0;for(;v<=b;)if(x=Math.floor((v+b)/2),c=n[x],p=n[x+1],c<=t){if(x===r||t<p)return x;v=x+1}else{if(!(c>t))throw new gn("Input is not a number.");b=x-1}return 0}class $s{constructor(t,r,c){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[p,v]of c)this.labels.push(p),this.outputs.push(v)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const c=r.parse(t[1],1,ht);if(!c)return null;const p=[];let v=null;r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let b=1;b<t.length;b+=2){const x=b===1?-1/0:t[b],k=t[b+1],L=b,A=b+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(p.length&&p[p.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const R=r.parse(k,A,v);if(!R)return null;v=v||R.type,p.push([x,R])}return new $s(v,c,p)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=r[0])return c[0].evaluate(t);const v=r.length;return p>=r[v-1]?c[v-1].evaluate(t):c[Sa(r,p)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function fc(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Vh=dc;function dc(n,t,r,c){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=c}dc.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,c=0;c<8;c++){var p=this.sampleCurveX(r)-n;if(Math.abs(p)<t)return r;var v=this.sampleCurveDerivativeX(r);if(Math.abs(v)<1e-6)break;r-=p/v}var b=0,x=1;for(r=n,c=0;c<20&&(p=this.sampleCurveX(r),!(Math.abs(p-n)<t));c++)n>p?b=r:x=r,r=.5*(x-b)+b;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var jh=fc(Vh);function Es(n,t,r){return n+r*(t-n)}function Oo(n,t,r){return n.map((c,p)=>Es(c,t[p],r))}const Jn={number:Es,color:function(n,t,r,c="rgb"){switch(c){case"rgb":{const[p,v,b,x]=Oo(n.rgb,t.rgb,r);return new qt(p,v,b,x,!1)}case"hcl":{const[p,v,b,x]=n.hcl,[k,L,A,R]=t.hcl;let V,G;if(isNaN(p)||isNaN(k))isNaN(p)?isNaN(k)?V=NaN:(V=k,b!==1&&b!==0||(G=L)):(V=p,A!==1&&A!==0||(G=v));else{let Ue=k-p;k>p&&Ue>180?Ue-=360:k<p&&p-k>180&&(Ue+=360),V=p+r*Ue}const[X,K,ce,_e]=function([Ue,Me,Oe,Xe]){return Ue=isNaN(Ue)?0:Ue*jt,en([Oe,Math.cos(Ue)*Me,Math.sin(Ue)*Me,Xe])}([V,G??Es(v,L,r),Es(b,A,r),Es(x,R,r)]);return new qt(X,K,ce,_e,!1)}case"lab":{const[p,v,b,x]=en(Oo(n.lab,t.lab,r));return new qt(p,v,b,x,!1)}}},array:Oo,padding:function(n,t,r){return new nn(Oo(n.values,t.values,r))},variableAnchorOffsetCollection:function(n,t,r){const c=n.values,p=t.values;if(c.length!==p.length)throw new gn(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const v=[];for(let b=0;b<c.length;b+=2){if(c[b]!==p[b])throw new gn(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${c[b]}, to[${b}]: ${p[b]}`);v.push(c[b]);const[x,k]=c[b+1],[L,A]=p[b+1];v.push([Es(x,L,r),Es(k,A,r)])}return new kn(v)}};class Yn{constructor(t,r,c,p,v){this.type=t,this.operator=r,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[b,x]of v)this.labels.push(b),this.outputs.push(x)}static interpolationFactor(t,r,c,p){let v=0;if(t.name==="exponential")v=ka(r,t.base,c,p);else if(t.name==="linear")v=ka(r,1,c,p);else if(t.name==="cubic-bezier"){const b=t.controlPoints;v=new jh(b[0],b[1],b[2],b[3]).solve(ka(r,1,c,p))}return v}static parse(t,r){let[c,p,v,...b]=t;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const L=p[1];if(typeof L!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:L}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const L=p.slice(1);if(L.length!==4||L.some(A=>typeof A!="number"||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:L}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(v=r.parse(v,2,ht),!v)return null;const x=[];let k=null;c==="interpolate-hcl"||c==="interpolate-lab"?k=tn:r.expectedType&&r.expectedType.kind!=="value"&&(k=r.expectedType);for(let L=0;L<b.length;L+=2){const A=b[L],R=b[L+1],V=L+3,G=L+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(x.length&&x[x.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const X=r.parse(R,G,k);if(!X)return null;k=k||X.type,x.push([A,X])}return Ve(k,ht)||Ve(k,tn)||Ve(k,gr)||Ve(k,de)||Ve(k,j(ht))?new Yn(k,c,p,v,x):r.error(`Type ${q(k)} is not interpolatable.`)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=r[0])return c[0].evaluate(t);const v=r.length;if(p>=r[v-1])return c[v-1].evaluate(t);const b=Sa(r,p),x=Yn.interpolationFactor(this.interpolation,p,r[b],r[b+1]),k=c[b].evaluate(t),L=c[b+1].evaluate(t);switch(this.operator){case"interpolate":return Jn[this.type.kind](k,L,x);case"interpolate-hcl":return Jn.color(k,L,x,"hcl");case"interpolate-lab":return Jn.color(k,L,x,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ka(n,t,r,c){const p=c-r,v=n-r;return p===0?0:t===1?v/p:(Math.pow(t,v)-1)/(Math.pow(t,p)-1)}class Ta{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let c=null;const p=r.expectedType;p&&p.kind!=="value"&&(c=p);const v=[];for(const x of t.slice(1)){const k=r.parse(x,1+v.length,c,void 0,{typeAnnotation:"omit"});if(!k)return null;c=c||k.type,v.push(k)}if(!c)throw new Error("No output type");const b=p&&v.some(x=>le(p,x.type));return new Ta(b?Xt:c,v)}evaluate(t){let r,c=null,p=0;for(const v of this.args)if(p++,c=v.evaluate(t),c&&c instanceof Zn&&!c.available&&(r||(r=c.name),c=null,p===this.args.length&&(c=r)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ca(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function pc(n,t,r,c){return c.compare(t,r)===0}function eo(n,t,r){const c=n!=="=="&&n!=="!=";return class K_{constructor(v,b,x){this.type=Ht,this.lhs=v,this.rhs=b,this.collator=x,this.hasUntypedArgument=v.type.kind==="value"||b.type.kind==="value"}static parse(v,b){if(v.length!==3&&v.length!==4)return b.error("Expected two or three arguments.");const x=v[0];let k=b.parse(v[1],1,Xt);if(!k)return null;if(!Ca(x,k.type))return b.concat(1).error(`"${x}" comparisons are not supported for type '${q(k.type)}'.`);let L=b.parse(v[2],2,Xt);if(!L)return null;if(!Ca(x,L.type))return b.concat(2).error(`"${x}" comparisons are not supported for type '${q(L.type)}'.`);if(k.type.kind!==L.type.kind&&k.type.kind!=="value"&&L.type.kind!=="value")return b.error(`Cannot compare types '${q(k.type)}' and '${q(L.type)}'.`);c&&(k.type.kind==="value"&&L.type.kind!=="value"?k=new Lr(L.type,[k]):k.type.kind!=="value"&&L.type.kind==="value"&&(L=new Lr(k.type,[L])));let A=null;if(v.length===4){if(k.type.kind!=="string"&&L.type.kind!=="string"&&k.type.kind!=="value"&&L.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(A=b.parse(v[3],3,ar),!A)return null}return new K_(k,L,A)}evaluate(v){const b=this.lhs.evaluate(v),x=this.rhs.evaluate(v);if(c&&this.hasUntypedArgument){const k=bi(b),L=bi(x);if(k.kind!==L.kind||k.kind!=="string"&&k.kind!=="number")throw new gn(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${k.kind}, ${L.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const k=bi(b),L=bi(x);if(k.kind!=="string"||L.kind!=="string")return t(v,b,x)}return this.collator?r(v,b,x,this.collator.evaluate(v)):t(v,b,x)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const Uh=eo("==",function(n,t,r){return t===r},pc),mc=eo("!=",function(n,t,r){return t!==r},function(n,t,r,c){return!pc(0,t,r,c)}),gc=eo("<",function(n,t,r){return t<r},function(n,t,r,c){return c.compare(t,r)<0}),qh=eo(">",function(n,t,r){return t>r},function(n,t,r,c){return c.compare(t,r)>0}),Zh=eo("<=",function(n,t,r){return t<=r},function(n,t,r,c){return c.compare(t,r)<=0}),_c=eo(">=",function(n,t,r){return t>=r},function(n,t,r,c){return c.compare(t,r)>=0});class No{constructor(t,r,c){this.type=ar,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return r.error("Collator options argument must be an object.");const p=r.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Ht);if(!p)return null;const v=r.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Ht);if(!v)return null;let b=null;return c.locale&&(b=r.parse(c.locale,1,ii),!b)?null:new No(p,v,b)}evaluate(t){return new rs(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Fl{constructor(t,r,c,p,v){this.type=ii,this.number=t,this.locale=r,this.currency=c,this.minFractionDigits=p,this.maxFractionDigits=v}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const c=r.parse(t[1],1,ht);if(!c)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let v=null;if(p.locale&&(v=r.parse(p.locale,1,ii),!v))return null;let b=null;if(p.currency&&(b=r.parse(p.currency,1,ii),!b))return null;let x=null;if(p["min-fraction-digits"]&&(x=r.parse(p["min-fraction-digits"],1,ht),!x))return null;let k=null;return p["max-fraction-digits"]&&(k=r.parse(p["max-fraction-digits"],1,ht),!k)?null:new Fl(c,v,b,x,k)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ia{constructor(t){this.type=lr,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return r.error("First argument must be an image or text section.");const p=[];let v=!1;for(let b=1;b<=t.length-1;++b){const x=t[b];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;let k=null;if(x["font-scale"]&&(k=r.parse(x["font-scale"],1,ht),!k))return null;let L=null;if(x["text-font"]&&(L=r.parse(x["text-font"],1,j(ii)),!L))return null;let A=null;if(x["text-color"]&&(A=r.parse(x["text-color"],1,tn),!A))return null;const R=p[p.length-1];R.scale=k,R.font=L,R.textColor=A}else{const k=r.parse(t[b],1,Xt);if(!k)return null;const L=k.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,p.push({content:k,scale:null,font:null,textColor:null})}}return new Ia(p)}evaluate(t){return new En(this.sections.map(r=>{const c=r.content.evaluate(t);return bi(c)===_r?new An("",c,null,null,null):new An(Bo(c),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Ol{constructor(t){this.type=_r,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const c=r.parse(t[1],1,ii);return c?new Ol(c):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),c=Zn.fromString(r);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(r)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class Nl{constructor(t){this.type=ht,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=r.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${q(c.type)} instead.`):new Nl(c):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new gn(`Expected value to be of type string or array, but found ${q(bi(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Hr=8192;function Gh(n,t){const r=(180+n[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(r*p*Hr),Math.round(c*p*Hr)]}function Vl(n,t){const r=Math.pow(2,t.z);return[(p=(n[0]/Hr+t.x)/r,360*p-180),(c=(n[1]/Hr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90)];var c,p}function Ms(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function gs(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Ai(n,t,r){const c=n[0]-t[0],p=n[1]-t[1],v=n[0]-r[0],b=n[1]-r[1];return c*b-v*p==0&&c*v<=0&&p*b<=0}function Ea(n,t,r,c){return(p=[c[0]-r[0],c[1]-r[1]])[0]*(v=[t[0]-n[0],t[1]-n[1]])[1]-p[1]*v[0]!=0&&!(!vc(n,t,r,c)||!vc(r,c,n,t));var p,v}function Wh(n,t,r){for(const c of r)for(let p=0;p<c.length-1;++p)if(Ea(n,t,c[p],c[p+1]))return!0;return!1}function to(n,t,r=!1){let c=!1;for(const x of t)for(let k=0;k<x.length-1;k++){if(Ai(n,x[k],x[k+1]))return r;(v=x[k])[1]>(p=n)[1]!=(b=x[k+1])[1]>p[1]&&p[0]<(b[0]-v[0])*(p[1]-v[1])/(b[1]-v[1])+v[0]&&(c=!c)}var p,v,b;return c}function Hh(n,t){for(const r of t)if(to(n,r))return!0;return!1}function yc(n,t){for(const r of n)if(!to(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Wh(n[r],n[r+1],t))return!1;return!0}function Xh(n,t){for(const r of t)if(yc(n,r))return!0;return!1}function vc(n,t,r,c){const p=c[0]-r[0],v=c[1]-r[1],b=(n[0]-r[0])*v-p*(n[1]-r[1]),x=(t[0]-r[0])*v-p*(t[1]-r[1]);return b>0&&x<0||b<0&&x>0}function jl(n,t,r){const c=[];for(let p=0;p<n.length;p++){const v=[];for(let b=0;b<n[p].length;b++){const x=Gh(n[p][b],r);Ms(t,x),v.push(x)}c.push(v)}return c}function bc(n,t,r){const c=[];for(let p=0;p<n.length;p++){const v=jl(n[p],t,r);c.push(v)}return c}function xc(n,t,r,c){if(n[0]<r[0]||n[0]>r[2]){const p=.5*c;let v=n[0]-r[0]>p?-c:r[0]-n[0]>p?c:0;v===0&&(v=n[0]-r[2]>p?-c:r[2]-n[0]>p?c:0),n[0]+=v}Ms(t,n)}function wc(n,t,r,c){const p=Math.pow(2,c.z)*Hr,v=[c.x*Hr,c.y*Hr],b=[];for(const x of n)for(const k of x){const L=[k.x+v[0],k.y+v[1]];xc(L,t,r,p),b.push(L)}return b}function Sc(n,t,r,c){const p=Math.pow(2,c.z)*Hr,v=[c.x*Hr,c.y*Hr],b=[];for(const k of n){const L=[];for(const A of k){const R=[A.x+v[0],A.y+v[1]];Ms(t,R),L.push(R)}b.push(L)}if(t[2]-t[0]<=p/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const k of b)for(const L of k)xc(L,t,r,p)}var x;return b}class Ls{constructor(t,r){this.type=Ht,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ur(t[1])){const c=t[1];if(c.type==="FeatureCollection"){const p=[];for(const v of c.features){const{type:b,coordinates:x}=v.geometry;b==="Polygon"&&p.push(x),b==="MultiPolygon"&&p.push(...x)}if(p.length)return new Ls(c,{type:"MultiPolygon",coordinates:p})}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ls(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Ls(c,c)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,c){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=r.canonicalID();if(c.type==="Polygon"){const x=jl(c.coordinates,v,b),k=wc(r.geometry(),p,v,b);if(!gs(p,v))return!1;for(const L of k)if(!to(L,x))return!1}if(c.type==="MultiPolygon"){const x=bc(c.coordinates,v,b),k=wc(r.geometry(),p,v,b);if(!gs(p,v))return!1;for(const L of k)if(!Hh(L,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,c){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=r.canonicalID();if(c.type==="Polygon"){const x=jl(c.coordinates,v,b),k=Sc(r.geometry(),p,v,b);if(!gs(p,v))return!1;for(const L of k)if(!yc(L,x))return!1}if(c.type==="MultiPolygon"){const x=bc(c.coordinates,v,b),k=Sc(r.geometry(),p,v,b);if(!gs(p,v))return!1;for(const L of k)if(!Xh(L,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let kc=class{constructor(n=[],t=(r,c)=>r<c?-1:r>c?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,c=t[n];for(;n>0;){const p=n-1>>1,v=t[p];if(r(c,v)>=0)break;t[n]=v,n=p}t[n]=c}_down(n){const{data:t,compare:r}=this,c=this.length>>1,p=t[n];for(;n<c;){let v=1+(n<<1);const b=v+1;if(b<this.length&&r(t[b],t[v])<0&&(v=b),r(t[v],p)>=0)break;t[n]=t[v],n=v}t[n]=p}};function Kh(n,t,r,c,p){Tc(n,t,r,c||n.length-1,p||Jh)}function Tc(n,t,r,c,p){for(;c>r;){if(c-r>600){var v=c-r+1,b=t-r+1,x=Math.log(v),k=.5*Math.exp(2*x/3),L=.5*Math.sqrt(x*k*(v-k)/v)*(b-v/2<0?-1:1);Tc(n,t,Math.max(r,Math.floor(t-b*k/v+L)),Math.min(c,Math.floor(t+(v-b)*k/v+L)),p)}var A=n[t],R=r,V=c;for(Vo(n,r,t),p(n[c],A)>0&&Vo(n,r,c);R<V;){for(Vo(n,R,V),R++,V--;p(n[R],A)<0;)R++;for(;p(n[V],A)>0;)V--}p(n[r],A)===0?Vo(n,r,V):Vo(n,++V,c),V<=t&&(r=V+1),t<=V&&(c=V-1)}}function Vo(n,t,r){var c=n[t];n[t]=n[r],n[r]=c}function Jh(n,t){return n<t?-1:n>t?1:0}function Ma(n,t){if(n.length<=1)return[n];const r=[];let c,p;for(const v of n){const b=Qh(v);b!==0&&(v.area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(c&&r.push(c),c=[v]):c.push(v))}if(c&&r.push(c),t>1)for(let v=0;v<r.length;v++)r[v].length<=t||(Kh(r[v],t,1,r[v].length-1,Yh),r[v]=r[v].slice(0,t));return r}function Yh(n,t){return t.area-n.area}function Qh(n){let t=0;for(let r,c,p=0,v=n.length,b=v-1;p<v;b=p++)r=n[p],c=n[b],t+=(c.x-r.x)*(r.y+c.y);return t}const Cc=1/298.257223563,Ic=Cc*(2-Cc),Ec=Math.PI/180;class Ul{constructor(t){const r=6378.137*Ec*1e3,c=Math.cos(t*Ec),p=1/(1-Ic*(1-c*c)),v=Math.sqrt(p);this.kx=r*v*c,this.ky=r*v*p*(1-Ic)}distance(t,r){const c=this.wrap(t[0]-r[0])*this.kx,p=(t[1]-r[1])*this.ky;return Math.sqrt(c*c+p*p)}pointOnLine(t,r){let c,p,v,b,x=1/0;for(let k=0;k<t.length-1;k++){let L=t[k][0],A=t[k][1],R=this.wrap(t[k+1][0]-L)*this.kx,V=(t[k+1][1]-A)*this.ky,G=0;R===0&&V===0||(G=(this.wrap(r[0]-L)*this.kx*R+(r[1]-A)*this.ky*V)/(R*R+V*V),G>1?(L=t[k+1][0],A=t[k+1][1]):G>0&&(L+=R/this.kx*G,A+=V/this.ky*G)),R=this.wrap(r[0]-L)*this.kx,V=(r[1]-A)*this.ky;const X=R*R+V*V;X<x&&(x=X,c=L,p=A,v=k,b=G)}return{point:[c,p],index:v,t:Math.max(0,Math.min(1,b))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Mc(n,t){return t[0]-n[0]}function La(n){return n[1]-n[0]+1}function ss(n,t){return n[1]>=n[0]&&n[1]<t}function ql(n,t){if(n[0]>n[1])return[null,null];const r=La(n);if(t){if(r===2)return[n,null];const p=Math.floor(r/2);return[[n[0],n[0]+p],[n[0]+p,n[1]]]}if(r===1)return[n,null];const c=Math.floor(r/2)-1;return[[n[0],n[0]+c],[n[0]+c+1,n[1]]]}function Zl(n,t){if(!ss(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let c=t[0];c<=t[1];++c)Ms(r,n[c]);return r}function Gl(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const c of r)Ms(t,c);return t}function Pa(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Wl(n,t,r){if(!Pa(n)||!Pa(t))return NaN;let c=0,p=0;return n[2]<t[0]&&(c=t[0]-n[2]),n[0]>t[2]&&(c=n[0]-t[2]),n[1]>t[3]&&(p=n[1]-t[3]),n[3]<t[1]&&(p=t[1]-n[3]),r.distance([0,0],[c,p])}function Ps(n,t,r){const c=r.pointOnLine(t,n);return r.distance(n,c.point)}function Hl(n,t,r,c,p){const v=Math.min(Ps(n,[r,c],p),Ps(t,[r,c],p)),b=Math.min(Ps(r,[n,t],p),Ps(c,[n,t],p));return Math.min(v,b)}function $h(n,t,r,c,p){if(!ss(t,n.length)||!ss(c,r.length))return 1/0;let v=1/0;for(let b=t[0];b<t[1];++b){const x=n[b],k=n[b+1];for(let L=c[0];L<c[1];++L){const A=r[L],R=r[L+1];if(Ea(x,k,A,R))return 0;v=Math.min(v,Hl(x,k,A,R,p))}}return v}function dn(n,t,r,c,p){if(!ss(t,n.length)||!ss(c,r.length))return NaN;let v=1/0;for(let b=t[0];b<=t[1];++b)for(let x=c[0];x<=c[1];++x)if(v=Math.min(v,p.distance(n[b],r[x])),v===0)return v;return v}function ef(n,t,r){if(to(n,t,!0))return 0;let c=1/0;for(const p of t){const v=p[0],b=p[p.length-1];if(v!==b&&(c=Math.min(c,Ps(n,[b,v],r)),c===0))return c;const x=r.pointOnLine(p,n);if(c=Math.min(c,r.distance(n,x.point)),c===0)return c}return c}function ui(n,t,r,c){if(!ss(t,n.length))return NaN;for(let v=t[0];v<=t[1];++v)if(to(n[v],r,!0))return 0;let p=1/0;for(let v=t[0];v<t[1];++v){const b=n[v],x=n[v+1];for(const k of r)for(let L=0,A=k.length,R=A-1;L<A;R=L++){const V=k[R],G=k[L];if(Ea(b,x,V,G))return 0;p=Math.min(p,Hl(b,x,V,G,c))}}return p}function Aa(n,t){for(const r of n)for(const c of r)if(to(c,t,!0))return!0;return!1}function Gi(n,t,r,c=1/0){const p=Gl(n),v=Gl(t);if(c!==1/0&&Wl(p,v,r)>=c)return c;if(gs(p,v)){if(Aa(n,t))return 0}else if(Aa(t,n))return 0;let b=1/0;for(const x of n)for(let k=0,L=x.length,A=L-1;k<L;A=k++){const R=x[A],V=x[k];for(const G of t)for(let X=0,K=G.length,ce=K-1;X<K;ce=X++){const _e=G[ce],Ue=G[X];if(Ea(R,V,_e,Ue))return 0;b=Math.min(b,Hl(R,V,_e,Ue,r))}}return b}function Fi(n,t,r,c,p,v){if(!v)return;const b=Wl(Zl(c,v),p,r);b<t&&n.push([b,v,[0,0]])}function As(n,t,r,c,p,v,b){if(!v||!b)return;const x=Wl(Zl(c,v),Zl(p,b),r);x<t&&n.push([x,v,b])}function jo(n,t,r,c,p=1/0){let v=Math.min(c.distance(n[0],r[0][0]),p);if(v===0)return v;const b=new kc([[0,[0,n.length-1],[0,0]]],Mc),x=Gl(r);for(;b.length>0;){const k=b.pop();if(k[0]>=v)continue;const L=k[1],A=t?50:100;if(La(L)<=A){if(!ss(L,n.length))return NaN;if(t){const R=ui(n,L,r,c);if(isNaN(R)||R===0)return R;v=Math.min(v,R)}else for(let R=L[0];R<=L[1];++R){const V=ef(n[R],r,c);if(v=Math.min(v,V),v===0)return 0}}else{const R=ql(L,t);Fi(b,v,c,n,x,R[0]),Fi(b,v,c,n,x,R[1])}}return v}function Uo(n,t,r,c,p,v=1/0){let b=Math.min(v,p.distance(n[0],r[0]));if(b===0)return b;const x=new kc([[0,[0,n.length-1],[0,r.length-1]]],Mc);for(;x.length>0;){const k=x.pop();if(k[0]>=b)continue;const L=k[1],A=k[2],R=t?50:100,V=c?50:100;if(La(L)<=R&&La(A)<=V){if(!ss(L,n.length)&&ss(A,r.length))return NaN;let G;if(t&&c)G=$h(n,L,r,A,p),b=Math.min(b,G);else if(t&&!c){const X=n.slice(L[0],L[1]+1);for(let K=A[0];K<=A[1];++K)if(G=Ps(r[K],X,p),b=Math.min(b,G),b===0)return b}else if(!t&&c){const X=r.slice(A[0],A[1]+1);for(let K=L[0];K<=L[1];++K)if(G=Ps(n[K],X,p),b=Math.min(b,G),b===0)return b}else G=dn(n,L,r,A,p),b=Math.min(b,G)}else{const G=ql(L,t),X=ql(A,c);As(x,b,p,n,r,G[0],X[0]),As(x,b,p,n,r,G[0],X[1]),As(x,b,p,n,r,G[1],X[0]),As(x,b,p,n,r,G[1],X[1])}}return b}function Xl(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class zs{constructor(t,r){this.type=ht,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ur(t[1])){const c=t[1];if(c.type==="FeatureCollection")return new zs(c,c.features.map(p=>Xl(p.geometry)).flat());if(c.type==="Feature")return new zs(c,Xl(c.geometry));if("type"in c&&"coordinates"in c)return new zs(c,Xl(c))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,c){const p=r.geometry(),v=p.flat().map(k=>Vl([k.x,k.y],r.canonical));if(p.length===0)return NaN;const b=new Ul(v[0][1]);let x=1/0;for(const k of c){switch(k.type){case"Point":x=Math.min(x,Uo(v,!1,[k.coordinates],!1,b,x));break;case"LineString":x=Math.min(x,Uo(v,!1,k.coordinates,!0,b,x));break;case"Polygon":x=Math.min(x,jo(v,!1,k.coordinates,b,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,c){const p=r.geometry(),v=p.flat().map(k=>Vl([k.x,k.y],r.canonical));if(p.length===0)return NaN;const b=new Ul(v[0][1]);let x=1/0;for(const k of c){switch(k.type){case"Point":x=Math.min(x,Uo(v,!0,[k.coordinates],!1,b,x));break;case"LineString":x=Math.min(x,Uo(v,!0,k.coordinates,!0,b,x));break;case"Polygon":x=Math.min(x,jo(v,!0,k.coordinates,b,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,c){const p=r.geometry();if(p.length===0||p[0].length===0)return NaN;const v=Ma(p,0).map(k=>k.map(L=>L.map(A=>Vl([A.x,A.y],r.canonical)))),b=new Ul(v[0][0][0][1]);let x=1/0;for(const k of c)for(const L of v){switch(k.type){case"Point":x=Math.min(x,jo([k.coordinates],!1,L,b,x));break;case"LineString":x=Math.min(x,jo(k.coordinates,!0,L,b,x));break;case"Polygon":x=Math.min(x,Gi(L,k.coordinates,b,x))}if(x===0)return x}return x}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const io={"==":Uh,"!=":mc,">":qh,"<":gc,">=":_c,"<=":Zh,array:Lr,at:Dl,boolean:Lr,case:wa,coalesce:Ta,collator:No,format:Ia,image:Ol,in:Rl,"index-of":Qs,interpolate:Yn,"interpolate-hcl":Yn,"interpolate-lab":Yn,length:Nl,let:ms,literal:Mr,match:Bl,number:Lr,"number-format":Fl,object:Lr,slice:Fo,step:$s,string:Lr,"to-boolean":Pr,"to-color":Pr,"to-number":Pr,"to-string":Pr,var:Li,within:Ls,distance:zs};class yr{constructor(t,r,c,p){this.name=t,this.type=r,this._evaluate=c,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const c=t[0],p=yr.definitions[c];if(!p)return r.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=b.filter(([L])=>!Array.isArray(L)||L.length===t.length-1);let k=null;for(const[L,A]of x){k=new Is(r.registry,qo,r.path,null,r.scope);const R=[];let V=!1;for(let G=1;G<t.length;G++){const X=t[G],K=Array.isArray(L)?L[G-1]:L.type,ce=k.parse(X,1+R.length,K);if(!ce){V=!0;break}R.push(ce)}if(!V)if(Array.isArray(L)&&L.length!==R.length)k.error(`Expected ${L.length} arguments, but found ${R.length} instead.`);else{for(let G=0;G<R.length;G++){const X=Array.isArray(L)?L[G]:L.type,K=R[G];k.concat(G+1).checkSubtype(X,K.type)}if(k.errors.length===0)return new yr(c,v,A,R)}}if(x.length===1)r.errors.push(...k.errors);else{const L=(x.length?x:b).map(([R])=>{return V=R,Array.isArray(V)?`(${V.map(q).join(", ")})`:`(${q(V.type)}...)`;var V}).join(" | "),A=[];for(let R=1;R<t.length;R++){const V=r.parse(t[R],1+A.length);if(!V)return null;A.push(q(V.type))}r.error(`Expected arguments of type ${L}, but found (${A.join(", ")}) instead.`)}return null}static register(t,r){yr.definitions=r;for(const c in r)t[c]=yr}}function Kl(n,[t,r,c,p]){t=t.evaluate(n),r=r.evaluate(n),c=c.evaluate(n);const v=p?p.evaluate(n):1,b=Er(t,r,c,v);if(b)throw new gn(b);return new qt(t/255,r/255,c/255,v,!1)}function Jl(n,t){return n in t}function Yl(n,t){const r=t[n];return r===void 0?null:r}function Ds(n){return{type:n}}function qo(n){if(n instanceof Li)return qo(n.boundExpression);if(n instanceof yr&&n.name==="error"||n instanceof No||n instanceof Ls||n instanceof zs)return!1;const t=n instanceof Pr||n instanceof Lr;let r=!0;return n.eachChild(c=>{r=t?r&&qo(c):r&&c instanceof Mr}),!!r&&Zo(n)&&Go(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Zo(n){if(n instanceof yr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Ls||n instanceof zs)return!1;let t=!0;return n.eachChild(r=>{t&&!Zo(r)&&(t=!1)}),t}function no(n){if(n instanceof yr&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(r=>{t&&!no(r)&&(t=!1)}),t}function Go(n,t){if(n instanceof yr&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(c=>{r&&!Go(c,t)&&(r=!1)}),r}function za(n){return{result:"success",value:n}}function ro(n){return{result:"error",value:n}}function so(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Lc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ql(n){return!!n.expression&&n.expression.interpolated}function Ci(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Da(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function tf(n){return n}function Pc(n,t){const r=t.type==="color",c=n.stops&&typeof n.stops[0][0]=="object",p=c||!(c||n.property!==void 0),v=n.type||(Ql(t)?"exponential":"interval");if(r||t.type==="padding"){const A=r?qt.parse:nn.parse;(n=fi({},n)).stops&&(n.stops=n.stops.map(R=>[R[0],A(R[1])])),n.default=A(n.default?n.default:t.default)}if(n.colorSpace&&(b=n.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var b;let x,k,L;if(v==="exponential")x=zc;else if(v==="interval")x=Ra;else if(v==="categorical"){x=Ac,k=Object.create(null);for(const A of n.stops)k[A[0]]=A[1];L=typeof n.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);x=Dc}if(c){const A={},R=[];for(let X=0;X<n.stops.length;X++){const K=n.stops[X],ce=K[0].zoom;A[ce]===void 0&&(A[ce]={zoom:ce,type:n.type,property:n.property,default:n.default,stops:[]},R.push(ce)),A[ce].stops.push([K[0].value,K[1]])}const V=[];for(const X of R)V.push([A[X].zoom,Pc(A[X],t)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:Yn.interpolationFactor.bind(void 0,G),zoomStops:V.map(X=>X[0]),evaluate:({zoom:X},K)=>zc({stops:V,base:n.base},t,X).evaluate(X,K)}}if(p){const A=v==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Yn.interpolationFactor.bind(void 0,A),zoomStops:n.stops.map(R=>R[0]),evaluate:({zoom:R})=>x(n,t,R,k,L)}}return{kind:"source",evaluate(A,R){const V=R&&R.properties?R.properties[n.property]:void 0;return V===void 0?oo(n.default,t.default):x(n,t,V,k,L)}}}function oo(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function Ac(n,t,r,c,p){return oo(typeof r===p?c[r]:void 0,n.default,t.default)}function Ra(n,t,r){if(Ci(r)!=="number")return oo(n.default,t.default);const c=n.stops.length;if(c===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[c-1][0])return n.stops[c-1][1];const p=Sa(n.stops.map(v=>v[0]),r);return n.stops[p][1]}function zc(n,t,r){const c=n.base!==void 0?n.base:1;if(Ci(r)!=="number")return oo(n.default,t.default);const p=n.stops.length;if(p===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[p-1][0])return n.stops[p-1][1];const v=Sa(n.stops.map(A=>A[0]),r),b=function(A,R,V,G){const X=G-V,K=A-V;return X===0?0:R===1?K/X:(Math.pow(R,K)-1)/(Math.pow(R,X)-1)}(r,c,n.stops[v][0],n.stops[v+1][0]),x=n.stops[v][1],k=n.stops[v+1][1],L=Jn[t.type]||tf;return typeof x.evaluate=="function"?{evaluate(...A){const R=x.evaluate.apply(void 0,A),V=k.evaluate.apply(void 0,A);if(R!==void 0&&V!==void 0)return L(R,V,b,n.colorSpace)}}:L(x,k,b,n.colorSpace)}function Dc(n,t,r){switch(t.type){case"color":r=qt.parse(r);break;case"formatted":r=En.fromString(r.toString());break;case"resolvedImage":r=Zn.fromString(r.toString());break;case"padding":r=nn.parse(r);break;default:Ci(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return oo(r,n.default,t.default)}yr.register(io,{error:[{kind:"error"},[ii],(n,[t])=>{throw new gn(t.evaluate(n))}],typeof:[ii,[Xt],(n,[t])=>q(bi(t.evaluate(n)))],"to-rgba":[j(ht,4),[tn],(n,[t])=>{const[r,c,p,v]=t.evaluate(n).rgb;return[255*r,255*c,255*p,v]}],rgb:[tn,[ht,ht,ht],Kl],rgba:[tn,[ht,ht,ht,ht],Kl],has:{type:Ht,overloads:[[[ii],(n,[t])=>Jl(t.evaluate(n),n.properties())],[[ii,or],(n,[t,r])=>Jl(t.evaluate(n),r.evaluate(n))]]},get:{type:Xt,overloads:[[[ii],(n,[t])=>Yl(t.evaluate(n),n.properties())],[[ii,or],(n,[t,r])=>Yl(t.evaluate(n),r.evaluate(n))]]},"feature-state":[Xt,[ii],(n,[t])=>Yl(t.evaluate(n),n.featureState||{})],properties:[or,[],n=>n.properties()],"geometry-type":[ii,[],n=>n.geometryType()],id:[Xt,[],n=>n.id()],zoom:[ht,[],n=>n.globals.zoom],"heatmap-density":[ht,[],n=>n.globals.heatmapDensity||0],"line-progress":[ht,[],n=>n.globals.lineProgress||0],accumulated:[Xt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ht,Ds(ht),(n,t)=>{let r=0;for(const c of t)r+=c.evaluate(n);return r}],"*":[ht,Ds(ht),(n,t)=>{let r=1;for(const c of t)r*=c.evaluate(n);return r}],"-":{type:ht,overloads:[[[ht,ht],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[ht],(n,[t])=>-t.evaluate(n)]]},"/":[ht,[ht,ht],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[ht,[ht,ht],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[ht,[ht],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[ht,[ht],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[ht,[ht],(n,[t])=>Math.log(t.evaluate(n))],log2:[ht,[ht],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[ht,[ht],(n,[t])=>Math.sin(t.evaluate(n))],cos:[ht,[ht],(n,[t])=>Math.cos(t.evaluate(n))],tan:[ht,[ht],(n,[t])=>Math.tan(t.evaluate(n))],asin:[ht,[ht],(n,[t])=>Math.asin(t.evaluate(n))],acos:[ht,[ht],(n,[t])=>Math.acos(t.evaluate(n))],atan:[ht,[ht],(n,[t])=>Math.atan(t.evaluate(n))],min:[ht,Ds(ht),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[ht,Ds(ht),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[ht,[ht],(n,[t])=>Math.abs(t.evaluate(n))],round:[ht,[ht],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[ht,[ht],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[ht,[ht],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Ht,[ii,Xt],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[Ht,[Xt],(n,[t])=>n.id()===t.value],"filter-type-==":[Ht,[ii],(n,[t])=>n.geometryType()===t.value],"filter-<":[Ht,[ii,Xt],(n,[t,r])=>{const c=n.properties()[t.value],p=r.value;return typeof c==typeof p&&c<p}],"filter-id-<":[Ht,[Xt],(n,[t])=>{const r=n.id(),c=t.value;return typeof r==typeof c&&r<c}],"filter->":[Ht,[ii,Xt],(n,[t,r])=>{const c=n.properties()[t.value],p=r.value;return typeof c==typeof p&&c>p}],"filter-id->":[Ht,[Xt],(n,[t])=>{const r=n.id(),c=t.value;return typeof r==typeof c&&r>c}],"filter-<=":[Ht,[ii,Xt],(n,[t,r])=>{const c=n.properties()[t.value],p=r.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[Ht,[Xt],(n,[t])=>{const r=n.id(),c=t.value;return typeof r==typeof c&&r<=c}],"filter->=":[Ht,[ii,Xt],(n,[t,r])=>{const c=n.properties()[t.value],p=r.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[Ht,[Xt],(n,[t])=>{const r=n.id(),c=t.value;return typeof r==typeof c&&r>=c}],"filter-has":[Ht,[Xt],(n,[t])=>t.value in n.properties()],"filter-has-id":[Ht,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ht,[j(ii)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ht,[j(Xt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Ht,[ii,j(Xt)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Ht,[ii,j(Xt)],(n,[t,r])=>function(c,p,v,b){for(;v<=b;){const x=v+b>>1;if(p[x]===c)return!0;p[x]>c?b=x-1:v=x+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ht,overloads:[[[Ht,Ht],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[Ds(Ht),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Ht,overloads:[[[Ht,Ht],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[Ds(Ht),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[Ht,[Ht],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Ht,[ii],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[ii,[ii],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[ii,[ii],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[ii,Ds(Xt),(n,t)=>t.map(r=>Bo(r.evaluate(n))).join("")],"resolved-locale":[ii,[ar],(n,[t])=>t.evaluate(n).resolvedLocale()]});class Ba{constructor(t,r){var c;this.expression=t,this._warningHistory={},this._evaluator=new xa,this._defaultValue=r?(c=r).type==="color"&&Da(c.default)?new qt(0,0,0,0):c.type==="color"?qt.parse(c.default)||null:c.type==="padding"?nn.parse(c.default)||null:c.type==="variableAnchorOffsetCollection"?kn.parse(c.default)||null:c.default===void 0?null:c.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,c,p,v,b){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=c,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(t,r,c,p,v,b){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new gn(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Fa(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in io}function ao(n,t){const r=new Is(io,qo,[],t?function(p){const v={color:tn,string:ii,number:ht,enum:ii,boolean:Ht,formatted:lr,padding:gr,resolvedImage:_r,variableAnchorOffsetCollection:de};return p.type==="array"?j(v[p.value]||Xt,p.length):v[p.type]}(t):void 0),c=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?za(new Ba(c,t)):ro(r.errors)}class lo{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!no(r.expression)}evaluateWithoutErrorHandling(t,r,c,p,v,b){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,p,v,b)}evaluate(t,r,c,p,v,b){return this._styleExpression.evaluate(t,r,c,p,v,b)}}class uo{constructor(t,r,c,p){this.kind=t,this.zoomStops=c,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!no(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,r,c,p,v,b){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,p,v,b)}evaluate(t,r,c,p,v,b){return this._styleExpression.evaluate(t,r,c,p,v,b)}interpolationFactor(t,r,c){return this.interpolationType?Yn.interpolationFactor(this.interpolationType,t,r,c):0}}function $l(n,t){const r=ao(n,t);if(r.result==="error")return r;const c=r.value.expression,p=Zo(c);if(!p&&!so(t))return ro([new Hi("","data expressions not supported")]);const v=Go(c,["zoom"]);if(!v&&!Lc(t))return ro([new Hi("","zoom expressions not supported")]);const b=Wo(c);return b||v?b instanceof Hi?ro([b]):b instanceof Yn&&!Ql(t)?ro([new Hi("",'"interpolate" expressions cannot be used with this property')]):za(b?new uo(p?"camera":"composite",r.value,b.labels,b instanceof Yn?b.interpolation:void 0):new lo(p?"constant":"source",r.value)):ro([new Hi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class co{constructor(t,r){this._parameters=t,this._specification=r,fi(this,Pc(this._parameters,this._specification))}static deserialize(t){return new co(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Wo(n){let t=null;if(n instanceof ms)t=Wo(n.result);else if(n instanceof Ta){for(const r of n.args)if(t=Wo(r),t)break}else(n instanceof $s||n instanceof Yn)&&n.input instanceof yr&&n.input.name==="zoom"&&(t=n);return t instanceof Hi||n.eachChild(r=>{const c=Wo(r);c instanceof Hi?t=c:!t&&c?t=new Hi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new Hi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Oa(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Oa(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Na={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function eu(n){if(n==null)return{filter:()=>!0,needGeometry:!1};Oa(n)||(n=Va(n));const t=ao(n,Na);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,c,p)=>t.value.evaluate(r,c,{},p),needGeometry:Rc(n)}}function nf(n,t){return n<t?-1:n>t?1:0}function Rc(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Rc(n[t]))return!0;return!1}function Va(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?tu(n[1],n[2],"=="):t==="!="?zn(tu(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?tu(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(Va))):t==="all"?["all"].concat(n.slice(1).map(Va)):t==="none"?["all"].concat(n.slice(1).map(Va).map(zn)):t==="in"?Ho(n[1],n.slice(2)):t==="!in"?zn(Ho(n[1],n.slice(2))):t==="has"?Xo(n[1]):t!=="!has"||zn(Xo(n[1]));var r}function tu(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function Ho(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(nf)]]:["filter-in-small",n,["literal",t]]}}function Xo(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function zn(n){return["!",n]}function Rs(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let p="[";for(const v of n)p+=`${Rs(v)},`;return`${p}]`}const r=Object.keys(n).sort();let c="{";for(let p=0;p<r.length;p++)c+=`${JSON.stringify(r[p])}:${Rs(n[r[p]])},`;return`${c}}`}function Bc(n){let t="";for(const r of $e)t+=`/${Rs(n[r])}`;return t}function Fc(n){const t=n.value;return t?[new ot(n.key,t,"constants have been deprecated as of v8")]:[]}function pn(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Ar(n){if(Array.isArray(n))return n.map(Ar);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Ar(n[r]);return t}return pn(n)}function cr(n){const t=n.key,r=n.value,c=n.valueSpec||{},p=n.objectElementValidators||{},v=n.style,b=n.styleSpec,x=n.validateSpec;let k=[];const L=Ci(r);if(L!=="object")return[new ot(t,r,`object expected, ${L} found`)];for(const A in r){const R=A.split(".")[0],V=c[R]||c["*"];let G;if(p[R])G=p[R];else if(c[R])G=x;else if(p["*"])G=p["*"];else{if(!c["*"]){k.push(new ot(t,r[A],`unknown property "${A}"`));continue}G=x}k=k.concat(G({key:(t&&`${t}.`)+A,value:r[A],valueSpec:V,style:v,styleSpec:b,object:r,objectKey:A,validateSpec:x},r))}for(const A in c)p[A]||c[A].required&&c[A].default===void 0&&r[A]===void 0&&k.push(new ot(t,r,`missing required property "${A}"`));return k}function Ko(n){const t=n.value,r=n.valueSpec,c=n.style,p=n.styleSpec,v=n.key,b=n.arrayElementValidator||n.validateSpec;if(Ci(t)!=="array")return[new ot(v,t,`array expected, ${Ci(t)} found`)];if(r.length&&t.length!==r.length)return[new ot(v,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ot(v,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let x={type:r.value,values:r.values};p.$version<7&&(x.function=r.function),Ci(r.value)==="object"&&(x=r.value);let k=[];for(let L=0;L<t.length;L++)k=k.concat(b({array:t,arrayIndex:L,value:t[L],valueSpec:x,validateSpec:n.validateSpec,style:c,styleSpec:p,key:`${v}[${L}]`}));return k}function iu(n){const t=n.key,r=n.value,c=n.valueSpec;let p=Ci(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new ot(t,r,`number expected, ${p} found`)]:"minimum"in c&&r<c.minimum?[new ot(t,r,`${r} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&r>c.maximum?[new ot(t,r,`${r} is greater than the maximum value ${c.maximum}`)]:[]}function ja(n){const t=n.valueSpec,r=pn(n.value.type);let c,p,v,b={};const x=r!=="categorical"&&n.value.property===void 0,k=!x,L=Ci(n.value.stops)==="array"&&Ci(n.value.stops[0])==="array"&&Ci(n.value.stops[0][0])==="object",A=cr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(G){if(r==="identity")return[new ot(G.key,G.value,'identity function may not have a "stops" property')];let X=[];const K=G.value;return X=X.concat(Ko({key:G.key,value:K,valueSpec:G.valueSpec,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:R})),Ci(K)==="array"&&K.length===0&&X.push(new ot(G.key,K,"array must have at least one stop")),X},default:function(G){return G.validateSpec({key:G.key,value:G.value,valueSpec:t,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec})}}});return r==="identity"&&x&&A.push(new ot(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||A.push(new ot(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Ql(n.valueSpec)&&A.push(new ot(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(k&&!so(n.valueSpec)?A.push(new ot(n.key,n.value,"property functions not supported")):x&&!Lc(n.valueSpec)&&A.push(new ot(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!L||n.value.property!==void 0||A.push(new ot(n.key,n.value,'"property" property is required')),A;function R(G){let X=[];const K=G.value,ce=G.key;if(Ci(K)!=="array")return[new ot(ce,K,`array expected, ${Ci(K)} found`)];if(K.length!==2)return[new ot(ce,K,`array length 2 expected, length ${K.length} found`)];if(L){if(Ci(K[0])!=="object")return[new ot(ce,K,`object expected, ${Ci(K[0])} found`)];if(K[0].zoom===void 0)return[new ot(ce,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new ot(ce,K,"object stop key must have value")];if(v&&v>pn(K[0].zoom))return[new ot(ce,K[0].zoom,"stop zoom values must appear in ascending order")];pn(K[0].zoom)!==v&&(v=pn(K[0].zoom),p=void 0,b={}),X=X.concat(cr({key:`${ce}[0]`,value:K[0],valueSpec:{zoom:{}},validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:iu,value:V}}))}else X=X.concat(V({key:`${ce}[0]`,value:K[0],validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec},K));return Fa(Ar(K[1]))?X.concat([new ot(`${ce}[1]`,K[1],"expressions are not allowed in function stops.")]):X.concat(G.validateSpec({key:`${ce}[1]`,value:K[1],valueSpec:t,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec}))}function V(G,X){const K=Ci(G.value),ce=pn(G.value),_e=G.value!==null?G.value:X;if(c){if(K!==c)return[new ot(G.key,_e,`${K} stop domain type must match previous stop domain type ${c}`)]}else c=K;if(K!=="number"&&K!=="string"&&K!=="boolean")return[new ot(G.key,_e,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&r!=="categorical"){let Ue=`number expected, ${K} found`;return so(t)&&r===void 0&&(Ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ot(G.key,_e,Ue)]}return r!=="categorical"||K!=="number"||isFinite(ce)&&Math.floor(ce)===ce?r!=="categorical"&&K==="number"&&p!==void 0&&ce<p?[new ot(G.key,_e,"stop domain values must appear in ascending order")]:(p=ce,r==="categorical"&&ce in b?[new ot(G.key,_e,"stop domain values must be unique")]:(b[ce]=!0,[])):[new ot(G.key,_e,`integer expected, found ${ce}`)]}}function ho(n){const t=(n.expressionContext==="property"?$l:ao)(Ar(n.value),n.valueSpec);if(t.result==="error")return t.value.map(c=>new ot(`${n.key}${c.key}`,n.value,c.message));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new ot(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!no(r))return[new ot(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!no(r))return[new ot(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Go(r,["zoom","feature-state"]))return[new ot(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Zo(r))return[new ot(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function os(n){const t=n.key,r=n.value,c=n.valueSpec,p=[];return Array.isArray(c.values)?c.values.indexOf(pn(r))===-1&&p.push(new ot(t,r,`expected one of [${c.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(c.values).indexOf(pn(r))===-1&&p.push(new ot(t,r,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function nu(n){return Oa(Ar(n.value))?ho(fi({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ua(n)}function Ua(n){const t=n.value,r=n.key;if(Ci(t)!=="array")return[new ot(r,t,`array expected, ${Ci(t)} found`)];const c=n.styleSpec;let p,v=[];if(t.length<1)return[new ot(r,t,"filter array must have at least 1 element")];switch(v=v.concat(os({key:`${r}[0]`,value:t[0],valueSpec:c.filter_operator,style:n.style,styleSpec:n.styleSpec})),pn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&pn(t[1])==="$type"&&v.push(new ot(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new ot(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=Ci(t[1]),p!=="string"&&v.push(new ot(`${r}[1]`,t[1],`string expected, ${p} found`)));for(let b=2;b<t.length;b++)p=Ci(t[b]),pn(t[1])==="$type"?v=v.concat(os({key:`${r}[${b}]`,value:t[b],valueSpec:c.geometry_type,style:n.style,styleSpec:n.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&v.push(new ot(`${r}[${b}]`,t[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)v=v.concat(Ua({key:`${r}[${b}]`,value:t[b],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":p=Ci(t[1]),t.length!==2?v.push(new ot(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&v.push(new ot(`${r}[1]`,t[1],`string expected, ${p} found`))}return v}function ru(n,t){const r=n.key,c=n.validateSpec,p=n.style,v=n.styleSpec,b=n.value,x=n.objectKey,k=v[`${t}_${n.layerType}`];if(!k)return[];const L=x.match(/^(.*)-transition$/);if(t==="paint"&&L&&k[L[1]]&&k[L[1]].transition)return c({key:r,value:b,valueSpec:v.transition,style:p,styleSpec:v});const A=n.valueSpec||k[x];if(!A)return[new ot(r,b,`unknown property "${x}"`)];let R;if(Ci(b)==="string"&&so(A)&&!A.tokens&&(R=/^{([^}]+)}$/.exec(b)))return[new ot(r,b,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const V=[];return n.layerType==="symbol"&&(x==="text-field"&&p&&!p.glyphs&&V.push(new ot(r,b,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Da(Ar(b))&&pn(b.type)==="identity"&&V.push(new ot(r,b,'"text-font" does not support identity functions'))),V.concat(c({key:n.key,value:b,valueSpec:A,style:p,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function qa(n){return ru(n,"paint")}function su(n){return ru(n,"layout")}function ou(n){let t=[];const r=n.value,c=n.key,p=n.style,v=n.styleSpec;r.type||r.ref||t.push(new ot(c,r,'either "type" or "ref" is required'));let b=pn(r.type);const x=pn(r.ref);if(r.id){const k=pn(r.id);for(let L=0;L<n.arrayIndex;L++){const A=p.layers[L];pn(A.id)===k&&t.push(new ot(c,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let k;["type","source","source-layer","filter","layout"].forEach(L=>{L in r&&t.push(new ot(c,r[L],`"${L}" is prohibited for ref layers`))}),p.layers.forEach(L=>{pn(L.id)===x&&(k=L)}),k?k.ref?t.push(new ot(c,r.ref,"ref cannot reference another ref layer")):b=pn(k.type):t.push(new ot(c,r.ref,`ref layer "${x}" not found`))}else if(b!=="background")if(r.source){const k=p.sources&&p.sources[r.source],L=k&&pn(k.type);k?L==="vector"&&b==="raster"?t.push(new ot(c,r.source,`layer "${r.id}" requires a raster source`)):L!=="raster-dem"&&b==="hillshade"?t.push(new ot(c,r.source,`layer "${r.id}" requires a raster-dem source`)):L==="raster"&&b!=="raster"?t.push(new ot(c,r.source,`layer "${r.id}" requires a vector source`)):L!=="vector"||r["source-layer"]?L==="raster-dem"&&b!=="hillshade"?t.push(new ot(c,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!r.paint||!r.paint["line-gradient"]||L==="geojson"&&k.lineMetrics||t.push(new ot(c,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ot(c,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ot(c,r.source,`source "${r.source}" not found`))}else t.push(new ot(c,r,'missing required property "source"'));return t=t.concat(cr({key:c,value:r,valueSpec:v.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${c}.type`,value:r.type,valueSpec:v.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:nu,layout:k=>cr({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":L=>su(fi({layerType:b},L))}}),paint:k=>cr({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":L=>qa(fi({layerType:b},L))}})}})),t}function Bs(n){const t=n.value,r=n.key,c=Ci(t);return c!=="string"?[new ot(r,t,`string expected, ${c} found`)]:[]}const Za={promoteId:function({key:n,value:t}){if(Ci(t)==="string")return Bs({key:n,value:t});{const r=[];for(const c in t)r.push(...Bs({key:`${n}.${c}`,value:t[c]}));return r}}};function Jo(n){const t=n.value,r=n.key,c=n.styleSpec,p=n.style,v=n.validateSpec;if(!t.type)return[new ot(r,t,'"type" is required')];const b=pn(t.type);let x;switch(b){case"vector":case"raster":return x=cr({key:r,value:t,valueSpec:c[`source_${b.replace("-","_")}`],style:n.style,styleSpec:c,objectElementValidators:Za,validateSpec:v}),x;case"raster-dem":return x=function(k){var L;const A=(L=k.sourceName)!==null&&L!==void 0?L:"",R=k.value,V=k.styleSpec,G=V.source_raster_dem,X=k.style;let K=[];const ce=Ci(R);if(R===void 0)return K;if(ce!=="object")return K.push(new ot("source_raster_dem",R,`object expected, ${ce} found`)),K;const _e=pn(R.encoding)==="custom",Ue=["redFactor","greenFactor","blueFactor","baseShift"],Me=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Oe in R)!_e&&Ue.includes(Oe)?K.push(new ot(Oe,R[Oe],`In "${A}": "${Oe}" is only valid when "encoding" is set to "custom". ${Me} encoding found`)):G[Oe]?K=K.concat(k.validateSpec({key:Oe,value:R[Oe],valueSpec:G[Oe],validateSpec:k.validateSpec,style:X,styleSpec:V})):K.push(new ot(Oe,R[Oe],`unknown property "${Oe}"`));return K}({sourceName:r,value:t,style:n.style,styleSpec:c,validateSpec:v}),x;case"geojson":if(x=cr({key:r,value:t,valueSpec:c.source_geojson,style:p,styleSpec:c,validateSpec:v,objectElementValidators:Za}),t.cluster)for(const k in t.clusterProperties){const[L,A]=t.clusterProperties[k],R=typeof L=="string"?[L,["accumulated"],["get",k]]:L;x.push(...ho({key:`${r}.${k}.map`,value:A,expressionContext:"cluster-map"})),x.push(...ho({key:`${r}.${k}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return x;case"video":return cr({key:r,value:t,valueSpec:c.source_video,style:p,validateSpec:v,styleSpec:c});case"image":return cr({key:r,value:t,valueSpec:c.source_image,style:p,validateSpec:v,styleSpec:c});case"canvas":return[new ot(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return os({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function au(n){const t=n.value,r=n.styleSpec,c=r.light,p=n.style;let v=[];const b=Ci(t);if(t===void 0)return v;if(b!=="object")return v=v.concat([new ot("light",t,`object expected, ${b} found`)]),v;for(const x in t){const k=x.match(/^(.*)-transition$/);v=v.concat(k&&c[k[1]]&&c[k[1]].transition?n.validateSpec({key:x,value:t[x],valueSpec:r.transition,validateSpec:n.validateSpec,style:p,styleSpec:r}):c[x]?n.validateSpec({key:x,value:t[x],valueSpec:c[x],validateSpec:n.validateSpec,style:p,styleSpec:r}):[new ot(x,t[x],`unknown property "${x}"`)])}return v}function lu(n){const t=n.value,r=n.styleSpec,c=r.sky,p=n.style,v=Ci(t);if(t===void 0)return[];if(v!=="object")return[new ot("sky",t,`object expected, ${v} found`)];let b=[];for(const x in t)b=b.concat(c[x]?n.validateSpec({key:x,value:t[x],valueSpec:c[x],style:p,styleSpec:r}):[new ot(x,t[x],`unknown property "${x}"`)]);return b}function uu(n){const t=n.value,r=n.styleSpec,c=r.terrain,p=n.style;let v=[];const b=Ci(t);if(t===void 0)return v;if(b!=="object")return v=v.concat([new ot("terrain",t,`object expected, ${b} found`)]),v;for(const x in t)v=v.concat(c[x]?n.validateSpec({key:x,value:t[x],valueSpec:c[x],validateSpec:n.validateSpec,style:p,styleSpec:r}):[new ot(x,t[x],`unknown property "${x}"`)]);return v}function cu(n){let t=[];const r=n.value,c=n.key;if(Array.isArray(r)){const p=[],v=[];for(const b in r)r[b].id&&p.includes(r[b].id)&&t.push(new ot(c,r,`all the sprites' ids must be unique, but ${r[b].id} is duplicated`)),p.push(r[b].id),r[b].url&&v.includes(r[b].url)&&t.push(new ot(c,r,`all the sprites' URLs must be unique, but ${r[b].url} is duplicated`)),v.push(r[b].url),t=t.concat(cr({key:`${c}[${b}]`,value:r[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Bs({key:c,value:r})}const Ga={"*":()=>[],array:Ko,boolean:function(n){const t=n.value,r=n.key,c=Ci(t);return c!=="boolean"?[new ot(r,t,`boolean expected, ${c} found`)]:[]},number:iu,color:function(n){const t=n.key,r=n.value,c=Ci(r);return c!=="string"?[new ot(t,r,`color expected, ${c} found`)]:qt.parse(String(r))?[]:[new ot(t,r,`color expected, "${r}" found`)]},constants:Fc,enum:os,filter:nu,function:ja,layer:ou,object:cr,source:Jo,light:au,sky:lu,terrain:uu,projection:function(n){const t=n.value,r=n.styleSpec,c=r.projection,p=n.style,v=Ci(t);if(t===void 0)return[];if(v!=="object")return[new ot("projection",t,`object expected, ${v} found`)];let b=[];for(const x in t)b=b.concat(c[x]?n.validateSpec({key:x,value:t[x],valueSpec:c[x],style:p,styleSpec:r}):[new ot(x,t[x],`unknown property "${x}"`)]);return b},string:Bs,formatted:function(n){return Bs(n).length===0?[]:ho(n)},resolvedImage:function(n){return Bs(n).length===0?[]:ho(n)},padding:function(n){const t=n.key,r=n.value;if(Ci(r)==="array"){if(r.length<1||r.length>4)return[new ot(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const c={type:"number"};let p=[];for(let v=0;v<r.length;v++)p=p.concat(n.validateSpec({key:`${t}[${v}]`,value:r[v],validateSpec:n.validateSpec,valueSpec:c}));return p}return iu({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,c=Ci(r),p=n.styleSpec;if(c!=="array"||r.length<1||r.length%2!=0)return[new ot(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let b=0;b<r.length;b+=2)v=v.concat(os({key:`${t}[${b}]`,value:r[b],valueSpec:p.layout_symbol["text-anchor"]})),v=v.concat(Ko({key:`${t}[${b+1}]`,value:r[b+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:p}));return v},sprite:cu};function Yo(n){const t=n.value,r=n.valueSpec,c=n.styleSpec;return n.validateSpec=Yo,r.expression&&Da(pn(t))?ja(n):r.expression&&Fa(Ar(t))?ho(n):r.type&&Ga[r.type]?Ga[r.type](n):cr(fi({},n,{valueSpec:r.type?c[r.type]:r}))}function Oc(n){const t=n.value,r=n.key,c=Bs(n);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new ot(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new ot(r,t,'"glyphs" url must include a "{range}" token'))),c}function vr(n,t=je){let r=[];return r=r.concat(Yo({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Yo,objectElementValidators:{glyphs:Oc,"*":()=>[]}})),n.constants&&(r=r.concat(Fc({key:"constants",value:n.constants}))),hu(r)}function Xr(n){return function(t){return n({...t,validateSpec:Yo})}}function hu(n){return[].concat(n).sort((t,r)=>t.line-r.line)}function zr(n){return function(...t){return hu(n.apply(this,t))}}vr.source=zr(Xr(Jo)),vr.sprite=zr(Xr(cu)),vr.glyphs=zr(Xr(Oc)),vr.light=zr(Xr(au)),vr.sky=zr(Xr(lu)),vr.terrain=zr(Xr(uu)),vr.layer=zr(Xr(ou)),vr.filter=zr(Xr(nu)),vr.paintProperty=zr(Xr(qa)),vr.layoutProperty=zr(Xr(su));const Fs=vr,rf=Fs.light,sf=Fs.sky,Nc=Fs.paintProperty,Vc=Fs.layoutProperty;function fu(n,t){let r=!1;if(t&&t.length)for(const c of t)n.fire(new yt(new Error(c.message))),r=!0;return r}class fo{constructor(t,r,c){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const b=new Int32Array(this.arrayBuffer);t=b[0],this.d=(r=b[1])+2*(c=b[2]);for(let k=0;k<this.d*this.d;k++){const L=b[3+k],A=b[3+k+1];p.push(L===A?null:b.subarray(L,A))}const x=b[3+p.length+1];this.keys=b.subarray(b[3+p.length],x),this.bboxes=b.subarray(x),this.insert=this._insertReadonly}else{this.d=r+2*c;for(let b=0;b<this.d*this.d;b++)p.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=c,this.scale=r/t,this.uid=0;const v=c/r*t;this.min=-v,this.max=t+v}insert(t,r,c,p,v){this._forEachCell(r,c,p,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,c,p,v,b){this.cells[v].push(b)}query(t,r,c,p,v){const b=this.min,x=this.max;if(t<=b&&r<=b&&x<=c&&x<=p&&!v)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(t,r,c,p,this._queryCell,k,{},v),k}}_queryCell(t,r,c,p,v,b,x,k){const L=this.cells[v];if(L!==null){const A=this.keys,R=this.bboxes;for(let V=0;V<L.length;V++){const G=L[V];if(x[G]===void 0){const X=4*G;(k?k(R[X+0],R[X+1],R[X+2],R[X+3]):t<=R[X+2]&&r<=R[X+3]&&c>=R[X+0]&&p>=R[X+1])?(x[G]=!0,b.push(A[G])):x[G]=!1}}}}_forEachCell(t,r,c,p,v,b,x,k){const L=this._convertToCellCoord(t),A=this._convertToCellCoord(r),R=this._convertToCellCoord(c),V=this._convertToCellCoord(p);for(let G=L;G<=R;G++)for(let X=A;X<=V;X++){const K=this.d*X+G;if((!k||k(this._convertFromCellCoord(G),this._convertFromCellCoord(X),this._convertFromCellCoord(G+1),this._convertFromCellCoord(X+1)))&&v.call(this,t,r,c,p,K,b,x,k))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let c=0;for(let b=0;b<this.cells.length;b++)c+=this.cells[b].length;const p=new Int32Array(r+c+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let v=r;for(let b=0;b<t.length;b++){const x=t[b];p[3+b]=v,p.set(x,v),v+=x.length}return p[3+t.length]=v,p.set(this.keys,v),v+=this.keys.length,p[3+t.length+1]=v,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer}static serialize(t,r){const c=t.toArrayBuffer();return r&&r.push(c),{buffer:c}}static deserialize(t){return new fo(t.buffer)}}const br={};function Et(n,t,r={}){if(br[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),br[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Et("Object",Object),Et("TransferableGridIndex",fo),Et("Color",qt),Et("Error",Error),Et("AJAXError",Lt),Et("ResolvedImage",Zn),Et("StylePropertyFunction",co),Et("StyleExpression",Ba,{omit:["_evaluator"]}),Et("ZoomDependentExpression",uo),Et("ZoomConstantExpression",lo),Et("CompoundExpression",yr,{omit:["_evaluate"]});for(const n in io)io[n]._classRegistryKey||Et(`Expression_${n}`,io[n]);function Wa(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function du(n){return n.$name||n.constructor._classRegistryKey}function jc(n){return!function(t){if(t===null||typeof t!="object")return!1;const r=du(t);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Wa(n)||Ce(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function po(n,t){if(jc(n))return(Wa(n)||Ce(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const v=[];for(const b of n)v.push(po(b,t));return v}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=du(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!br[r])throw new Error(`${r} is not registered.`);const{klass:c}=br[r],p=c.serialize?c.serialize(n,t):{};if(c.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in n){if(!n.hasOwnProperty(v)||br[r].omit.indexOf(v)>=0)continue;const b=n[v];p[v]=br[r].shallow.indexOf(v)>=0?b:po(b,t)}n instanceof Error&&(p.message=n.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(p.$name=r),p}function mo(n){if(jc(n))return n;if(Array.isArray(n))return n.map(mo);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=du(n)||"Object";if(!br[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=br[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const c=Object.create(r.prototype);for(const p of Object.keys(n)){if(p==="$name")continue;const v=n[p];c[p]=br[t].shallow.indexOf(p)>=0?v:mo(v)}return c}class pu{constructor(){this.first=!0}update(t,r){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const pi={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function mu(n){for(const t of n)if(_u(t.charCodeAt(0)))return!0;return!1}function of(n){for(const t of n)if(!go(t.charCodeAt(0)))return!1;return!0}function gu(n){const t=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const af=gu(["Arab","Dupl","Mong","Ougr","Syrc"]);function go(n){return!af.test(String.fromCodePoint(n))}const Uc=gu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function _u(n){return!(n!==746&&n!==747&&(n<4352||!(pi["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||pi["CJK Compatibility"](n)||pi["CJK Strokes"](n)||!(!pi["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||pi["Enclosed CJK Letters and Months"](n)||pi["Ideographic Description Characters"](n)||pi.Kanbun(n)||pi.Katakana(n)&&n!==12540||!(!pi["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!pi["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||pi["Vertical Forms"](n)||pi["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Uc.test(String.fromCodePoint(n)))))}function qc(n){return!(_u(n)||function(t){return!!(pi["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||pi["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||pi["Letterlike Symbols"](t)||pi["Number Forms"](t)||pi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||pi["Control Pictures"](t)&&t!==9251||pi["Optical Character Recognition"](t)||pi["Enclosed Alphanumerics"](t)||pi["Geometric Shapes"](t)||pi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||pi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||pi["CJK Symbols and Punctuation"](t)||pi.Katakana(t)||pi["Private Use Area"](t)||pi["CJK Compatibility Forms"](t)||pi["Small Form Variants"](t)||pi["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const lf=gu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function yu(n){return lf.test(String.fromCodePoint(n))}function uf(n,t){return!(!t&&yu(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||pi.Khmer(n))}function cf(n){for(const t of n)if(yu(t.charCodeAt(0)))return!0;return!1}const hr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ki{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new pu,this.transition={})}isSupportedScript(t){return function(r,c){for(const p of r)if(!uf(p.charCodeAt(0),c))return!1;return!0}(t,hr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*r}}}class _o{constructor(t,r){this.property=t,this.value=r,this.expression=function(c,p){if(Da(c))return new co(c,p);if(Fa(c)){const v=$l(c,p);if(v.result==="error")throw new Error(v.value.map(b=>`${b.key}: ${b.message}`).join(", "));return v.value}{let v=c;return p.type==="color"&&typeof c=="string"?v=qt.parse(c):p.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(c)&&(v=kn.parse(c)):v=nn.parse(c),{kind:"constant",evaluate:()=>v}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,c){return this.property.possiblyEvaluate(this,t,r,c)}}class Ha{constructor(t){this.property=t,this.value=new _o(t,void 0)}transitioned(t,r){return new Zc(this.property,this.value,r,Ae({},t.transition,this.transition),t.now)}untransitioned(){return new Zc(this.property,this.value,null,{},0)}}class Xa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return D(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ha(this._values[t].property)),this._values[t].value=new _o(this._values[t].property,r===null?void 0:D(r))}getTransition(t){return D(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ha(this._values[t].property)),this._values[t].transition=D(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c);const p=this.getTransition(r);p!==void 0&&(t[`${r}-transition`]=p)}return t}transitioned(t,r){const c=new Qo(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(t,r._values[p]);return c}untransitioned(){const t=new Qo(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Zc{constructor(t,r,c,p,v){this.property=t,this.value=r,this.begin=v+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(t,r,c){const p=t.now||0,v=this.value.possiblyEvaluate(t,r,c),b=this.prior;if(b){if(p>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(p<this.begin)return b.possiblyEvaluate(t,r,c);{const x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,r,c),v,function(k){if(k<=0)return 0;if(k>=1)return 1;const L=k*k,A=L*k;return 4*(k<.5?A:3*(k-L)+A-.75)}(x))}}return v}}class Qo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,c){const p=new ea(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,r,c);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class $o{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return D(this._values[t].value)}setValue(t,r){this._values[t]=new _o(this._values[t].property,r===null?void 0:D(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c)}return t}possiblyEvaluate(t,r,c){const p=new ea(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,r,c);return p}}class Kr{constructor(t,r,c){this.property=t,this.value=r,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,c,p){return this.property.evaluate(this.value,this.parameters,t,r,c,p)}}class ea{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class zt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,c){const p=Jn[this.specification.type];return p?p(t,r,c):t}}class Kt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,c,p){return new Kr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},c,p)}:t.expression,r)}interpolate(t,r,c){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Kr(this,{kind:"constant",value:void 0},t.parameters);const p=Jn[this.specification.type];if(p){const v=p(t.value.value,r.value.value,c);return new Kr(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,r,c,p,v,b){return t.kind==="constant"?t.value:t.evaluate(r,c,p,v,b)}}class Ka extends Kt{possiblyEvaluate(t,r,c,p){if(t.value===void 0)return new Kr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const v=t.expression.evaluate(r,null,{},c,p),b=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,x=this._calculate(b,b,b,r);return new Kr(this,{kind:"constant",value:x},r)}if(t.expression.kind==="camera"){const v=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Kr(this,{kind:"constant",value:v},r)}return new Kr(this,t.expression,r)}evaluate(t,r,c,p,v,b){if(t.kind==="source"){const x=t.evaluate(r,c,p,v,b);return this._calculate(x,x,x,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},c,p),t.evaluate({zoom:Math.floor(r.zoom)},c,p),t.evaluate({zoom:Math.floor(r.zoom)+1},c,p),r):t.value}_calculate(t,r,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:c,to:r}}interpolate(t){return t}}class Ja{constructor(t){this.specification=t}possiblyEvaluate(t,r,c,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const v=t.expression.evaluate(r,null,{},c,p);return this._calculate(v,v,v,r)}return this._calculate(t.expression.evaluate(new Ki(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Ki(Math.floor(r.zoom),r)),t.expression.evaluate(new Ki(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:c,to:r}}interpolate(t){return t}}class vu{constructor(t){this.specification=t}possiblyEvaluate(t,r,c,p){return!!t.expression.evaluate(r,null,{},c,p)}interpolate(){return!1}}class y{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const c=t[r];c.specification.overridable&&this.overridableProperties.push(r);const p=this.defaultPropertyValues[r]=new _o(c,void 0),v=this.defaultTransitionablePropertyValues[r]=new Ha(c);this.defaultTransitioningPropertyValues[r]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=p.possiblyEvaluate({})}}}Et("DataDrivenProperty",Kt),Et("DataConstantProperty",zt),Et("CrossFadedDataDrivenProperty",Ka),Et("CrossFadedProperty",Ja),Et("ColorRampProperty",vu);const e="-transition";class l extends Qt{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new $o(r.layout)),r.paint)){this._transitionablePaint=new Xa(r.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ea(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,c={}){r!=null&&this._validate(Vc,`layers.${this.id}.layout.${t}`,t,r,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,c={}){if(r!=null&&this._validate(Nc,`layers.${this.id}.paint.${t}`,t,r,c))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const p=this._transitionablePaint._values[t],v=p.property.specification["property-type"]==="cross-faded-data-driven",b=p.value.isDataDriven(),x=p.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const k=this._transitionablePaint._values[t].value;return k.isDataDriven()||b||v||this._handleOverridablePaintPropertyUpdate(t,x,k)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Q(t,(r,c)=>!(r===void 0||c==="layout"&&!Object.keys(r).length||c==="paint"&&!Object.keys(r).length))}_validate(t,r,c,p,v={}){return(!v||v.validate!==!1)&&fu(this,t.call(Fs,{key:r,layerType:this.type,objectKey:c,value:p,styleSpec:je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Kr&&so(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const f={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class d{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function S(n,t=1){let r=0,c=0;return{members:n.map(p=>{const v=f[p.type].BYTES_PER_ELEMENT,b=r=T(r,Math.max(t,v)),x=p.components||1;return c=Math.max(c,v),r+=v*x,{name:p.name,type:p.type,components:x,offset:b}}),size:T(r,Math.max(c,t)),alignment:t}}function T(n,t){return Math.ceil(n/t)*t}class M extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const p=2*t;return this.int16[p+0]=r,this.int16[p+1]=c,t}}M.prototype.bytesPerElement=4,Et("StructArrayLayout2i4",M);class z extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,c)}emplace(t,r,c,p){const v=3*t;return this.int16[v+0]=r,this.int16[v+1]=c,this.int16[v+2]=p,t}}z.prototype.bytesPerElement=6,Et("StructArrayLayout3i6",z);class F extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,p)}emplace(t,r,c,p,v){const b=4*t;return this.int16[b+0]=r,this.int16[b+1]=c,this.int16[b+2]=p,this.int16[b+3]=v,t}}F.prototype.bytesPerElement=8,Et("StructArrayLayout4i8",F);class O extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v,b){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,c,p,v,b)}emplace(t,r,c,p,v,b,x){const k=6*t;return this.int16[k+0]=r,this.int16[k+1]=c,this.int16[k+2]=p,this.int16[k+3]=v,this.int16[k+4]=b,this.int16[k+5]=x,t}}O.prototype.bytesPerElement=12,Et("StructArrayLayout2i4i12",O);class W extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v,b){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,c,p,v,b)}emplace(t,r,c,p,v,b,x){const k=4*t,L=8*t;return this.int16[k+0]=r,this.int16[k+1]=c,this.uint8[L+4]=p,this.uint8[L+5]=v,this.uint8[L+6]=b,this.uint8[L+7]=x,t}}W.prototype.bytesPerElement=8,Et("StructArrayLayout2i4ub8",W);class Y extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const p=2*t;return this.float32[p+0]=r,this.float32[p+1]=c,t}}Y.prototype.bytesPerElement=8,Et("StructArrayLayout2f8",Y);class re extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v,b,x,k,L,A){const R=this.length;return this.resize(R+1),this.emplace(R,t,r,c,p,v,b,x,k,L,A)}emplace(t,r,c,p,v,b,x,k,L,A,R){const V=10*t;return this.uint16[V+0]=r,this.uint16[V+1]=c,this.uint16[V+2]=p,this.uint16[V+3]=v,this.uint16[V+4]=b,this.uint16[V+5]=x,this.uint16[V+6]=k,this.uint16[V+7]=L,this.uint16[V+8]=A,this.uint16[V+9]=R,t}}re.prototype.bytesPerElement=20,Et("StructArrayLayout10ui20",re);class he extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v,b,x,k,L,A,R,V){const G=this.length;return this.resize(G+1),this.emplace(G,t,r,c,p,v,b,x,k,L,A,R,V)}emplace(t,r,c,p,v,b,x,k,L,A,R,V,G){const X=12*t;return this.int16[X+0]=r,this.int16[X+1]=c,this.int16[X+2]=p,this.int16[X+3]=v,this.uint16[X+4]=b,this.uint16[X+5]=x,this.uint16[X+6]=k,this.uint16[X+7]=L,this.int16[X+8]=A,this.int16[X+9]=R,this.int16[X+10]=V,this.int16[X+11]=G,t}}he.prototype.bytesPerElement=24,Et("StructArrayLayout4i4ui4i24",he);class ye extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,c)}emplace(t,r,c,p){const v=3*t;return this.float32[v+0]=r,this.float32[v+1]=c,this.float32[v+2]=p,t}}ye.prototype.bytesPerElement=12,Et("StructArrayLayout3f12",ye);class xe extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}xe.prototype.bytesPerElement=4,Et("StructArrayLayout1ul4",xe);class Ie extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v,b,x,k,L){const A=this.length;return this.resize(A+1),this.emplace(A,t,r,c,p,v,b,x,k,L)}emplace(t,r,c,p,v,b,x,k,L,A){const R=10*t,V=5*t;return this.int16[R+0]=r,this.int16[R+1]=c,this.int16[R+2]=p,this.int16[R+3]=v,this.int16[R+4]=b,this.int16[R+5]=x,this.uint32[V+3]=k,this.uint16[R+8]=L,this.uint16[R+9]=A,t}}Ie.prototype.bytesPerElement=20,Et("StructArrayLayout6i1ul2ui20",Ie);class ue extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v,b){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,c,p,v,b)}emplace(t,r,c,p,v,b,x){const k=6*t;return this.int16[k+0]=r,this.int16[k+1]=c,this.int16[k+2]=p,this.int16[k+3]=v,this.int16[k+4]=b,this.int16[k+5]=x,t}}ue.prototype.bytesPerElement=12,Et("StructArrayLayout2i2i2i12",ue);class ze extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,r,c,p,v)}emplace(t,r,c,p,v,b){const x=4*t,k=8*t;return this.float32[x+0]=r,this.float32[x+1]=c,this.float32[x+2]=p,this.int16[k+6]=v,this.int16[k+7]=b,t}}ze.prototype.bytesPerElement=16,Et("StructArrayLayout2f1f2i16",ze);class Fe extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v,b){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,c,p,v,b)}emplace(t,r,c,p,v,b,x){const k=16*t,L=4*t,A=8*t;return this.uint8[k+0]=r,this.uint8[k+1]=c,this.float32[L+1]=p,this.float32[L+2]=v,this.int16[A+6]=b,this.int16[A+7]=x,t}}Fe.prototype.bytesPerElement=16,Et("StructArrayLayout2ub2f2i16",Fe);class Ze extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,c)}emplace(t,r,c,p){const v=3*t;return this.uint16[v+0]=r,this.uint16[v+1]=c,this.uint16[v+2]=p,t}}Ze.prototype.bytesPerElement=6,Et("StructArrayLayout3ui6",Ze);class Ye extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v,b,x,k,L,A,R,V,G,X,K,ce,_e){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,t,r,c,p,v,b,x,k,L,A,R,V,G,X,K,ce,_e)}emplace(t,r,c,p,v,b,x,k,L,A,R,V,G,X,K,ce,_e,Ue){const Me=24*t,Oe=12*t,Xe=48*t;return this.int16[Me+0]=r,this.int16[Me+1]=c,this.uint16[Me+2]=p,this.uint16[Me+3]=v,this.uint32[Oe+2]=b,this.uint32[Oe+3]=x,this.uint32[Oe+4]=k,this.uint16[Me+10]=L,this.uint16[Me+11]=A,this.uint16[Me+12]=R,this.float32[Oe+7]=V,this.float32[Oe+8]=G,this.uint8[Xe+36]=X,this.uint8[Xe+37]=K,this.uint8[Xe+38]=ce,this.uint32[Oe+10]=_e,this.int16[Me+22]=Ue,t}}Ye.prototype.bytesPerElement=48,Et("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ye);class ct extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,p,v,b,x,k,L,A,R,V,G,X,K,ce,_e,Ue,Me,Oe,Xe,rt,wt,Zt,bt,_t,Bt,Mt){const Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,t,r,c,p,v,b,x,k,L,A,R,V,G,X,K,ce,_e,Ue,Me,Oe,Xe,rt,wt,Zt,bt,_t,Bt,Mt)}emplace(t,r,c,p,v,b,x,k,L,A,R,V,G,X,K,ce,_e,Ue,Me,Oe,Xe,rt,wt,Zt,bt,_t,Bt,Mt,Ct){const Je=32*t,Ot=16*t;return this.int16[Je+0]=r,this.int16[Je+1]=c,this.int16[Je+2]=p,this.int16[Je+3]=v,this.int16[Je+4]=b,this.int16[Je+5]=x,this.int16[Je+6]=k,this.int16[Je+7]=L,this.uint16[Je+8]=A,this.uint16[Je+9]=R,this.uint16[Je+10]=V,this.uint16[Je+11]=G,this.uint16[Je+12]=X,this.uint16[Je+13]=K,this.uint16[Je+14]=ce,this.uint16[Je+15]=_e,this.uint16[Je+16]=Ue,this.uint16[Je+17]=Me,this.uint16[Je+18]=Oe,this.uint16[Je+19]=Xe,this.uint16[Je+20]=rt,this.uint16[Je+21]=wt,this.uint16[Je+22]=Zt,this.uint32[Ot+12]=bt,this.float32[Ot+13]=_t,this.float32[Ot+14]=Bt,this.uint16[Je+30]=Mt,this.uint16[Je+31]=Ct,t}}ct.prototype.bytesPerElement=64,Et("StructArrayLayout8i15ui1ul2f2ui64",ct);class vt extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}vt.prototype.bytesPerElement=4,Et("StructArrayLayout1f4",vt);class kt extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,c)}emplace(t,r,c,p){const v=3*t;return this.uint16[6*t+0]=r,this.float32[v+1]=c,this.float32[v+2]=p,t}}kt.prototype.bytesPerElement=12,Et("StructArrayLayout1ui2f12",kt);class mt extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,c)}emplace(t,r,c,p){const v=4*t;return this.uint32[2*t+0]=r,this.uint16[v+2]=c,this.uint16[v+3]=p,t}}mt.prototype.bytesPerElement=8,Et("StructArrayLayout1ul2ui8",mt);class pt extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const p=2*t;return this.uint16[p+0]=r,this.uint16[p+1]=c,t}}pt.prototype.bytesPerElement=4,Et("StructArrayLayout2ui4",pt);class Dt extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Dt.prototype.bytesPerElement=2,Et("StructArrayLayout1ui2",Dt);class ti extends _{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,c,p)}emplace(t,r,c,p,v){const b=4*t;return this.float32[b+0]=r,this.float32[b+1]=c,this.float32[b+2]=p,this.float32[b+3]=v,t}}ti.prototype.bytesPerElement=16,Et("StructArrayLayout4f16",ti);class gt extends d{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}gt.prototype.size=20;class xt extends Ie{get(t){return new gt(this,t)}}Et("CollisionBoxArray",xt);class $t extends d{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$t.prototype.size=48;class Ji extends Ye{get(t){return new $t(this,t)}}Et("PlacedSymbolArray",Ji);class oi extends d{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}oi.prototype.size=64;class di extends ct{get(t){return new oi(this,t)}}Et("SymbolInstanceArray",di);class Yi extends vt{getoffsetX(t){return this.float32[1*t+0]}}Et("GlyphOffsetArray",Yi);class Dn extends z{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Et("SymbolLineVertexArray",Dn);class Dr extends d{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Dr.prototype.size=12;class Qi extends kt{get(t){return new Dr(this,t)}}Et("TextAnchorOffsetArray",Qi);class Qn extends d{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Qn.prototype.size=8;class Gn extends mt{get(t){return new Qn(this,t)}}Et("FeatureIndexArray",Gn);class Rn extends M{}class Wn extends M{}class Jr extends M{}class yo extends O{}class Ya extends W{}class vo extends Y{}class xr extends re{}class Qa extends he{}class bu extends ye{}class wr extends xe{}class Sr extends ue{}class _s extends Fe{}class Rr extends Ze{}class Mn extends pt{}const Bn=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:fr}=Bn;class mi{constructor(t=[]){this.segments=t}prepareSegment(t,r,c,p){let v=this.segments[this.segments.length-1];return t>mi.MAX_VERTEX_ARRAY_LENGTH&&ee(`Max vertices per segment is ${mi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!v||v.vertexLength+t>mi.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==p)&&(v={vertexOffset:r.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},p!==void 0&&(v.sortKey=p),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,c,p){return new mi([{vertexOffset:t,primitiveOffset:r,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function Os(n,t){return 256*(n=ve(Math.floor(n),0,255))+ve(Math.floor(t),0,255)}mi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et("SegmentVector",mi);const bo=S([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xo={exports:{}},Gc={exports:{}};Gc.exports=function(n,t){var r,c,p,v,b,x,k,L;for(c=n.length-(r=3&n.length),p=t,b=3432918353,x=461845907,L=0;L<c;)k=255&n.charCodeAt(L)|(255&n.charCodeAt(++L))<<8|(255&n.charCodeAt(++L))<<16|(255&n.charCodeAt(++L))<<24,++L,p=27492+(65535&(v=5*(65535&(p=(p^=k=(65535&(k=(k=(65535&k)*b+(((k>>>16)*b&65535)<<16)&4294967295)<<15|k>>>17))*x+(((k>>>16)*x&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(k=0,r){case 3:k^=(255&n.charCodeAt(L+2))<<16;case 2:k^=(255&n.charCodeAt(L+1))<<8;case 1:p^=k=(65535&(k=(k=(65535&(k^=255&n.charCodeAt(L)))*b+(((k>>>16)*b&65535)<<16)&4294967295)<<15|k>>>17))*x+(((k>>>16)*x&65535)<<16)&4294967295}return p^=n.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var hf=Gc.exports,Wc={exports:{}};Wc.exports=function(n,t){for(var r,c=n.length,p=t^c,v=0;c>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(r>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),c-=4,++v;switch(c){case 3:p^=(255&n.charCodeAt(v+2))<<16;case 2:p^=(255&n.charCodeAt(v+1))<<8;case 1:p=1540483477*(65535&(p^=255&n.charCodeAt(v)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var ys=hf,Hc=Wc.exports;xo.exports=ys,xo.exports.murmur3=ys,xo.exports.murmur2=Hc;var $a=w(xo.exports);class ta{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,c,p){this.ids.push(el(t)),this.positions.push(r,c,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=el(t);let c=0,p=this.ids.length-1;for(;c<p;){const b=c+p>>1;this.ids[b]>=r?p=b:c=b+1}const v=[];for(;this.ids[c]===r;)v.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return v}static serialize(t,r){const c=new Float64Array(t.ids),p=new Uint32Array(t.positions);return tl(c,p,0,c.length-1),r&&r.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(t){const r=new ta;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function el(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:$a(String(n))}function tl(n,t,r,c){for(;r<c;){const p=n[r+c>>1];let v=r-1,b=c+1;for(;;){do v++;while(n[v]<p);do b--;while(n[b]>p);if(v>=b)break;wo(n,v,b),wo(t,3*v,3*b),wo(t,3*v+1,3*b+1),wo(t,3*v+2,3*b+2)}b-r<c-b?(tl(n,t,r,b),r=b+1):(tl(n,t,b+1,c),c=b)}}function wo(n,t,r){const c=n[t];n[t]=n[r],n[r]=c}Et("FeaturePositionMap",ta);class ia{constructor(t,r){this.gl=t.gl,this.location=r}}class Xc extends ia{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Od extends ia{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Nd extends ia{constructor(t,r){super(t,r),this.current=qt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Ly=new Float32Array(16);function ff(n){return[Os(255*n.r,255*n.g),Os(255*n.b,255*n.a)]}class xu{constructor(t,r,c){this.value=t,this.uniformNames=r.map(p=>`u_${p}`),this.type=c}setUniform(t,r,c){t.set(c.constantOr(this.value))}getBinding(t,r,c){return this.type==="color"?new Nd(t,r):new Xc(t,r)}}class il{constructor(t,r){this.uniformNames=r.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,c,p){const v=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,r,c){return c.substr(0,9)==="u_pattern"?new Od(t,r):new Xc(t,r)}}class Ns{constructor(t,r,c,p){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,r,c,p,v){const b=this.paintVertexArray.length,x=this.expression.evaluate(new Ki(0),r,{},p,[],v);this.paintVertexArray.resize(t),this._setPaintValue(b,t,x)}updatePaintArray(t,r,c,p){const v=this.expression.evaluate({zoom:0},c,p);this._setPaintValue(t,r,v)}_setPaintValue(t,r,c){if(this.type==="color"){const p=ff(c);for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,p[0],p[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class as{constructor(t,r,c,p,v,b){this.expression=t,this.uniformNames=r.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=r.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(t,r,c,p,v){const b=this.expression.evaluate(new Ki(this.zoom),r,{},p,[],v),x=this.expression.evaluate(new Ki(this.zoom+1),r,{},p,[],v),k=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(k,t,b,x)}updatePaintArray(t,r,c,p){const v=this.expression.evaluate({zoom:this.zoom},c,p),b=this.expression.evaluate({zoom:this.zoom+1},c,p);this._setPaintValue(t,r,v,b)}_setPaintValue(t,r,c,p){if(this.type==="color"){const v=ff(c),b=ff(p);for(let x=t;x<r;x++)this.paintVertexArray.emplace(x,v[0],v[1],b[0],b[1])}else{for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const c=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=ve(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,r,c){return new Xc(t,r)}}class So{constructor(t,r,c,p,v,b){this.expression=t,this.type=r,this.useIntegerZoom=c,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,r,c){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,r.patterns&&r.patterns[this.layerId],c)}updatePaintArray(t,r,c,p,v){this._setPaintValues(t,r,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(t,r,c,p){if(!p||!c)return;const{min:v,mid:b,max:x}=c,k=p[v],L=p[b],A=p[x];if(k&&L&&A)for(let R=t;R<r;R++)this.zoomInPaintVertexArray.emplace(R,L.tl[0],L.tl[1],L.br[0],L.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],L.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,L.tl[0],L.tl[1],L.br[0],L.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],L.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,bo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,bo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Vd{constructor(t,r,c){this.binders={},this._buffers=[];const p=[];for(const v in t.paint._values){if(!c(v))continue;const b=t.paint.get(v);if(!(b instanceof Kr&&so(b.property.specification)))continue;const x=Py(v,t.type),k=b.value,L=b.property.specification.type,A=b.property.useIntegerZoom,R=b.property.specification["property-type"],V=R==="cross-faded"||R==="cross-faded-data-driven";if(k.kind==="constant")this.binders[v]=V?new il(k.value,x):new xu(k.value,x,L),p.push(`/u_${v}`);else if(k.kind==="source"||V){const G=jd(v,L,"source");this.binders[v]=V?new So(k,L,A,r,G,t.id):new Ns(k,x,L,G),p.push(`/a_${v}`)}else{const G=jd(v,L,"composite");this.binders[v]=new as(k,x,L,A,r,G),p.push(`/z_${v}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Ns||r instanceof as?r.maxValue:0}populatePaintArrays(t,r,c,p,v){for(const b in this.binders){const x=this.binders[b];(x instanceof Ns||x instanceof as||x instanceof So)&&x.populatePaintArray(t,r,c,p,v)}}setConstantPatternPositions(t,r){for(const c in this.binders){const p=this.binders[c];p instanceof il&&p.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,c,p,v){let b=!1;for(const x in t){const k=r.getPositions(x);for(const L of k){const A=c.feature(L.index);for(const R in this.binders){const V=this.binders[R];if((V instanceof Ns||V instanceof as||V instanceof So)&&V.expression.isStateDependent===!0){const G=p.paint.get(R);V.expression=G.value,V.updatePaintArray(L.start,L.end,A,t[x],v),b=!0}}}}return b}defines(){const t=[];for(const r in this.binders){const c=this.binders[r];(c instanceof xu||c instanceof il)&&t.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const c=this.binders[r];if(c instanceof Ns||c instanceof as)for(let p=0;p<c.paintVertexAttributes.length;p++)t.push(c.paintVertexAttributes[p].name);else if(c instanceof So)for(let p=0;p<bo.members.length;p++)t.push(bo.members[p].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const c=this.binders[r];if(c instanceof xu||c instanceof il||c instanceof as)for(const p of c.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const c=[];for(const p in this.binders){const v=this.binders[p];if(v instanceof xu||v instanceof il||v instanceof as){for(const b of v.uniformNames)if(r[b]){const x=v.getBinding(t,r[b],b);c.push({name:b,property:p,binding:x})}}}return c}setUniforms(t,r,c,p){for(const{name:v,property:b,binding:x}of r)this.binders[b].setUniform(x,p,c.get(b),v)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const c=this.binders[r];if(t&&c instanceof So){const p=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(c instanceof Ns||c instanceof as)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const r in this.binders){const c=this.binders[r];(c instanceof Ns||c instanceof as||c instanceof So)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Ns||r instanceof as||r instanceof So)&&r.destroy()}}}class na{constructor(t,r,c=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Vd(p,r,c);this.needsUpload=!1,this._featureMap=new ta,this._bufferOffset=0}populatePaintArrays(t,r,c,p,v,b){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,r,p,v,b);r.id!==void 0&&this._featureMap.add(r.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,c,p){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,r,v,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Py(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function jd(n,t,r){const c={color:{source:Y,composite:ti},number:{source:vt,composite:Y}},p=function(v){return{"line-pattern":{source:xr,composite:xr},"fill-pattern":{source:xr,composite:xr},"fill-extrusion-pattern":{source:xr,composite:xr}}[v]}(n);return p&&p[r]||c[t][r]}Et("ConstantBinder",xu),Et("CrossFadedConstantBinder",il),Et("SourceExpressionBinder",Ns),Et("CrossFadedCompositeBinder",So),Et("CompositeExpressionBinder",as),Et("ProgramConfiguration",Vd,{omit:["_buffers"]}),Et("ProgramConfigurationSet",na);const vn=8192,df=Math.pow(2,14)-1,Ud=-df-1;function ra(n){const t=vn/n.extent,r=n.loadGeometry();for(let c=0;c<r.length;c++){const p=r[c];for(let v=0;v<p.length;v++){const b=p[v],x=Math.round(b.x*t),k=Math.round(b.y*t);b.x=ve(x,Ud,df),b.y=ve(k,Ud,df),(x<b.x||x>b.x+1||k<b.y||k>b.y+1)&&ee("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function sa(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?ra(n):[]}}function Kc(n,t,r,c,p){n.emplaceBack(2*t+(c+1)/2,2*r+(p+1)/2)}class pf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Wn,this.indexArray=new Rr,this.segments=new mi,this.programConfigurations=new na(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,c){const p=this.layers[0],v=[];let b=null,x=!1;p.type==="circle"&&(b=p.layout.get("circle-sort-key"),x=!b.isConstant());for(const{feature:k,id:L,index:A,sourceLayerIndex:R}of t){const V=this.layers[0]._featureFilter.needGeometry,G=sa(k,V);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),G,c))continue;const X=x?b.evaluate(G,{},c):void 0,K={id:L,properties:k.properties,type:k.type,sourceLayerIndex:R,index:A,geometry:V?G.geometry:ra(k),patterns:{},sortKey:X};v.push(K)}x&&v.sort((k,L)=>k.sortKey-L.sortKey);for(const k of v){const{geometry:L,index:A,sourceLayerIndex:R}=k,V=t[A].feature;this.addFeature(k,L,A,c),r.featureIndex.insert(V,L,A,R,this.index)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,c,p){for(const v of r)for(const b of v){const x=b.x,k=b.y;if(x<0||x>=vn||k<0||k>=vn)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=L.vertexLength;Kc(this.layoutVertexArray,x,k,-1,-1),Kc(this.layoutVertexArray,x,k,1,-1),Kc(this.layoutVertexArray,x,k,1,1),Kc(this.layoutVertexArray,x,k,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},p)}}function qd(n,t){for(let r=0;r<n.length;r++)if(nl(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(nl(n,t[r]))return!0;return!!mf(n,t)}function Ay(n,t,r){return!!nl(n,t)||!!gf(t,n,r)}function Zd(n,t){if(n.length===1)return Wd(t,n[0]);for(let r=0;r<t.length;r++){const c=t[r];for(let p=0;p<c.length;p++)if(nl(n,c[p]))return!0}for(let r=0;r<n.length;r++)if(Wd(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(mf(n,t[r]))return!0;return!1}function zy(n,t,r){if(n.length>1){if(mf(n,t))return!0;for(let c=0;c<t.length;c++)if(gf(t[c],n,r))return!0}for(let c=0;c<n.length;c++)if(gf(n[c],t,r))return!0;return!1}function mf(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const c=n[r],p=n[r+1];for(let v=0;v<t.length-1;v++)if(Dy(c,p,t[v],t[v+1]))return!0}return!1}function Dy(n,t,r,c){return me(n,r,c)!==me(t,r,c)&&me(n,t,r)!==me(n,t,c)}function gf(n,t,r){const c=r*r;if(t.length===1)return n.distSqr(t[0])<c;for(let p=1;p<t.length;p++)if(Gd(n,t[p-1],t[p])<c)return!0;return!1}function Gd(n,t,r){const c=t.distSqr(r);if(c===0)return n.distSqr(t);const p=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/c;return n.distSqr(p<0?t:p>1?r:r.sub(t)._mult(p)._add(t))}function Wd(n,t){let r,c,p,v=!1;for(let b=0;b<n.length;b++){r=n[b];for(let x=0,k=r.length-1;x<r.length;k=x++)c=r[x],p=r[k],c.y>t.y!=p.y>t.y&&t.x<(p.x-c.x)*(t.y-c.y)/(p.y-c.y)+c.x&&(v=!v)}return v}function nl(n,t){let r=!1;for(let c=0,p=n.length-1;c<n.length;p=c++){const v=n[c],b=n[p];v.y>t.y!=b.y>t.y&&t.x<(b.x-v.x)*(t.y-v.y)/(b.y-v.y)+v.x&&(r=!r)}return r}function Ry(n,t,r){const c=r[0],p=r[2];if(n.x<c.x&&t.x<c.x||n.x>p.x&&t.x>p.x||n.y<c.y&&t.y<c.y||n.y>p.y&&t.y>p.y)return!1;const v=me(n,t,r[0]);return v!==me(n,t,r[1])||v!==me(n,t,r[2])||v!==me(n,t,r[3])}function wu(n,t,r){const c=t.paint.get(n).value;return c.kind==="constant"?c.value:r.programConfigurations.get(t.id).getMaxValue(n)}function Jc(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Yc(n,t,r,c,p){if(!t[0]&&!t[1])return n;const v=C.convert(t)._mult(p);r==="viewport"&&v._rotate(-c);const b=[];for(let x=0;x<n.length;x++)b.push(n[x].sub(v));return b}let Hd,Xd;Et("CircleBucket",pf,{omit:["layers"]});var By={get paint(){return Xd=Xd||new y({"circle-radius":new Kt(je.paint_circle["circle-radius"]),"circle-color":new Kt(je.paint_circle["circle-color"]),"circle-blur":new Kt(je.paint_circle["circle-blur"]),"circle-opacity":new Kt(je.paint_circle["circle-opacity"]),"circle-translate":new zt(je.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(je.paint_circle["circle-stroke-opacity"])})},get layout(){return Hd=Hd||new y({"circle-sort-key":new Kt(je.layout_circle["circle-sort-key"])})}},$n=1e-6,rl=typeof Float32Array<"u"?Float32Array:Array;function _f(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Kd(n,t,r){var c=t[0],p=t[1],v=t[2],b=t[3],x=t[4],k=t[5],L=t[6],A=t[7],R=t[8],V=t[9],G=t[10],X=t[11],K=t[12],ce=t[13],_e=t[14],Ue=t[15],Me=r[0],Oe=r[1],Xe=r[2],rt=r[3];return n[0]=Me*c+Oe*x+Xe*R+rt*K,n[1]=Me*p+Oe*k+Xe*V+rt*ce,n[2]=Me*v+Oe*L+Xe*G+rt*_e,n[3]=Me*b+Oe*A+Xe*X+rt*Ue,n[4]=(Me=r[4])*c+(Oe=r[5])*x+(Xe=r[6])*R+(rt=r[7])*K,n[5]=Me*p+Oe*k+Xe*V+rt*ce,n[6]=Me*v+Oe*L+Xe*G+rt*_e,n[7]=Me*b+Oe*A+Xe*X+rt*Ue,n[8]=(Me=r[8])*c+(Oe=r[9])*x+(Xe=r[10])*R+(rt=r[11])*K,n[9]=Me*p+Oe*k+Xe*V+rt*ce,n[10]=Me*v+Oe*L+Xe*G+rt*_e,n[11]=Me*b+Oe*A+Xe*X+rt*Ue,n[12]=(Me=r[12])*c+(Oe=r[13])*x+(Xe=r[14])*R+(rt=r[15])*K,n[13]=Me*p+Oe*k+Xe*V+rt*ce,n[14]=Me*v+Oe*L+Xe*G+rt*_e,n[15]=Me*b+Oe*A+Xe*X+rt*Ue,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Su,Fy=Kd;function Qc(n,t,r){var c=t[0],p=t[1],v=t[2],b=t[3];return n[0]=r[0]*c+r[4]*p+r[8]*v+r[12]*b,n[1]=r[1]*c+r[5]*p+r[9]*v+r[13]*b,n[2]=r[2]*c+r[6]*p+r[10]*v+r[14]*b,n[3]=r[3]*c+r[7]*p+r[11]*v+r[15]*b,n}Su=new rl(4),rl!=Float32Array&&(Su[0]=0,Su[1]=0,Su[2]=0,Su[3]=0);class Oy extends l{constructor(t){super(t,By)}createBucket(t){return new pf(t)}queryRadius(t){const r=t;return wu("circle-radius",this,r)+wu("circle-stroke-width",this,r)+Jc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,c,p,v,b,x,k){const L=Yc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,x),A=this.paint.get("circle-radius").evaluate(r,c)+this.paint.get("circle-stroke-width").evaluate(r,c),R=this.paint.get("circle-pitch-alignment")==="map",V=R?L:function(X,K){return X.map(ce=>Jd(ce,K))}(L,k),G=R?A*x:A;for(const X of p)for(const K of X){const ce=R?K:Jd(K,k);let _e=G;const Ue=Qc([],[K.x,K.y,0,1],k);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?_e*=Ue[3]/b.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(_e*=b.cameraToCenterDistance/Ue[3]),Ay(V,ce,_e))return!0}return!1}}function Jd(n,t){const r=Qc([],[n.x,n.y,0,1],t);return new C(r[0]/r[3],r[1]/r[3])}class Yd extends pf{}let Qd;Et("HeatmapBucket",Yd,{omit:["layers"]});var Ny={get paint(){return Qd=Qd||new y({"heatmap-radius":new Kt(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vu(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(je.paint_heatmap["heatmap-opacity"])})}};function yf(n,{width:t,height:r},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*r*c)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*r*c}`)}else p=new Uint8Array(t*r*c);return n.width=t,n.height=r,n.data=p,n}function $d(n,{width:t,height:r},c){if(t===n.width&&r===n.height)return;const p=yf({},{width:t,height:r},c);vf(n,p,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},c),n.width=t,n.height=r,n.data=p.data}function vf(n,t,r,c,p,v){if(p.width===0||p.height===0)return t;if(p.width>n.width||p.height>n.height||r.x>n.width-p.width||r.y>n.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||c.x>t.width-p.width||c.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=n.data,x=t.data;if(b===x)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<p.height;k++){const L=((r.y+k)*n.width+r.x)*v,A=((c.y+k)*t.width+c.x)*v;for(let R=0;R<p.width*v;R++)x[A+R]=b[L+R]}return t}class ku{constructor(t,r){yf(this,t,1,r)}resize(t){$d(this,t,1)}clone(){return new ku({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,p,v){vf(t,r,c,p,v,1)}}class Br{constructor(t,r){yf(this,t,4,r)}resize(t){$d(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Br({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,p,v){vf(t,r,c,p,v,4)}}function ep(n){const t={},r=n.resolution||256,c=n.clips?n.clips.length:1,p=n.image||new Br({width:r,height:c});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const v=(b,x,k)=>{t[n.evaluationKey]=k;const L=n.expression.evaluate(t);p.data[b+x+0]=Math.floor(255*L.r/L.a),p.data[b+x+1]=Math.floor(255*L.g/L.a),p.data[b+x+2]=Math.floor(255*L.b/L.a),p.data[b+x+3]=Math.floor(255*L.a)};if(n.clips)for(let b=0,x=0;b<c;++b,x+=4*r)for(let k=0,L=0;k<r;k++,L+=4){const A=k/(r-1),{start:R,end:V}=n.clips[b];v(x,L,R*(1-A)+V*A)}else for(let b=0,x=0;b<r;b++,x+=4)v(0,x,b/(r-1));return p}Et("AlphaImage",ku),Et("RGBAImage",Br);const bf="big-fb";class Vy extends l{createBucket(t){return new Yd(t)}constructor(t){super(t,Ny),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ep({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(bf)&&this.heatmapFbos.delete(bf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let tp;var jy={get paint(){return tp=tp||new y({"hillshade-illumination-direction":new zt(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zt(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(je.paint_hillshade["hillshade-accent-color"])})}};class Uy extends l{constructor(t){super(t,jy)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const qy=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zy}=qy;function ip(n,t,r=2){const c=t&&t.length,p=c?t[0]*r:n.length;let v=np(n,0,p,r,!0);const b=[];if(!v||v.next===v.prev)return b;let x,k,L;if(c&&(v=function(A,R,V,G){const X=[];for(let K=0,ce=R.length;K<ce;K++){const _e=np(A,R[K]*G,K<ce-1?R[K+1]*G:A.length,G,!1);_e===_e.next&&(_e.steiner=!0),X.push(Qy(_e))}X.sort(Ky);for(let K=0;K<X.length;K++)V=Jy(X[K],V);return V}(n,t,v,r)),n.length>80*r){x=1/0,k=1/0;let A=-1/0,R=-1/0;for(let V=r;V<p;V+=r){const G=n[V],X=n[V+1];G<x&&(x=G),X<k&&(k=X),G>A&&(A=G),X>R&&(R=X)}L=Math.max(A-x,R-k),L=L!==0?32767/L:0}return Tu(v,b,r,x,k,L,0),b}function np(n,t,r,c,p){let v;if(p===function(b,x,k,L){let A=0;for(let R=x,V=k-L;R<k;R+=L)A+=(b[V]-b[R])*(b[R+1]+b[V+1]),V=R;return A}(n,t,r,c)>0)for(let b=t;b<r;b+=c)v=op(b/c|0,n[b],n[b+1],v);else for(let b=r-c;b>=t;b-=c)v=op(b/c|0,n[b],n[b+1],v);return v&&$c(v,v.next)&&(Iu(v),v=v.next),v}function oa(n,t){if(!n)return n;t||(t=n);let r,c=n;do if(r=!1,c.steiner||!$c(c,c.next)&&_n(c.prev,c,c.next)!==0)c=c.next;else{if(Iu(c),c=t=c.prev,c===c.next)break;r=!0}while(r||c!==t);return t}function Tu(n,t,r,c,p,v,b){if(!n)return;!b&&v&&function(k,L,A,R){let V=k;do V.z===0&&(V.z=xf(V.x,V.y,L,A,R)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==k);V.prevZ.nextZ=null,V.prevZ=null,function(G){let X,K=1;do{let ce,_e=G;G=null;let Ue=null;for(X=0;_e;){X++;let Me=_e,Oe=0;for(let rt=0;rt<K&&(Oe++,Me=Me.nextZ,Me);rt++);let Xe=K;for(;Oe>0||Xe>0&&Me;)Oe!==0&&(Xe===0||!Me||_e.z<=Me.z)?(ce=_e,_e=_e.nextZ,Oe--):(ce=Me,Me=Me.nextZ,Xe--),Ue?Ue.nextZ=ce:G=ce,ce.prevZ=Ue,Ue=ce;_e=Me}Ue.nextZ=null,K*=2}while(X>1)}(V)}(n,c,p,v);let x=n;for(;n.prev!==n.next;){const k=n.prev,L=n.next;if(v?Wy(n,c,p,v):Gy(n))t.push(k.i,n.i,L.i),Iu(n),n=L.next,x=L.next;else if((n=L)===x){b?b===1?Tu(n=Hy(oa(n),t),t,r,c,p,v,2):b===2&&Xy(n,t,r,c,p,v):Tu(oa(n),t,r,c,p,v,1);break}}}function Gy(n){const t=n.prev,r=n,c=n.next;if(_n(t,r,c)>=0)return!1;const p=t.x,v=r.x,b=c.x,x=t.y,k=r.y,L=c.y,A=p<v?p<b?p:b:v<b?v:b,R=x<k?x<L?x:L:k<L?k:L,V=p>v?p>b?p:b:v>b?v:b,G=x>k?x>L?x:L:k>L?k:L;let X=c.next;for(;X!==t;){if(X.x>=A&&X.x<=V&&X.y>=R&&X.y<=G&&sl(p,x,v,k,b,L,X.x,X.y)&&_n(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function Wy(n,t,r,c){const p=n.prev,v=n,b=n.next;if(_n(p,v,b)>=0)return!1;const x=p.x,k=v.x,L=b.x,A=p.y,R=v.y,V=b.y,G=x<k?x<L?x:L:k<L?k:L,X=A<R?A<V?A:V:R<V?R:V,K=x>k?x>L?x:L:k>L?k:L,ce=A>R?A>V?A:V:R>V?R:V,_e=xf(G,X,t,r,c),Ue=xf(K,ce,t,r,c);let Me=n.prevZ,Oe=n.nextZ;for(;Me&&Me.z>=_e&&Oe&&Oe.z<=Ue;){if(Me.x>=G&&Me.x<=K&&Me.y>=X&&Me.y<=ce&&Me!==p&&Me!==b&&sl(x,A,k,R,L,V,Me.x,Me.y)&&_n(Me.prev,Me,Me.next)>=0||(Me=Me.prevZ,Oe.x>=G&&Oe.x<=K&&Oe.y>=X&&Oe.y<=ce&&Oe!==p&&Oe!==b&&sl(x,A,k,R,L,V,Oe.x,Oe.y)&&_n(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;Me&&Me.z>=_e;){if(Me.x>=G&&Me.x<=K&&Me.y>=X&&Me.y<=ce&&Me!==p&&Me!==b&&sl(x,A,k,R,L,V,Me.x,Me.y)&&_n(Me.prev,Me,Me.next)>=0)return!1;Me=Me.prevZ}for(;Oe&&Oe.z<=Ue;){if(Oe.x>=G&&Oe.x<=K&&Oe.y>=X&&Oe.y<=ce&&Oe!==p&&Oe!==b&&sl(x,A,k,R,L,V,Oe.x,Oe.y)&&_n(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function Hy(n,t){let r=n;do{const c=r.prev,p=r.next.next;!$c(c,p)&&rp(c,r,r.next,p)&&Cu(c,p)&&Cu(p,c)&&(t.push(c.i,r.i,p.i),Iu(r),Iu(r.next),r=n=p),r=r.next}while(r!==n);return oa(r)}function Xy(n,t,r,c,p,v){let b=n;do{let x=b.next.next;for(;x!==b.prev;){if(b.i!==x.i&&$y(b,x)){let k=sp(b,x);return b=oa(b,b.next),k=oa(k,k.next),Tu(b,t,r,c,p,v,0),void Tu(k,t,r,c,p,v,0)}x=x.next}b=b.next}while(b!==n)}function Ky(n,t){return n.x-t.x}function Jy(n,t){const r=function(p,v){let b=v;const x=p.x,k=p.y;let L,A=-1/0;do{if(k<=b.y&&k>=b.next.y&&b.next.y!==b.y){const K=b.x+(k-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(K<=x&&K>A&&(A=K,L=b.x<b.next.x?b:b.next,K===x))return L}b=b.next}while(b!==v);if(!L)return null;const R=L,V=L.x,G=L.y;let X=1/0;b=L;do{if(x>=b.x&&b.x>=V&&x!==b.x&&sl(k<G?x:A,k,V,G,k<G?A:x,k,b.x,b.y)){const K=Math.abs(k-b.y)/(x-b.x);Cu(b,p)&&(K<X||K===X&&(b.x>L.x||b.x===L.x&&Yy(L,b)))&&(L=b,X=K)}b=b.next}while(b!==R);return L}(n,t);if(!r)return t;const c=sp(r,n);return oa(c,c.next),oa(r,r.next)}function Yy(n,t){return _n(n.prev,n,t.prev)<0&&_n(t.next,n,n.next)<0}function xf(n,t,r,c,p){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qy(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function sl(n,t,r,c,p,v,b,x){return(p-b)*(t-x)>=(n-b)*(v-x)&&(n-b)*(c-x)>=(r-b)*(t-x)&&(r-b)*(v-x)>=(p-b)*(c-x)}function $y(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,c){let p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==c.i&&p.next.i!==c.i&&rp(p,p.next,r,c))return!0;p=p.next}while(p!==r);return!1}(n,t)&&(Cu(n,t)&&Cu(t,n)&&function(r,c){let p=r,v=!1;const b=(r.x+c.x)/2,x=(r.y+c.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&b<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(v=!v),p=p.next;while(p!==r);return v}(n,t)&&(_n(n.prev,n,t.prev)||_n(n,t.prev,t))||$c(n,t)&&_n(n.prev,n,n.next)>0&&_n(t.prev,t,t.next)>0)}function _n(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function $c(n,t){return n.x===t.x&&n.y===t.y}function rp(n,t,r,c){const p=th(_n(n,t,r)),v=th(_n(n,t,c)),b=th(_n(r,c,n)),x=th(_n(r,c,t));return p!==v&&b!==x||!(p!==0||!eh(n,r,t))||!(v!==0||!eh(n,c,t))||!(b!==0||!eh(r,n,c))||!(x!==0||!eh(r,t,c))}function eh(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function th(n){return n>0?1:n<0?-1:0}function Cu(n,t){return _n(n.prev,n,n.next)<0?_n(n,t,n.next)>=0&&_n(n,n.prev,t)>=0:_n(n,t,n.prev)<0||_n(n,n.next,t)<0}function sp(n,t){const r=wf(n.i,n.x,n.y),c=wf(t.i,t.x,t.y),p=n.next,v=t.prev;return n.next=t,t.prev=n,r.next=p,p.prev=r,c.next=r,r.prev=c,v.next=c,c.prev=v,c}function op(n,t,r,c){const p=wf(n,t,r);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Iu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function wf(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Sf(n,t,r){const c=r.patternDependencies;let p=!1;for(const v of t){const b=v.paint.get(`${n}-pattern`);b.isConstant()||(p=!0);const x=b.constantOr(null);x&&(p=!0,c[x.to]=!0,c[x.from]=!0)}return p}function kf(n,t,r,c,p){const v=p.patternDependencies;for(const b of t){const x=b.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let k=x.evaluate({zoom:c-1},r,{},p.availableImages),L=x.evaluate({zoom:c},r,{},p.availableImages),A=x.evaluate({zoom:c+1},r,{},p.availableImages);k=k&&k.name?k.name:k,L=L&&L.name?L.name:L,A=A&&A.name?A.name:A,v[k]=!0,v[L]=!0,v[A]=!0,r.patterns[b.id]={min:k,mid:L,max:A}}}return r}class Tf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jr,this.indexArray=new Rr,this.indexArray2=new Mn,this.programConfigurations=new na(t.layers,t.zoom),this.segments=new mi,this.segments2=new mi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,c){this.hasPattern=Sf("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),v=!p.isConstant(),b=[];for(const{feature:x,id:k,index:L,sourceLayerIndex:A}of t){const R=this.layers[0]._featureFilter.needGeometry,V=sa(x,R);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),V,c))continue;const G=v?p.evaluate(V,{},c,r.availableImages):void 0,X={id:k,properties:x.properties,type:x.type,sourceLayerIndex:A,index:L,geometry:R?V.geometry:ra(x),patterns:{},sortKey:G};b.push(X)}v&&b.sort((x,k)=>x.sortKey-k.sortKey);for(const x of b){const{geometry:k,index:L,sourceLayerIndex:A}=x;if(this.hasPattern){const R=kf("fill",this.layers,x,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(x,k,L,c,{});r.featureIndex.insert(t[L].feature,k,L,A,this.index)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,c)}addFeatures(t,r,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zy),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,c,p,v){for(const b of Ma(r,500)){let x=0;for(const G of b)x+=G.length;const k=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),L=k.vertexLength,A=[],R=[];for(const G of b){if(G.length===0)continue;G!==b[0]&&R.push(A.length/2);const X=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),K=X.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(K+G.length-1,K),A.push(G[0].x),A.push(G[0].y);for(let ce=1;ce<G.length;ce++)this.layoutVertexArray.emplaceBack(G[ce].x,G[ce].y),this.indexArray2.emplaceBack(K+ce-1,K+ce),A.push(G[ce].x),A.push(G[ce].y);X.vertexLength+=G.length,X.primitiveLength+=G.length}const V=ip(A,R);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(L+V[G],L+V[G+1],L+V[G+2]);k.vertexLength+=x,k.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,p)}}let ap,lp;Et("FillBucket",Tf,{omit:["layers","patternFeatures"]});var e0={get paint(){return lp=lp||new y({"fill-antialias":new zt(je.paint_fill["fill-antialias"]),"fill-opacity":new Kt(je.paint_fill["fill-opacity"]),"fill-color":new Kt(je.paint_fill["fill-color"]),"fill-outline-color":new Kt(je.paint_fill["fill-outline-color"]),"fill-translate":new zt(je.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ka(je.paint_fill["fill-pattern"])})},get layout(){return ap=ap||new y({"fill-sort-key":new Kt(je.layout_fill["fill-sort-key"])})}};class t0 extends l{constructor(t){super(t,e0)}recalculate(t,r){super.recalculate(t,r);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Tf(t)}queryRadius(){return Jc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,c,p,v,b,x){return Zd(Yc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,x),p)}isTileClipped(){return!0}}const i0=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),n0=S([{name:"a_centroid",components:2,type:"Int16"}],4),{members:r0}=i0;var ko={},s0=I,up=ol;function ol(n,t,r,c,p){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=c,this._values=p,n.readFields(o0,this,t)}function o0(n,t,r){n==1?t.id=r.readVarint():n==2?function(c,p){for(var v=c.readVarint()+c.pos;c.pos<v;){var b=p._keys[c.readVarint()],x=p._values[c.readVarint()];p.properties[b]=x}}(r,t):n==3?t.type=r.readVarint():n==4&&(t._geometry=r.pos)}function a0(n){for(var t,r,c=0,p=0,v=n.length,b=v-1;p<v;b=p++)c+=((r=n[b]).x-(t=n[p]).x)*(t.y+r.y);return c}ol.types=["Unknown","Point","LineString","Polygon"],ol.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,r=n.readVarint()+n.pos,c=1,p=0,v=0,b=0,x=[];n.pos<r;){if(p<=0){var k=n.readVarint();c=7&k,p=k>>3}if(p--,c===1||c===2)v+=n.readSVarint(),b+=n.readSVarint(),c===1&&(t&&x.push(t),t=[]),t.push(new s0(v,b));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&x.push(t),x},ol.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,r=1,c=0,p=0,v=0,b=1/0,x=-1/0,k=1/0,L=-1/0;n.pos<t;){if(c<=0){var A=n.readVarint();r=7&A,c=A>>3}if(c--,r===1||r===2)(p+=n.readSVarint())<b&&(b=p),p>x&&(x=p),(v+=n.readSVarint())<k&&(k=v),v>L&&(L=v);else if(r!==7)throw new Error("unknown command "+r)}return[b,k,x,L]},ol.prototype.toGeoJSON=function(n,t,r){var c,p,v=this.extent*Math.pow(2,r),b=this.extent*n,x=this.extent*t,k=this.loadGeometry(),L=ol.types[this.type];function A(G){for(var X=0;X<G.length;X++){var K=G[X];G[X]=[360*(K.x+b)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+x)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(c=0;c<k.length;c++)R[c]=k[c][0];A(k=R);break;case 2:for(c=0;c<k.length;c++)A(k[c]);break;case 3:for(k=function(G){var X=G.length;if(X<=1)return[G];for(var K,ce,_e=[],Ue=0;Ue<X;Ue++){var Me=a0(G[Ue]);Me!==0&&(ce===void 0&&(ce=Me<0),ce===Me<0?(K&&_e.push(K),K=[G[Ue]]):K.push(G[Ue]))}return K&&_e.push(K),_e}(k),c=0;c<k.length;c++)for(p=0;p<k[c].length;p++)A(k[c][p])}k.length===1?k=k[0]:L="Multi"+L;var V={type:"Feature",geometry:{type:L,coordinates:k},properties:this.properties};return"id"in this&&(V.id=this.id),V};var l0=up,cp=hp;function hp(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(u0,this,t),this.length=this._features.length}function u0(n,t,r){n===15?t.version=r.readVarint():n===1?t.name=r.readString():n===5?t.extent=r.readVarint():n===2?t._features.push(r.pos):n===3?t._keys.push(r.readString()):n===4&&t._values.push(function(c){for(var p=null,v=c.readVarint()+c.pos;c.pos<v;){var b=c.readVarint()>>3;p=b===1?c.readString():b===2?c.readFloat():b===3?c.readDouble():b===4?c.readVarint64():b===5?c.readVarint():b===6?c.readSVarint():b===7?c.readBoolean():null}return p}(r))}hp.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new l0(this._pbf,t,this.extent,this._keys,this._values)};var c0=cp;function h0(n,t,r){if(n===3){var c=new c0(r,r.readVarint()+r.pos);c.length&&(t[c.name]=c)}}ko.VectorTile=function(n,t){this.layers=n.readFields(h0,{},t)},ko.VectorTileFeature=up,ko.VectorTileLayer=cp;const f0=ko.VectorTileFeature.types,Cf=Math.pow(2,13);function Eu(n,t,r,c,p,v,b,x){n.emplaceBack(t,r,2*Math.floor(c*Cf)+b,p*Cf*2,v*Cf*2,Math.round(x))}class If{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yo,this.centroidVertexArray=new Rn,this.indexArray=new Rr,this.programConfigurations=new na(t.layers,t.zoom),this.segments=new mi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,c){this.features=[],this.hasPattern=Sf("fill-extrusion",this.layers,r);for(const{feature:p,id:v,index:b,sourceLayerIndex:x}of t){const k=this.layers[0]._featureFilter.needGeometry,L=sa(p,k);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),L,c))continue;const A={id:v,sourceLayerIndex:x,index:b,geometry:k?L.geometry:ra(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(kf("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,b,c,{}),r.featureIndex.insert(p,A.geometry,b,x,this.index,!0)}}addFeatures(t,r,c){for(const p of this.features){const{geometry:v}=p;this.addFeature(p,v,p.index,r,c)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,r0),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,n0.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,c,p,v){for(const b of Ma(r,500)){const x={x:0,y:0,vertexCount:0};let k=0;for(const X of b)k+=X.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const X of b){if(X.length===0||p0(X))continue;let K=0;for(let ce=0;ce<X.length;ce++){const _e=X[ce];if(ce>=1){const Ue=X[ce-1];if(!d0(_e,Ue)){L.vertexLength+4>mi.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Me=_e.sub(Ue)._perp()._unit(),Oe=Ue.dist(_e);K+Oe>32768&&(K=0),Eu(this.layoutVertexArray,_e.x,_e.y,Me.x,Me.y,0,0,K),Eu(this.layoutVertexArray,_e.x,_e.y,Me.x,Me.y,0,1,K),x.x+=2*_e.x,x.y+=2*_e.y,x.vertexCount+=2,K+=Oe,Eu(this.layoutVertexArray,Ue.x,Ue.y,Me.x,Me.y,0,0,K),Eu(this.layoutVertexArray,Ue.x,Ue.y,Me.x,Me.y,0,1,K),x.x+=2*Ue.x,x.y+=2*Ue.y,x.vertexCount+=2;const Xe=L.vertexLength;this.indexArray.emplaceBack(Xe,Xe+2,Xe+1),this.indexArray.emplaceBack(Xe+1,Xe+2,Xe+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+k>mi.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),f0[t.type]!=="Polygon")continue;const A=[],R=[],V=L.vertexLength;for(const X of b)if(X.length!==0){X!==b[0]&&R.push(A.length/2);for(let K=0;K<X.length;K++){const ce=X[K];Eu(this.layoutVertexArray,ce.x,ce.y,0,0,1,1,0),x.x+=ce.x,x.y+=ce.y,x.vertexCount+=1,A.push(ce.x),A.push(ce.y)}}const G=ip(A,R);for(let X=0;X<G.length;X+=3)this.indexArray.emplaceBack(V+G[X],V+G[X+2],V+G[X+1]);L.primitiveLength+=G.length/3,L.vertexLength+=k;for(let X=0;X<x.vertexCount;X++){const K=Math.floor(x.x/x.vertexCount),ce=Math.floor(x.y/x.vertexCount);this.centroidVertexArray.emplaceBack(K,ce)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,p)}}function d0(n,t){return n.x===t.x&&(n.x<0||n.x>vn)||n.y===t.y&&(n.y<0||n.y>vn)}function p0(n){return n.every(t=>t.x<0)||n.every(t=>t.x>vn)||n.every(t=>t.y<0)||n.every(t=>t.y>vn)}let fp;Et("FillExtrusionBucket",If,{omit:["layers","features"]});var m0={get paint(){return fp=fp||new y({"fill-extrusion-opacity":new zt(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ka(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kt(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class g0 extends l{constructor(t){super(t,m0)}createBucket(t){return new If(t)}queryRadius(){return Jc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,c,p,v,b,x,k){const L=Yc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,x),A=this.paint.get("fill-extrusion-height").evaluate(r,c),R=this.paint.get("fill-extrusion-base").evaluate(r,c),V=function(X,K,ce,_e){const Ue=[];for(const Me of X){const Oe=[Me.x,Me.y,0,1];Qc(Oe,Oe,K),Ue.push(new C(Oe[0]/Oe[3],Oe[1]/Oe[3]))}return Ue}(L,k),G=function(X,K,ce,_e){const Ue=[],Me=[],Oe=_e[8]*K,Xe=_e[9]*K,rt=_e[10]*K,wt=_e[11]*K,Zt=_e[8]*ce,bt=_e[9]*ce,_t=_e[10]*ce,Bt=_e[11]*ce;for(const Mt of X){const Ct=[],Je=[];for(const Ot of Mt){const Rt=Ot.x,ei=Ot.y,ji=_e[0]*Rt+_e[4]*ei+_e[12],Ni=_e[1]*Rt+_e[5]*ei+_e[13],Tn=_e[2]*Rt+_e[6]*ei+_e[14],Yr=_e[3]*Rt+_e[7]*ei+_e[15],On=Tn+rt,Cn=Yr+wt,er=ji+Zt,tr=Ni+bt,ir=Tn+_t,mn=Yr+Bt,In=new C((ji+Oe)/Cn,(Ni+Xe)/Cn);In.z=On/Cn,Ct.push(In);const Hn=new C(er/mn,tr/mn);Hn.z=ir/mn,Je.push(Hn)}Ue.push(Ct),Me.push(Je)}return[Ue,Me]}(p,R,A,k);return function(X,K,ce){let _e=1/0;Zd(ce,K)&&(_e=dp(ce,K[0]));for(let Ue=0;Ue<K.length;Ue++){const Me=K[Ue],Oe=X[Ue];for(let Xe=0;Xe<Me.length-1;Xe++){const rt=Me[Xe],wt=[rt,Me[Xe+1],Oe[Xe+1],Oe[Xe],rt];qd(ce,wt)&&(_e=Math.min(_e,dp(ce,wt)))}}return _e!==1/0&&_e}(G[0],G[1],V)}}function Mu(n,t){return n.x*t.x+n.y*t.y}function dp(n,t){if(n.length===1){let r=0;const c=t[r++];let p;for(;!p||c.equals(p);)if(p=t[r++],!p)return 1/0;for(;r<t.length;r++){const v=t[r],b=n[0],x=p.sub(c),k=v.sub(c),L=b.sub(c),A=Mu(x,x),R=Mu(x,k),V=Mu(k,k),G=Mu(L,x),X=Mu(L,k),K=A*V-R*R,ce=(V*G-R*X)/K,_e=(A*X-R*G)/K,Ue=c.z*(1-ce-_e)+p.z*ce+v.z*_e;if(isFinite(Ue))return Ue}return 1/0}{let r=1/0;for(const c of t)r=Math.min(r,c.z);return r}}const _0=S([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:y0}=_0,v0=S([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:b0}=v0,x0=ko.VectorTileFeature.types,w0=Math.cos(Math.PI/180*37.5),pp=Math.pow(2,14)/.5;class Ef{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ya,this.layoutVertexArray2=new vo,this.indexArray=new Rr,this.programConfigurations=new na(t.layers,t.zoom),this.segments=new mi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,c){this.hasPattern=Sf("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),v=!p.isConstant(),b=[];for(const{feature:x,id:k,index:L,sourceLayerIndex:A}of t){const R=this.layers[0]._featureFilter.needGeometry,V=sa(x,R);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),V,c))continue;const G=v?p.evaluate(V,{},c):void 0,X={id:k,properties:x.properties,type:x.type,sourceLayerIndex:A,index:L,geometry:R?V.geometry:ra(x),patterns:{},sortKey:G};b.push(X)}v&&b.sort((x,k)=>x.sortKey-k.sortKey);for(const x of b){const{geometry:k,index:L,sourceLayerIndex:A}=x;if(this.hasPattern){const R=kf("line",this.layers,x,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(x,k,L,c,{});r.featureIndex.insert(t[L].feature,k,L,A,this.index)}}update(t,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,c)}addFeatures(t,r,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,b0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,y0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,c,p,v){const b=this.layers[0].layout,x=b.get("line-join").evaluate(t,{}),k=b.get("line-cap"),L=b.get("line-miter-limit"),A=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const R of r)this.addLine(R,t,x,k,L,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,v,p)}addLine(t,r,c,p,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _e=0;_e<t.length-1;_e++)this.totalDistance+=t[_e].dist(t[_e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=x0[r.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let L=0;for(;L<k-1&&t[L].equals(t[L+1]);)L++;if(k<(x?3:2))return;c==="bevel"&&(v=1.05);const A=this.overscaling<=16?15*vn/(512*this.overscaling):0,R=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let V,G,X,K,ce;this.e1=this.e2=-1,x&&(V=t[k-2],ce=t[L].sub(V)._unit()._perp());for(let _e=L;_e<k;_e++){if(X=_e===k-1?x?t[L+1]:void 0:t[_e+1],X&&t[_e].equals(X))continue;ce&&(K=ce),V&&(G=V),V=t[_e],ce=X?X.sub(V)._unit()._perp():K,K=K||ce;let Ue=K.add(ce);Ue.x===0&&Ue.y===0||Ue._unit();const Me=K.x*ce.x+K.y*ce.y,Oe=Ue.x*ce.x+Ue.y*ce.y,Xe=Oe!==0?1/Oe:1/0,rt=2*Math.sqrt(2-2*Oe),wt=Oe<w0&&G&&X,Zt=K.x*ce.y-K.y*ce.x>0;if(wt&&_e>L){const Bt=V.dist(G);if(Bt>2*A){const Mt=V.sub(V.sub(G)._mult(A/Bt)._round());this.updateDistance(G,Mt),this.addCurrentVertex(Mt,K,0,0,R),G=Mt}}const bt=G&&X;let _t=bt?c:x?"butt":p;if(bt&&_t==="round"&&(Xe<b?_t="miter":Xe<=2&&(_t="fakeround")),_t==="miter"&&Xe>v&&(_t="bevel"),_t==="bevel"&&(Xe>2&&(_t="flipbevel"),Xe<v&&(_t="miter")),G&&this.updateDistance(G,V),_t==="miter")Ue._mult(Xe),this.addCurrentVertex(V,Ue,0,0,R);else if(_t==="flipbevel"){if(Xe>100)Ue=ce.mult(-1);else{const Bt=Xe*K.add(ce).mag()/K.sub(ce).mag();Ue._perp()._mult(Bt*(Zt?-1:1))}this.addCurrentVertex(V,Ue,0,0,R),this.addCurrentVertex(V,Ue.mult(-1),0,0,R)}else if(_t==="bevel"||_t==="fakeround"){const Bt=-Math.sqrt(Xe*Xe-1),Mt=Zt?Bt:0,Ct=Zt?0:Bt;if(G&&this.addCurrentVertex(V,K,Mt,Ct,R),_t==="fakeround"){const Je=Math.round(180*rt/Math.PI/20);for(let Ot=1;Ot<Je;Ot++){let Rt=Ot/Je;if(Rt!==.5){const ji=Rt-.5;Rt+=Rt*ji*(Rt-1)*((1.0904+Me*(Me*(3.55645-1.43519*Me)-3.2452))*ji*ji+(.848013+Me*(.215638*Me-1.06021)))}const ei=ce.sub(K)._mult(Rt)._add(K)._unit()._mult(Zt?-1:1);this.addHalfVertex(V,ei.x,ei.y,!1,Zt,0,R)}}X&&this.addCurrentVertex(V,ce,-Mt,-Ct,R)}else if(_t==="butt")this.addCurrentVertex(V,Ue,0,0,R);else if(_t==="square"){const Bt=G?1:-1;this.addCurrentVertex(V,Ue,Bt,Bt,R)}else _t==="round"&&(G&&(this.addCurrentVertex(V,K,0,0,R),this.addCurrentVertex(V,K,1,1,R,!0)),X&&(this.addCurrentVertex(V,ce,-1,-1,R,!0),this.addCurrentVertex(V,ce,0,0,R)));if(wt&&_e<k-1){const Bt=V.dist(X);if(Bt>2*A){const Mt=V.add(X.sub(V)._mult(A/Bt)._round());this.updateDistance(V,Mt),this.addCurrentVertex(Mt,ce,0,0,R),V=Mt}}}}addCurrentVertex(t,r,c,p,v,b=!1){const x=r.y*p-r.x,k=-r.y-r.x*p;this.addHalfVertex(t,r.x+r.y*c,r.y-r.x*c,b,!1,c,v),this.addHalfVertex(t,x,k,b,!0,-p,v),this.distance>pp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,c,p,v,b))}addHalfVertex({x:t,y:r},c,p,v,b,x,k){const L=.5*(this.lineClips?this.scaledDistance*(pp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(r<<1)+(b?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),k.primitiveLength++),b?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let mp,gp;Et("LineBucket",Ef,{omit:["layers","patternFeatures"]});var _p={get paint(){return gp=gp||new y({"line-opacity":new Kt(je.paint_line["line-opacity"]),"line-color":new Kt(je.paint_line["line-color"]),"line-translate":new zt(je.paint_line["line-translate"]),"line-translate-anchor":new zt(je.paint_line["line-translate-anchor"]),"line-width":new Kt(je.paint_line["line-width"]),"line-gap-width":new Kt(je.paint_line["line-gap-width"]),"line-offset":new Kt(je.paint_line["line-offset"]),"line-blur":new Kt(je.paint_line["line-blur"]),"line-dasharray":new Ja(je.paint_line["line-dasharray"]),"line-pattern":new Ka(je.paint_line["line-pattern"]),"line-gradient":new vu(je.paint_line["line-gradient"])})},get layout(){return mp=mp||new y({"line-cap":new zt(je.layout_line["line-cap"]),"line-join":new Kt(je.layout_line["line-join"]),"line-miter-limit":new zt(je.layout_line["line-miter-limit"]),"line-round-limit":new zt(je.layout_line["line-round-limit"]),"line-sort-key":new Kt(je.layout_line["line-sort-key"])})}};class S0 extends Kt{possiblyEvaluate(t,r){return r=new Ki(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,c,p){return r=Ae({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,c,p)}}let ih;class k0 extends l{constructor(t){super(t,_p),this.gradientVersion=0,ih||(ih=new S0(_p.paint.properties["line-width"].specification),ih.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(c){return c._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof $s,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=ih.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ef(t)}queryRadius(t){const r=t,c=yp(wu("line-width",this,r),wu("line-gap-width",this,r)),p=wu("line-offset",this,r);return c/2+Math.abs(p)+Jc(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,c,p,v,b,x){const k=Yc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,x),L=x/2*yp(this.paint.get("line-width").evaluate(r,c),this.paint.get("line-gap-width").evaluate(r,c)),A=this.paint.get("line-offset").evaluate(r,c);return A&&(p=function(R,V){const G=[];for(let X=0;X<R.length;X++){const K=R[X],ce=[];for(let _e=0;_e<K.length;_e++){const Ue=K[_e-1],Me=K[_e],Oe=K[_e+1],Xe=_e===0?new C(0,0):Me.sub(Ue)._unit()._perp(),rt=_e===K.length-1?new C(0,0):Oe.sub(Me)._unit()._perp(),wt=Xe._add(rt)._unit(),Zt=wt.x*rt.x+wt.y*rt.y;Zt!==0&&wt._mult(1/Zt),ce.push(wt._mult(V)._add(Me))}G.push(ce)}return G}(p,A*x)),function(R,V,G){for(let X=0;X<V.length;X++){const K=V[X];if(R.length>=3){for(let ce=0;ce<K.length;ce++)if(nl(R,K[ce]))return!0}if(zy(R,K,G))return!0}return!1}(k,p,L)}isTileClipped(){return!0}}function yp(n,t){return t>0?t+2*n:n}const T0=S([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),C0=S([{name:"a_projected_pos",components:3,type:"Float32"}],4);S([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const I0=S([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);S([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vp=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),E0=S([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function M0(n,t,r){return n.sections.forEach(c=>{c.text=function(p,v,b){const x=v.layout.get("text-transform").evaluate(b,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),hr.applyArabicShaping&&(p=hr.applyArabicShaping(p)),p}(c.text,t,r)}),n}S([{name:"triangle",components:3,type:"Uint16"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),S([{type:"Float32",name:"offsetX"}]),S([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),S([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Lu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var wn=24,bp=Oi,xp=function(n,t,r,c,p){var v,b,x=8*p-c-1,k=(1<<x)-1,L=k>>1,A=-7,R=p-1,V=-1,G=n[t+R];for(R+=V,v=G&(1<<-A)-1,G>>=-A,A+=x;A>0;v=256*v+n[t+R],R+=V,A-=8);for(b=v&(1<<-A)-1,v>>=-A,A+=c;A>0;b=256*b+n[t+R],R+=V,A-=8);if(v===0)v=1-L;else{if(v===k)return b?NaN:1/0*(G?-1:1);b+=Math.pow(2,c),v-=L}return(G?-1:1)*b*Math.pow(2,v-c)},wp=function(n,t,r,c,p,v){var b,x,k,L=8*v-p-1,A=(1<<L)-1,R=A>>1,V=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=0,X=1,K=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,b=A):(b=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-b))<1&&(b--,k*=2),(t+=b+R>=1?V/k:V*Math.pow(2,1-R))*k>=2&&(b++,k/=2),b+R>=A?(x=0,b=A):b+R>=1?(x=(t*k-1)*Math.pow(2,p),b+=R):(x=t*Math.pow(2,R-1)*Math.pow(2,p),b=0));p>=8;n[r+G]=255&x,G+=X,x/=256,p-=8);for(b=b<<p|x,L+=p;L>0;n[r+G]=255&b,G+=X,b/=256,L-=8);n[r+G-X]|=128*K};function Oi(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Oi.Varint=0,Oi.Fixed64=1,Oi.Bytes=2,Oi.Fixed32=5;var Mf=4294967296,Sp=1/Mf,kp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Vs(n){return n.type===Oi.Bytes?n.readVarint()+n.pos:n.pos+1}function al(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function Tp(n,t,r){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(c);for(var p=r.pos-1;p>=n;p--)r.buf[p+c]=r.buf[p]}function L0(n,t){for(var r=0;r<n.length;r++)t.writeVarint(n[r])}function P0(n,t){for(var r=0;r<n.length;r++)t.writeSVarint(n[r])}function A0(n,t){for(var r=0;r<n.length;r++)t.writeFloat(n[r])}function z0(n,t){for(var r=0;r<n.length;r++)t.writeDouble(n[r])}function D0(n,t){for(var r=0;r<n.length;r++)t.writeBoolean(n[r])}function R0(n,t){for(var r=0;r<n.length;r++)t.writeFixed32(n[r])}function B0(n,t){for(var r=0;r<n.length;r++)t.writeSFixed32(n[r])}function F0(n,t){for(var r=0;r<n.length;r++)t.writeFixed64(n[r])}function O0(n,t){for(var r=0;r<n.length;r++)t.writeSFixed64(n[r])}function nh(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function ll(n,t,r){n[r]=t,n[r+1]=t>>>8,n[r+2]=t>>>16,n[r+3]=t>>>24}function Cp(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}Oi.prototype={destroy:function(){this.buf=null},readFields:function(n,t,r){for(r=r||this.length;this.pos<r;){var c=this.readVarint(),p=c>>3,v=this.pos;this.type=7&c,n(p,t,this),this.pos===v&&this.skip(c)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=nh(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Cp(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=nh(this.buf,this.pos)+nh(this.buf,this.pos+4)*Mf;return this.pos+=8,n},readSFixed64:function(){var n=nh(this.buf,this.pos)+Cp(this.buf,this.pos+4)*Mf;return this.pos+=8,n},readFloat:function(){var n=xp(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=xp(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,r,c=this.buf;return t=127&(r=c[this.pos++]),r<128?t:(t|=(127&(r=c[this.pos++]))<<7,r<128?t:(t|=(127&(r=c[this.pos++]))<<14,r<128?t:(t|=(127&(r=c[this.pos++]))<<21,r<128?t:function(p,v,b){var x,k,L=b.buf;if(x=(112&(k=L[b.pos++]))>>4,k<128||(x|=(127&(k=L[b.pos++]))<<3,k<128)||(x|=(127&(k=L[b.pos++]))<<10,k<128)||(x|=(127&(k=L[b.pos++]))<<17,k<128)||(x|=(127&(k=L[b.pos++]))<<24,k<128)||(x|=(1&(k=L[b.pos++]))<<31,k<128))return al(p,x,v);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=c[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&kp?function(r,c,p){return kp.decode(r.subarray(c,p))}(this.buf,t,n):function(r,c,p){for(var v="",b=c;b<p;){var x,k,L,A=r[b],R=null,V=A>239?4:A>223?3:A>191?2:1;if(b+V>p)break;V===1?A<128&&(R=A):V===2?(192&(x=r[b+1]))==128&&(R=(31&A)<<6|63&x)<=127&&(R=null):V===3?(k=r[b+2],(192&(x=r[b+1]))==128&&(192&k)==128&&((R=(15&A)<<12|(63&x)<<6|63&k)<=2047||R>=55296&&R<=57343)&&(R=null)):V===4&&(k=r[b+2],L=r[b+3],(192&(x=r[b+1]))==128&&(192&k)==128&&(192&L)==128&&((R=(15&A)<<18|(63&x)<<12|(63&k)<<6|63&L)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,V=1):R>65535&&(R-=65536,v+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),v+=String.fromCharCode(R),b+=V}return v}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==Oi.Bytes)return n.push(this.readVarint(t));var r=Vs(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==Oi.Bytes)return n.push(this.readSVarint());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Oi.Bytes)return n.push(this.readBoolean());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Oi.Bytes)return n.push(this.readFloat());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Oi.Bytes)return n.push(this.readDouble());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Oi.Bytes)return n.push(this.readFixed32());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Oi.Bytes)return n.push(this.readSFixed32());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Oi.Bytes)return n.push(this.readFixed64());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Oi.Bytes)return n.push(this.readSFixed64());var t=Vs(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===Oi.Varint)for(;this.buf[this.pos++]>127;);else if(t===Oi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Oi.Fixed32)this.pos+=4;else{if(t!==Oi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),ll(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),ll(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),ll(this.buf,-1&n,this.pos),ll(this.buf,Math.floor(n*Sp),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),ll(this.buf,-1&n,this.pos),ll(this.buf,Math.floor(n*Sp),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,r){var c,p;if(t>=0?(c=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(v,b,x){x.buf[x.pos++]=127&v|128,v>>>=7,x.buf[x.pos++]=127&v|128,v>>>=7,x.buf[x.pos++]=127&v|128,v>>>=7,x.buf[x.pos++]=127&v|128,x.buf[x.pos]=127&(v>>>=7)}(c,0,r),function(v,b){var x=(7&v)<<4;b.buf[b.pos++]|=x|((v>>>=3)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v)))))}(p,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(c,p,v){for(var b,x,k=0;k<p.length;k++){if((b=p.charCodeAt(k))>55295&&b<57344){if(!x){b>56319||k+1===p.length?(c[v++]=239,c[v++]=191,c[v++]=189):x=b;continue}if(b<56320){c[v++]=239,c[v++]=191,c[v++]=189,x=b;continue}b=x-55296<<10|b-56320|65536,x=null}else x&&(c[v++]=239,c[v++]=191,c[v++]=189,x=null);b<128?c[v++]=b:(b<2048?c[v++]=b>>6|192:(b<65536?c[v++]=b>>12|224:(c[v++]=b>>18|240,c[v++]=b>>12&63|128),c[v++]=b>>6&63|128),c[v++]=63&b|128)}return v}(this.buf,n,this.pos);var r=this.pos-t;r>=128&&Tp(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),wp(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),wp(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,t){this.pos++;var r=this.pos;n(t,this);var c=this.pos-r;c>=128&&Tp(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c},writeMessage:function(n,t,r){this.writeTag(n,Oi.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,L0,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,P0,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,D0,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,A0,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,z0,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,R0,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,B0,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,F0,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,O0,t)},writeBytesField:function(n,t){this.writeTag(n,Oi.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,Oi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,Oi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,Oi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,Oi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,Oi.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,Oi.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,Oi.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,Oi.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,Oi.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var Lf=w(bp);const Pf=3;function N0(n,t,r){n===1&&r.readMessage(V0,t)}function V0(n,t,r){if(n===3){const{id:c,bitmap:p,width:v,height:b,left:x,top:k,advance:L}=r.readMessage(j0,{});t.push({id:c,bitmap:new ku({width:v+2*Pf,height:b+2*Pf},p),metrics:{width:v,height:b,left:x,top:k,advance:L}})}}function j0(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}const Ip=Pf;function Ep(n){let t=0,r=0;for(const b of n)t+=b.w*b.h,r=Math.max(r,b.w);n.sort((b,x)=>x.h-b.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let p=0,v=0;for(const b of n)for(let x=c.length-1;x>=0;x--){const k=c[x];if(!(b.w>k.w||b.h>k.h)){if(b.x=k.x,b.y=k.y,v=Math.max(v,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===k.w&&b.h===k.h){const L=c.pop();x<c.length&&(c[x]=L)}else b.h===k.h?(k.x+=b.w,k.w-=b.w):b.w===k.w?(k.y+=b.h,k.h-=b.h):(c.push({x:k.x+b.w,y:k.y,w:k.w-b.w,h:b.h}),k.y+=b.h,k.h-=b.h);break}}return{w:p,h:v,fill:t/(p*v)||0}}const dr=1;class Af{constructor(t,{pixelRatio:r,version:c,stretchX:p,stretchY:v,content:b,textFitWidth:x,textFitHeight:k}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=p,this.stretchY=v,this.content=b,this.version=c,this.textFitWidth=x,this.textFitHeight=k}get tl(){return[this.paddedRect.x+dr,this.paddedRect.y+dr]}get br(){return[this.paddedRect.x+this.paddedRect.w-dr,this.paddedRect.y+this.paddedRect.h-dr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*dr)/this.pixelRatio,(this.paddedRect.h-2*dr)/this.pixelRatio]}}class Mp{constructor(t,r){const c={},p={};this.haveRenderCallbacks=[];const v=[];this.addImages(t,c,v),this.addImages(r,p,v);const{w:b,h:x}=Ep(v),k=new Br({width:b||1,height:x||1});for(const L in t){const A=t[L],R=c[L].paddedRect;Br.copy(A.data,k,{x:0,y:0},{x:R.x+dr,y:R.y+dr},A.data)}for(const L in r){const A=r[L],R=p[L].paddedRect,V=R.x+dr,G=R.y+dr,X=A.data.width,K=A.data.height;Br.copy(A.data,k,{x:0,y:0},{x:V,y:G},A.data),Br.copy(A.data,k,{x:0,y:K-1},{x:V,y:G-1},{width:X,height:1}),Br.copy(A.data,k,{x:0,y:0},{x:V,y:G+K},{width:X,height:1}),Br.copy(A.data,k,{x:X-1,y:0},{x:V-1,y:G},{width:1,height:K}),Br.copy(A.data,k,{x:0,y:0},{x:V+X,y:G},{width:1,height:K})}this.image=k,this.iconPositions=c,this.patternPositions=p}addImages(t,r,c){for(const p in t){const v=t[p],b={x:0,y:0,w:v.data.width+2*dr,h:v.data.height+2*dr};c.push(b),r[p]=new Af(b,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),r),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),r)}patchUpdatedImage(t,r,c){if(!t||!r||t.version===r.version)return;t.version=r.version;const[p,v]=t.tl;c.update(r.data,void 0,{x:p,y:v})}}var To;Et("ImagePosition",Af),Et("ImageAtlas",Mp),m.ah=void 0,(To=m.ah||(m.ah={}))[To.none=0]="none",To[To.horizontal=1]="horizontal",To[To.vertical=2]="vertical",To[To.horizontalOnly=3]="horizontalOnly";const Pu=-17;class Au{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const c=new Au;return c.scale=t||1,c.fontStack=r,c}static forImage(t){const r=new Au;return r.imageName=t,r}}class ul{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const c=new ul;for(let p=0;p<t.sections.length;p++){const v=t.sections[p];v.image?c.addImageSection(v):c.addTextSection(v,r)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let c=0;c<t.length;c++){const p=t.charCodeAt(c+1)||null,v=t.charCodeAt(c-1)||null;r+=p&&qc(p)&&!Lu[t[c+1]]||v&&qc(v)&&!Lu[t[c-1]]||!Lu[t[c]]?t[c]:Lu[t[c]]}return r}(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&sh[this.text.charCodeAt(c)];c++)t++;let r=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&sh[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const c=new ul;return c.text=this.text.substring(t,r),c.sectionIndex=this.sectionIndex.slice(t,r),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Au.forText(t.scale,t.fontStack||r));const c=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(c)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void ee("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Au.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ee("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rh(n,t,r,c,p,v,b,x,k,L,A,R,V,G,X){const K=ul.fromFeature(n,p);let ce;R===m.ah.vertical&&K.verticalizePunctuation();const{processBidirectionalText:_e,processStyledBidirectionalText:Ue}=hr;if(_e&&K.sections.length===1){ce=[];const Xe=_e(K.toString(),zf(K,L,v,t,c,G));for(const rt of Xe){const wt=new ul;wt.text=rt,wt.sections=K.sections;for(let Zt=0;Zt<rt.length;Zt++)wt.sectionIndex.push(0);ce.push(wt)}}else if(Ue){ce=[];const Xe=Ue(K.text,K.sectionIndex,zf(K,L,v,t,c,G));for(const rt of Xe){const wt=new ul;wt.text=rt[0],wt.sectionIndex=rt[1],wt.sections=K.sections,ce.push(wt)}}else ce=function(Xe,rt){const wt=[],Zt=Xe.text;let bt=0;for(const _t of rt)wt.push(Xe.substring(bt,_t)),bt=_t;return bt<Zt.length&&wt.push(Xe.substring(bt,Zt.length)),wt}(K,zf(K,L,v,t,c,G));const Me=[],Oe={positionedLines:Me,text:K.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(Xe,rt,wt,Zt,bt,_t,Bt,Mt,Ct,Je,Ot,Rt){let ei=0,ji=Pu,Ni=0,Tn=0;const Yr=Mt==="right"?1:Mt==="left"?0:.5;let On=0;for(const mn of bt){mn.trim();const In=mn.getMaxScale(),Hn=(In-1)*wn,Nn={positionedGlyphs:[],lineOffset:0};Xe.positionedLines[On]=Nn;const nr=Nn.positionedGlyphs;let Vn=0;if(!mn.length()){ji+=_t,++On;continue}for(let pr=0;pr<mn.length();pr++){const Ii=mn.getSection(pr),Wi=mn.getSectionIndex(pr),$i=mn.getCharCode(pr);let kr=0,sn=null,dl=null,bs=null,xs=wn;const Qr=!(Ct===m.ah.horizontal||!Ot&&!_u($i)||Ot&&(sh[$i]||(Cn=$i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Cn)))));if(Ii.imageName){const Nr=Zt[Ii.imageName];if(!Nr)continue;bs=Ii.imageName,Xe.iconsInText=Xe.iconsInText||!0,dl=Nr.paddedRect;const Ln=Nr.displaySize;Ii.scale=Ii.scale*wn/Rt,sn={width:Ln[0],height:Ln[1],left:dr,top:-Ip,advance:Qr?Ln[1]:Ln[0]},kr=Hn+(wn-Ln[1]*Ii.scale),xs=sn.advance;const js=Qr?Ln[0]*Ii.scale-wn*In:Ln[1]*Ii.scale-wn*In;js>0&&js>Vn&&(Vn=js)}else{const Nr=wt[Ii.fontStack],Ln=Nr&&Nr[$i];if(Ln&&Ln.rect)dl=Ln.rect,sn=Ln.metrics;else{const js=rt[Ii.fontStack],Ou=js&&js[$i];if(!Ou)continue;sn=Ou.metrics}kr=(In-Ii.scale)*wn}Qr?(Xe.verticalizable=!0,nr.push({glyph:$i,imageName:bs,x:ei,y:ji+kr,vertical:Qr,scale:Ii.scale,fontStack:Ii.fontStack,sectionIndex:Wi,metrics:sn,rect:dl}),ei+=xs*Ii.scale+Je):(nr.push({glyph:$i,imageName:bs,x:ei,y:ji+kr,vertical:Qr,scale:Ii.scale,fontStack:Ii.fontStack,sectionIndex:Wi,metrics:sn,rect:dl}),ei+=sn.advance*Ii.scale+Je)}nr.length!==0&&(Ni=Math.max(ei-Je,Ni),G0(nr,0,nr.length-1,Yr,Vn)),ei=0;const Or=_t*In+Vn;Nn.lineOffset=Math.max(Vn,Hn),ji+=Or,Tn=Math.max(Or,Tn),++On}var Cn;const er=ji-Pu,{horizontalAlign:tr,verticalAlign:ir}=Df(Bt);(function(mn,In,Hn,Nn,nr,Vn,Or,pr,Ii){const Wi=(In-Hn)*nr;let $i=0;$i=Vn!==Or?-pr*Nn-Pu:(-Nn*Ii+.5)*Or;for(const kr of mn)for(const sn of kr.positionedGlyphs)sn.x+=Wi,sn.y+=$i})(Xe.positionedLines,Yr,tr,ir,Ni,Tn,_t,er,bt.length),Xe.top+=-ir*er,Xe.bottom=Xe.top+er,Xe.left+=-tr*Ni,Xe.right=Xe.left+Ni}(Oe,t,r,c,ce,b,x,k,R,L,V,X),!function(Xe){for(const rt of Xe)if(rt.positionedGlyphs.length!==0)return!1;return!0}(Me)&&Oe}const sh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},U0={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},q0={40:!0};function Lp(n,t,r,c,p,v){if(t.imageName){const b=c[t.imageName];return b?b.displaySize[0]*t.scale*wn/v+p:0}{const b=r[t.fontStack],x=b&&b[n];return x?x.metrics.advance*t.scale+p:0}}function Pp(n,t,r,c){const p=Math.pow(n-t,2);return c?n<t?p/2:2*p:p+Math.abs(r)*r}function Z0(n,t,r){let c=0;return n===10&&(c-=1e4),r&&(c+=150),n!==40&&n!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Ap(n,t,r,c,p,v){let b=null,x=Pp(t,r,p,v);for(const k of c){const L=Pp(t-k.x,r,p,v)+k.badness;L<=x&&(b=k,x=L)}return{index:n,x:t,priorBreak:b,badness:x}}function zp(n){return n?zp(n.priorBreak).concat(n.index):[]}function zf(n,t,r,c,p,v){if(!n)return[];const b=[],x=function(R,V,G,X,K,ce){let _e=0;for(let Ue=0;Ue<R.length();Ue++){const Me=R.getSection(Ue);_e+=Lp(R.getCharCode(Ue),Me,X,K,V,ce)}return _e/Math.max(1,Math.ceil(_e/G))}(n,t,r,c,p,v),k=n.text.indexOf("")>=0;let L=0;for(let R=0;R<n.length();R++){const V=n.getSection(R),G=n.getCharCode(R);if(sh[G]||(L+=Lp(G,V,c,p,t,v)),R<n.length()-1){const X=!((A=G)<11904)&&(!!pi["CJK Compatibility Forms"](A)||!!pi["CJK Compatibility"](A)||!!pi["CJK Strokes"](A)||!!pi["CJK Symbols and Punctuation"](A)||!!pi["Enclosed CJK Letters and Months"](A)||!!pi["Halfwidth and Fullwidth Forms"](A)||!!pi["Ideographic Description Characters"](A)||!!pi["Vertical Forms"](A)||Uc.test(String.fromCodePoint(A)));(U0[G]||X||V.imageName||R!==n.length()-2&&q0[n.getCharCode(R+1)])&&b.push(Ap(R+1,L,x,b,Z0(G,n.getCharCode(R+1),X&&k),!1))}}var A;return zp(Ap(n.length(),L,x,b,0,!0))}function Df(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function G0(n,t,r,c,p){if(!c&&!p)return;const v=n[r],b=(n[r].x+v.metrics.advance*v.scale)*c;for(let x=t;x<=r;x++)n[x].x-=b,n[x].y+=p}function W0(n,t,r){const{horizontalAlign:c,verticalAlign:p}=Df(r),v=t[0]-n.displaySize[0]*c,b=t[1]-n.displaySize[1]*p;return{image:n,top:b,bottom:b+n.displaySize[1],left:v,right:v+n.displaySize[0]}}function Dp(n){var t,r;let c=n.left,p=n.top,v=n.right-c,b=n.bottom-p;const x=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",k=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",L=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(k==="proportional"){if(x==="stretchOnly"&&v/b<L||x==="proportional"){const A=Math.ceil(b*L);c*=A/v,v=A}}else if(x==="proportional"&&k==="stretchOnly"&&L!==0&&v/b>L){const A=Math.ceil(v/L);p*=A/b,b=A}return{x1:c,y1:p,x2:c+v,y2:p+b}}function Rp(n,t,r,c,p,v){const b=n.image;let x;if(b.content){const ce=b.content,_e=b.pixelRatio||1;x=[ce[0]/_e,ce[1]/_e,b.displaySize[0]-ce[2]/_e,b.displaySize[1]-ce[3]/_e]}const k=t.left*v,L=t.right*v;let A,R,V,G;r==="width"||r==="both"?(G=p[0]+k-c[3],R=p[0]+L+c[1]):(G=p[0]+(k+L-b.displaySize[0])/2,R=G+b.displaySize[0]);const X=t.top*v,K=t.bottom*v;return r==="height"||r==="both"?(A=p[1]+X-c[0],V=p[1]+K+c[2]):(A=p[1]+(X+K-b.displaySize[1])/2,V=A+b.displaySize[1]),{image:b,top:A,right:R,bottom:V,left:G,collisionPadding:x}}const zu=255,vs=128,Co=zu*vs;function Bp(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ki(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=r;let v=0;for(;v<c.length&&c[v]<=n;)v++;v=Math.max(0,v-1);let b=v;for(;b<c.length&&c[b]<n+1;)b++;b=Math.min(c.length-1,b);const x=c[v],k=c[b];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:k,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:k,minSize:r.evaluate(new Ki(x)),maxSize:r.evaluate(new Ki(k)),interpolationType:p}}}function Rf(n,t,r){let c="never";const p=n.get(t);return p?c=p:n.get(r)&&(c="always"),c}const H0=ko.VectorTileFeature.types,X0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function oh(n,t,r,c,p,v,b,x,k,L,A,R,V){const G=x?Math.min(Co,Math.round(x[0])):0,X=x?Math.min(Co,Math.round(x[1])):0;n.emplaceBack(t,r,Math.round(32*c),Math.round(32*p),v,b,(G<<1)+(k?1:0),X,16*L,16*A,256*R,256*V)}function Bf(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function K0(n){for(const t of n.sections)if(cf(t.text))return!0;return!1}class Ff{constructor(t){this.layoutVertexArray=new Qa,this.indexArray=new Rr,this.programConfigurations=t,this.segments=new mi,this.dynamicLayoutVertexArray=new bu,this.opacityVertexArray=new wr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ji}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,T0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,C0.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,X0,!0),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Et("SymbolBuffers",Ff);class Of{constructor(t,r,c){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new c,this.segments=new mi,this.collisionVertexArray=new _s}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,I0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Et("CollisionBuffers",Of);class cl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(b=>b.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_f([]),this.placementViewportMatrix=_f([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bp(this.zoom,r["text-size"]),this.iconSizeData=Bp(this.zoom,r["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),v=c.get("symbol-z-order");this.canOverlap=Rf(c,"text-overlap","text-allow-overlap")!=="never"||Rf(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(b=>m.ah[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=t.sourceID}createArrays(){this.text=new Ff(new na(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Ff(new na(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Yi,this.lineVertexArray=new Dn,this.symbolInstances=new di,this.textAnchorOffsets=new Qi}calculateGlyphDependencies(t,r,c,p,v){for(let b=0;b<t.length;b++)if(r[t.charCodeAt(b)]=!0,(c||p)&&v){const x=Lu[t.charAt(b)];x&&(r[x.charCodeAt(0)]=!0)}}populate(t,r,c){const p=this.layers[0],v=p.layout,b=v.get("text-font"),x=v.get("text-field"),k=v.get("icon-image"),L=(x.value.kind!=="constant"||x.value.value instanceof En&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),A=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,R=v.get("symbol-sort-key");if(this.features=[],!L&&!A)return;const V=r.iconDependencies,G=r.glyphDependencies,X=r.availableImages,K=new Ki(this.zoom);for(const{feature:ce,id:_e,index:Ue,sourceLayerIndex:Me}of t){const Oe=p._featureFilter.needGeometry,Xe=sa(ce,Oe);if(!p._featureFilter.filter(K,Xe,c))continue;let rt,wt;if(Oe||(Xe.geometry=ra(ce)),L){const bt=p.getValueAndResolveTokens("text-field",Xe,c,X),_t=En.factory(bt),Bt=this.hasRTLText=this.hasRTLText||K0(_t);(!Bt||hr.getRTLTextPluginStatus()==="unavailable"||Bt&&hr.isParsed())&&(rt=M0(_t,p,Xe))}if(A){const bt=p.getValueAndResolveTokens("icon-image",Xe,c,X);wt=bt instanceof Zn?bt:Zn.fromString(bt)}if(!rt&&!wt)continue;const Zt=this.sortFeaturesByKey?R.evaluate(Xe,{},c):void 0;if(this.features.push({id:_e,text:rt,icon:wt,index:Ue,sourceLayerIndex:Me,geometry:Xe.geometry,properties:ce.properties,type:H0[ce.type],sortKey:Zt}),wt&&(V[wt.name]=!0),rt){const bt=b.evaluate(Xe,{},c).join(","),_t=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const Bt of rt.sections)if(Bt.image)V[Bt.image.name]=!0;else{const Mt=mu(rt.toString()),Ct=Bt.fontStack||bt,Je=G[Ct]=G[Ct]||{};this.calculateGlyphDependencies(Bt.text,Je,_t,this.allowVerticalPlacement,Mt)}}}v.get("symbol-placement")==="line"&&(this.features=function(ce){const _e={},Ue={},Me=[];let Oe=0;function Xe(bt){Me.push(ce[bt]),Oe++}function rt(bt,_t,Bt){const Mt=Ue[bt];return delete Ue[bt],Ue[_t]=Mt,Me[Mt].geometry[0].pop(),Me[Mt].geometry[0]=Me[Mt].geometry[0].concat(Bt[0]),Mt}function wt(bt,_t,Bt){const Mt=_e[_t];return delete _e[_t],_e[bt]=Mt,Me[Mt].geometry[0].shift(),Me[Mt].geometry[0]=Bt[0].concat(Me[Mt].geometry[0]),Mt}function Zt(bt,_t,Bt){const Mt=Bt?_t[0][_t[0].length-1]:_t[0][0];return`${bt}:${Mt.x}:${Mt.y}`}for(let bt=0;bt<ce.length;bt++){const _t=ce[bt],Bt=_t.geometry,Mt=_t.text?_t.text.toString():null;if(!Mt){Xe(bt);continue}const Ct=Zt(Mt,Bt),Je=Zt(Mt,Bt,!0);if(Ct in Ue&&Je in _e&&Ue[Ct]!==_e[Je]){const Ot=wt(Ct,Je,Bt),Rt=rt(Ct,Je,Me[Ot].geometry);delete _e[Ct],delete Ue[Je],Ue[Zt(Mt,Me[Rt].geometry,!0)]=Rt,Me[Ot].geometry=null}else Ct in Ue?rt(Ct,Je,Bt):Je in _e?wt(Ct,Je,Bt):(Xe(bt),_e[Ct]=Oe-1,Ue[Je]=Oe-1)}return Me.filter(bt=>bt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ce,_e)=>ce.sortKey-_e.sortKey)}update(t,r,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,c),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const c=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(r[t.segment+1]),v=t.dist(r[t.segment]);const b={};for(let x=t.segment+1;x<r.length;x++)b[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:p},x<r.length-1&&(p+=r[x+1].dist(r[x]));for(let x=t.segment||0;x>=0;x--)b[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:v},x>0&&(v+=r[x-1].dist(r[x]));for(let x=0;x<r.length;x++){const k=b[x];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,r,c,p,v,b,x,k,L,A,R,V){const G=t.indexArray,X=t.layoutVertexArray,K=t.segments.prepareSegment(4*r.length,X,G,this.canOverlap?b.sortKey:void 0),ce=this.glyphOffsetArray.length,_e=K.vertexLength,Ue=this.allowVerticalPlacement&&x===m.ah.vertical?Math.PI/2:0,Me=b.text&&b.text.sections;for(let Oe=0;Oe<r.length;Oe++){const{tl:Xe,tr:rt,bl:wt,br:Zt,tex:bt,pixelOffsetTL:_t,pixelOffsetBR:Bt,minFontScaleX:Mt,minFontScaleY:Ct,glyphOffset:Je,isSDF:Ot,sectionIndex:Rt}=r[Oe],ei=K.vertexLength,ji=Je[1];oh(X,k.x,k.y,Xe.x,ji+Xe.y,bt.x,bt.y,c,Ot,_t.x,_t.y,Mt,Ct),oh(X,k.x,k.y,rt.x,ji+rt.y,bt.x+bt.w,bt.y,c,Ot,Bt.x,_t.y,Mt,Ct),oh(X,k.x,k.y,wt.x,ji+wt.y,bt.x,bt.y+bt.h,c,Ot,_t.x,Bt.y,Mt,Ct),oh(X,k.x,k.y,Zt.x,ji+Zt.y,bt.x+bt.w,bt.y+bt.h,c,Ot,Bt.x,Bt.y,Mt,Ct),Bf(t.dynamicLayoutVertexArray,k,Ue),G.emplaceBack(ei,ei+1,ei+2),G.emplaceBack(ei+1,ei+2,ei+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),Oe!==r.length-1&&Rt===r[Oe+1].sectionIndex||t.programConfigurations.populatePaintArrays(X.length,b,b.index,{},V,Me&&Me[Rt])}t.placedSymbolArray.emplaceBack(k.x,k.y,ce,this.glyphOffsetArray.length-ce,_e,L,A,k.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],x,0,!1,0,R)}_addCollisionDebugVertex(t,r,c,p,v,b){return r.emplaceBack(0,0),t.emplaceBack(c.x,c.y,p,v,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(t,r,c,p,v,b,x){const k=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),L=k.vertexLength,A=v.layoutVertexArray,R=v.collisionVertexArray,V=x.anchorX,G=x.anchorY;this._addCollisionDebugVertex(A,R,b,V,G,new C(t,r)),this._addCollisionDebugVertex(A,R,b,V,G,new C(c,r)),this._addCollisionDebugVertex(A,R,b,V,G,new C(c,p)),this._addCollisionDebugVertex(A,R,b,V,G,new C(t,p)),k.vertexLength+=4;const X=v.indexArray;X.emplaceBack(L,L+1),X.emplaceBack(L+1,L+2),X.emplaceBack(L+2,L+3),X.emplaceBack(L+3,L),k.primitiveLength+=4}addDebugCollisionBoxes(t,r,c,p){for(let v=t;v<r;v++){const b=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Of(Sr,vp.members,Mn),this.iconCollisionBox=new Of(Sr,vp.members,Mn);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,c,p,v,b,x,k,L){const A={};for(let R=r;R<c;R++){const V=t.get(R);A.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},A.textFeatureIndex=V.featureIndex;break}for(let R=p;R<v;R++){const V=t.get(R);A.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},A.verticalTextFeatureIndex=V.featureIndex;break}for(let R=b;R<x;R++){const V=t.get(R);A.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},A.iconFeatureIndex=V.featureIndex;break}for(let R=k;R<L;R++){const V=t.get(R);A.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},A.verticalIconFeatureIndex=V.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const c=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const c=t.placedSymbolArray.get(r),p=c.vertexStartIndex+4*c.numGlyphs;for(let v=c.vertexStartIndex;v<p;v+=4)t.indexArray.emplaceBack(v,v+1,v+2),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),c=Math.cos(t),p=[],v=[],b=[];for(let x=0;x<this.symbolInstances.length;++x){b.push(x);const k=this.symbolInstances.get(x);p.push(0|Math.round(r*k.anchorX+c*k.anchorY)),v.push(k.featureIndex)}return b.sort((x,k)=>p[x]-p[k]||v[k]-v[x]),b}addToSortKeyRanges(t,r){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===r?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const c=this.symbolInstances.get(r);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((p,v,b)=>{p>=0&&b.indexOf(p)===v&&this.addIndicesForPlacedSymbol(this.text,p)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Fp,Op;Et("SymbolBucket",cl,{omit:["layers","collisionBoxArray","features","compareText"]}),cl.MAX_GLYPHS=65535,cl.addDynamicAttributes=Bf;var Nf={get paint(){return Op=Op||new y({"icon-opacity":new Kt(je.paint_symbol["icon-opacity"]),"icon-color":new Kt(je.paint_symbol["icon-color"]),"icon-halo-color":new Kt(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(je.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(je.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kt(je.paint_symbol["text-opacity"]),"text-color":new Kt(je.paint_symbol["text-color"],{runtimeType:tn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Kt(je.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(je.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(je.paint_symbol["text-halo-blur"]),"text-translate":new zt(je.paint_symbol["text-translate"]),"text-translate-anchor":new zt(je.paint_symbol["text-translate-anchor"])})},get layout(){return Fp=Fp||new y({"symbol-placement":new zt(je.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(je.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zt(je.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zt(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(je.layout_symbol["icon-size"]),"icon-text-fit":new zt(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(je.layout_symbol["icon-image"]),"icon-rotate":new Kt(je.layout_symbol["icon-rotate"]),"icon-padding":new Kt(je.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(je.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(je.layout_symbol["icon-offset"]),"icon-anchor":new Kt(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(je.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(je.layout_symbol["text-field"]),"text-font":new Kt(je.layout_symbol["text-font"]),"text-size":new Kt(je.layout_symbol["text-size"]),"text-max-width":new Kt(je.layout_symbol["text-max-width"]),"text-line-height":new zt(je.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(je.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(je.layout_symbol["text-justify"]),"text-radial-offset":new Kt(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(je.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Kt(je.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Kt(je.layout_symbol["text-anchor"]),"text-max-angle":new zt(je.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(je.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(je.layout_symbol["text-rotate"]),"text-padding":new zt(je.layout_symbol["text-padding"]),"text-keep-upright":new zt(je.layout_symbol["text-keep-upright"]),"text-transform":new Kt(je.layout_symbol["text-transform"]),"text-offset":new Kt(je.layout_symbol["text-offset"]),"text-allow-overlap":new zt(je.layout_symbol["text-allow-overlap"]),"text-overlap":new zt(je.layout_symbol["text-overlap"]),"text-ignore-placement":new zt(je.layout_symbol["text-ignore-placement"]),"text-optional":new zt(je.layout_symbol["text-optional"])})}};class Np{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Pn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et("FormatSectionOverride",Np,{omit:["defaultValue"]});class ah extends l{constructor(t){super(t,Nf)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const v of c)p.indexOf(v)<0&&p.push(v);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,c,p){const v=this.layout.get(t).evaluate(r,{},c,p),b=this._unevaluatedLayout._values[t];return b.isDataDriven()||Fa(b.value)||!v?v:function(x,k){return k.replace(/{([^{}]+)}/g,(L,A)=>x&&A in x?String(x[A]):"")}(r.properties,v)}createBucket(t){return new cl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Nf.paint.overridableProperties){if(!ah.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),c=new Np(r),p=new Ba(c,r.property.specification);let v=null;v=r.value.kind==="constant"||r.value.kind==="source"?new lo("source",p):new uo("composite",p,r.value.zoomStops),this.paint._values[t]=new Kr(r.property,v,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,c){return!(!this.layout||r.isDataDriven()||c.isDataDriven())&&ah.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const c=t.get("text-field"),p=Nf.paint.properties[r];let v=!1;const b=x=>{for(const k of x)if(p.overrides&&p.overrides.hasOverride(k))return void(v=!0)};if(c.value.kind==="constant"&&c.value.value instanceof En)b(c.value.value.sections);else if(c.value.kind==="source"){const x=L=>{v||(L instanceof Mr&&bi(L.value)===lr?b(L.value.sections):L instanceof Ia?b(L.sections):L.eachChild(x))},k=c.value;k._styleExpression&&x(k._styleExpression.expression)}return v}}let Vp;var J0={get paint(){return Vp=Vp||new y({"background-color":new zt(je.paint_background["background-color"]),"background-pattern":new Ja(je.paint_background["background-pattern"]),"background-opacity":new zt(je.paint_background["background-opacity"])})}};class Y0 extends l{constructor(t){super(t,J0)}}let jp;var Q0={get paint(){return jp=jp||new y({"raster-opacity":new zt(je.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(je.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(je.paint_raster["raster-saturation"]),"raster-contrast":new zt(je.paint_raster["raster-contrast"]),"raster-resampling":new zt(je.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(je.paint_raster["raster-fade-duration"])})}};class $0 extends l{constructor(t){super(t,Q0)}}class e1 extends l{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class t1{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Vf=63710088e-1;class Io{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Io(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,c=this.lat*r,p=t.lat*r,v=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((t.lng-this.lng)*r);return Vf*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof Io)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Io(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Io(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Up=2*Math.PI*Vf;function qp(n){return Up*Math.cos(n*Math.PI/180)}function Zp(n){return(180+n)/360}function Gp(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Wp(n,t){return n/qp(t)}function jf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class Du{constructor(t,r,c=0){this.x=+t,this.y=+r,this.z=+c}static fromLngLat(t,r=0){const c=Io.convert(t);return new Du(Zp(c.lng),Gp(c.lat),Wp(r,c.lat))}toLngLat(){return new Io(360*this.x-180,jf(this.y))}toAltitude(){return this.z*qp(jf(this.y))}meterInMercatorCoordinateUnits(){return 1/Up*(t=jf(this.y),1/Math.cos(t*Math.PI/180));var t}}function Hp(n,t,r){var c=2*Math.PI*6378137/256/Math.pow(2,r);return[n*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class Uf{constructor(t,r,c){if(!function(p,v,b){return!(p<0||p>25||b<0||b>=Math.pow(2,p)||v<0||v>=Math.pow(2,p))}(t,r,c))throw new Error(`x=${r}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=c,this.key=Ru(0,t,t,r,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,c){const p=(b=this.y,x=this.z,k=Hp(256*(v=this.x),256*(b=Math.pow(2,x)-b-1),x),L=Hp(256*(v+1),256*(b+1),x),k[0]+","+k[1]+","+L[0]+","+L[1]);var v,b,x,k,L;const A=function(R,V,G){let X,K="";for(let ce=R;ce>0;ce--)X=1<<ce-1,K+=(V&X?1:0)+(G&X?2:0);return K}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new C((t.x*r-this.x)*vn,(t.y*r-this.y)*vn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xp{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Ru(t,r.z,r.z,r.x,r.y)}}class Fr{constructor(t,r,c,p,v){if(t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Uf(c,+p,+v),this.key=Ru(r,t,c,p,v)}clone(){return new Fr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Fr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fr(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-t;return t>this.canonical.z?Ru(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Ru(this.wrap*+r,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Fr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new Fr(r,this.wrap,r,c,p),new Fr(r,this.wrap,r,c+1,p),new Fr(r,this.wrap,r,c,p+1),new Fr(r,this.wrap,r,c+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Fr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Fr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Du(t.x-this.wrap,t.y))}}function Ru(n,t,r,c,p){(n*=2)<0&&(n=-1*n-1);const v=1<<r;return(v*v*n+v*p+c).toString(36)+r.toString(36)+t.toString(36)}Et("CanonicalTileID",Uf),Et("OverscaledTileID",Fr,{omit:["posMatrix"]});class Kp{constructor(t,r,c,p=1,v=1,b=1,x=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void ee(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const k=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=v,this.blueFactor=b,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let L=0;L<k;L++)this.data[this._idx(-1,L)]=this.data[this._idx(0,L)],this.data[this._idx(k,L)]=this.data[this._idx(k-1,L)],this.data[this._idx(L,-1)]=this.data[this._idx(L,0)],this.data[this._idx(L,k)]=this.data[this._idx(L,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let L=0;L<k;L++)for(let A=0;A<k;A++){const R=this.get(L,A);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(t,r){const c=new Uint8Array(this.data.buffer),p=4*this._idx(t,r);return this.unpack(c[p],c[p+1],c[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,c){return t*this.redFactor+r*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new Br({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,v=r*this.dim+this.dim,b=c*this.dim,x=c*this.dim+this.dim;switch(r){case-1:p=v-1;break;case 1:v=p+1}switch(c){case-1:b=x-1;break;case 1:x=b+1}const k=-r*this.dim,L=-c*this.dim;for(let A=b;A<x;A++)for(let R=p;R<v;R++)this.data[this._idx(R,A)]=t.data[this._idx(R+k,A+L)]}}Et("DEMData",Kp);class Jp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const c=t[r];this._stringToNumber[c]=r,this._numberToString[r]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Yp{constructor(t,r,c,p,v){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=c,t._y=p,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Qp{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new fo(vn,16,0),this.grid3D=new fo(vn,16,0),this.featureIndexArray=new Gn,this.promoteId=r}insert(t,r,c,p,v,b){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,v);const k=b?this.grid3D:this.grid;for(let L=0;L<r.length;L++){const A=r[L],R=[1/0,1/0,-1/0,-1/0];for(let V=0;V<A.length;V++){const G=A[V];R[0]=Math.min(R[0],G.x),R[1]=Math.min(R[1],G.y),R[2]=Math.max(R[2],G.x),R[3]=Math.max(R[3],G.y)}R[0]<vn&&R[1]<vn&&R[2]>=0&&R[3]>=0&&k.insert(x,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ko.VectorTile(new Lf(this.rawTileData)).layers,this.sourceLayerCoder=new Jp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,c,p){this.loadVTLayers();const v=t.params||{},b=vn/t.tileSize/t.scale,x=eu(v.filter),k=t.queryGeometry,L=t.queryPadding*b,A=em(k),R=this.grid.query(A.minX-L,A.minY-L,A.maxX+L,A.maxY+L),V=em(t.cameraQueryGeometry),G=this.grid3D.query(V.minX-L,V.minY-L,V.maxX+L,V.maxY+L,(ce,_e,Ue,Me)=>function(Oe,Xe,rt,wt,Zt){for(const _t of Oe)if(Xe<=_t.x&&rt<=_t.y&&wt>=_t.x&&Zt>=_t.y)return!0;const bt=[new C(Xe,rt),new C(Xe,Zt),new C(wt,Zt),new C(wt,rt)];if(Oe.length>2){for(const _t of bt)if(nl(Oe,_t))return!0}for(let _t=0;_t<Oe.length-1;_t++)if(Ry(Oe[_t],Oe[_t+1],bt))return!0;return!1}(t.cameraQueryGeometry,ce-L,_e-L,Ue+L,Me+L));for(const ce of G)R.push(ce);R.sort(i1);const X={};let K;for(let ce=0;ce<R.length;ce++){const _e=R[ce];if(_e===K)continue;K=_e;const Ue=this.featureIndexArray.get(_e);let Me=null;this.loadMatchingFeature(X,Ue.bucketIndex,Ue.sourceLayerIndex,Ue.featureIndex,x,v.layers,v.availableImages,r,c,p,(Oe,Xe,rt)=>(Me||(Me=ra(Oe)),Xe.queryIntersectsFeature(k,Oe,rt,Me,this.z,t.transform,b,t.pixelPosMatrix)))}return X}loadMatchingFeature(t,r,c,p,v,b,x,k,L,A,R){const V=this.bucketLayerIDs[r];if(b&&!function(ce,_e){for(let Ue=0;Ue<ce.length;Ue++)if(_e.indexOf(ce[Ue])>=0)return!0;return!1}(b,V))return;const G=this.sourceLayerCoder.decode(c),X=this.vtLayers[G].feature(p);if(v.needGeometry){const ce=sa(X,!0);if(!v.filter(new Ki(this.tileID.overscaledZ),ce,this.tileID.canonical))return}else if(!v.filter(new Ki(this.tileID.overscaledZ),X))return;const K=this.getId(X,G);for(let ce=0;ce<V.length;ce++){const _e=V[ce];if(b&&b.indexOf(_e)<0)continue;const Ue=k[_e];if(!Ue)continue;let Me={};K&&A&&(Me=A.getState(Ue.sourceLayer||"_geojsonTileLayer",K));const Oe=Ae({},L[_e]);Oe.paint=$p(Oe.paint,Ue.paint,X,Me,x),Oe.layout=$p(Oe.layout,Ue.layout,X,Me,x);const Xe=!R||R(X,Ue,Me);if(!Xe)continue;const rt=new Yp(X,this.z,this.x,this.y,K);rt.layer=Oe;let wt=t[_e];wt===void 0&&(wt=t[_e]=[]),wt.push({featureIndex:p,feature:rt,intersectionZ:Xe})}}lookupSymbolFeatures(t,r,c,p,v,b,x,k){const L={};this.loadVTLayers();const A=eu(v);for(const R of t)this.loadMatchingFeature(L,c,p,R,A,b,x,k,r);return L}hasLayer(t){for(const r of this.bucketLayerIDs)for(const c of r)if(t===c)return!0;return!1}getId(t,r){let c=t.id;return this.promoteId&&(c=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof c=="boolean"&&(c=Number(c))),c}}function $p(n,t,r,c,p){return Z(n,(v,b)=>{const x=t instanceof ea?t.get(b):null;return x&&x.evaluate?x.evaluate(r,c,p):x})}function em(n){let t=1/0,r=1/0,c=-1/0,p=-1/0;for(const v of n)t=Math.min(t,v.x),r=Math.min(r,v.y),c=Math.max(c,v.x),p=Math.max(p,v.y);return{minX:t,minY:r,maxX:c,maxY:p}}function i1(n,t){return t-n}function tm(n,t,r,c,p){const v=[];for(let b=0;b<n.length;b++){const x=n[b];let k;for(let L=0;L<x.length-1;L++){let A=x[L],R=x[L+1];A.x<t&&R.x<t||(A.x<t?A=new C(t,A.y+(t-A.x)/(R.x-A.x)*(R.y-A.y))._round():R.x<t&&(R=new C(t,A.y+(t-A.x)/(R.x-A.x)*(R.y-A.y))._round()),A.y<r&&R.y<r||(A.y<r?A=new C(A.x+(r-A.y)/(R.y-A.y)*(R.x-A.x),r)._round():R.y<r&&(R=new C(A.x+(r-A.y)/(R.y-A.y)*(R.x-A.x),r)._round()),A.x>=c&&R.x>=c||(A.x>=c?A=new C(c,A.y+(c-A.x)/(R.x-A.x)*(R.y-A.y))._round():R.x>=c&&(R=new C(c,A.y+(c-A.x)/(R.x-A.x)*(R.y-A.y))._round()),A.y>=p&&R.y>=p||(A.y>=p?A=new C(A.x+(p-A.y)/(R.y-A.y)*(R.x-A.x),p)._round():R.y>=p&&(R=new C(A.x+(p-A.y)/(R.y-A.y)*(R.x-A.x),p)._round()),k&&A.equals(k[k.length-1])||(k=[A],v.push(k)),k.push(R)))))}}return v}Et("FeatureIndex",Qp,{omit:["rawTileData","sourceLayerCoder"]});class Eo extends C{constructor(t,r,c,p){super(t,r),this.angle=c,p!==void 0&&(this.segment=p)}clone(){return new Eo(this.x,this.y,this.angle,this.segment)}}function im(n,t,r,c,p){if(t.segment===void 0||r===0)return!0;let v=t,b=t.segment+1,x=0;for(;x>-r/2;){if(b--,b<0)return!1;x-=n[b].dist(v),v=n[b]}x+=n[b].dist(n[b+1]),b++;const k=[];let L=0;for(;x<r/2;){const A=n[b],R=n[b+1];if(!R)return!1;let V=n[b-1].angleTo(A)-A.angleTo(R);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:x,angleDelta:V}),L+=V;x-k[0].distance>c;)L-=k.shift().angleDelta;if(L>p)return!1;b++,x+=A.dist(R)}return!0}function nm(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function rm(n,t,r){return n?.6*t*r:0}function sm(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function n1(n,t,r,c,p,v){const b=rm(r,p,v),x=sm(r,c)*v;let k=0;const L=nm(n)/2;for(let A=0;A<n.length-1;A++){const R=n[A],V=n[A+1],G=R.dist(V);if(k+G>L){const X=(L-k)/G,K=Jn.number(R.x,V.x,X),ce=Jn.number(R.y,V.y,X),_e=new Eo(K,ce,V.angleTo(R),A);return _e._round(),!b||im(n,_e,x,b,t)?_e:void 0}k+=G}}function r1(n,t,r,c,p,v,b,x,k){const L=rm(c,v,b),A=sm(c,p),R=A*b,V=n[0].x===0||n[0].x===k||n[0].y===0||n[0].y===k;return t-R<t/4&&(t=R+t/4),om(n,V?t/2*x%t:(A/2+2*v)*b*x%t,t,L,r,R,V,!1,k)}function om(n,t,r,c,p,v,b,x,k){const L=v/2,A=nm(n);let R=0,V=t-r,G=[];for(let X=0;X<n.length-1;X++){const K=n[X],ce=n[X+1],_e=K.dist(ce),Ue=ce.angleTo(K);for(;V+r<R+_e;){V+=r;const Me=(V-R)/_e,Oe=Jn.number(K.x,ce.x,Me),Xe=Jn.number(K.y,ce.y,Me);if(Oe>=0&&Oe<k&&Xe>=0&&Xe<k&&V-L>=0&&V+L<=A){const rt=new Eo(Oe,Xe,Ue,X);rt._round(),c&&!im(n,rt,v,c,p)||G.push(rt)}}R+=_e}return x||G.length||b||(G=om(n,R/2,r,c,p,v,b,!0,k)),G}Et("Anchor",Eo);const hl=dr;function am(n,t,r,c){const p=[],v=n.image,b=v.pixelRatio,x=v.paddedRect.w-2*hl,k=v.paddedRect.h-2*hl;let L={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const A=v.stretchX||[[0,x]],R=v.stretchY||[[0,k]],V=(Je,Ot)=>Je+Ot[1]-Ot[0],G=A.reduce(V,0),X=R.reduce(V,0),K=x-G,ce=k-X;let _e=0,Ue=G,Me=0,Oe=X,Xe=0,rt=K,wt=0,Zt=ce;if(v.content&&c){const Je=v.content,Ot=Je[2]-Je[0],Rt=Je[3]-Je[1];(v.textFitWidth||v.textFitHeight)&&(L=Dp(n)),_e=lh(A,0,Je[0]),Me=lh(R,0,Je[1]),Ue=lh(A,Je[0],Je[2]),Oe=lh(R,Je[1],Je[3]),Xe=Je[0]-_e,wt=Je[1]-Me,rt=Ot-Ue,Zt=Rt-Oe}const bt=L.x1,_t=L.y1,Bt=L.x2-bt,Mt=L.y2-_t,Ct=(Je,Ot,Rt,ei)=>{const ji=uh(Je.stretch-_e,Ue,Bt,bt),Ni=ch(Je.fixed-Xe,rt,Je.stretch,G),Tn=uh(Ot.stretch-Me,Oe,Mt,_t),Yr=ch(Ot.fixed-wt,Zt,Ot.stretch,X),On=uh(Rt.stretch-_e,Ue,Bt,bt),Cn=ch(Rt.fixed-Xe,rt,Rt.stretch,G),er=uh(ei.stretch-Me,Oe,Mt,_t),tr=ch(ei.fixed-wt,Zt,ei.stretch,X),ir=new C(ji,Tn),mn=new C(On,Tn),In=new C(On,er),Hn=new C(ji,er),Nn=new C(Ni/b,Yr/b),nr=new C(Cn/b,tr/b),Vn=t*Math.PI/180;if(Vn){const Ii=Math.sin(Vn),Wi=Math.cos(Vn),$i=[Wi,-Ii,Ii,Wi];ir._matMult($i),mn._matMult($i),Hn._matMult($i),In._matMult($i)}const Or=Je.stretch+Je.fixed,pr=Ot.stretch+Ot.fixed;return{tl:ir,tr:mn,bl:Hn,br:In,tex:{x:v.paddedRect.x+hl+Or,y:v.paddedRect.y+hl+pr,w:Rt.stretch+Rt.fixed-Or,h:ei.stretch+ei.fixed-pr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Nn,pixelOffsetBR:nr,minFontScaleX:rt/b/Bt,minFontScaleY:Zt/b/Mt,isSDF:r}};if(c&&(v.stretchX||v.stretchY)){const Je=lm(A,K,G),Ot=lm(R,ce,X);for(let Rt=0;Rt<Je.length-1;Rt++){const ei=Je[Rt],ji=Je[Rt+1];for(let Ni=0;Ni<Ot.length-1;Ni++)p.push(Ct(ei,Ot[Ni],ji,Ot[Ni+1]))}}else p.push(Ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:k+1}));return p}function lh(n,t,r){let c=0;for(const p of n)c+=Math.max(t,Math.min(r,p[1]))-Math.max(t,Math.min(r,p[0]));return c}function lm(n,t,r){const c=[{fixed:-hl,stretch:0}];for(const[p,v]of n){const b=c[c.length-1];c.push({fixed:p-b.stretch,stretch:b.stretch}),c.push({fixed:p-b.stretch,stretch:b.stretch+(v-p)})}return c.push({fixed:t+hl,stretch:r}),c}function uh(n,t,r,c){return n/t*r+c}function ch(n,t,r,c){return n-t*r/c}class hh{constructor(t,r,c,p,v,b,x,k,L,A){var R;if(this.boxStartIndex=t.length,L){let V=b.top,G=b.bottom;const X=b.collisionPadding;X&&(V-=X[1],G+=X[3]);let K=G-V;K>0&&(K=Math.max(10,K),this.circleDiameter=K)}else{const V=!((R=b.image)===null||R===void 0)&&R.content&&(b.image.textFitWidth||b.image.textFitHeight)?Dp(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};V.y1=V.y1*x-k[0],V.y2=V.y2*x+k[2],V.x1=V.x1*x-k[3],V.x2=V.x2*x+k[1];const G=b.collisionPadding;if(G&&(V.x1-=G[0]*x,V.y1-=G[1]*x,V.x2+=G[2]*x,V.y2+=G[3]*x),A){const X=new C(V.x1,V.y1),K=new C(V.x2,V.y1),ce=new C(V.x1,V.y2),_e=new C(V.x2,V.y2),Ue=A*Math.PI/180;X._rotate(Ue),K._rotate(Ue),ce._rotate(Ue),_e._rotate(Ue),V.x1=Math.min(X.x,K.x,ce.x,_e.x),V.x2=Math.max(X.x,K.x,ce.x,_e.x),V.y1=Math.min(X.y,K.y,ce.y,_e.y),V.y2=Math.max(X.y,K.y,ce.y,_e.y)}t.emplaceBack(r.x,r.y,V.x1,V.y1,V.x2,V.y2,c,p,v)}this.boxEndIndex=t.length}}class s1{constructor(t=[],r=(c,p)=>c<p?-1:c>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:c}=this,p=r[t];for(;t>0;){const v=t-1>>1,b=r[v];if(c(p,b)>=0)break;r[t]=b,t=v}r[t]=p}_down(t){const{data:r,compare:c}=this,p=this.length>>1,v=r[t];for(;t<p;){let b=1+(t<<1);const x=b+1;if(x<this.length&&c(r[x],r[b])<0&&(b=x),c(r[b],v)>=0)break;r[t]=r[b],t=b}r[t]=v}}function o1(n,t=1,r=!1){let c=1/0,p=1/0,v=-1/0,b=-1/0;const x=n[0];for(let G=0;G<x.length;G++){const X=x[G];(!G||X.x<c)&&(c=X.x),(!G||X.y<p)&&(p=X.y),(!G||X.x>v)&&(v=X.x),(!G||X.y>b)&&(b=X.y)}const k=Math.min(v-c,b-p);let L=k/2;const A=new s1([],a1);if(k===0)return new C(c,p);for(let G=c;G<v;G+=k)for(let X=p;X<b;X+=k)A.push(new fl(G+L,X+L,L,n));let R=function(G){let X=0,K=0,ce=0;const _e=G[0];for(let Ue=0,Me=_e.length,Oe=Me-1;Ue<Me;Oe=Ue++){const Xe=_e[Ue],rt=_e[Oe],wt=Xe.x*rt.y-rt.x*Xe.y;K+=(Xe.x+rt.x)*wt,ce+=(Xe.y+rt.y)*wt,X+=3*wt}return new fl(K/X,ce/X,0,G)}(n),V=A.length;for(;A.length;){const G=A.pop();(G.d>R.d||!R.d)&&(R=G,r&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,V)),G.max-R.d<=t||(L=G.h/2,A.push(new fl(G.p.x-L,G.p.y-L,L,n)),A.push(new fl(G.p.x+L,G.p.y-L,L,n)),A.push(new fl(G.p.x-L,G.p.y+L,L,n)),A.push(new fl(G.p.x+L,G.p.y+L,L,n)),V+=4)}return r&&(console.log(`num probes: ${V}`),console.log(`best distance: ${R.d}`)),R.p}function a1(n,t){return t.max-n.max}function fl(n,t,r,c){this.p=new C(n,t),this.h=r,this.d=function(p,v){let b=!1,x=1/0;for(let k=0;k<v.length;k++){const L=v[k];for(let A=0,R=L.length,V=R-1;A<R;V=A++){const G=L[A],X=L[V];G.y>p.y!=X.y>p.y&&p.x<(X.x-G.x)*(p.y-G.y)/(X.y-G.y)+G.x&&(b=!b),x=Math.min(x,Gd(p,G,X))}}return(b?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}var Fn;m.aq=void 0,(Fn=m.aq||(m.aq={}))[Fn.center=1]="center",Fn[Fn.left=2]="left",Fn[Fn.right=3]="right",Fn[Fn.top=4]="top",Fn[Fn.bottom=5]="bottom",Fn[Fn["top-left"]=6]="top-left",Fn[Fn["top-right"]=7]="top-right",Fn[Fn["bottom-left"]=8]="bottom-left",Fn[Fn["bottom-right"]=9]="bottom-right";const Mo=7,qf=Number.POSITIVE_INFINITY;function um(n,t){return t[1]!==qf?function(r,c,p){let v=0,b=0;switch(c=Math.abs(c),p=Math.abs(p),r){case"top-right":case"top-left":case"top":b=p-Mo;break;case"bottom-right":case"bottom-left":case"bottom":b=-p+Mo}switch(r){case"top-right":case"bottom-right":case"right":v=-c;break;case"top-left":case"bottom-left":case"left":v=c}return[v,b]}(n,t[0],t[1]):function(r,c){let p=0,v=0;c<0&&(c=0);const b=c/Math.SQRT2;switch(r){case"top-right":case"top-left":v=b-Mo;break;case"bottom-right":case"bottom-left":v=-b+Mo;break;case"bottom":v=-c+Mo;break;case"top":v=c-Mo}switch(r){case"top-right":case"bottom-right":p=-b;break;case"top-left":case"bottom-left":p=b;break;case"left":p=c;break;case"right":p=-c}return[p,v]}(n,t[0])}function cm(n,t,r){var c;const p=n.layout,v=(c=p.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},r);if(v){const x=v.values,k=[];for(let L=0;L<x.length;L+=2){const A=k[L]=x[L],R=x[L+1].map(V=>V*wn);A.startsWith("top")?R[1]-=Mo:A.startsWith("bottom")&&(R[1]+=Mo),k[L+1]=R}return new kn(k)}const b=p.get("text-variable-anchor");if(b){let x;x=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},r)*wn,qf]:p.get("text-offset").evaluate(t,{},r).map(L=>L*wn);const k=[];for(const L of b)k.push(L,um(L,x));return new kn(k)}return null}function Zf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function l1(n,t,r,c,p,v,b,x,k,L,A){let R=v.textMaxSize.evaluate(t,{});R===void 0&&(R=b);const V=n.layers[0].layout,G=V.get("icon-offset").evaluate(t,{},A),X=fm(r.horizontal),K=b/24,ce=n.tilePixelRatio*K,_e=n.tilePixelRatio*R/24,Ue=n.tilePixelRatio*x,Me=n.tilePixelRatio*V.get("symbol-spacing"),Oe=V.get("text-padding")*n.tilePixelRatio,Xe=function(Je,Ot,Rt,ei=1){const ji=Je.get("icon-padding").evaluate(Ot,{},Rt),Ni=ji&&ji.values;return[Ni[0]*ei,Ni[1]*ei,Ni[2]*ei,Ni[3]*ei]}(V,t,A,n.tilePixelRatio),rt=V.get("text-max-angle")/180*Math.PI,wt=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",Zt=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",bt=V.get("symbol-placement"),_t=Me/2,Bt=V.get("icon-text-fit");let Mt;c&&Bt!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(Mt=Rp(c,r.vertical,Bt,V.get("icon-text-fit-padding"),G,K)),X&&(c=Rp(c,X,Bt,V.get("icon-text-fit-padding"),G,K)));const Ct=(Je,Ot)=>{Ot.x<0||Ot.x>=vn||Ot.y<0||Ot.y>=vn||function(Rt,ei,ji,Ni,Tn,Yr,On,Cn,er,tr,ir,mn,In,Hn,Nn,nr,Vn,Or,pr,Ii,Wi,$i,kr,sn,dl){const bs=Rt.addToLineVertexArray(ei,ji);let xs,Qr,Nr,Ln,js=0,Ou=0,gm=0,_m=0,Qf=-1,$f=-1;const Us={};let ym=$a("");if(Rt.allowVerticalPlacement&&Ni.vertical){const Xn=Cn.layout.get("text-rotate").evaluate(Wi,{},sn)+90;Nr=new hh(er,ei,tr,ir,mn,Ni.vertical,In,Hn,Nn,Xn),On&&(Ln=new hh(er,ei,tr,ir,mn,On,Vn,Or,Nn,Xn))}if(Tn){const Xn=Cn.layout.get("icon-rotate").evaluate(Wi,{}),Vr=Cn.layout.get("icon-text-fit")!=="none",aa=am(Tn,Xn,kr,Vr),us=On?am(On,Xn,kr,Vr):void 0;Qr=new hh(er,ei,tr,ir,mn,Tn,Vn,Or,!1,Xn),js=4*aa.length;const la=Rt.iconSizeData;let ws=null;la.kind==="source"?(ws=[vs*Cn.layout.get("icon-size").evaluate(Wi,{})],ws[0]>Co&&ee(`${Rt.layerIds[0]}: Value for "icon-size" is >= ${zu}. Reduce your "icon-size".`)):la.kind==="composite"&&(ws=[vs*$i.compositeIconSizes[0].evaluate(Wi,{},sn),vs*$i.compositeIconSizes[1].evaluate(Wi,{},sn)],(ws[0]>Co||ws[1]>Co)&&ee(`${Rt.layerIds[0]}: Value for "icon-size" is >= ${zu}. Reduce your "icon-size".`)),Rt.addSymbols(Rt.icon,aa,ws,Ii,pr,Wi,m.ah.none,ei,bs.lineStartIndex,bs.lineLength,-1,sn),Qf=Rt.icon.placedSymbolArray.length-1,us&&(Ou=4*us.length,Rt.addSymbols(Rt.icon,us,ws,Ii,pr,Wi,m.ah.vertical,ei,bs.lineStartIndex,bs.lineLength,-1,sn),$f=Rt.icon.placedSymbolArray.length-1)}const vm=Object.keys(Ni.horizontal);for(const Xn of vm){const Vr=Ni.horizontal[Xn];if(!xs){ym=$a(Vr.text);const us=Cn.layout.get("text-rotate").evaluate(Wi,{},sn);xs=new hh(er,ei,tr,ir,mn,Vr,In,Hn,Nn,us)}const aa=Vr.positionedLines.length===1;if(gm+=hm(Rt,ei,Vr,Yr,Cn,Nn,Wi,nr,bs,Ni.vertical?m.ah.horizontal:m.ah.horizontalOnly,aa?vm:[Xn],Us,Qf,$i,sn),aa)break}Ni.vertical&&(_m+=hm(Rt,ei,Ni.vertical,Yr,Cn,Nn,Wi,nr,bs,m.ah.vertical,["vertical"],Us,$f,$i,sn));const h1=xs?xs.boxStartIndex:Rt.collisionBoxArray.length,f1=xs?xs.boxEndIndex:Rt.collisionBoxArray.length,d1=Nr?Nr.boxStartIndex:Rt.collisionBoxArray.length,p1=Nr?Nr.boxEndIndex:Rt.collisionBoxArray.length,m1=Qr?Qr.boxStartIndex:Rt.collisionBoxArray.length,g1=Qr?Qr.boxEndIndex:Rt.collisionBoxArray.length,_1=Ln?Ln.boxStartIndex:Rt.collisionBoxArray.length,y1=Ln?Ln.boxEndIndex:Rt.collisionBoxArray.length;let ls=-1;const dh=(Xn,Vr)=>Xn&&Xn.circleDiameter?Math.max(Xn.circleDiameter,Vr):Vr;ls=dh(xs,ls),ls=dh(Nr,ls),ls=dh(Qr,ls),ls=dh(Ln,ls);const bm=ls>-1?1:0;bm&&(ls*=dl/wn),Rt.glyphOffsetArray.length>=cl.MAX_GLYPHS&&ee("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Wi.sortKey!==void 0&&Rt.addToSortKeyRanges(Rt.symbolInstances.length,Wi.sortKey);const v1=cm(Cn,Wi,sn),[b1,x1]=function(Xn,Vr){const aa=Xn.length,us=Vr==null?void 0:Vr.values;if((us==null?void 0:us.length)>0)for(let la=0;la<us.length;la+=2){const ws=us[la+1];Xn.emplaceBack(m.aq[us[la]],ws[0],ws[1])}return[aa,Xn.length]}(Rt.textAnchorOffsets,v1);Rt.symbolInstances.emplaceBack(ei.x,ei.y,Us.right>=0?Us.right:-1,Us.center>=0?Us.center:-1,Us.left>=0?Us.left:-1,Us.vertical||-1,Qf,$f,ym,h1,f1,d1,p1,m1,g1,_1,y1,tr,gm,_m,js,Ou,bm,0,In,ls,b1,x1)}(n,Ot,Je,r,c,p,Mt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ce,[Oe,Oe,Oe,Oe],wt,k,Ue,Xe,Zt,G,t,v,L,A,b)};if(bt==="line")for(const Je of tm(t.geometry,0,0,vn,vn)){const Ot=r1(Je,Me,rt,r.vertical||X,c,24,_e,n.overscaling,vn);for(const Rt of Ot)X&&u1(n,X.text,_t,Rt)||Ct(Je,Rt)}else if(bt==="line-center"){for(const Je of t.geometry)if(Je.length>1){const Ot=n1(Je,rt,r.vertical||X,c,24,_e);Ot&&Ct(Je,Ot)}}else if(t.type==="Polygon")for(const Je of Ma(t.geometry,0)){const Ot=o1(Je,16);Ct(Je[0],new Eo(Ot.x,Ot.y,0))}else if(t.type==="LineString")for(const Je of t.geometry)Ct(Je,new Eo(Je[0].x,Je[0].y,0));else if(t.type==="Point")for(const Je of t.geometry)for(const Ot of Je)Ct([Ot],new Eo(Ot.x,Ot.y,0))}function hm(n,t,r,c,p,v,b,x,k,L,A,R,V,G,X){const K=function(Ue,Me,Oe,Xe,rt,wt,Zt,bt){const _t=Xe.layout.get("text-rotate").evaluate(wt,{})*Math.PI/180,Bt=[];for(const Mt of Me.positionedLines)for(const Ct of Mt.positionedGlyphs){if(!Ct.rect)continue;const Je=Ct.rect||{};let Ot=Ip+1,Rt=!0,ei=1,ji=0;const Ni=(rt||bt)&&Ct.vertical,Tn=Ct.metrics.advance*Ct.scale/2;if(bt&&Me.verticalizable&&(ji=Mt.lineOffset/2-(Ct.imageName?-(wn-Ct.metrics.width*Ct.scale)/2:(Ct.scale-1)*wn)),Ct.imageName){const Ii=Zt[Ct.imageName];Rt=Ii.sdf,ei=Ii.pixelRatio,Ot=dr/ei}const Yr=rt?[Ct.x+Tn,Ct.y]:[0,0];let On=rt?[0,0]:[Ct.x+Tn+Oe[0],Ct.y+Oe[1]-ji],Cn=[0,0];Ni&&(Cn=On,On=[0,0]);const er=Ct.metrics.isDoubleResolution?2:1,tr=(Ct.metrics.left-Ot)*Ct.scale-Tn+On[0],ir=(-Ct.metrics.top-Ot)*Ct.scale+On[1],mn=tr+Je.w/er*Ct.scale/ei,In=ir+Je.h/er*Ct.scale/ei,Hn=new C(tr,ir),Nn=new C(mn,ir),nr=new C(tr,In),Vn=new C(mn,In);if(Ni){const Ii=new C(-Tn,Tn-Pu),Wi=-Math.PI/2,$i=wn/2-Tn,kr=new C(5-Pu-$i,-(Ct.imageName?$i:0)),sn=new C(...Cn);Hn._rotateAround(Wi,Ii)._add(kr)._add(sn),Nn._rotateAround(Wi,Ii)._add(kr)._add(sn),nr._rotateAround(Wi,Ii)._add(kr)._add(sn),Vn._rotateAround(Wi,Ii)._add(kr)._add(sn)}if(_t){const Ii=Math.sin(_t),Wi=Math.cos(_t),$i=[Wi,-Ii,Ii,Wi];Hn._matMult($i),Nn._matMult($i),nr._matMult($i),Vn._matMult($i)}const Or=new C(0,0),pr=new C(0,0);Bt.push({tl:Hn,tr:Nn,bl:nr,br:Vn,tex:Je,writingMode:Me.writingMode,glyphOffset:Yr,sectionIndex:Ct.sectionIndex,isSDF:Rt,pixelOffsetTL:Or,pixelOffsetBR:pr,minFontScaleX:0,minFontScaleY:0})}return Bt}(0,r,x,p,v,b,c,n.allowVerticalPlacement),ce=n.textSizeData;let _e=null;ce.kind==="source"?(_e=[vs*p.layout.get("text-size").evaluate(b,{})],_e[0]>Co&&ee(`${n.layerIds[0]}: Value for "text-size" is >= ${zu}. Reduce your "text-size".`)):ce.kind==="composite"&&(_e=[vs*G.compositeTextSizes[0].evaluate(b,{},X),vs*G.compositeTextSizes[1].evaluate(b,{},X)],(_e[0]>Co||_e[1]>Co)&&ee(`${n.layerIds[0]}: Value for "text-size" is >= ${zu}. Reduce your "text-size".`)),n.addSymbols(n.text,K,_e,x,v,b,L,t,k.lineStartIndex,k.lineLength,V,X);for(const Ue of A)R[Ue]=n.text.placedSymbolArray.length-1;return 4*K.length}function fm(n){for(const t in n)return n[t];return null}function u1(n,t,r,c){const p=n.compareText;if(t in p){const v=p[t];for(let b=v.length-1;b>=0;b--)if(c.dist(v[b])<r)return!0}else p[t]=[];return p[t].push(c),!1}const dm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,c]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const v=dm[15&c];if(!v)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new Gf(x,b,v,t)}constructor(t,r=64,c=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const v=dm.indexOf(this.ArrayType),b=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-x%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+k,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+b+x+k),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+k,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=r,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Wf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:b,nodeSize:x}=this,k=[0,v.length-1,0],L=[];for(;k.length;){const A=k.pop()||0,R=k.pop()||0,V=k.pop()||0;if(R-V<=x){for(let ce=V;ce<=R;ce++){const _e=b[2*ce],Ue=b[2*ce+1];_e>=t&&_e<=c&&Ue>=r&&Ue<=p&&L.push(v[ce])}continue}const G=V+R>>1,X=b[2*G],K=b[2*G+1];X>=t&&X<=c&&K>=r&&K<=p&&L.push(v[G]),(A===0?t<=X:r<=K)&&(k.push(V),k.push(G-1),k.push(1-A)),(A===0?c>=X:p>=K)&&(k.push(G+1),k.push(R),k.push(1-A))}return L}within(t,r,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:v,nodeSize:b}=this,x=[0,p.length-1,0],k=[],L=c*c;for(;x.length;){const A=x.pop()||0,R=x.pop()||0,V=x.pop()||0;if(R-V<=b){for(let ce=V;ce<=R;ce++)mm(v[2*ce],v[2*ce+1],t,r)<=L&&k.push(p[ce]);continue}const G=V+R>>1,X=v[2*G],K=v[2*G+1];mm(X,K,t,r)<=L&&k.push(p[G]),(A===0?t-c<=X:r-c<=K)&&(x.push(V),x.push(G-1),x.push(1-A)),(A===0?t+c>=X:r+c>=K)&&(x.push(G+1),x.push(R),x.push(1-A))}return k}}function Wf(n,t,r,c,p,v){if(p-c<=r)return;const b=c+p>>1;pm(n,t,b,c,p,v),Wf(n,t,r,c,b-1,1-v),Wf(n,t,r,b+1,p,1-v)}function pm(n,t,r,c,p,v){for(;p>c;){if(p-c>600){const L=p-c+1,A=r-c+1,R=Math.log(L),V=.5*Math.exp(2*R/3),G=.5*Math.sqrt(R*V*(L-V)/L)*(A-L/2<0?-1:1);pm(n,t,r,Math.max(c,Math.floor(r-A*V/L+G)),Math.min(p,Math.floor(r+(L-A)*V/L+G)),v)}const b=t[2*r+v];let x=c,k=p;for(Bu(n,t,c,r),t[2*p+v]>b&&Bu(n,t,c,p);x<k;){for(Bu(n,t,x,k),x++,k--;t[2*x+v]<b;)x++;for(;t[2*k+v]>b;)k--}t[2*c+v]===b?Bu(n,t,c,k):(k++,Bu(n,t,k,p)),k<=r&&(c=k+1),r<=k&&(p=k-1)}}function Bu(n,t,r,c){Hf(n,r,c),Hf(t,2*r,2*c),Hf(t,2*r+1,2*c+1)}function Hf(n,t,r){const c=n[t];n[t]=n[r],n[r]=c}function mm(n,t,r,c){const p=n-r,v=t-c;return p*p+v*v}var Xf;m.bg=void 0,(Xf=m.bg||(m.bg={})).create="create",Xf.load="load",Xf.fullLoad="fullLoad";let fh=null,Fu=[];const Kf=1e3/60,Jf="loadTime",Yf="fullLoadTime",c1={mark(n){performance.mark(n)},frame(n){const t=n;fh!=null&&Fu.push(t-fh),fh=t},clearMetrics(){fh=null,Fu=[],performance.clearMeasures(Jf),performance.clearMeasures(Yf);for(const n in m.bg)performance.clearMarks(m.bg[n])},getPerformanceMetrics(){performance.measure(Jf,m.bg.create,m.bg.load),performance.measure(Yf,m.bg.create,m.bg.fullLoad);const n=performance.getEntriesByName(Jf)[0].duration,t=performance.getEntriesByName(Yf)[0].duration,r=Fu.length,c=1/(Fu.reduce((v,b)=>v+b,0)/r/1e3),p=Fu.filter(v=>v>Kf).reduce((v,b)=>v+(b-Kf)/Kf,0);return{loadTime:n,fullLoadTime:t,fps:c,percentDroppedFrames:p/(r+p)*100,totalFrames:r}}};m.$=class extends F{},m.A=rl,m.B=sf,m.C=function(n){if(pe==null){const t=n.navigator?n.navigator.userAgent:null;pe=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return pe},m.D=zt,m.E=Qt,m.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new t1(()=>this.process()),this.subscription=function(r,c,p,v){return r.addEventListener(c,p,!1),{unsubscribe:()=>{r.removeEventListener(c,p,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=ne(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((r,c)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[p]={resolve:r,reject:c},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[p];const x={id:p,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)},{once:!0});const v=[],b=Object.assign(Object.assign({},n),{id:p,sourceMapId:this.mapId,origin:location.origin,data:po(n.data,v)});this.target.postMessage(b,{transfer:v})})}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const c=this.abortControllers[r];return delete this.abortControllers[r],void(c&&c.abort())}if(ne(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return u(this,void 0,void 0,function*(){if(t.type==="<response>"){const p=this.resolveRejects[n];return delete this.resolveRejects[n],p?void(t.error?p.reject(mo(t.error)):p.resolve(mo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=mo(t.data),c=new AbortController;this.abortControllers[n]=c;try{const p=yield this.messageHandlers[t.type](t.sourceMapId,r,c);this.completeTask(n,null,p)}catch(p){this.completeTask(n,p)}})}completeTask(n,t,r){const c=[];delete this.abortControllers[n];const p={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?po(t):null,data:po(r,c)};this.target.postMessage(p,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.G=st,m.H=function(){var n=new rl(16);return rl!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},m.I=Af,m.J=function(n,t,r){var c,p,v,b,x,k,L,A,R,V,G,X,K=r[0],ce=r[1],_e=r[2];return t===n?(n[12]=t[0]*K+t[4]*ce+t[8]*_e+t[12],n[13]=t[1]*K+t[5]*ce+t[9]*_e+t[13],n[14]=t[2]*K+t[6]*ce+t[10]*_e+t[14],n[15]=t[3]*K+t[7]*ce+t[11]*_e+t[15]):(p=t[1],v=t[2],b=t[3],x=t[4],k=t[5],L=t[6],A=t[7],R=t[8],V=t[9],G=t[10],X=t[11],n[0]=c=t[0],n[1]=p,n[2]=v,n[3]=b,n[4]=x,n[5]=k,n[6]=L,n[7]=A,n[8]=R,n[9]=V,n[10]=G,n[11]=X,n[12]=c*K+x*ce+R*_e+t[12],n[13]=p*K+k*ce+V*_e+t[13],n[14]=v*K+L*ce+G*_e+t[14],n[15]=b*K+A*ce+X*_e+t[15]),n},m.K=function(n,t,r){var c=r[0],p=r[1],v=r[2];return n[0]=t[0]*c,n[1]=t[1]*c,n[2]=t[2]*c,n[3]=t[3]*c,n[4]=t[4]*p,n[5]=t[5]*p,n[6]=t[6]*p,n[7]=t[7]*p,n[8]=t[8]*v,n[9]=t[9]*v,n[10]=t[10]*v,n[11]=t[11]*v,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.L=Kd,m.M=function(n,t){const r={};for(let c=0;c<t.length;c++){const p=t[c];p in n&&(r[p]=n[p])}return r},m.N=Io,m.O=Zp,m.P=C,m.Q=Gp,m.R=Br,m.S=Fr,m.T=Xa,m.U=ae,m.V=$,m.W=qe,m.X=vn,m.Y=S,m.Z=Du,m._=u,m.a=St,m.a$=function(n,t){var r=n[0],c=n[1],p=n[2],v=n[3],b=n[4],x=n[5],k=n[6],L=n[7],A=n[8],R=n[9],V=n[10],G=n[11],X=n[12],K=n[13],ce=n[14],_e=n[15],Ue=t[0],Me=t[1],Oe=t[2],Xe=t[3],rt=t[4],wt=t[5],Zt=t[6],bt=t[7],_t=t[8],Bt=t[9],Mt=t[10],Ct=t[11],Je=t[12],Ot=t[13],Rt=t[14],ei=t[15];return Math.abs(r-Ue)<=$n*Math.max(1,Math.abs(r),Math.abs(Ue))&&Math.abs(c-Me)<=$n*Math.max(1,Math.abs(c),Math.abs(Me))&&Math.abs(p-Oe)<=$n*Math.max(1,Math.abs(p),Math.abs(Oe))&&Math.abs(v-Xe)<=$n*Math.max(1,Math.abs(v),Math.abs(Xe))&&Math.abs(b-rt)<=$n*Math.max(1,Math.abs(b),Math.abs(rt))&&Math.abs(x-wt)<=$n*Math.max(1,Math.abs(x),Math.abs(wt))&&Math.abs(k-Zt)<=$n*Math.max(1,Math.abs(k),Math.abs(Zt))&&Math.abs(L-bt)<=$n*Math.max(1,Math.abs(L),Math.abs(bt))&&Math.abs(A-_t)<=$n*Math.max(1,Math.abs(A),Math.abs(_t))&&Math.abs(R-Bt)<=$n*Math.max(1,Math.abs(R),Math.abs(Bt))&&Math.abs(V-Mt)<=$n*Math.max(1,Math.abs(V),Math.abs(Mt))&&Math.abs(G-Ct)<=$n*Math.max(1,Math.abs(G),Math.abs(Ct))&&Math.abs(X-Je)<=$n*Math.max(1,Math.abs(X),Math.abs(Je))&&Math.abs(K-Ot)<=$n*Math.max(1,Math.abs(K),Math.abs(Ot))&&Math.abs(ce-Rt)<=$n*Math.max(1,Math.abs(ce),Math.abs(Rt))&&Math.abs(_e-ei)<=$n*Math.max(1,Math.abs(_e),Math.abs(ei))},m.a0=mi,m.a1=Uf,m.a2=ot,m.a3=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const c of n){const p=window.document.createElement("source");Zi(c)||(t.crossOrigin="Anonymous"),p.src=c,t.appendChild(p)}})},m.a4=function(){return B++},m.a5=xt,m.a6=cl,m.a7=eu,m.a8=sa,m.a9=Yp,m.aA=function(n){if(n.type==="custom")return new e1(n);switch(n.type){case"background":return new Y0(n);case"circle":return new Oy(n);case"fill":return new t0(n);case"fill-extrusion":return new g0(n);case"heatmap":return new Vy(n);case"hillshade":return new Uy(n);case"line":return new k0(n);case"raster":return new $0(n);case"symbol":return new ah(n)}},m.aB=D,m.aC=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Ge(n.version,t.version))return[{command:"setStyle",args:[t]}];Ge(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Ge(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Ge(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Ge(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Ge(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Ge(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Ge(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Ge(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),Ge(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Ge(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Ge(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const c={},p=[];(function(b,x,k,L){let A;for(A in x=x||{},b=b||{})Object.prototype.hasOwnProperty.call(b,A)&&(Object.prototype.hasOwnProperty.call(x,A)||jn(A,k,L));for(A in x)Object.prototype.hasOwnProperty.call(x,A)&&(Object.prototype.hasOwnProperty.call(b,A)?Ge(b[A],x[A])||(b[A].type==="geojson"&&x[A].type==="geojson"&&si(b,x,A)?Vt(k,{command:"setGeoJSONSourceData",args:[A,x[A].data]}):Ir(A,x,k,L)):Ri(A,x,k))})(n.sources,t.sources,p,c);const v=[];n.layers&&n.layers.forEach(b=>{"source"in b&&c[b.source]?r.push({command:"removeLayer",args:[b.id]}):v.push(b)}),r=r.concat(p),function(b,x,k){x=x||[];const L=(b=b||[]).map(Ut),A=x.map(Ut),R=b.reduce(ps,{}),V=x.reduce(ps,{}),G=L.slice(),X=Object.create(null);let K,ce,_e,Ue,Me;for(let Oe=0,Xe=0;Oe<L.length;Oe++)K=L[Oe],Object.prototype.hasOwnProperty.call(V,K)?Xe++:(Vt(k,{command:"removeLayer",args:[K]}),G.splice(G.indexOf(K,Xe),1));for(let Oe=0,Xe=0;Oe<A.length;Oe++)K=A[A.length-1-Oe],G[G.length-1-Oe]!==K&&(Object.prototype.hasOwnProperty.call(R,K)?(Vt(k,{command:"removeLayer",args:[K]}),G.splice(G.lastIndexOf(K,G.length-Xe),1)):Xe++,Ue=G[G.length-Oe],Vt(k,{command:"addLayer",args:[V[K],Ue]}),G.splice(G.length-Oe,0,K),X[K]=!0);for(let Oe=0;Oe<A.length;Oe++)if(K=A[Oe],ce=R[K],_e=V[K],!X[K]&&!Ge(ce,_e))if(Ge(ce.source,_e.source)&&Ge(ce["source-layer"],_e["source-layer"])&&Ge(ce.type,_e.type)){for(Me in Mi(ce.layout,_e.layout,k,K,null,"setLayoutProperty"),Mi(ce.paint,_e.paint,k,K,null,"setPaintProperty"),Ge(ce.filter,_e.filter)||Vt(k,{command:"setFilter",args:[K,_e.filter]}),Ge(ce.minzoom,_e.minzoom)&&Ge(ce.maxzoom,_e.maxzoom)||Vt(k,{command:"setLayerZoomRange",args:[K,_e.minzoom,_e.maxzoom]}),ce)Object.prototype.hasOwnProperty.call(ce,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Mi(ce[Me],_e[Me],k,K,Me.slice(6),"setPaintProperty"):Ge(ce[Me],_e[Me])||Vt(k,{command:"setLayerProperty",args:[K,Me,_e[Me]]}));for(Me in _e)Object.prototype.hasOwnProperty.call(_e,Me)&&!Object.prototype.hasOwnProperty.call(ce,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Mi(ce[Me],_e[Me],k,K,Me.slice(6),"setPaintProperty"):Ge(ce[Me],_e[Me])||Vt(k,{command:"setLayerProperty",args:[K,Me,_e[Me]]}))}else Vt(k,{command:"removeLayer",args:[K]}),Ue=G[G.lastIndexOf(K)+1],Vt(k,{command:"addLayer",args:[_e,Ue]})}(v,t.layers,r)}catch(c){console.warn("Unable to compute style diff:",c),r=[{command:"setStyle",args:[t]}]}return r},m.aD=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},m.aE=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let c=0;c<t.length;c++)if(!n(t[c],r[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const c in t)if(!n(t[c],r[c]))return!1;return!0}return t===r},m.aF=Z,m.aG=Q,m.aH=class extends ia{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},m.aI=Xc,m.aJ=class extends ia{constructor(n,t){super(n,t),this.current=Ly}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},m.aK=Od,m.aL=Nd,m.aM=qt,m.aN=class extends ia{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},m.aO=class extends ia{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},m.aP=function(n,t,r,c,p,v,b){var x=1/(t-r),k=1/(c-p),L=1/(v-b);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*k,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*L,n[11]=0,n[12]=(t+r)*x,n[13]=(p+c)*k,n[14]=(b+v)*L,n[15]=1,n},m.aQ=Fy,m.aR=class extends ze{},m.aS=E0,m.aT=class extends Ze{},m.aU=bf,m.aV=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},m.aW=ep,m.aX=Rn,m.aY=Rr,m.aZ=class extends Dt{},m.a_=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},m.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,c,p,v)=>{const b=p||v;return t[c]=!b||b.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},m.ab=function(n,t){const r=[];for(const c in n)c in t||r.push(c);return r},m.ac=ve,m.ad=function(n,t,r){var c=Math.sin(r),p=Math.cos(r),v=t[0],b=t[1],x=t[2],k=t[3],L=t[4],A=t[5],R=t[6],V=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=v*p+L*c,n[1]=b*p+A*c,n[2]=x*p+R*c,n[3]=k*p+V*c,n[4]=L*p-v*c,n[5]=A*p-b*c,n[6]=R*p-x*c,n[7]=V*p-k*c,n},m.ae=function(n){var t=new rl(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},m.af=Qc,m.ag=function(n,t){let r=0,c=0;if(n.kind==="constant")c=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:p,minZoom:v,maxZoom:b}=n,x=p?ve(Yn.interpolationFactor(p,t,v,b),0,1):0;n.kind==="camera"?c=Jn.number(n.minSize,n.maxSize,x):r=x}return{uSizeT:r,uSize:c}},m.ai=function(n,{uSize:t,uSizeT:r},{lowerSize:c,upperSize:p}){return n.kind==="source"?c/vs:n.kind==="composite"?Jn.number(c/vs,p/vs,r):t},m.aj=Bf,m.ak=function(n,t,r,c){const p=t.y-n.y,v=t.x-n.x,b=c.y-r.y,x=c.x-r.x,k=b*v-x*p;if(k===0)return null;const L=(x*(n.y-r.y)-b*(n.x-r.x))/k;return new C(n.x+L*v,n.y+L*p)},m.al=tm,m.am=qd,m.an=_f,m.ao=function(n){let t=1/0,r=1/0,c=-1/0,p=-1/0;for(const v of n)t=Math.min(t,v.x),r=Math.min(r,v.y),c=Math.max(c,v.x),p=Math.max(p,v.y);return[t,r,c,p]},m.ap=wn,m.ar=Rf,m.as=function(n,t){var r=t[0],c=t[1],p=t[2],v=t[3],b=t[4],x=t[5],k=t[6],L=t[7],A=t[8],R=t[9],V=t[10],G=t[11],X=t[12],K=t[13],ce=t[14],_e=t[15],Ue=r*x-c*b,Me=r*k-p*b,Oe=r*L-v*b,Xe=c*k-p*x,rt=c*L-v*x,wt=p*L-v*k,Zt=A*K-R*X,bt=A*ce-V*X,_t=A*_e-G*X,Bt=R*ce-V*K,Mt=R*_e-G*K,Ct=V*_e-G*ce,Je=Ue*Ct-Me*Mt+Oe*Bt+Xe*_t-rt*bt+wt*Zt;return Je?(n[0]=(x*Ct-k*Mt+L*Bt)*(Je=1/Je),n[1]=(p*Mt-c*Ct-v*Bt)*Je,n[2]=(K*wt-ce*rt+_e*Xe)*Je,n[3]=(V*rt-R*wt-G*Xe)*Je,n[4]=(k*_t-b*Ct-L*bt)*Je,n[5]=(r*Ct-p*_t+v*bt)*Je,n[6]=(ce*Oe-X*wt-_e*Me)*Je,n[7]=(A*wt-V*Oe+G*Me)*Je,n[8]=(b*Mt-x*_t+L*Zt)*Je,n[9]=(c*_t-r*Mt-v*Zt)*Je,n[10]=(X*rt-K*Oe+_e*Ue)*Je,n[11]=(R*Oe-A*rt-G*Ue)*Je,n[12]=(x*bt-b*Bt-k*Zt)*Je,n[13]=(r*Bt-c*bt+p*Zt)*Je,n[14]=(K*Me-X*Xe-ce*Ue)*Je,n[15]=(A*Xe-R*Me+V*Ue)*Je,n):null},m.at=Zf,m.au=Df,m.av=Gf,m.aw=function(){const n={},t=je.$version;for(const r in je.$root){const c=je.$root[r];if(c.required){let p=null;p=r==="version"?t:c.type==="array"?[]:{},p!=null&&(n[r]=p)}}return n},m.ax=pu,m.ay=wi,m.az=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=Ei(n[r],t[n[r].ref]));return n},m.b=Ce,m.b0=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},m.b1=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},m.b2=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},m.b3=De,m.b4=Xp,m.b5=Wp,m.b6=function(n,t,r,c,p){var v,b=1/Math.tan(t/2);return n[0]=b/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,p!=null&&p!==1/0?(n[10]=(p+c)*(v=1/(c-p)),n[14]=2*p*c*v):(n[10]=-1,n[14]=-2*c),n},m.b7=function(n,t,r){var c=Math.sin(r),p=Math.cos(r),v=t[4],b=t[5],x=t[6],k=t[7],L=t[8],A=t[9],R=t[10],V=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=v*p+L*c,n[5]=b*p+A*c,n[6]=x*p+R*c,n[7]=k*p+V*c,n[8]=L*p-v*c,n[9]=A*p-b*c,n[10]=R*p-x*c,n[11]=V*p-k*c,n},m.b8=Te,m.b9=Pe,m.bA=bp,m.bB=function(n){return n.message===at},m.bC=ao,m.bD=hr,m.ba=function(n){return n*Math.PI/180},m.bb=function(n,t){const{x:r,y:c}=Du.fromLngLat(t);return!(n<0||n>25||c<0||c>=1||r<0||r>=1)},m.bc=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},m.bd=class extends z{},m.be=Vf,m.bf=c1,m.bh=Lt,m.bi=function(n,t){St.REGISTERED_PROTOCOLS[n]=t},m.bj=function(n){delete St.REGISTERED_PROTOCOLS[n]},m.bk=function(n,t){const r={};for(let p=0;p<n.length;p++){const v=t&&t[n[p].id]||Bc(n[p]);t&&(t[n[p].id]=v);let b=r[v];b||(b=r[v]=[]),b.push(n[p])}const c=[];for(const p in r)c.push(r[p]);return c},m.bl=Et,m.bm=Jp,m.bn=Qp,m.bo=Mp,m.bp=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=vn/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,c=t._unevaluatedLayout._values,p={layoutIconSize:c["icon-size"].possiblyEvaluate(new Ki(n.bucket.zoom+1),n.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new Ki(n.bucket.zoom+1),n.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new Ki(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:A}=n.bucket.textSizeData;p.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Ki(L),n.canonical),c["text-size"].possiblyEvaluate(new Ki(A),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:A}=n.bucket.iconSizeData;p.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Ki(L),n.canonical),c["icon-size"].possiblyEvaluate(new Ki(A),n.canonical)]}const v=r.get("text-line-height")*wn,b=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",x=r.get("text-keep-upright"),k=r.get("text-size");for(const L of n.bucket.features){const A=r.get("text-font").evaluate(L,{},n.canonical).join(","),R=k.evaluate(L,{},n.canonical),V=p.layoutTextSize.evaluate(L,{},n.canonical),G=p.layoutIconSize.evaluate(L,{},n.canonical),X={horizontal:{},vertical:void 0},K=L.text;let ce,_e=[0,0];if(K){const Oe=K.toString(),Xe=r.get("text-letter-spacing").evaluate(L,{},n.canonical)*wn,rt=of(Oe)?Xe:0,wt=r.get("text-anchor").evaluate(L,{},n.canonical),Zt=cm(t,L,n.canonical);if(!Zt){const Mt=r.get("text-radial-offset").evaluate(L,{},n.canonical);_e=Mt?um(wt,[Mt*wn,qf]):r.get("text-offset").evaluate(L,{},n.canonical).map(Ct=>Ct*wn)}let bt=b?"center":r.get("text-justify").evaluate(L,{},n.canonical);const _t=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(L,{},n.canonical)*wn:1/0,Bt=()=>{n.bucket.allowVerticalPlacement&&mu(Oe)&&(X.vertical=rh(K,n.glyphMap,n.glyphPositions,n.imagePositions,A,_t,v,wt,"left",rt,_e,m.ah.vertical,!0,V,R))};if(!b&&Zt){const Mt=new Set;if(bt==="auto")for(let Je=0;Je<Zt.values.length;Je+=2)Mt.add(Zf(Zt.values[Je]));else Mt.add(bt);let Ct=!1;for(const Je of Mt)if(!X.horizontal[Je])if(Ct)X.horizontal[Je]=X.horizontal[0];else{const Ot=rh(K,n.glyphMap,n.glyphPositions,n.imagePositions,A,_t,v,"center",Je,rt,_e,m.ah.horizontal,!1,V,R);Ot&&(X.horizontal[Je]=Ot,Ct=Ot.positionedLines.length===1)}Bt()}else{bt==="auto"&&(bt=Zf(wt));const Mt=rh(K,n.glyphMap,n.glyphPositions,n.imagePositions,A,_t,v,wt,bt,rt,_e,m.ah.horizontal,!1,V,R);Mt&&(X.horizontal[bt]=Mt),Bt(),mu(Oe)&&b&&x&&(X.vertical=rh(K,n.glyphMap,n.glyphPositions,n.imagePositions,A,_t,v,wt,bt,rt,_e,m.ah.vertical,!1,V,R))}}let Ue=!1;if(L.icon&&L.icon.name){const Oe=n.imageMap[L.icon.name];Oe&&(ce=W0(n.imagePositions[L.icon.name],r.get("icon-offset").evaluate(L,{},n.canonical),r.get("icon-anchor").evaluate(L,{},n.canonical)),Ue=!!Oe.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Ue:n.bucket.sdfIcons!==Ue&&ee("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const Me=fm(X.horizontal)||X.vertical;n.bucket.iconsInText=!!Me&&Me.iconsInText,(Me||ce)&&l1(n.bucket,L,X,ce,n.imageMap,p,V,G,_e,Ue,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},m.bq=Ef,m.br=Tf,m.bs=If,m.bt=ko,m.bu=Lf,m.bv=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},m.bw=function(n,t,r,c,p){return u(this,void 0,void 0,function*(){if($())try{return yield qe(n,t,r,c,p)}catch{}return function(v,b,x,k,L){const A=v.width,R=v.height;nt&&lt||(nt=new OffscreenCanvas(A,R),lt=nt.getContext("2d",{willReadFrequently:!0})),nt.width=A,nt.height=R,lt.drawImage(v,0,0,A,R);const V=lt.getImageData(b,x,k,L);return lt.clearRect(0,0,A,R),V.data}(n,t,r,c,p)})},m.bx=Kp,m.by=w,m.bz=I,m.c=ut,m.d=n=>u(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=Ae,m.f=n=>new Promise((t,r)=>{const c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=fe})},c.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(n)],{type:"image/png"});c.src=n.byteLength?URL.createObjectURL(p):fe}),m.g=It,m.h=(n,t)=>Di(Ae(n,{type:"json"}),t),m.i=ne,m.j=yt,m.k=Ne,m.l=(n,t)=>Di(Ae(n,{type:"arrayBuffer"}),t),m.m=Di,m.n=function(n){return new Lf(n).readFields(N0,[])},m.o=ku,m.p=Ep,m.q=y,m.r=rf,m.s=Zi,m.t=fu,m.u=Fs,m.v=je,m.w=ee,m.x=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},m.y=Jn,m.z=Ki}),h("worker",["./shared"],function(m){class u{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,q){for(const le of j){this._layerConfigs[le.id]=le;const Ee=this._layers[le.id]=m.aA(le);Ee._featureFilter=m.a7(Ee.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of q)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const J=m.bk(Object.values(this._layerConfigs),this.keyCache);for(const le of J){const Ee=le.map(We=>this._layers[We.id]),Re=Ee[0];if(Re.visibility==="none")continue;const Ve=Re.source||"";let we=this.familiesBySource[Ve];we||(we=this.familiesBySource[Ve]={});const Ke=Re.sourceLayer||"_geojsonTileLayer";let Qe=we[Ke];Qe||(Qe=we[Ke]=[]),Qe.push(Ee)}}}class w{constructor(j){const q={},J=[];for(const Ve in j){const we=j[Ve],Ke=q[Ve]={};for(const Qe in we){const We=we[+Qe];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const dt={x:0,y:0,w:We.bitmap.width+2,h:We.bitmap.height+2};J.push(dt),Ke[Qe]={rect:dt,metrics:We.metrics}}}const{w:le,h:Ee}=m.p(J),Re=new m.o({width:le||1,height:Ee||1});for(const Ve in j){const we=j[Ve];for(const Ke in we){const Qe=we[+Ke];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const We=q[Ve][Ke].rect;m.o.copy(Qe.bitmap,Re,{x:0,y:0},{x:We.x+1,y:We.y+1},Qe.bitmap)}}this.image=Re,this.positions=q}}m.bl("GlyphAtlas",w);class I{constructor(j){this.tileID=new m.S(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,q,J,le){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new m.a5;const Ee=new m.bm(Object.keys(j.layers).sort()),Re=new m.bn(this.tileID,this.promoteId);Re.bucketLayerIDs=[];const Ve={},we={featureIndex:Re,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},Ke=q.familiesBySource[this.source];for(const Be in Ke){const Yt=j.layers[Be];if(!Yt)continue;Yt.version===1&&m.w(`Vector tile source "${this.source}" layer "${Be}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ri=Ee.encode(Be),Pi=[];for(let zi=0;zi<Yt.length;zi++){const Xi=Yt.feature(zi),qn=Re.getId(Xi,Be);Pi.push({feature:Xi,id:qn,index:zi,sourceLayerIndex:ri})}for(const zi of Ke[Be]){const Xi=zi[0];Xi.source!==this.source&&m.w(`layer.source = ${Xi.source} does not equal this.source = ${this.source}`),Xi.minzoom&&this.zoom<Math.floor(Xi.minzoom)||Xi.maxzoom&&this.zoom>=Xi.maxzoom||Xi.visibility!=="none"&&(E(zi,this.zoom,J),(Ve[Xi.id]=Xi.createBucket({index:Re.bucketLayerIDs.length,layers:zi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source})).populate(Pi,we,this.tileID.canonical),Re.bucketLayerIDs.push(zi.map(qn=>qn.id)))}}const Qe=m.aF(we.glyphDependencies,Be=>Object.keys(Be).map(Number));this.inFlightDependencies.forEach(Be=>Be==null?void 0:Be.abort()),this.inFlightDependencies=[];let We=Promise.resolve({});if(Object.keys(Qe).length){const Be=new AbortController;this.inFlightDependencies.push(Be),We=le.sendAsync({type:"GG",data:{stacks:Qe,source:this.source,tileID:this.tileID,type:"glyphs"}},Be)}const dt=Object.keys(we.iconDependencies);let Ft=Promise.resolve({});if(dt.length){const Be=new AbortController;this.inFlightDependencies.push(Be),Ft=le.sendAsync({type:"GI",data:{icons:dt,source:this.source,tileID:this.tileID,type:"icons"}},Be)}const jt=Object.keys(we.patternDependencies);let yi=Promise.resolve({});if(jt.length){const Be=new AbortController;this.inFlightDependencies.push(Be),yi=le.sendAsync({type:"GI",data:{icons:jt,source:this.source,tileID:this.tileID,type:"patterns"}},Be)}const[ni,vi,li]=yield Promise.all([We,Ft,yi]),fn=new w(ni),en=new m.bo(vi,li);for(const Be in Ve){const Yt=Ve[Be];Yt instanceof m.a6?(E(Yt.layers,this.zoom,J),m.bp({bucket:Yt,glyphMap:ni,glyphPositions:fn.positions,imageMap:vi,imagePositions:en.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Yt.hasPattern&&(Yt instanceof m.bq||Yt instanceof m.br||Yt instanceof m.bs)&&(E(Yt.layers,this.zoom,J),Yt.addFeatures(we,this.tileID.canonical,en.patternPositions))}return this.status="done",{buckets:Object.values(Ve).filter(Be=>!Be.isEmpty()),featureIndex:Re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fn.image,imageAtlas:en,glyphMap:this.returnDependencies?ni:null,iconMap:this.returnDependencies?vi:null,glyphPositions:this.returnDependencies?fn.positions:null}})}}function E(de,j,q){const J=new m.z(j);for(const le of de)le.recalculate(J,q)}class C{constructor(j,q,J){this.actor=j,this.layerIndex=q,this.availableImages=J,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,q){return m._(this,void 0,void 0,function*(){const J=yield m.l(j.request,q);try{return{vectorTile:new m.bt.VectorTile(new m.bu(J.data)),rawData:J.data,cacheControl:J.cacheControl,expires:J.expires}}catch(le){const Ee=new Uint8Array(J.data);let Re=`Unable to parse the tile at ${j.request.url}, `;throw Re+=Ee[0]===31&&Ee[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${le.message}`,new Error(Re)}})}loadTile(j){return m._(this,void 0,void 0,function*(){const q=j.uid,J=!!(j&&j.request&&j.request.collectResourceTiming)&&new m.bv(j.request),le=new I(j);this.loading[q]=le;const Ee=new AbortController;le.abort=Ee;try{const Re=yield this.loadVectorTile(j,Ee);if(delete this.loading[q],!Re)return null;const Ve=Re.rawData,we={};Re.expires&&(we.expires=Re.expires),Re.cacheControl&&(we.cacheControl=Re.cacheControl);const Ke={};if(J){const We=J.finish();We&&(Ke.resourceTiming=JSON.parse(JSON.stringify(We)))}le.vectorTile=Re.vectorTile;const Qe=le.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[q]=le,this.fetching[q]={rawTileData:Ve,cacheControl:we,resourceTiming:Ke};try{const We=yield Qe;return m.e({rawTileData:Ve.slice(0)},We,we,Ke)}finally{delete this.fetching[q]}}catch(Re){throw delete this.loading[q],le.status="done",this.loaded[q]=le,Re}})}reloadTile(j){return m._(this,void 0,void 0,function*(){const q=j.uid;if(!this.loaded||!this.loaded[q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const J=this.loaded[q];if(J.showCollisionBoxes=j.showCollisionBoxes,J.status==="parsing"){const le=yield J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ee;if(this.fetching[q]){const{rawTileData:Re,cacheControl:Ve,resourceTiming:we}=this.fetching[q];delete this.fetching[q],Ee=m.e({rawTileData:Re.slice(0)},le,Ve,we)}else Ee=le;return Ee}if(J.status==="done"&&J.vectorTile)return J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(j){return m._(this,void 0,void 0,function*(){const q=this.loading,J=j.uid;q&&q[J]&&q[J].abort&&(q[J].abort.abort(),delete q[J])})}removeTile(j){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]})}}class P{constructor(){this.loaded={}}loadTile(j){return m._(this,void 0,void 0,function*(){const{uid:q,encoding:J,rawImageData:le,redFactor:Ee,greenFactor:Re,blueFactor:Ve,baseShift:we}=j,Ke=le.width+2,Qe=le.height+2,We=m.b(le)?new m.R({width:Ke,height:Qe},yield m.bw(le,-1,-1,Ke,Qe)):le,dt=new m.bx(q,We,J,Ee,Re,Ve,we);return this.loaded=this.loaded||{},this.loaded[q]=dt,dt})}removeTile(j){const q=this.loaded,J=j.uid;q&&q[J]&&delete q[J]}}function H(de,j){if(de.length!==0){U(de[0],j);for(var q=1;q<de.length;q++)U(de[q],!j)}}function U(de,j){for(var q=0,J=0,le=0,Ee=de.length,Re=Ee-1;le<Ee;Re=le++){var Ve=(de[le][0]-de[Re][0])*(de[Re][1]+de[le][1]),we=q+Ve;J+=Math.abs(q)>=Math.abs(Ve)?q-we+Ve:Ve-we+q,q=we}q+J>=0!=!!j&&de.reverse()}var ie=m.by(function de(j,q){var J,le=j&&j.type;if(le==="FeatureCollection")for(J=0;J<j.features.length;J++)de(j.features[J],q);else if(le==="GeometryCollection")for(J=0;J<j.geometries.length;J++)de(j.geometries[J],q);else if(le==="Feature")de(j.geometry,q);else if(le==="Polygon")H(j.coordinates,q);else if(le==="MultiPolygon")for(J=0;J<j.coordinates.length;J++)H(j.coordinates[J],q);return j});const se=m.bt.VectorTileFeature.prototype.toGeoJSON;var ae={exports:{}},$=m.bz,Te=m.bt.VectorTileFeature,Pe=ve;function ve(de,j){this.options=j||{},this.features=de,this.length=de.length}function De(de,j){this.id=typeof de.id=="number"?de.id:void 0,this.type=de.type,this.rawGeometry=de.type===1?[de.geometry]:de.geometry,this.properties=de.tags,this.extent=j||4096}ve.prototype.feature=function(de){return new De(this.features[de],this.options.extent)},De.prototype.loadGeometry=function(){var de=this.rawGeometry;this.geometry=[];for(var j=0;j<de.length;j++){for(var q=de[j],J=[],le=0;le<q.length;le++)J.push(new $(q[le][0],q[le][1]));this.geometry.push(J)}return this.geometry},De.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var de=this.geometry,j=1/0,q=-1/0,J=1/0,le=-1/0,Ee=0;Ee<de.length;Ee++)for(var Re=de[Ee],Ve=0;Ve<Re.length;Ve++){var we=Re[Ve];j=Math.min(j,we.x),q=Math.max(q,we.x),J=Math.min(J,we.y),le=Math.max(le,we.y)}return[j,J,q,le]},De.prototype.toGeoJSON=Te.prototype.toGeoJSON;var Ae=m.bA,B=Pe;function Z(de){var j=new Ae;return function(q,J){for(var le in q.layers)J.writeMessage(3,Q,q.layers[le])}(de,j),j.finish()}function Q(de,j){var q;j.writeVarintField(15,de.version||1),j.writeStringField(1,de.name||""),j.writeVarintField(5,de.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<de.length;q++)J.feature=de.feature(q),j.writeMessage(2,D,J);var le=J.keys;for(q=0;q<le.length;q++)j.writeStringField(3,le[q]);var Ee=J.values;for(q=0;q<Ee.length;q++)j.writeMessage(4,pe,Ee[q])}function D(de,j){var q=de.feature;q.id!==void 0&&j.writeVarintField(1,q.id),j.writeMessage(2,N,de),j.writeVarintField(3,q.type),j.writeMessage(4,ne,q)}function N(de,j){var q=de.feature,J=de.keys,le=de.values,Ee=de.keycache,Re=de.valuecache;for(var Ve in q.properties){var we=q.properties[Ve],Ke=Ee[Ve];if(we!==null){Ke===void 0&&(J.push(Ve),Ee[Ve]=Ke=J.length-1),j.writeVarint(Ke);var Qe=typeof we;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(we=JSON.stringify(we));var We=Qe+":"+we,dt=Re[We];dt===void 0&&(le.push(we),Re[We]=dt=le.length-1),j.writeVarint(dt)}}}function ee(de,j){return(j<<3)+(7&de)}function me(de){return de<<1^de>>31}function ne(de,j){for(var q=de.loadGeometry(),J=de.type,le=0,Ee=0,Re=q.length,Ve=0;Ve<Re;Ve++){var we=q[Ve],Ke=1;J===1&&(Ke=we.length),j.writeVarint(ee(1,Ke));for(var Qe=J===3?we.length-1:we.length,We=0;We<Qe;We++){We===1&&J!==1&&j.writeVarint(ee(2,Qe-1));var dt=we[We].x-le,Ft=we[We].y-Ee;j.writeVarint(me(dt)),j.writeVarint(me(Ft)),le+=dt,Ee+=Ft}J===3&&j.writeVarint(ee(7,1))}}function pe(de,j){var q=typeof de;q==="string"?j.writeStringField(1,de):q==="boolean"?j.writeBooleanField(7,de):q==="number"&&(de%1!=0?j.writeDoubleField(3,de):de<0?j.writeSVarintField(6,de):j.writeVarintField(5,de))}ae.exports=Z,ae.exports.fromVectorTileJs=Z,ae.exports.fromGeojsonVt=function(de,j){j=j||{};var q={};for(var J in de)q[J]=new B(de[J].features,j),q[J].name=J,q[J].version=j.version,q[J].extent=j.extent;return Z({layers:q})},ae.exports.GeoJSONWrapper=B;var Ce=m.by(ae.exports);const fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:de=>de},qe=Math.fround||(nt=new Float32Array(1),de=>(nt[0]=+de,nt[0]));var nt;const lt=3,at=5,ut=6;class St{constructor(j){this.options=Object.assign(Object.create(fe),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:q,minZoom:J,maxZoom:le}=this.options;q&&console.time("total time");const Ee=`prepare ${j.length} points`;q&&console.time(Ee),this.points=j;const Re=[];for(let we=0;we<j.length;we++){const Ke=j[we];if(!Ke.geometry)continue;const[Qe,We]=Ke.geometry.coordinates,dt=qe(Lt(Qe)),Ft=qe(wi(We));Re.push(dt,Ft,1/0,we,-1,1),this.options.reduce&&Re.push(0)}let Ve=this.trees[le+1]=this._createTree(Re);q&&console.timeEnd(Ee);for(let we=le;we>=J;we--){const Ke=+Date.now();Ve=this.trees[we]=this._createTree(this._cluster(Ve,we)),q&&console.log("z%d: %d clusters in %dms",we,Ve.numItems,+Date.now()-Ke)}return q&&console.timeEnd("total time"),this}getClusters(j,q){let J=((j[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,j[1]));let Ee=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)J=-180,Ee=180;else if(J>Ee){const We=this.getClusters([J,le,180,Re],q),dt=this.getClusters([-180,le,Ee,Re],q);return We.concat(dt)}const Ve=this.trees[this._limitZoom(q)],we=Ve.range(Lt(J),wi(Re),Lt(Ee),wi(le)),Ke=Ve.data,Qe=[];for(const We of we){const dt=this.stride*We;Qe.push(Ke[dt+at]>1?It(Ke,dt,this.clusterProps):this.points[Ke[dt+lt]])}return Qe}getChildren(j){const q=this._getOriginId(j),J=this._getOriginZoom(j),le="No cluster with the specified id.",Ee=this.trees[J];if(!Ee)throw new Error(le);const Re=Ee.data;if(q*this.stride>=Re.length)throw new Error(le);const Ve=this.options.radius/(this.options.extent*Math.pow(2,J-1)),we=Ee.within(Re[q*this.stride],Re[q*this.stride+1],Ve),Ke=[];for(const Qe of we){const We=Qe*this.stride;Re[We+4]===j&&Ke.push(Re[We+at]>1?It(Re,We,this.clusterProps):this.points[Re[We+lt]])}if(Ke.length===0)throw new Error(le);return Ke}getLeaves(j,q,J){const le=[];return this._appendLeaves(le,j,q=q||10,J=J||0,0),le}getTile(j,q,J){const le=this.trees[this._limitZoom(j)],Ee=Math.pow(2,j),{extent:Re,radius:Ve}=this.options,we=Ve/Re,Ke=(J-we)/Ee,Qe=(J+1+we)/Ee,We={features:[]};return this._addTileFeatures(le.range((q-we)/Ee,Ke,(q+1+we)/Ee,Qe),le.data,q,J,Ee,We),q===0&&this._addTileFeatures(le.range(1-we/Ee,Ke,1,Qe),le.data,Ee,J,Ee,We),q===Ee-1&&this._addTileFeatures(le.range(0,Ke,we/Ee,Qe),le.data,-1,J,Ee,We),We.features.length?We:null}getClusterExpansionZoom(j){let q=this._getOriginZoom(j)-1;for(;q<=this.options.maxZoom;){const J=this.getChildren(j);if(q++,J.length!==1)break;j=J[0].properties.cluster_id}return q}_appendLeaves(j,q,J,le,Ee){const Re=this.getChildren(q);for(const Ve of Re){const we=Ve.properties;if(we&&we.cluster?Ee+we.point_count<=le?Ee+=we.point_count:Ee=this._appendLeaves(j,we.cluster_id,J,le,Ee):Ee<le?Ee++:j.push(Ve),j.length===J)break}return Ee}_createTree(j){const q=new m.av(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<j.length;J+=this.stride)q.add(j[J],j[J+1]);return q.finish(),q.data=j,q}_addTileFeatures(j,q,J,le,Ee,Re){for(const Ve of j){const we=Ve*this.stride,Ke=q[we+at]>1;let Qe,We,dt;if(Ke)Qe=st(q,we,this.clusterProps),We=q[we],dt=q[we+1];else{const yi=this.points[q[we+lt]];Qe=yi.properties;const[ni,vi]=yi.geometry.coordinates;We=Lt(ni),dt=wi(vi)}const Ft={type:1,geometry:[[Math.round(this.options.extent*(We*Ee-J)),Math.round(this.options.extent*(dt*Ee-le))]],tags:Qe};let jt;jt=Ke||this.options.generateId?q[we+lt]:this.points[q[we+lt]].id,jt!==void 0&&(Ft.id=jt),Re.features.push(Ft)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,q){const{radius:J,extent:le,reduce:Ee,minPoints:Re}=this.options,Ve=J/(le*Math.pow(2,q)),we=j.data,Ke=[],Qe=this.stride;for(let We=0;We<we.length;We+=Qe){if(we[We+2]<=q)continue;we[We+2]=q;const dt=we[We],Ft=we[We+1],jt=j.within(we[We],we[We+1],Ve),yi=we[We+at];let ni=yi;for(const vi of jt){const li=vi*Qe;we[li+2]>q&&(ni+=we[li+at])}if(ni>yi&&ni>=Re){let vi,li=dt*yi,fn=Ft*yi,en=-1;const Be=((We/Qe|0)<<5)+(q+1)+this.points.length;for(const Yt of jt){const ri=Yt*Qe;if(we[ri+2]<=q)continue;we[ri+2]=q;const Pi=we[ri+at];li+=we[ri]*Pi,fn+=we[ri+1]*Pi,we[ri+4]=Be,Ee&&(vi||(vi=this._map(we,We,!0),en=this.clusterProps.length,this.clusterProps.push(vi)),Ee(vi,this._map(we,ri)))}we[We+4]=Be,Ke.push(li/ni,fn/ni,1/0,Be,-1,ni),Ee&&Ke.push(en)}else{for(let vi=0;vi<Qe;vi++)Ke.push(we[We+vi]);if(ni>1)for(const vi of jt){const li=vi*Qe;if(!(we[li+2]<=q)){we[li+2]=q;for(let fn=0;fn<Qe;fn++)Ke.push(we[li+fn])}}}}return Ke}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,q,J){if(j[q+at]>1){const Re=this.clusterProps[j[q+ut]];return J?Object.assign({},Re):Re}const le=this.points[j[q+lt]].properties,Ee=this.options.map(le);return J&&Ee===le?Object.assign({},Ee):Ee}}function It(de,j,q){return{type:"Feature",id:de[j+lt],properties:st(de,j,q),geometry:{type:"Point",coordinates:[(J=de[j],360*(J-.5)),Di(de[j+1])]}};var J}function st(de,j,q){const J=de[j+at],le=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,Ee=de[j+ut],Re=Ee===-1?{}:Object.assign({},q[Ee]);return Object.assign(Re,{cluster:!0,cluster_id:de[j+lt],point_count:J,point_count_abbreviated:le})}function Lt(de){return de/360+.5}function wi(de){const j=Math.sin(de*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function Di(de){const j=(180-360*de)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function Zi(de,j,q,J){let le=J;const Ee=j+(q-j>>1);let Re,Ve=q-j;const we=de[j],Ke=de[j+1],Qe=de[q],We=de[q+1];for(let dt=j+3;dt<q;dt+=3){const Ft=_i(de[dt],de[dt+1],we,Ke,Qe,We);if(Ft>le)Re=dt,le=Ft;else if(Ft===le){const jt=Math.abs(dt-Ee);jt<Ve&&(Re=dt,Ve=jt)}}le>J&&(Re-j>3&&Zi(de,j,Re,J),de[Re+2]=le,q-Re>3&&Zi(de,Re,q,J))}function _i(de,j,q,J,le,Ee){let Re=le-q,Ve=Ee-J;if(Re!==0||Ve!==0){const we=((de-q)*Re+(j-J)*Ve)/(Re*Re+Ve*Ve);we>1?(q=le,J=Ee):we>0&&(q+=Re*we,J+=Ve*we)}return Re=de-q,Ve=j-J,Re*Re+Ve*Ve}function Si(de,j,q,J){const le={id:de??null,type:j,geometry:q,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Ne(le,q);else if(j==="Polygon")Ne(le,q[0]);else if(j==="MultiLineString")for(const Ee of q)Ne(le,Ee);else if(j==="MultiPolygon")for(const Ee of q)Ne(le,Ee[0]);return le}function Ne(de,j){for(let q=0;q<j.length;q+=3)de.minX=Math.min(de.minX,j[q]),de.minY=Math.min(de.minY,j[q+1]),de.maxX=Math.max(de.maxX,j[q]),de.maxY=Math.max(de.maxY,j[q+1])}function yt(de,j,q,J){if(!j.geometry)return;const le=j.geometry.coordinates;if(le&&le.length===0)return;const Ee=j.geometry.type,Re=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2);let Ve=[],we=j.id;if(q.promoteId?we=j.properties[q.promoteId]:q.generateId&&(we=J||0),Ee==="Point")Qt(le,Ve);else if(Ee==="MultiPoint")for(const Ke of le)Qt(Ke,Ve);else if(Ee==="LineString")je(le,Ve,Re,!1);else if(Ee==="MultiLineString"){if(q.lineMetrics){for(const Ke of le)Ve=[],je(Ke,Ve,Re,!1),de.push(Si(we,"LineString",Ve,j.properties));return}$e(le,Ve,Re,!1)}else if(Ee==="Polygon")$e(le,Ve,Re,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Ke of j.geometry.geometries)yt(de,{id:we,geometry:Ke,properties:j.properties},q,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ke of le){const Qe=[];$e(Ke,Qe,Re,!0),Ve.push(Qe)}}de.push(Si(we,Ee,Ve,j.properties))}function Qt(de,j){j.push(Ei(de[0]),Ge(de[1]),0)}function je(de,j,q,J){let le,Ee,Re=0;for(let we=0;we<de.length;we++){const Ke=Ei(de[we][0]),Qe=Ge(de[we][1]);j.push(Ke,Qe,0),we>0&&(Re+=J?(le*Qe-Ke*Ee)/2:Math.sqrt(Math.pow(Ke-le,2)+Math.pow(Qe-Ee,2))),le=Ke,Ee=Qe}const Ve=j.length-3;j[2]=1,Zi(j,0,Ve,q),j[Ve+2]=1,j.size=Math.abs(Re),j.start=0,j.end=j.size}function $e(de,j,q,J){for(let le=0;le<de.length;le++){const Ee=[];je(de[le],Ee,q,J),j.push(Ee)}}function Ei(de){return de/360+.5}function Ge(de){const j=Math.sin(de*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function Vt(de,j,q,J,le,Ee,Re,Ve){if(J/=j,Ee>=(q/=j)&&Re<J)return de;if(Re<q||Ee>=J)return null;const we=[];for(const Ke of de){const Qe=Ke.geometry;let We=Ke.type;const dt=le===0?Ke.minX:Ke.minY,Ft=le===0?Ke.maxX:Ke.maxY;if(dt>=q&&Ft<J){we.push(Ke);continue}if(Ft<q||dt>=J)continue;let jt=[];if(We==="Point"||We==="MultiPoint")Ri(Qe,jt,q,J,le);else if(We==="LineString")jn(Qe,jt,q,J,le,!1,Ve.lineMetrics);else if(We==="MultiLineString")si(Qe,jt,q,J,le,!1);else if(We==="Polygon")si(Qe,jt,q,J,le,!0);else if(We==="MultiPolygon")for(const yi of Qe){const ni=[];si(yi,ni,q,J,le,!0),ni.length&&jt.push(ni)}if(jt.length){if(Ve.lineMetrics&&We==="LineString"){for(const yi of jt)we.push(Si(Ke.id,We,yi,Ke.tags));continue}We!=="LineString"&&We!=="MultiLineString"||(jt.length===1?(We="LineString",jt=jt[0]):We="MultiLineString"),We!=="Point"&&We!=="MultiPoint"||(We=jt.length===3?"Point":"MultiPoint"),we.push(Si(Ke.id,We,jt,Ke.tags))}}return we.length?we:null}function Ri(de,j,q,J,le){for(let Ee=0;Ee<de.length;Ee+=3){const Re=de[Ee+le];Re>=q&&Re<=J&&Mi(j,de[Ee],de[Ee+1],de[Ee+2])}}function jn(de,j,q,J,le,Ee,Re){let Ve=Ir(de);const we=le===0?Ut:ps;let Ke,Qe,We=de.start;for(let ni=0;ni<de.length-3;ni+=3){const vi=de[ni],li=de[ni+1],fn=de[ni+2],en=de[ni+3],Be=de[ni+4],Yt=le===0?vi:li,ri=le===0?en:Be;let Pi=!1;Re&&(Ke=Math.sqrt(Math.pow(vi-en,2)+Math.pow(li-Be,2))),Yt<q?ri>q&&(Qe=we(Ve,vi,li,en,Be,q),Re&&(Ve.start=We+Ke*Qe)):Yt>J?ri<J&&(Qe=we(Ve,vi,li,en,Be,J),Re&&(Ve.start=We+Ke*Qe)):Mi(Ve,vi,li,fn),ri<q&&Yt>=q&&(Qe=we(Ve,vi,li,en,Be,q),Pi=!0),ri>J&&Yt<=J&&(Qe=we(Ve,vi,li,en,Be,J),Pi=!0),!Ee&&Pi&&(Re&&(Ve.end=We+Ke*Qe),j.push(Ve),Ve=Ir(de)),Re&&(We+=Ke)}let dt=de.length-3;const Ft=de[dt],jt=de[dt+1],yi=le===0?Ft:jt;yi>=q&&yi<=J&&Mi(Ve,Ft,jt,de[dt+2]),dt=Ve.length-3,Ee&&dt>=3&&(Ve[dt]!==Ve[0]||Ve[dt+1]!==Ve[1])&&Mi(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&j.push(Ve)}function Ir(de){const j=[];return j.size=de.size,j.start=de.start,j.end=de.end,j}function si(de,j,q,J,le,Ee){for(const Re of de)jn(Re,j,q,J,le,Ee,!1)}function Mi(de,j,q,J){de.push(j,q,J)}function Ut(de,j,q,J,le,Ee){const Re=(Ee-j)/(J-j);return Mi(de,Ee,q+(le-q)*Re,1),Re}function ps(de,j,q,J,le,Ee){const Re=(Ee-q)/(le-q);return Mi(de,j+(J-j)*Re,Ee,1),Re}function ot(de,j){const q=[];for(let J=0;J<de.length;J++){const le=de[J],Ee=le.type;let Re;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")Re=fi(le.geometry,j);else if(Ee==="MultiLineString"||Ee==="Polygon"){Re=[];for(const Ve of le.geometry)Re.push(fi(Ve,j))}else if(Ee==="MultiPolygon"){Re=[];for(const Ve of le.geometry){const we=[];for(const Ke of Ve)we.push(fi(Ke,j));Re.push(we)}}q.push(Si(le.id,Ee,Re,le.tags))}return q}function fi(de,j){const q=[];q.size=de.size,de.start!==void 0&&(q.start=de.start,q.end=de.end);for(let J=0;J<de.length;J+=3)q.push(de[J]+j,de[J+1],de[J+2]);return q}function Hi(de,j){if(de.transformed)return de;const q=1<<de.z,J=de.x,le=de.y;for(const Ee of de.features){const Re=Ee.geometry,Ve=Ee.type;if(Ee.geometry=[],Ve===1)for(let we=0;we<Re.length;we+=2)Ee.geometry.push(Un(Re[we],Re[we+1],j,q,J,le));else for(let we=0;we<Re.length;we++){const Ke=[];for(let Qe=0;Qe<Re[we].length;Qe+=2)Ke.push(Un(Re[we][Qe],Re[we][Qe+1],j,q,J,le));Ee.geometry.push(Ke)}}return de.transformed=!0,de}function Un(de,j,q,J,le,Ee){return[Math.round(q*(de*J-le)),Math.round(q*(j*J-Ee))]}function Pn(de,j,q,J,le){const Ee=j===le.maxZoom?0:le.tolerance/((1<<j)*le.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:de.length,source:null,x:q,y:J,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ve of de)ht(Re,Ve,Ee,le);return Re}function ht(de,j,q,J){const le=j.geometry,Ee=j.type,Re=[];if(de.minX=Math.min(de.minX,j.minX),de.minY=Math.min(de.minY,j.minY),de.maxX=Math.max(de.maxX,j.maxX),de.maxY=Math.max(de.maxY,j.maxY),Ee==="Point"||Ee==="MultiPoint")for(let Ve=0;Ve<le.length;Ve+=3)Re.push(le[Ve],le[Ve+1]),de.numPoints++,de.numSimplified++;else if(Ee==="LineString")ii(Re,le,de,q,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let Ve=0;Ve<le.length;Ve++)ii(Re,le[Ve],de,q,Ee==="Polygon",Ve===0);else if(Ee==="MultiPolygon")for(let Ve=0;Ve<le.length;Ve++){const we=le[Ve];for(let Ke=0;Ke<we.length;Ke++)ii(Re,we[Ke],de,q,!0,Ke===0)}if(Re.length){let Ve=j.tags||null;if(Ee==="LineString"&&J.lineMetrics){Ve={};for(const Ke in j.tags)Ve[Ke]=j.tags[Ke];Ve.mapbox_clip_start=le.start/le.size,Ve.mapbox_clip_end=le.end/le.size}const we={geometry:Re,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:Ve};j.id!==null&&(we.id=j.id),de.features.push(we)}}function ii(de,j,q,J,le,Ee){const Re=J*J;if(J>0&&j.size<(le?Re:J))return void(q.numPoints+=j.length/3);const Ve=[];for(let we=0;we<j.length;we+=3)(J===0||j[we+2]>Re)&&(q.numSimplified++,Ve.push(j[we],j[we+1])),q.numPoints++;le&&function(we,Ke){let Qe=0;for(let We=0,dt=we.length,Ft=dt-2;We<dt;Ft=We,We+=2)Qe+=(we[We]-we[Ft])*(we[We+1]+we[Ft+1]);if(Qe>0===Ke)for(let We=0,dt=we.length;We<dt/2;We+=2){const Ft=we[We],jt=we[We+1];we[We]=we[dt-2-We],we[We+1]=we[dt-1-We],we[dt-2-We]=Ft,we[dt-1-We]=jt}}(Ve,Ee),de.push(Ve)}const Ht={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class tn{constructor(j,q){const J=(q=this.options=function(Ee,Re){for(const Ve in Re)Ee[Ve]=Re[Ve];return Ee}(Object.create(Ht),q)).debug;if(J&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");let le=function(Ee,Re){const Ve=[];if(Ee.type==="FeatureCollection")for(let we=0;we<Ee.features.length;we++)yt(Ve,Ee.features[we],Re,we);else yt(Ve,Ee.type==="Feature"?Ee:{geometry:Ee},Re);return Ve}(j,q);this.tiles={},this.tileCoords=[],J&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),le=function(Ee,Re){const Ve=Re.buffer/Re.extent;let we=Ee;const Ke=Vt(Ee,1,-1-Ve,Ve,0,-1,2,Re),Qe=Vt(Ee,1,1-Ve,2+Ve,0,-1,2,Re);return(Ke||Qe)&&(we=Vt(Ee,1,-Ve,1+Ve,0,-1,2,Re)||[],Ke&&(we=ot(Ke,1).concat(we)),Qe&&(we=we.concat(ot(Qe,-1)))),we}(le,q),le.length&&this.splitTile(le,0,0,0),J&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,q,J,le,Ee,Re,Ve){const we=[j,q,J,le],Ke=this.options,Qe=Ke.debug;for(;we.length;){le=we.pop(),J=we.pop(),q=we.pop(),j=we.pop();const We=1<<q,dt=or(q,J,le);let Ft=this.tiles[dt];if(!Ft&&(Qe>1&&console.time("creation"),Ft=this.tiles[dt]=Pn(j,q,J,le,Ke),this.tileCoords.push({z:q,x:J,y:le}),Qe)){Qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,J,le,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));const Pi=`z${q}`;this.stats[Pi]=(this.stats[Pi]||0)+1,this.total++}if(Ft.source=j,Ee==null){if(q===Ke.indexMaxZoom||Ft.numPoints<=Ke.indexMaxPoints)continue}else{if(q===Ke.maxZoom||q===Ee)continue;if(Ee!=null){const Pi=Ee-q;if(J!==Re>>Pi||le!==Ve>>Pi)continue}}if(Ft.source=null,j.length===0)continue;Qe>1&&console.time("clipping");const jt=.5*Ke.buffer/Ke.extent,yi=.5-jt,ni=.5+jt,vi=1+jt;let li=null,fn=null,en=null,Be=null,Yt=Vt(j,We,J-jt,J+ni,0,Ft.minX,Ft.maxX,Ke),ri=Vt(j,We,J+yi,J+vi,0,Ft.minX,Ft.maxX,Ke);j=null,Yt&&(li=Vt(Yt,We,le-jt,le+ni,1,Ft.minY,Ft.maxY,Ke),fn=Vt(Yt,We,le+yi,le+vi,1,Ft.minY,Ft.maxY,Ke),Yt=null),ri&&(en=Vt(ri,We,le-jt,le+ni,1,Ft.minY,Ft.maxY,Ke),Be=Vt(ri,We,le+yi,le+vi,1,Ft.minY,Ft.maxY,Ke),ri=null),Qe>1&&console.timeEnd("clipping"),we.push(li||[],q+1,2*J,2*le),we.push(fn||[],q+1,2*J,2*le+1),we.push(en||[],q+1,2*J+1,2*le),we.push(Be||[],q+1,2*J+1,2*le+1)}}getTile(j,q,J){j=+j,q=+q,J=+J;const le=this.options,{extent:Ee,debug:Re}=le;if(j<0||j>24)return null;const Ve=1<<j,we=or(j,q=q+Ve&Ve-1,J);if(this.tiles[we])return Hi(this.tiles[we],Ee);Re>1&&console.log("drilling down to z%d-%d-%d",j,q,J);let Ke,Qe=j,We=q,dt=J;for(;!Ke&&Qe>0;)Qe--,We>>=1,dt>>=1,Ke=this.tiles[or(Qe,We,dt)];return Ke&&Ke.source?(Re>1&&(console.log("found parent tile z%d-%d-%d",Qe,We,dt),console.time("drilling down")),this.splitTile(Ke.source,Qe,We,dt,j,q,J),Re>1&&console.timeEnd("drilling down"),this.tiles[we]?Hi(this.tiles[we],Ee):null):null}}function or(de,j,q){return 32*((1<<de)*q+j)+de}function Xt(de,j){return j?de.properties[j]:de.id}function ar(de,j){if(de==null)return!0;if(de.type==="Feature")return Xt(de,j)!=null;if(de.type==="FeatureCollection"){const q=new Set;for(const J of de.features){const le=Xt(J,j);if(le==null||q.has(le))return!1;q.add(le)}return!0}return!1}function lr(de,j){const q=new Map;if(de!=null)if(de.type==="Feature")q.set(Xt(de,j),de);else for(const J of de.features)q.set(Xt(J,j),J);return q}class gr extends C{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,q){return m._(this,void 0,void 0,function*(){const J=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const le=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!le)return null;const Ee=new class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.X,this.length=Ve.length,this._features=Ve}feature(Ve){return new class{constructor(we){this._feature=we,this.extent=m.X,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const Ke of this._feature.geometry)we.push([new m.P(Ke[0],Ke[1])]);return we}{const we=[];for(const Ke of this._feature.geometry){const Qe=[];for(const We of Ke)Qe.push(new m.P(We[0],We[1]));we.push(Qe)}return we}}toGeoJSON(we,Ke,Qe){return se.call(this,we,Ke,Qe)}}(this._features[Ve])}}(le.features);let Re=Ce(Ee);return Re.byteOffset===0&&Re.byteLength===Re.buffer.byteLength||(Re=new Uint8Array(Re)),{vectorTile:Ee,rawData:Re.buffer}})}loadData(j){return m._(this,void 0,void 0,function*(){var q;(q=this._pendingRequest)===null||q===void 0||q.abort();const J=!!(j&&j.request&&j.request.collectResourceTiming)&&new m.bv(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new St(function({superclusterOptions:Re,clusterProperties:Ve}){if(!Ve||!Re)return Re;const we={},Ke={},Qe={accumulated:null,zoom:0},We={properties:null},dt=Object.keys(Ve);for(const Ft of dt){const[jt,yi]=Ve[Ft],ni=m.bC(yi),vi=m.bC(typeof jt=="string"?[jt,["accumulated"],["get",Ft]]:jt);we[Ft]=ni.value,Ke[Ft]=vi.value}return Re.map=Ft=>{We.properties=Ft;const jt={};for(const yi of dt)jt[yi]=we[yi].evaluate(Qe,We);return jt},Re.reduce=(Ft,jt)=>{We.properties=jt;for(const yi of dt)Qe.accumulated=Ft[yi],Ft[yi]=Ke[yi].evaluate(Qe,We)},Re}(j)).load((yield this._pendingData).features):(le=yield this._pendingData,new tn(le,j.geojsonVtOptions)),this.loaded={};const Ee={};if(J){const Re=J.finish();Re&&(Ee.resourceTiming={},Ee.resourceTiming[j.source]=JSON.parse(JSON.stringify(Re)))}return Ee}catch(Ee){if(delete this._pendingRequest,m.bB(Ee))return{abandoned:!0};throw Ee}var le})}getData(){return m._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(j){const q=this.loaded;return q&&q[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,q){return m._(this,void 0,void 0,function*(){let J=yield this.loadGeoJSON(j,q);if(delete this._pendingRequest,typeof J!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(ie(J,!0),j.filter){const le=m.bC(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(Re=>`${Re.key}: ${Re.message}`).join(", "));J={type:"FeatureCollection",features:J.features.filter(Re=>le.value.evaluate({zoom:0},Re))}}return J})}loadGeoJSON(j,q){return m._(this,void 0,void 0,function*(){const{promoteId:J}=j;if(j.request){const le=yield m.h(j.request,q);return this._dataUpdateable=ar(le.data,J)?lr(le.data,J):void 0,le.data}if(typeof j.data=="string")try{const le=JSON.parse(j.data);return this._dataUpdateable=ar(le,J)?lr(le,J):void 0,le}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return function(le,Ee,Re){var Ve,we,Ke,Qe;if(Ee.removeAll&&le.clear(),Ee.remove)for(const We of Ee.remove)le.delete(We);if(Ee.add)for(const We of Ee.add){const dt=Xt(We,Re);dt!=null&&le.set(dt,We)}if(Ee.update)for(const We of Ee.update){let dt=le.get(We.id);if(dt==null)continue;const Ft=!We.removeAllProperties&&(((Ve=We.removeProperties)===null||Ve===void 0?void 0:Ve.length)>0||((we=We.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0);if((We.newGeometry||We.removeAllProperties||Ft)&&(dt=Object.assign({},dt),le.set(We.id,dt),Ft&&(dt.properties=Object.assign({},dt.properties))),We.newGeometry&&(dt.geometry=We.newGeometry),We.removeAllProperties)dt.properties={};else if(((Ke=We.removeProperties)===null||Ke===void 0?void 0:Ke.length)>0)for(const jt of We.removeProperties)Object.prototype.hasOwnProperty.call(dt.properties,jt)&&delete dt.properties[jt];if(((Qe=We.addOrUpdateProperties)===null||Qe===void 0?void 0:Qe.length)>0)for(const{key:jt,value:yi}of We.addOrUpdateProperties)dt.properties[jt]=yi}}(this._dataUpdateable,j.dataDiff,J),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(j){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class _r{constructor(j){this.self=j,this.actor=new m.F(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(q,J)=>{if(this.externalWorkerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.externalWorkerSourceTypes[q]=J},this.self.addProtocol=m.bi,this.self.removeProtocol=m.bj,this.self.registerRTLTextPlugin=q=>{if(m.bD.isParsed())throw new Error("RTL text plugin already registered.");m.bD.setMethods(q)},this.actor.registerMessageHandler("LDT",(q,J)=>this._getDEMWorkerSource(q,J.source).loadTile(J)),this.actor.registerMessageHandler("RDT",(q,J)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(q,J.source).removeTile(J)})),this.actor.registerMessageHandler("GCEZ",(q,J)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(q,J.type,J.source).getClusterExpansionZoom(J)})),this.actor.registerMessageHandler("GCC",(q,J)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(q,J.type,J.source).getClusterChildren(J)})),this.actor.registerMessageHandler("GCL",(q,J)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(q,J.type,J.source).getClusterLeaves(J)})),this.actor.registerMessageHandler("LD",(q,J)=>this._getWorkerSource(q,J.type,J.source).loadData(J)),this.actor.registerMessageHandler("GD",(q,J)=>this._getWorkerSource(q,J.type,J.source).getData()),this.actor.registerMessageHandler("LT",(q,J)=>this._getWorkerSource(q,J.type,J.source).loadTile(J)),this.actor.registerMessageHandler("RT",(q,J)=>this._getWorkerSource(q,J.type,J.source).reloadTile(J)),this.actor.registerMessageHandler("AT",(q,J)=>this._getWorkerSource(q,J.type,J.source).abortTile(J)),this.actor.registerMessageHandler("RMT",(q,J)=>this._getWorkerSource(q,J.type,J.source).removeTile(J)),this.actor.registerMessageHandler("RS",(q,J)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[q]||!this.workerSources[q][J.type]||!this.workerSources[q][J.type][J.source])return;const le=this.workerSources[q][J.type][J.source];delete this.workerSources[q][J.type][J.source],le.removeSource!==void 0&&le.removeSource(J)})),this.actor.registerMessageHandler("RM",q=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q]})),this.actor.registerMessageHandler("SR",(q,J)=>m._(this,void 0,void 0,function*(){this.referrer=J})),this.actor.registerMessageHandler("SRPS",(q,J)=>this._syncRTLPluginState(q,J)),this.actor.registerMessageHandler("IS",(q,J)=>m._(this,void 0,void 0,function*(){this.self.importScripts(J)})),this.actor.registerMessageHandler("SI",(q,J)=>this._setImages(q,J)),this.actor.registerMessageHandler("UL",(q,J)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(q).update(J.layers,J.removedIds)})),this.actor.registerMessageHandler("SL",(q,J)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(q).replace(J)}))}_setImages(j,q){return m._(this,void 0,void 0,function*(){this.availableImages[j]=q;for(const J in this.workerSources[j]){const le=this.workerSources[j][J];for(const Ee in le)le[Ee].availableImages=q}})}_syncRTLPluginState(j,q){return m._(this,void 0,void 0,function*(){if(m.bD.isParsed())return m.bD.getState();if(q.pluginStatus!=="loading")return m.bD.setState(q),q;const J=q.pluginURL;if(this.self.importScripts(J),m.bD.isParsed()){const le={pluginStatus:"loaded",pluginURL:J};return m.bD.setState(le),le}throw m.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${J}`)})}_getAvailableImages(j){let q=this.availableImages[j];return q||(q=[]),q}_getLayerIndex(j){let q=this.layerIndexes[j];return q||(q=this.layerIndexes[j]=new u),q}_getWorkerSource(j,q,J){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][q]||(this.workerSources[j][q]={}),!this.workerSources[j][q][J]){const le={sendAsync:(Ee,Re)=>(Ee.targetMapId=j,this.actor.sendAsync(Ee,Re))};switch(q){case"vector":this.workerSources[j][q][J]=new C(le,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][q][J]=new gr(le,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][q][J]=new this.externalWorkerSourceTypes[q](le,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][q][J]}_getDEMWorkerSource(j,q){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][q]||(this.demWorkerSources[j][q]=new P),this.demWorkerSources[j][q]}}return m.i(self)&&(self.worker=new _r(self)),_r}),h("index",["exports","./shared"],function(m,u){var w="4.7.1";let I,E;const C={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((e,l)=>{const f=requestAnimationFrame(e);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(f),l(u.c())})}),getImageData(y,e=0){return this.getImageCanvasContext(y).getImageData(-e,-e,y.width+2*e,y.height+2*e)},getImageCanvasContext(y){const e=window.document.createElement("canvas"),l=e.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return e.width=y.width,e.height=y.height,l.drawImage(y,0,0,y.width,y.height),l},resolveURL:y=>(I||(I=document.createElement("a")),I.href=y,I.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(E==null&&(E=matchMedia("(prefers-reduced-motion: reduce)")),E.matches)}};class P{static testProp(e){if(!P.docStyle)return e[0];for(let l=0;l<e.length;l++)if(e[l]in P.docStyle)return e[l];return e[0]}static create(e,l,f){const d=window.document.createElement(e);return l!==void 0&&(d.className=l),f&&f.appendChild(d),d}static createNS(e,l){return window.document.createElementNS(e,l)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(e,l){e.style[P.transformProp]=l}static addEventListener(e,l,f,d={}){e.addEventListener(l,f,"passive"in d?d:d.capture)}static removeEventListener(e,l,f,d={}){e.removeEventListener(l,f,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static getScale(e){const l=e.getBoundingClientRect();return{x:l.width/e.offsetWidth||1,y:l.height/e.offsetHeight||1,boundingClientRect:l}}static getPoint(e,l,f){const d=l.boundingClientRect;return new u.P((f.clientX-d.left)/l.x-e.clientLeft,(f.clientY-d.top)/l.y-e.clientTop)}static mousePos(e,l){const f=P.getScale(e);return P.getPoint(e,f,l)}static touchPos(e,l){const f=[],d=P.getScale(e);for(let _=0;_<l.length;_++)f.push(P.getPoint(e,d,l[_]));return f}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);const H={supported:!1,testSupport:function(y){!se&&ie&&(ae?$(y):U=y)}};let U,ie,se=!1,ae=!1;function $(y){const e=y.createTexture();y.bindTexture(y.TEXTURE_2D,e);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,ie),y.isContextLost())return;H.supported=!0}catch{}y.deleteTexture(e),se=!0}var Te;typeof document<"u"&&(ie=document.createElement("img"),ie.onload=()=>{U&&$(U),U=null,ae=!0},ie.onerror=()=>{se=!0,U=null},ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let e,l,f,d;y.resetRequestQueue=()=>{e=[],l=0,f=0,d={}},y.addThrottleControl=M=>{const z=f++;return d[z]=M,z},y.removeThrottleControl=M=>{delete d[M],S()},y.getImage=(M,z,F=!0)=>new Promise((O,W)=>{H.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),u.e(M,{type:"image"}),e.push({abortController:z,requestParameters:M,supportImageRefresh:F,state:"queued",onError:Y=>{W(Y)},onSuccess:Y=>{O(Y)}}),S()});const _=M=>u._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:z,supportImageRefresh:F,onError:O,onSuccess:W,abortController:Y}=M,re=F===!1&&!u.i(self)&&!u.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce((xe,Ie)=>xe&&Ie==="accept",!0));l++;const he=re?T(z,Y):u.m(z,Y);try{const xe=yield he;delete M.abortController,M.state="completed",xe.data instanceof HTMLImageElement||u.b(xe.data)?W(xe):xe.data&&W({data:yield(ye=xe.data,typeof createImageBitmap=="function"?u.d(ye):u.f(ye)),cacheControl:xe.cacheControl,expires:xe.expires})}catch(xe){delete M.abortController,O(xe)}finally{l--,S()}var ye}),S=()=>{const M=(()=>{for(const z of Object.keys(d))if(d[z]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=l;z<M&&e.length>0;z++){const F=e.shift();F.abortController.signal.aborted?z--:_(F)}},T=(M,z)=>new Promise((F,O)=>{const W=new Image,Y=M.url,re=M.credentials;re&&re==="include"?W.crossOrigin="use-credentials":(re&&re==="same-origin"||!u.s(Y))&&(W.crossOrigin="anonymous"),z.signal.addEventListener("abort",()=>{W.src="",O(u.c())}),W.fetchPriority="high",W.onload=()=>{W.onerror=W.onload=null,F({data:W})},W.onerror=()=>{W.onerror=W.onload=null,z.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},W.src=Y})}(Te||(Te={})),Te.resetRequestQueue();class Pe{constructor(e){this._transformRequestFn=e}transformRequest(e,l){return this._transformRequestFn&&this._transformRequestFn(e,l)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ve(y){var e=new u.A(3);return e[0]=y[0],e[1]=y[1],e[2]=y[2],e}var De,Ae=function(y,e,l){return y[0]=e[0]-l[0],y[1]=e[1]-l[1],y[2]=e[2]-l[2],y};De=new u.A(3),u.A!=Float32Array&&(De[0]=0,De[1]=0,De[2]=0);var B=function(y){var e=y[0],l=y[1];return e*e+l*l};function Z(y){const e=[];if(typeof y=="string")e.push({id:"default",url:y});else if(y&&y.length>0){const l=[];for(const{id:f,url:d}of y){const _=`${f}${d}`;l.indexOf(_)===-1&&(l.push(_),e.push({id:f,url:d}))}}return e}function Q(y,e,l){const f=y.split("?");return f[0]+=`${e}${l}`,f.join("?")}(function(){var y=new u.A(2);u.A!=Float32Array&&(y[0]=0,y[1]=0)})();class D{constructor(e,l,f,d){this.context=e,this.format=f,this.texture=e.gl.createTexture(),this.update(l,d)}update(e,l,f){const{width:d,height:_}=e,S=!(this.size&&this.size[0]===d&&this.size[1]===_||f),{context:T}=this,{gl:M}=T;if(this.useMipmap=!!(l&&l.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!l||l.premultiply!==!1)),S)this.size=[d,_],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,d,_,0,this.format,M.UNSIGNED_BYTE,e.data);else{const{x:z,y:F}=f||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?M.texSubImage2D(M.TEXTURE_2D,0,z,F,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,z,F,d,_,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(e,l,f){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),f!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=_.LINEAR),e!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,e),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,f||e),this.filter=e),l!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function N(y){const{userImage:e}=y;return!!(e&&e.render&&e.render())&&(y.data.replace(new Uint8Array(e.data.buffer)),!0)}class ee extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:l,promiseResolve:f}of this.requestors)f(this._getImagesForIds(l));this.requestors=[]}}getImage(e){const l=this.images[e];if(l&&!l.data&&l.spriteData){const f=l.spriteData;l.data=new u.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),l.spriteData=null}return l}addImage(e,l){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,l)&&(this.images[e]=l)}_validate(e,l){let f=!0;const d=l.data||l.spriteData;return this._validateStretch(l.stretchX,d&&d.width)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,d&&d.height)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "content" value`))),f=!1),f}_validateStretch(e,l){if(!e)return!0;let f=0;for(const d of e){if(d[0]<f||d[1]<d[0]||l<d[1])return!1;f=d[1]}return!0}_validateContent(e,l){if(!e)return!0;if(e.length!==4)return!1;const f=l.spriteData,d=f&&f.width||l.data.width,_=f&&f.height||l.data.height;return!(e[0]<0||d<e[0]||e[1]<0||_<e[1]||e[2]<0||d<e[2]||e[3]<0||_<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,l,f=!0){const d=this.getImage(e);if(f&&(d.data.width!==l.data.width||d.data.height!==l.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=d.version+1,this.images[e]=l,this.updatedImages[e]=!0}removeImage(e){const l=this.images[e];delete this.images[e],delete this.patterns[e],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((l,f)=>{let d=!0;if(!this.isLoaded())for(const _ of e)this.images[_]||(d=!1);this.isLoaded()||d?l(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:l})})}_getImagesForIds(e){const l={};for(const f of e){let d=this.getImage(f);d||(this.fire(new u.k("styleimagemissing",{id:f})),d=this.getImage(f)),d?l[f]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:u.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return l}getPixelSize(){const{width:e,height:l}=this.atlasImage;return{width:e,height:l}}getPattern(e){const l=this.patterns[e],f=this.getImage(e);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const d={w:f.data.width+2,h:f.data.height+2,x:0,y:0},_=new u.I(d,f);this.patterns[e]={bin:d,position:_}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const l=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new D(e,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const _ in this.patterns)e.push(this.patterns[_].bin);const{w:l,h:f}=u.p(e),d=this.atlasImage;d.resize({width:l||1,height:f||1});for(const _ in this.patterns){const{bin:S}=this.patterns[_],T=S.x+1,M=S.y+1,z=this.getImage(_).data,F=z.width,O=z.height;u.R.copy(z,d,{x:0,y:0},{x:T,y:M},{width:F,height:O}),u.R.copy(z,d,{x:0,y:O-1},{x:T,y:M-1},{width:F,height:1}),u.R.copy(z,d,{x:0,y:0},{x:T,y:M+O},{width:F,height:1}),u.R.copy(z,d,{x:F-1,y:0},{x:T-1,y:M},{width:1,height:O}),u.R.copy(z,d,{x:0,y:0},{x:T+F,y:M},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const l of e){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.getImage(l);f||u.w(`Image with ID: "${l}" was not found`),N(f)&&this.updateImage(l,f)}}}const me=1e20;function ne(y,e,l,f,d,_,S,T,M){for(let z=e;z<e+f;z++)pe(y,l*_+z,_,d,S,T,M);for(let z=l;z<l+d;z++)pe(y,z*_+e,1,f,S,T,M)}function pe(y,e,l,f,d,_,S){_[0]=0,S[0]=-me,S[1]=me,d[0]=y[e];for(let T=1,M=0,z=0;T<f;T++){d[T]=y[e+T*l];const F=T*T;do{const O=_[M];z=(d[T]-d[O]+F-O*O)/(T-O)/2}while(z<=S[M]&&--M>-1);M++,_[M]=T,S[M]=z,S[M+1]=me}for(let T=0,M=0;T<f;T++){for(;S[M+1]<T;)M++;const z=_[M],F=T-z;y[e+T*l]=d[z]+F*F}}class Ce{constructor(e,l){this.requestManager=e,this.localIdeographFontFamily=l,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return u._(this,void 0,void 0,function*(){const l=[];for(const _ in e)for(const S of e[_])l.push(this._getAndCacheGlyphsPromise(_,S));const f=yield Promise.all(l),d={};for(const{stack:_,id:S,glyph:T}of f)d[_]||(d[_]={}),d[_][S]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return d})}_getAndCacheGlyphsPromise(e,l){return u._(this,void 0,void 0,function*(){let f=this.entries[e];f||(f=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=f.glyphs[l];if(d!==void 0)return{stack:e,id:l,glyph:d};if(d=this._tinySDF(f,e,l),d)return f.glyphs[l]=d,{stack:e,id:l,glyph:d};const _=Math.floor(l/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(f.ranges[_])return{stack:e,id:l,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!f.requests[_]){const T=Ce.loadGlyphRange(e,_,this.url,this.requestManager);f.requests[_]=T}const S=yield f.requests[_];for(const T in S)this._doesCharSupportLocalGlyph(+T)||(f.glyphs[+T]=S[+T]);return f.ranges[_]=!0,{stack:e,id:l,glyph:S[l]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,l,f){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(f))return;let _=e.tinySDF;if(!_){let T="400";/bold/i.test(l)?T="900":/medium/i.test(l)?T="500":/light/i.test(l)&&(T="200"),_=e.tinySDF=new Ce.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:T})}const S=_.draw(String.fromCharCode(f));return{id:f,bitmap:new u.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ce.loadGlyphRange=function(y,e,l,f){return u._(this,void 0,void 0,function*(){const d=256*e,_=d+255,S=f.transformRequest(l.replace("{fontstack}",y).replace("{range}",`${d}-${_}`),"Glyphs"),T=yield u.l(S,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${_}`);const M={};for(const z of u.n(T.data))M[z.id]=z;return M})},Ce.TinySDF=class{constructor({fontSize:y=24,buffer:e=3,radius:l=8,cutoff:f=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:S="normal"}={}){this.buffer=e,this.cutoff=f,this.radius=l;const T=this.size=y+4*e,M=this._createCanvas(T),z=this.ctx=M.getContext("2d",{willReadFrequently:!0});z.font=`${S} ${_} ${y}px ${d}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(y){const e=document.createElement("canvas");return e.width=e.height=y,e}draw(y){const{width:e,actualBoundingBoxAscent:l,actualBoundingBoxDescent:f,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(y),S=Math.ceil(l),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),M=Math.min(this.size-this.buffer,S+Math.ceil(f)),z=T+2*this.buffer,F=M+2*this.buffer,O=Math.max(z*F,0),W=new Uint8ClampedArray(O),Y={data:W,width:z,height:F,glyphWidth:T,glyphHeight:M,glyphTop:S,glyphLeft:0,glyphAdvance:e};if(T===0||M===0)return Y;const{ctx:re,buffer:he,gridInner:ye,gridOuter:xe}=this;re.clearRect(he,he,T,M),re.fillText(y,he,he+S);const Ie=re.getImageData(he,he,T,M);xe.fill(me,0,O),ye.fill(0,0,O);for(let ue=0;ue<M;ue++)for(let ze=0;ze<T;ze++){const Fe=Ie.data[4*(ue*T+ze)+3]/255;if(Fe===0)continue;const Ze=(ue+he)*z+ze+he;if(Fe===1)xe[Ze]=0,ye[Ze]=me;else{const Ye=.5-Fe;xe[Ze]=Ye>0?Ye*Ye:0,ye[Ze]=Ye<0?Ye*Ye:0}}ne(xe,0,0,z,F,z,this.f,this.v,this.z),ne(ye,he,he,T,M,z,this.f,this.v,this.z);for(let ue=0;ue<O;ue++){const ze=Math.sqrt(xe[ue])-Math.sqrt(ye[ue]);W[ue]=Math.round(255-255*(ze/this.radius+this.cutoff))}return Y}};class fe{constructor(){this.specification=u.v.light.position}possiblyEvaluate(e,l){return u.x(e.expression.evaluate(l))}interpolate(e,l,f){return{x:u.y.number(e.x,l.x,f),y:u.y.number(e.y,l.y,f),z:u.y.number(e.z,l.z,f)}}}let qe;class nt extends u.E{constructor(e){super(),qe=qe||new u.q({anchor:new u.D(u.v.light.anchor),position:new fe,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(qe),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,l={}){if(!this._validate(u.r,e,l))for(const f in e){const d=e[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),d):this._transitionable.setValue(f,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,l,f){return(!f||f.validate!==!1)&&u.t(this,e.call(u.u,{value:l,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}const lt=new u.q({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class at extends u.E{constructor(e){super(),this._transitionable=new u.T(lt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.z(0))}setSky(e,l={}){if(!this._validate(u.B,e,l)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in e){const d=e[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),d):this._transitionable.setValue(f,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,l,f={}){return(f==null?void 0:f.validate)!==!1&&u.t(this,e.call(u.u,u.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ut{constructor(e,l){this.width=e,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,l){const f=e.join(",")+String(l);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(e,l)),this.dashEntry[f]}getDashRanges(e,l,f){const d=[];let _=e.length%2==1?-e[e.length-1]*f:0,S=e[0]*f,T=!0;d.push({left:_,right:S,isDash:T,zeroLength:e[0]===0});let M=e[0];for(let z=1;z<e.length;z++){T=!T;const F=e[z];_=M*f,M+=F,S=M*f,d.push({left:_,right:S,isDash:T,zeroLength:F===0})}return d}addRoundDash(e,l,f){const d=l/2;for(let _=-f;_<=f;_++){const S=this.width*(this.nextRow+f+_);let T=0,M=e[T];for(let z=0;z<this.width;z++){z/M.right>1&&(M=e[++T]);const F=Math.abs(z-M.left),O=Math.abs(z-M.right),W=Math.min(F,O);let Y;const re=_/f*(d+1);if(M.isDash){const he=d-Math.abs(re);Y=Math.sqrt(W*W+he*he)}else Y=d-Math.sqrt(W*W+re*re);this.data[S+z]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){const M=e[T],z=e[T+1];M.zeroLength?e.splice(T,1):z&&z.isDash===M.isDash&&(z.left=M.left,e.splice(T,1))}const l=e[0],f=e[e.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);const d=this.width*this.nextRow;let _=0,S=e[_];for(let T=0;T<this.width;T++){T/S.right>1&&(S=e[++_]);const M=Math.abs(T-S.left),z=Math.abs(T-S.right),F=Math.min(M,z);this.data[d+T]=Math.max(0,Math.min(255,(S.isDash?F:-F)+128))}}addDash(e,l){const f=l?7:0,d=2*f+1;if(this.nextRow+d>this.height)return u.w("LineAtlas out of space"),null;let _=0;for(let T=0;T<e.length;T++)_+=e[T];if(_!==0){const T=this.width/_,M=this.getDashRanges(e,this.width,T);l?this.addRoundDash(M,T,f):this.addRegularDash(M)}const S={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:_};return this.nextRow+=d,this.dirty=!0,S}bind(e){const l=e.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}const St="maplibre_preloaded_worker_pool";class It{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<It.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[St]}numActive(){return Object.keys(this.active).length}}const st=Math.floor(C.hardwareConcurrency/2);let Lt,wi;function Di(){return Lt||(Lt=new It),Lt}It.workerCount=u.C(globalThis)?Math.max(Math.min(st,3),1):1;class Zi{constructor(e,l){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=l;const f=this.workerPool.acquire(l);for(let d=0;d<f.length;d++){const _=new u.F(f[d],l);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,l){const f=[];for(const d of this.actors)f.push(d.sendAsync({type:e,data:l}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(l=>{l.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,l){for(const f of this.actors)f.registerMessageHandler(e,l)}}function _i(){return wi||(wi=new Zi(Di(),u.G),wi.registerMessageHandler("GR",(y,e,l)=>u.m(e,l))),wi}function Si(y,e){const l=u.H();return u.J(l,l,[1,1,0]),u.K(l,l,[.5*y.width,.5*y.height,1]),u.L(l,l,y.calculatePosMatrix(e.toUnwrapped()))}function Ne(y,e,l,f,d,_){const S=function(O,W,Y){if(O)for(const re of O){const he=W[re];if(he&&he.source===Y&&he.type==="fill-extrusion")return!0}else for(const re in W){const he=W[re];if(he.source===Y&&he.type==="fill-extrusion")return!0}return!1}(d&&d.layers,e,y.id),T=_.maxPitchScaleFactor(),M=y.tilesIn(f,T,S);M.sort(yt);const z=[];for(const O of M)z.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(e,l,y._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,d,_,T,Si(y.transform,O.tileID))});const F=function(O){const W={},Y={};for(const re of O){const he=re.queryResults,ye=re.wrappedTileID,xe=Y[ye]=Y[ye]||{};for(const Ie in he){const ue=he[Ie],ze=xe[Ie]=xe[Ie]||{},Fe=W[Ie]=W[Ie]||[];for(const Ze of ue)ze[Ze.featureIndex]||(ze[Ze.featureIndex]=!0,Fe.push(Ze))}}return W}(z);for(const O in F)F[O].forEach(W=>{const Y=W.feature,re=y.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=re});return F}function yt(y,e){const l=y.tileID,f=e.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}function Qt(y,e,l){return u._(this,void 0,void 0,function*(){let f=y;if(y.url?f=(yield u.h(e.transformRequest(y.url,"Source"),l)).data:yield C.frameAsync(l),!f)return null;const d=u.M(u.e(f,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(d.vectorLayerIds=f.vector_layers.map(_=>_.id)),d})}class je{constructor(e,l){e&&(l?this.setSouthWest(e).setNorthEast(l):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof u.N?new u.N(e.lng,e.lat):u.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof u.N?new u.N(e.lng,e.lat):u.N.convert(e),this}extend(e){const l=this._sw,f=this._ne;let d,_;if(e instanceof u.N)d=e,_=e;else{if(!(e instanceof je))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(je.convert(e)):this.extend(u.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(u.N.convert(e)):this;if(d=e._sw,_=e._ne,!d||!_)return this}return l||f?(l.lng=Math.min(d.lng,l.lng),l.lat=Math.min(d.lat,l.lat),f.lng=Math.max(_.lng,f.lng),f.lat=Math.max(_.lat,f.lat)):(this._sw=new u.N(d.lng,d.lat),this._ne=new u.N(_.lng,_.lat)),this}getCenter(){return new u.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.N(this.getWest(),this.getNorth())}getSouthEast(){return new u.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:l,lat:f}=u.N.convert(e);let d=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&d}static convert(e){return e instanceof je?e:e&&new je(e)}static fromLngLat(e,l=0){const f=360*l/40075017,d=f/Math.cos(Math.PI/180*e.lat);return new je(new u.N(e.lng-d,e.lat-f),new u.N(e.lng+d,e.lat+f))}adjustAntiMeridian(){const e=new u.N(this._sw.lng,this._sw.lat),l=new u.N(this._ne.lng,this._ne.lat);return new je(e,e.lng>l.lng?new u.N(l.lng+360,l.lat):l)}}class $e{constructor(e,l,f){this.bounds=je.convert(this.validateBounds(e)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const l=Math.pow(2,e.z),f=Math.floor(u.O(this.bounds.getWest())*l),d=Math.floor(u.Q(this.bounds.getNorth())*l),_=Math.ceil(u.O(this.bounds.getEast())*l),S=Math.ceil(u.Q(this.bounds.getSouth())*l);return e.x>=f&&e.x<_&&e.y>=d&&e.y<S}}class Ei extends u.E{constructor(e,l,f,d){if(super(),this.id=e,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.M(l,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Qt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(u.e(this,e),e.bounds&&(this.tileBounds=new $e(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(e){return u._(this,void 0,void 0,function*(){const l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(l,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};f.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((_,S)=>{e.reloadPromise={resolve:_,reject:S}})}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const _=yield e.actor.sendAsync({type:d,data:f},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,_)}catch(_){if(delete e.abortController,e.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,l){if(l&&l.resourceTiming&&(e.resourceTiming=l.resourceTiming),l&&this.map._refreshExpiredTiles&&e.setExpiryData(l),e.loadVectorData(l,this.map.painter),e.reloadPromise){const f=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(f.resolve).catch(f.reject)}}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ge extends u.E{constructor(e,l,f,d){super(),this.id=e,this.dispatcher=f,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},l),u.e(this,u.M(l,["url","scheme","tileSize"]))}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Qt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(u.e(this,e),e.bounds&&(this.tileBounds=new $e(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return u.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return u._(this,void 0,void 0,function*(){const l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const f=yield Te.getImage(this.map._requestManager.transformRequest(l,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&f.cacheControl&&f.expires&&e.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const d=this.map.painter.context,_=d.gl,S=f.data;e.texture=this.map.painter.getTileTexture(S.width),e.texture?e.texture.update(S,{useMipmap:!0}):(e.texture=new D(d,S,_.RGBA,{useMipmap:!0}),e.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(f){if(delete e.abortController,e.aborted)e.state="unloaded";else if(f)throw e.state="errored",f}})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Vt extends Ge{constructor(e,l,f,d){super(e,l,f,d),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox",this.redFactor=l.redFactor,this.greenFactor=l.greenFactor,this.blueFactor=l.blueFactor,this.baseShift=l.baseShift}loadTile(e){return u._(this,void 0,void 0,function*(){const l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(l,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield Te.getImage(f,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const _=d.data;this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const S=u.b(_)&&u.U()?_:yield this.readImageNow(_),T={type:this.type,uid:e.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const M=yield e.actor.sendAsync({type:"LDT",data:T});e.dem=M,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}})}readImageNow(e){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.V()){const l=e.width+2,f=e.height+2;try{return new u.R({width:l,height:f},yield u.W(e,-1,-1,l,f))}catch{}}return C.getImageData(e,1)})}_getNeighboringTiles(e){const l=e.canonical,f=Math.pow(2,l.z),d=(l.x-1+f)%f,_=l.x===0?e.wrap-1:e.wrap,S=(l.x+1+f)%f,T=l.x+1===f?e.wrap+1:e.wrap,M={};return M[new u.S(e.overscaledZ,_,l.z,d,l.y).key]={backfilled:!1},M[new u.S(e.overscaledZ,T,l.z,S,l.y).key]={backfilled:!1},l.y>0&&(M[new u.S(e.overscaledZ,_,l.z,d,l.y-1).key]={backfilled:!1},M[new u.S(e.overscaledZ,e.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},M[new u.S(e.overscaledZ,T,l.z,S,l.y-1).key]={backfilled:!1}),l.y+1<f&&(M[new u.S(e.overscaledZ,_,l.z,d,l.y+1).key]={backfilled:!1},M[new u.S(e.overscaledZ,e.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},M[new u.S(e.overscaledZ,T,l.z,S,l.y+1).key]={backfilled:!1}),M}unloadTile(e){return u._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Ri extends u.E{constructor(e,l,f,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(d),this._data=l.data,this._options=u.e({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const _=u.X/this.tileSize;l.clusterMaxZoom!==void 0&&this.maxzoom<=l.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${l.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*_,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*_,extent:u.X,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:u.X,radius:(l.clusterRadius||50)*_,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return u._(this,void 0,void 0,function*(){const e=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,l,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:l,offset:f}})}_updateWorkerData(e){return u._(this,void 0,void 0,function*(){const l=u.e({type:this.type},this.workerOptions);e?l.dataDiff=e:typeof this._data=="string"?(l.request=this.map._requestManager.transformRequest(C.resolveURL(this._data),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:l});if(this._pendingLoads--,this._removed||f.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let d=null;f.resourceTiming&&f.resourceTiming[this.id]&&(d=f.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&u.e(_,{resourceTiming:d}),this.fire(new u.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(f){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(f))}})}loaded(){return this._pendingLoads===0}loadTile(e){return u._(this,void 0,void 0,function*(){const l=e.actor?"RT":"LT";e.actor=this.actor;const f={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:l,data:f},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,l==="RT")})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var jn=u.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ir extends u.E{constructor(e,l,f,d){super(),this.id=e,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=l}load(e){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const l=yield Te.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,l&&l.data&&(this.image=l.data,e&&(this.coordinates=e),this._finishLoading())}catch(l){this._request=null,this._loaded=!0,this.fire(new u.j(l))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const l=e.map(u.Z.fromLngLat);this.tileID=function(d){let _=1/0,S=1/0,T=-1/0,M=-1/0;for(const W of d)_=Math.min(_,W.x),S=Math.min(S,W.y),T=Math.max(T,W.x),M=Math.max(M,W.y);const z=Math.max(T-_,M-S),F=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),O=Math.pow(2,F);return new u.a1(F,Math.floor((_+T)/2*O),Math.floor((S+M)/2*O))}(l),this.minzoom=this.maxzoom=this.tileID.z;const f=l.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new u.$,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,u.X,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,u.X),this._boundsArray.emplaceBack(f[2].x,f[2].y,u.X,u.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,l=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,jn.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new D(e,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let f=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,f=!0)}f&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class si extends Ir{constructor(e,l,f,d){super(e,l,f,d),this.roundZoom=!0,this.type="video",this.options=l}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const l of e.urls)this.urls.push(this.map._requestManager.transformRequest(l,"Source").url);try{const l=yield u.a3(this.urls);if(this._loaded=!0,!l)return;this.video=l,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(l){this.fire(new u.j(l))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const l=this.video.seekable;e<l.start(0)||e>l.end(0)?this.fire(new u.j(new u.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,l=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,jn.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new D(e,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let f=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,f=!0)}f&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Mi extends Ir{constructor(e,l,f,d){super(e,l,f,d),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(S=>typeof S!="number"))||this.fire(new u.j(new u.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.a2(`sources.${e}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new u.j(new u.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,jn.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new D(l,this.canvas,f.RGBA,{premultiply:!0});let d=!1;for(const _ in this.tiles){const S=this.tiles[_];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,d=!0)}d&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ut={},ps=y=>{switch(y){case"geojson":return Ri;case"image":return Ir;case"raster":return Ge;case"raster-dem":return Vt;case"vector":return Ei;case"video":return si;case"canvas":return Mi}return Ut[y]},ot="RTLPluginLoaded";class fi extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=_i()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(l=>{throw this.status="error",l})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return u._(this,arguments,void 0,function*(l,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=C.resolveURL(l),!this.url)throw new Error(`requested url ${l} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.k(ot))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Hi=null;function Un(){return Hi||(Hi=new fi),Hi}class Pn{constructor(e,l){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=u.a4(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const l=e+this.timeAdded;l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,l,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,_){const S={};if(!_)return S;for(const T of d){const M=T.layerIds.map(z=>_.getLayer(z)).filter(Boolean);if(M.length!==0){T.layers=M,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(z=>M.filter(F=>F.id===z)[0]));for(const z of M)S[z.id]=T}}return S}(e.buckets,l.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof u.a6){if(this.hasSymbolBuckets=!0,!f)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof u.a6&&_.hasRTLText){this.hasRTLText=!0,Un().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(d).queryRadius(_))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const f in this.buckets){const d=this.buckets[f];d.uploadPending()&&d.upload(e)}const l=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new D(e,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new D(e,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,l,f,d,_,S,T,M,z,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:S,tileSize:this.tileSize,pixelPosMatrix:F,transform:M,params:T,queryPadding:this.queryPadding*z},e,l,f):{}}querySourceFeatures(e,l){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const d=f.loadVTLayers(),_=l&&l.sourceLayer?l.sourceLayer:"",S=d._geojsonTileLayer||d[_];if(!S)return;const T=u.a7(l&&l.filter),{z:M,x:z,y:F}=this.tileID.canonical,O={z:M,x:z,y:F};for(let W=0;W<S.length;W++){const Y=S.feature(W);if(T.needGeometry){const ye=u.a8(Y,!0);if(!T.filter(new u.z(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!T.filter(new u.z(this.tileID.overscaledZ),Y))continue;const re=f.getId(Y,_),he=new u.a9(Y,M,z,F,re);he.tile=O,e.push(he)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const l=this.expirationTime;if(e.cacheControl){const f=u.aa(e.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const f=Date.now();let d=!1;if(this.expirationTime>f)d=!1;else if(l)if(this.expirationTime<l)d=!0;else{const _=this.expirationTime-l;_?this.expirationTime=f+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!l.style.hasLayer(d))continue;const _=this.buckets[d],S=_.layers[0].sourceLayer||"_geojsonTileLayer",T=f[S],M=e[S];if(!T||!M||Object.keys(M).length===0)continue;_.update(M,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=l&&l.style&&l.style.getLayer(d);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<C.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=C.now()+e}setDependencies(e,l){const f={};for(const d of l)f[d]=!0;this.dependencies[e]=f}hasDependency(e,l){for(const f of e){const d=this.dependencies[f];if(d){for(const _ of l)if(d[_])return!0}}return!1}}class ht{constructor(e,l){this.max=e,this.onRemove=l,this.reset()}reset(){for(const e in this.data)for(const l of this.data[e])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(e,l,f){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const _={value:l,timeout:void 0};if(f!==void 0&&(_.timeout=setTimeout(()=>{this.remove(e,_)},f)),this.data[d].push(_),this.order.push(d),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const l=this.data[e].shift();return l.timeout&&clearTimeout(l.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),l.value}getByKey(e){const l=this.data[e];return l?l[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,l){if(!this.has(e))return this;const f=e.wrapped().key,d=l===void 0?0:this.data[f].indexOf(l),_=this.data[f][d];return this.data[f].splice(d,1),_.timeout&&clearTimeout(_.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(_.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(e){const l=[];for(const f in this.data)for(const d of this.data[f])e(d.value)||l.push(d);for(const f of l)this.remove(f.value.tileID,f)}}class ii{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,l,f){const d=String(l);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},u.e(this.stateChanges[e][d],f),this.deletedStates[e]===null){this.deletedStates[e]={};for(const _ in this.state[e])_!==d&&(this.deletedStates[e][_]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const _ in this.state[e][d])f[_]||(this.deletedStates[e][d][_]=null)}else for(const _ in f)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][_]===null&&delete this.deletedStates[e][d][_]}removeFeatureState(e,l,f){if(this.deletedStates[e]===null)return;const d=String(l);if(this.deletedStates[e]=this.deletedStates[e]||{},f&&l!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][f]=null);else if(l!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(f in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][f]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,l){const f=String(l),d=u.e({},(this.state[e]||{})[f],(this.stateChanges[e]||{})[f]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const _=this.deletedStates[e][l];if(_===null)return{};for(const S in _)delete d[S]}return d}initializeTileState(e,l){e.setFeatureState(this.state,l)}coalesceChanges(e,l){const f={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const S in this.stateChanges[d])this.state[d][S]||(this.state[d][S]={}),u.e(this.state[d][S],this.stateChanges[d][S]),_[S]=this.state[d][S];f[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const S in this.state[d])_[S]={},this.state[d][S]={};else for(const S in this.deletedStates[d]){if(this.deletedStates[d][S]===null)this.state[d][S]={};else for(const T of Object.keys(this.deletedStates[d][S]))delete this.state[d][S][T];_[S]=this.state[d][S]}f[d]=f[d]||{},u.e(f[d],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const d in e)e[d].setFeatureState(f,l)}}class Ht extends u.E{constructor(e,l,f){super(),this.id=e,this.dispatcher=f,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,_,S,T)=>{const M=new(ps(_.type))(d,_,S,T);if(M.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${M.id}`);return M})(e,l,f,this),this._tiles={},this._cache=new ht(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ii,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const l=this._tiles[e];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,l,f){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,l,f)}catch(d){e.state="errored",d.status!==404?this._source.fire(new u.j(d,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new u.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const f=this._tiles[l];f.upload(e),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(tn).map(e=>e.key)}getRenderableIds(e){const l=[];for(const f in this._tiles)this._isIdRenderable(f,e)&&l.push(this._tiles[f]);return e?l.sort((f,d)=>{const _=f.tileID,S=d.tileID,T=new u.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),M=new u.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-S.overscaledZ||M.y-T.y||M.x-T.x}).map(f=>f.tileID.key):l.map(f=>f.tileID).sort(tn).map(f=>f.key)}hasRenderableParent(e){const l=this.findLoadedParent(e,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(e,l){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(l||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,l){return u._(this,void 0,void 0,function*(){const f=this._tiles[e];f&&(f.state!=="loading"&&(f.state=l),yield this._loadTile(f,e,l))})}_tileLoaded(e,l,f){e.timeAdded=C.now(),f==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(l,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const l=this.getRenderableIds();for(let d=0;d<l.length;d++){const _=l[d];if(e.neighboringTiles&&e.neighboringTiles[_]){const S=this.getTileByID(_);f(e,S),f(S,e)}}function f(d,_){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let S=_.tileID.canonical.x-d.tileID.canonical.x;const T=_.tileID.canonical.y-d.tileID.canonical.y,M=Math.pow(2,d.tileID.canonical.z),z=_.tileID.key;S===0&&T===0||Math.abs(T)>1||(Math.abs(S)>1&&(Math.abs(S+M)===1?S+=M:Math.abs(S-M)===1&&(S-=M)),_.dem&&d.dem&&(d.dem.backfillBorder(_.dem,S,T),d.neighboringTiles&&d.neighboringTiles[z]&&(d.neighboringTiles[z].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,l,f,d){for(const _ in this._tiles){let S=this._tiles[_];if(d[_]||!S.hasData()||S.tileID.overscaledZ<=l||S.tileID.overscaledZ>f)continue;let T=S.tileID;for(;S&&S.tileID.overscaledZ>l+1;){const z=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[z.key],S&&S.hasData()&&(T=z)}let M=T;for(;M.overscaledZ>l;)if(M=M.scaledTo(M.overscaledZ-1),e[M.key]){d[T.key]=T;break}}}findLoadedParent(e,l){if(e.key in this._loadedParentTiles){const f=this._loadedParentTiles[e.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=e.overscaledZ-1;f>=l;f--){const d=e.scaledTo(f),_=this._getLoadedTile(d);if(_)return _}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const l=this._tiles[e.key];return l&&l.hasData()?l:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const l=Math.ceil(e.width/this._source.tileSize)+1,f=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(l*f*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(_)}handleWrapJump(e){const l=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,l){const f={};for(const d in this._tiles){const _=this._tiles[d];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+l),f[_.tileID.key]=_}this._tiles=f;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,l,f,d,_,S){const T={},M={},z=Object.keys(e),F=C.now();for(const O of z){const W=e[O],Y=this._tiles[O];if(!Y||Y.fadeEndTime!==0&&Y.fadeEndTime<=F)continue;const re=this.findLoadedParent(W,l),he=this.findLoadedSibling(W),ye=re||he||null;ye&&(this._addTile(ye.tileID),T[ye.tileID.key]=ye.tileID),M[O]=W}this._retainLoadedChildren(M,d,f,e);for(const O in T)e[O]||(this._coveredTiles[O]=!0,e[O]=T[O]);if(S){const O={},W={};for(const Y of _)this._tiles[Y.key].hasData()?O[Y.key]=Y:W[Y.key]=Y;for(const Y in W){const re=W[Y].children(this._source.maxzoom);this._tiles[re[0].key]&&this._tiles[re[1].key]&&this._tiles[re[2].key]&&this._tiles[re[3].key]&&(O[re[0].key]=e[re[0].key]=re[0],O[re[1].key]=e[re[1].key]=re[1],O[re[2].key]=e[re[2].key]=re[2],O[re[3].key]=e[re[3].key]=re[3],delete W[Y])}for(const Y in W){const re=W[Y],he=this.findLoadedParent(re,this._source.minzoom),ye=this.findLoadedSibling(re),xe=he||ye||null;if(xe){O[xe.tileID.key]=e[xe.tileID.key]=xe.tileID;for(const Ie in O)O[Ie].isChildOf(xe.tileID)&&delete O[Ie]}}for(const Y in this._tiles)O[Y]||(this._coveredTiles[Y]=!0)}}update(e,l){if(!this._sourceLoaded||this._paused)return;let f;this.transform=e,this.terrain=l,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new u.S(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(f=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l}),this._source.hasTile&&(f=f.filter(F=>this._source.hasTile(F)))):f=[];const d=e.coveringZoomLevel(this._source),_=Math.max(d-Ht.maxOverzooming,this._source.minzoom),S=Math.max(d+Ht.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const O of f)if(O.canonical.z>this._source.minzoom){const W=O.scaledTo(O.canonical.z-1);F[W.key]=W;const Y=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));F[Y.key]=Y}f=f.concat(Object.values(F))}const T=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(f,d);or(this._source.type)&&this._updateCoveredAndRetainedTiles(M,_,S,d,f,l);for(const F in M)this._tiles[F].clearFadeHold();const z=u.ab(this._tiles,M);for(const F of z){const O=this._tiles[F];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,l){var f;const d={},_={},S=Math.max(l-Ht.maxOverzooming,this._source.minzoom),T=Math.max(l+Ht.maxUnderzooming,this._source.minzoom),M={};for(const z of e){const F=this._addTile(z);d[z.key]=z,F.hasData()||l<this._source.maxzoom&&(M[z.key]=z)}this._retainLoadedChildren(M,l,T,d);for(const z of e){let F=this._tiles[z.key];if(F.hasData())continue;if(l+1>this._source.maxzoom){const W=z.children(this._source.maxzoom)[0],Y=this.getTile(W);if(Y&&Y.hasData()){d[W.key]=W;continue}}else{const W=z.children(this._source.maxzoom);if(d[W[0].key]&&d[W[1].key]&&d[W[2].key]&&d[W[3].key])continue}let O=F.wasRequested();for(let W=z.overscaledZ-1;W>=S;--W){const Y=z.scaledTo(W);if(_[Y.key])break;if(_[Y.key]=!0,F=this.getTile(Y),!F&&O&&(F=this._addTile(Y)),F){const re=F.hasData();if((re||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||O)&&(d[Y.key]=Y),O=F.wasRequested(),re)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const l=[];let f,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){f=this._loadedParentTiles[d.key];break}l.push(d.key);const _=d.scaledTo(d.overscaledZ-1);if(f=this._getLoadedTile(_),f)break;d=_}for(const _ of l)this._loadedParentTiles[_]=f}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const l=this._tiles[e].tileID,f=this._getLoadedTile(l);this._loadedSiblingTiles[l.key]=f}}_addTile(e){let l=this._tiles[e.key];if(l)return l;l=this._cache.getAndRemove(e),l&&(this._setTileReloadTimer(e.key,l),l.tileID=e,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,l)));const f=l;return l||(l=new Pn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(l,e.key,l.state)),l.uses++,this._tiles[e.key]=l,f||this._source.fire(new u.k("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(e,l){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const f=l.getExpiryTimeout();f&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},f))}_removeTile(e){const l=this._tiles[e];l&&(l.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}_dataHandler(e){const l=e.sourceDataType;e.dataType==="source"&&l==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&l==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,l,f){const d=[],_=this.transform;if(!_)return d;const S=f?_.getCameraQueryGeometry(e):e,T=e.map(re=>_.pointCoordinate(re,this.terrain)),M=S.map(re=>_.pointCoordinate(re,this.terrain)),z=this.getIds();let F=1/0,O=1/0,W=-1/0,Y=-1/0;for(const re of M)F=Math.min(F,re.x),O=Math.min(O,re.y),W=Math.max(W,re.x),Y=Math.max(Y,re.y);for(let re=0;re<z.length;re++){const he=this._tiles[z[re]];if(he.holdingForFade())continue;const ye=he.tileID,xe=Math.pow(2,_.zoom-he.tileID.overscaledZ),Ie=l*he.queryPadding*u.X/he.tileSize/xe,ue=[ye.getTilePoint(new u.Z(F,O)),ye.getTilePoint(new u.Z(W,Y))];if(ue[0].x-Ie<u.X&&ue[0].y-Ie<u.X&&ue[1].x+Ie>=0&&ue[1].y+Ie>=0){const ze=T.map(Ze=>ye.getTilePoint(Ze)),Fe=M.map(Ze=>ye.getTilePoint(Ze));d.push({tile:he,tileID:ye,queryGeometry:ze,cameraQueryGeometry:Fe,scale:xe})}}return d}getVisibleCoordinates(e){const l=this.getRenderableIds(e).map(f=>this._tiles[f].tileID);for(const f of l)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(or(this._source.type)){const e=C.now();for(const l in this._tiles)if(this._tiles[l].fadeEndTime>=e)return!0}return!1}setFeatureState(e,l,f){this._state.updateState(e=e||"_geojsonTileLayer",l,f)}removeFeatureState(e,l,f){this._state.removeFeatureState(e=e||"_geojsonTileLayer",l,f)}getFeatureState(e,l){return this._state.getState(e=e||"_geojsonTileLayer",l)}setDependencies(e,l,f){const d=this._tiles[e];d&&d.setDependencies(l,f)}reloadTilesForDependencies(e,l){for(const f in this._tiles)this._tiles[f].hasDependency(e,l)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(e,l))}}function tn(y,e){const l=Math.abs(2*y.wrap)-+(y.wrap<0),f=Math.abs(2*e.wrap)-+(e.wrap<0);return y.overscaledZ-e.overscaledZ||f-l||e.canonical.y-y.canonical.y||e.canonical.x-y.canonical.x}function or(y){return y==="raster"||y==="image"||y==="video"}Ht.maxOverzooming=10,Ht.maxUnderzooming=3;class Xt{constructor(e,l){this.reset(e,l)}reset(e,l){this.points=e||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=u.ac(e,0,1);let l=1,f=this._distances[l];const d=e*this.paddedLength+this.padding;for(;f<d&&l<this._distances.length;)f=this._distances[++l];const _=l-1,S=this._distances[_],T=f-S,M=T>0?(d-S)/T:0;return this.points[_].mult(1-M).add(this.points[l].mult(M))}}function ar(y,e){let l=!0;return y==="always"||y!=="never"&&e!=="never"||(l=!1),l}class lr{constructor(e,l,f){const d=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(e/f),this.yCellCount=Math.ceil(l/f);for(let S=0;S<this.xCellCount*this.yCellCount;S++)d.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=l,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,l,f,d,_){this._forEachCell(l,f,d,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(d),this.bboxes.push(_)}insertCircle(e,l,f,d){this._forEachCell(l-d,f-d,l+d,f+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(l),this.circles.push(f),this.circles.push(d)}_insertBoxCell(e,l,f,d,_,S){this.boxCells[_].push(S)}_insertCircleCell(e,l,f,d,_,S){this.circleCells[_].push(S)}_query(e,l,f,d,_,S,T){if(f<0||e>this.width||d<0||l>this.height)return[];const M=[];if(e<=0&&l<=0&&this.width<=f&&this.height<=d){if(_)return[{key:null,x1:e,y1:l,x2:f,y2:d}];for(let z=0;z<this.boxKeys.length;z++)M.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const F=this.circles[3*z],O=this.circles[3*z+1],W=this.circles[3*z+2];M.push({key:this.circleKeys[z],x1:F-W,y1:O-W,x2:F+W,y2:O+W})}}else this._forEachCell(e,l,f,d,this._queryCell,M,{hitTest:_,overlapMode:S,seenUids:{box:{},circle:{}}},T);return M}query(e,l,f,d){return this._query(e,l,f,d,!1,null)}hitTest(e,l,f,d,_,S){return this._query(e,l,f,d,!0,_,S).length>0}hitTestCircle(e,l,f,d,_){const S=e-f,T=e+f,M=l-f,z=l+f;if(T<0||S>this.width||z<0||M>this.height)return!1;const F=[];return this._forEachCell(S,M,T,z,this._queryCellCircle,F,{hitTest:!0,overlapMode:d,circle:{x:e,y:l,radius:f},seenUids:{box:{},circle:{}}},_),F.length>0}_queryCell(e,l,f,d,_,S,T,M){const{seenUids:z,hitTest:F,overlapMode:O}=T,W=this.boxCells[_];if(W!==null){const re=this.bboxes;for(const he of W)if(!z.box[he]){z.box[he]=!0;const ye=4*he,xe=this.boxKeys[he];if(e<=re[ye+2]&&l<=re[ye+3]&&f>=re[ye+0]&&d>=re[ye+1]&&(!M||M(xe))&&(!F||!ar(O,xe.overlapMode))&&(S.push({key:xe,x1:re[ye],y1:re[ye+1],x2:re[ye+2],y2:re[ye+3]}),F))return!0}}const Y=this.circleCells[_];if(Y!==null){const re=this.circles;for(const he of Y)if(!z.circle[he]){z.circle[he]=!0;const ye=3*he,xe=this.circleKeys[he];if(this._circleAndRectCollide(re[ye],re[ye+1],re[ye+2],e,l,f,d)&&(!M||M(xe))&&(!F||!ar(O,xe.overlapMode))){const Ie=re[ye],ue=re[ye+1],ze=re[ye+2];if(S.push({key:xe,x1:Ie-ze,y1:ue-ze,x2:Ie+ze,y2:ue+ze}),F)return!0}}}return!1}_queryCellCircle(e,l,f,d,_,S,T,M){const{circle:z,seenUids:F,overlapMode:O}=T,W=this.boxCells[_];if(W!==null){const re=this.bboxes;for(const he of W)if(!F.box[he]){F.box[he]=!0;const ye=4*he,xe=this.boxKeys[he];if(this._circleAndRectCollide(z.x,z.y,z.radius,re[ye+0],re[ye+1],re[ye+2],re[ye+3])&&(!M||M(xe))&&!ar(O,xe.overlapMode))return S.push(!0),!0}}const Y=this.circleCells[_];if(Y!==null){const re=this.circles;for(const he of Y)if(!F.circle[he]){F.circle[he]=!0;const ye=3*he,xe=this.circleKeys[he];if(this._circlesCollide(re[ye],re[ye+1],re[ye+2],z.x,z.y,z.radius)&&(!M||M(xe))&&!ar(O,xe.overlapMode))return S.push(!0),!0}}}_forEachCell(e,l,f,d,_,S,T,M){const z=this._convertToXCellCoord(e),F=this._convertToYCellCoord(l),O=this._convertToXCellCoord(f),W=this._convertToYCellCoord(d);for(let Y=z;Y<=O;Y++)for(let re=F;re<=W;re++)if(_.call(this,e,l,f,d,this.xCellCount*re+Y,S,T,M))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,l,f,d,_,S){const T=d-e,M=_-l,z=f+S;return z*z>T*T+M*M}_circleAndRectCollide(e,l,f,d,_,S,T){const M=(S-d)/2,z=Math.abs(e-(d+M));if(z>M+f)return!1;const F=(T-_)/2,O=Math.abs(l-(_+F));if(O>F+f)return!1;if(z<=M||O<=F)return!0;const W=z-M,Y=O-F;return W*W+Y*Y<=f*f}}function gr(y,e,l,f,d){const _=u.H();return e?(u.K(_,_,[1/d,1/d,1]),l||u.ad(_,_,f.angle)):u.L(_,f.labelPlaneMatrix,y),_}function _r(y,e,l,f,d){if(e){const _=u.ae(y);return u.K(_,_,[d,d,1]),l||u.ad(_,_,-f.angle),_}return f.glCoordMatrix}function de(y,e,l,f){let d;f?(d=[y,e,f(y,e),1],u.af(d,d,l)):(d=[y,e,0,1],yi(d,d,l));const _=d[3];return{point:new u.P(d[0]/_,d[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function j(y,e){return .5+y/e*.5}function q(y,e){return y.x>=-e[0]&&y.x<=e[0]&&y.y>=-e[1]&&y.y<=e[1]}function J(y,e,l,f,d,_,S,T,M,z,F,O,W,Y,re){const he=f?y.textSizeData:y.iconSizeData,ye=u.ag(he,l.transform.zoom),xe=[256/l.width*2+1,256/l.height*2+1],Ie=f?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;Ie.clear();const ue=y.lineVertexArray,ze=f?y.text.placedSymbolArray:y.icon.placedSymbolArray,Fe=l.transform.width/l.transform.height;let Ze=!1;for(let Ye=0;Ye<ze.length;Ye++){const ct=ze.get(Ye);if(ct.hidden||ct.writingMode===u.ah.vertical&&!Ze){jt(ct.numGlyphs,Ie);continue}Ze=!1;const vt=de(ct.anchorX,ct.anchorY,e,re);if(!q(vt.point,xe)){jt(ct.numGlyphs,Ie);continue}const kt=j(l.transform.cameraToCenterDistance,vt.signedDistanceFromCamera),mt=u.ai(he,ye,ct),pt=S?mt/kt:mt*kt,Dt={getElevation:re,labelPlaneMatrix:d,lineVertexArray:ue,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:z,tileAnchorPoint:new u.P(ct.anchorX,ct.anchorY),unwrappedTileID:F,width:O,height:W,translation:Y},ti=Re(Dt,ct,pt,!1,T,e,_,y.glyphOffsetArray,Ie,Fe,M);Ze=ti.useVertical,(ti.notEnoughRoom||Ze||ti.needsFlipping&&Re(Dt,ct,pt,!0,T,e,_,y.glyphOffsetArray,Ie,Fe,M).notEnoughRoom)&&jt(ct.numGlyphs,Ie)}f?y.text.dynamicLayoutVertexBuffer.updateData(Ie):y.icon.dynamicLayoutVertexBuffer.updateData(Ie)}function le(y,e,l,f,d,_,S,T){const M=_.glyphStartIndex+_.numGlyphs,z=_.lineStartIndex,F=_.lineStartIndex+_.lineLength,O=e.getoffsetX(_.glyphStartIndex),W=e.getoffsetX(M-1),Y=dt(y*O,l,f,d,_.segment,z,F,T,S);if(!Y)return null;const re=dt(y*W,l,f,d,_.segment,z,F,T,S);return re?T.projectionCache.anyProjectionOccluded?null:{first:Y,last:re}:null}function Ee(y,e,l,f){return y===u.ah.horizontal&&Math.abs(l.y-e.y)>Math.abs(l.x-e.x)*f?{useVertical:!0}:(y===u.ah.vertical?e.y<l.y:e.x>l.x)?{needsFlipping:!0}:null}function Re(y,e,l,f,d,_,S,T,M,z,F){const O=l/24,W=e.lineOffsetX*O,Y=e.lineOffsetY*O;let re;if(e.numGlyphs>1){const he=e.glyphStartIndex+e.numGlyphs,ye=e.lineStartIndex,xe=e.lineStartIndex+e.lineLength,Ie=le(O,T,W,Y,f,e,F,y);if(!Ie)return{notEnoughRoom:!0};const ue=de(Ie.first.point.x,Ie.first.point.y,S,y.getElevation).point,ze=de(Ie.last.point.x,Ie.last.point.y,S,y.getElevation).point;if(d&&!f){const Fe=Ee(e.writingMode,ue,ze,z);if(Fe)return Fe}re=[Ie.first];for(let Fe=e.glyphStartIndex+1;Fe<he-1;Fe++)re.push(dt(O*T.getoffsetX(Fe),W,Y,f,e.segment,ye,xe,y,F));re.push(Ie.last)}else{if(d&&!f){const ye=de(y.tileAnchorPoint.x,y.tileAnchorPoint.y,_,y.getElevation).point,xe=e.lineStartIndex+e.segment+1,Ie=new u.P(y.lineVertexArray.getx(xe),y.lineVertexArray.gety(xe)),ue=de(Ie.x,Ie.y,_,y.getElevation),ze=ue.signedDistanceFromCamera>0?ue.point:function(Ze,Ye,ct,vt,kt,mt){return Ve(Ze,Ye,ct,1,kt,mt)}(y.tileAnchorPoint,Ie,ye,0,_,y),Fe=Ee(e.writingMode,ye,ze,z);if(Fe)return Fe}const he=dt(O*T.getoffsetX(e.glyphStartIndex),W,Y,f,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,y,F);if(!he||y.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};re=[he]}for(const he of re)u.aj(M,he.point,he.angle);return{}}function Ve(y,e,l,f,d,_){const S=y.add(y.sub(e)._unit()),T=d!==void 0?de(S.x,S.y,d,_.getElevation).point:Ke(S.x,S.y,_).point,M=l.sub(T);return l.add(M._mult(f/M.mag()))}function we(y,e,l){const f=e.projectionCache;if(f.projections[y])return f.projections[y];const d=new u.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),_=Ke(d.x,d.y,e);if(_.signedDistanceFromCamera>0)return f.projections[y]=_.point,f.anyProjectionOccluded=f.anyProjectionOccluded||_.isOccluded,_.point;const S=y-l.direction;return function(T,M,z,F,O){return Ve(T,M,z,F,void 0,O)}(l.distanceFromAnchor===0?e.tileAnchorPoint:new u.P(e.lineVertexArray.getx(S),e.lineVertexArray.gety(S)),d,l.previousVertex,l.absOffsetX-l.distanceFromAnchor+1,e)}function Ke(y,e,l){const f=y+l.translation[0],d=e+l.translation[1];let _;return!l.pitchWithMap&&l.projection.useSpecialProjectionForSymbols?(_=l.projection.projectTileCoordinates(f,d,l.unwrappedTileID,l.getElevation),_.point.x=(.5*_.point.x+.5)*l.width,_.point.y=(.5*-_.point.y+.5)*l.height):(_=de(f,d,l.labelPlaneMatrix,l.getElevation),_.isOccluded=!1),_}function Qe(y,e,l){return y._unit()._perp()._mult(e*l)}function We(y,e,l,f,d,_,S,T,M){if(T.projectionCache.offsets[y])return T.projectionCache.offsets[y];const z=l.add(e);if(y+M.direction<f||y+M.direction>=d)return T.projectionCache.offsets[y]=z,z;const F=we(y+M.direction,T,M),O=Qe(F.sub(l),S,M.direction),W=l.add(O),Y=F.add(O);return T.projectionCache.offsets[y]=u.ak(_,z,W,Y)||z,T.projectionCache.offsets[y]}function dt(y,e,l,f,d,_,S,T,M){const z=f?y-e:y+e;let F=z>0?1:-1,O=0;f&&(F*=-1,O=Math.PI),F<0&&(O+=Math.PI);let W,Y=F>0?_+d:_+d+1;T.projectionCache.cachedAnchorPoint?W=T.projectionCache.cachedAnchorPoint:(W=Ke(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=W);let re,he,ye=W,xe=W,Ie=0,ue=0;const ze=Math.abs(z),Fe=[];let Ze;for(;Ie+ue<=ze;){if(Y+=F,Y<_||Y>=S)return null;Ie+=ue,xe=ye,he=re;const vt={absOffsetX:ze,direction:F,distanceFromAnchor:Ie,previousVertex:xe};if(ye=we(Y,T,vt),l===0)Fe.push(xe),Ze=ye.sub(xe);else{let kt;const mt=ye.sub(xe);kt=mt.mag()===0?Qe(we(Y+F,T,vt).sub(ye),l,F):Qe(mt,l,F),he||(he=xe.add(kt)),re=We(Y,kt,ye,_,S,he,l,T,vt),Fe.push(he),Ze=re.sub(he)}ue=Ze.mag()}const Ye=Ze._mult((ze-Ie)/ue)._add(he||xe),ct=O+Math.atan2(ye.y-xe.y,ye.x-xe.x);return Fe.push(Ye),{point:Ye,angle:M?ct:0,path:Fe}}const Ft=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function jt(y,e){for(let l=0;l<y;l++){const f=e.length;e.resize(f+4),e.float32.set(Ft,3*f)}}function yi(y,e,l){const f=e[0],d=e[1];return y[0]=l[0]*f+l[4]*d+l[12],y[1]=l[1]*f+l[5]*d+l[13],y[3]=l[3]*f+l[7]*d+l[15],y}const ni=100;class vi{constructor(e,l,f=new lr(e.width+200,e.height+200,25),d=new lr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=l,this.grid=f,this.ignoredGrid=d,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ni,this.screenBottomBoundary=e.height+ni,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,l,f,d,_,S,T,M,z,F,O){const W=e.anchorPointX+M[0],Y=e.anchorPointY+M[1],re=this.projectAndGetPerspectiveRatio(d,W,Y,_,F),he=f*re.perspectiveRatio;let ye;if(S||T)ye=this._projectCollisionBox(e,he,d,_,S,T,M,re,F,O);else{const Fe=re.point.x+(O?O.x*he:0),Ze=re.point.y+(O?O.y*he:0);ye={allPointsOccluded:!1,box:[Fe+e.x1*he,Ze+e.y1*he,Fe+e.x2*he,Ze+e.y2*he]}}const[xe,Ie,ue,ze]=ye.box;return this.mapProjection.useSpecialProjectionForSymbols&&(S?ye.allPointsOccluded:this.mapProjection.isOccluded(W,Y,_))||re.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(xe,Ie,ue,ze)||l!=="always"&&this.grid.hitTest(xe,Ie,ue,ze,l,z)?{box:[xe,Ie,ue,ze],placeable:!1,offscreen:!1}:{box:[xe,Ie,ue,ze],placeable:!0,offscreen:this.isOffscreen(xe,Ie,ue,ze)}}placeCollisionCircles(e,l,f,d,_,S,T,M,z,F,O,W,Y,re,he,ye){const xe=[],Ie=new u.P(l.anchorX,l.anchorY),ue=this.getPerspectiveRatio(S,Ie.x,Ie.y,T,ye),ze=(O?_/ue:_*ue)/u.ap,Fe={getElevation:ye,labelPlaneMatrix:M,lineVertexArray:f,pitchWithMap:O,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ie,unwrappedTileID:T,width:this.transform.width,height:this.transform.height,translation:he},Ze=le(ze,d,l.lineOffsetX*ze,l.lineOffsetY*ze,!1,l,!1,Fe);let Ye=!1,ct=!1,vt=!0;if(Ze){const kt=.5*Y*ue+re,mt=new u.P(-100,-100),pt=new u.P(this.screenRightBoundary,this.screenBottomBoundary),Dt=new Xt,ti=Ze.first,gt=Ze.last;let xt=[];for(let oi=ti.path.length-1;oi>=1;oi--)xt.push(ti.path[oi]);for(let oi=1;oi<gt.path.length;oi++)xt.push(gt.path[oi]);const $t=2.5*kt;if(z){const oi=this.projectPathToScreenSpace(xt,Fe,z);xt=oi.some(di=>di.signedDistanceFromCamera<=0)?[]:oi.map(di=>di.point)}let Ji=[];if(xt.length>0){const oi=xt[0].clone(),di=xt[0].clone();for(let Yi=1;Yi<xt.length;Yi++)oi.x=Math.min(oi.x,xt[Yi].x),oi.y=Math.min(oi.y,xt[Yi].y),di.x=Math.max(di.x,xt[Yi].x),di.y=Math.max(di.y,xt[Yi].y);Ji=oi.x>=mt.x&&di.x<=pt.x&&oi.y>=mt.y&&di.y<=pt.y?[xt]:di.x<mt.x||oi.x>pt.x||di.y<mt.y||oi.y>pt.y?[]:u.al([xt],mt.x,mt.y,pt.x,pt.y)}for(const oi of Ji){Dt.reset(oi,.25*kt);let di=0;di=Dt.length<=.5*kt?1:Math.ceil(Dt.paddedLength/$t)+1;for(let Yi=0;Yi<di;Yi++){const Dn=Yi/Math.max(di-1,1),Dr=Dt.lerp(Dn),Qi=Dr.x+ni,Qn=Dr.y+ni;xe.push(Qi,Qn,kt,0);const Gn=Qi-kt,Rn=Qn-kt,Wn=Qi+kt,Jr=Qn+kt;if(vt=vt&&this.isOffscreen(Gn,Rn,Wn,Jr),ct=ct||this.isInsideGrid(Gn,Rn,Wn,Jr),e!=="always"&&this.grid.hitTestCircle(Qi,Qn,kt,e,W)&&(Ye=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Ye}}}}return{circles:!F&&Ye||!ct||ue<this.perspectiveRatioCutoff?[]:xe,offscreen:vt,collisionDetected:Ye}}projectPathToScreenSpace(e,l,f){return e.map(d=>de(d.x,d.y,f,l.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let f=1/0,d=1/0,_=-1/0,S=-1/0;for(const F of e){const O=new u.P(F.x+ni,F.y+ni);f=Math.min(f,O.x),d=Math.min(d,O.y),_=Math.max(_,O.x),S=Math.max(S,O.y),l.push(O)}const T=this.grid.query(f,d,_,S).concat(this.ignoredGrid.query(f,d,_,S)),M={},z={};for(const F of T){const O=F.key;if(M[O.bucketInstanceId]===void 0&&(M[O.bucketInstanceId]={}),M[O.bucketInstanceId][O.featureIndex])continue;const W=[new u.P(F.x1,F.y1),new u.P(F.x2,F.y1),new u.P(F.x2,F.y2),new u.P(F.x1,F.y2)];u.am(l,W)&&(M[O.bucketInstanceId][O.featureIndex]=!0,z[O.bucketInstanceId]===void 0&&(z[O.bucketInstanceId]=[]),z[O.bucketInstanceId].push(O.featureIndex))}return z}insertCollisionBox(e,l,f,d,_,S){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:S,overlapMode:l},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,l,f,d,_,S){const T=f?this.ignoredGrid:this.grid,M={bucketInstanceId:d,featureIndex:_,collisionGroupID:S,overlapMode:l};for(let z=0;z<e.length;z+=4)T.insertCircle(M,e[z],e[z+1],e[z+2])}projectAndGetPerspectiveRatio(e,l,f,d,_){let S;_?(S=[l,f,_(l,f),1],u.af(S,S,e)):(S=[l,f,0,1],yi(S,S,e));const T=S[3];return{point:new u.P((S[0]/T+1)/2*this.transform.width+ni,(-S[1]/T+1)/2*this.transform.height+ni),perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}getPerspectiveRatio(e,l,f,d,_){const S=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(l,f,d,_):de(l,f,e,_);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(e,l,f,d){return f<ni||e>=this.screenRightBoundary||d<ni||l>this.screenBottomBoundary}isInsideGrid(e,l,f,d){return f>=0&&e<this.gridRightBoundary&&d>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const e=u.an([]);return u.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,l,f,d,_,S,T,M,z,F){let O=new u.P(1,0),W=new u.P(0,1);const Y=new u.P(e.anchorPointX+T[0],e.anchorPointY+T[1]);if(S&&!_){const vt=this.projectAndGetPerspectiveRatio(f,Y.x+1,Y.y,d,z).point.sub(M.point).unit(),kt=Math.atan(vt.y/vt.x)+(vt.x<0?Math.PI:0),mt=Math.sin(kt),pt=Math.cos(kt);O=new u.P(pt,mt),W=new u.P(-mt,pt)}else if(!S&&_){const vt=-this.transform.angle,kt=Math.sin(vt),mt=Math.cos(vt);O=new u.P(mt,kt),W=new u.P(-kt,mt)}let re=M.point,he=l;if(_){re=Y;const vt=this.transform.zoom-Math.floor(this.transform.zoom);he=Math.pow(2,-vt),he*=this.mapProjection.getPitchedTextCorrection(this.transform,Y,d),F||(he*=u.ac(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}F&&(re=re.add(O.mult(F.x*he)).add(W.mult(F.y*he)));const ye=e.x1*he,xe=e.x2*he,Ie=(ye+xe)/2,ue=e.y1*he,ze=e.y2*he,Fe=(ue+ze)/2,Ze=[{offsetX:ye,offsetY:ue},{offsetX:Ie,offsetY:ue},{offsetX:xe,offsetY:ue},{offsetX:xe,offsetY:Fe},{offsetX:xe,offsetY:ze},{offsetX:Ie,offsetY:ze},{offsetX:ye,offsetY:ze},{offsetX:ye,offsetY:Fe}];let Ye=[];for(const{offsetX:vt,offsetY:kt}of Ze)Ye.push(new u.P(re.x+O.x*vt+W.x*kt,re.y+O.y*vt+W.y*kt));let ct=!1;if(_){const vt=Ye.map(kt=>this.projectAndGetPerspectiveRatio(f,kt.x,kt.y,d,z));ct=vt.some(kt=>!kt.isOccluded),Ye=vt.map(kt=>kt.point)}else ct=!0;return{box:u.ao(Ye),allPointsOccluded:!ct}}}function li(y,e,l){return e*(u.X/(y.tileSize*Math.pow(2,l-y.tileID.overscaledZ)))}class fn{constructor(e,l,f,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?l:-l))):d&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class en{constructor(e,l,f,d,_){this.text=new fn(e?e.text:null,l,f,_),this.icon=new fn(e?e.icon:null,l,d,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Be{constructor(e,l,f){this.text=e,this.icon=l,this.skipFade=f}}class Yt{constructor(){this.invProjMatrix=u.H(),this.viewportMatrix=u.H(),this.circles=[]}}class ri{constructor(e,l,f,d,_){this.bucketInstanceId=e,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=d,this.tileID=_}}class Pi{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const l=++this.maxGroupID;this.collisionGroups[e]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[e]}}function zi(y,e,l,f,d){const{horizontalAlign:_,verticalAlign:S}=u.au(y);return new u.P(-(_-.5)*e+f[0]*d,-(S-.5)*l+f[1]*d)}class Xi{constructor(e,l,f,d,_,S){this.transform=e.clone(),this.terrain=f,this.collisionIndex=new vi(this.transform,l),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Pi(_),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const l=this.terrain;return l?(f,d)=>l.getElevation(e,f,d):null}getBucketParts(e,l,f,d){const _=f.getBucket(l),S=f.latestFeatureIndex;if(!_||!S||l.id!==_.layerIds[0])return;const T=f.collisionBoxArray,M=_.layers[0].layout,z=_.layers[0].paint,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),O=f.tileSize/u.X,W=f.tileID.toUnwrapped(),Y=this.transform.calculatePosMatrix(W),re=M.get("text-pitch-alignment")==="map",he=M.get("text-rotation-alignment")==="map",ye=li(f,1,this.transform.zoom),xe=this.collisionIndex.mapProjection.translatePosition(this.transform,f,z.get("text-translate"),z.get("text-translate-anchor")),Ie=this.collisionIndex.mapProjection.translatePosition(this.transform,f,z.get("icon-translate"),z.get("icon-translate-anchor")),ue=gr(Y,re,he,this.transform,ye);let ze=null;if(re){const Ze=_r(Y,re,he,this.transform,ye);ze=u.L([],this.transform.labelPlaneMatrix,Ze)}this.retainedQueryData[_.bucketInstanceId]=new ri(_.bucketInstanceId,S,_.sourceLayerIndex,_.index,f.tileID);const Fe={bucket:_,layout:M,translationText:xe,translationIcon:Ie,posMatrix:Y,unwrappedTileID:W,textLabelPlaneMatrix:ue,labelToScreenMatrix:ze,scale:F,textPixelRatio:O,holdingForFade:f.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:u.ag(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(d)for(const Ze of _.sortKeyRanges){const{sortKey:Ye,symbolInstanceStart:ct,symbolInstanceEnd:vt}=Ze;e.push({sortKey:Ye,symbolInstanceStart:ct,symbolInstanceEnd:vt,parameters:Fe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(e,l,f,d,_,S,T,M,z,F,O,W,Y,re,he,ye,xe,Ie,ue){const ze=u.aq[e.textAnchor],Fe=[e.textOffset0,e.textOffset1],Ze=zi(ze,f,d,Fe,_),Ye=this.collisionIndex.placeCollisionBox(l,W,M,z,F,T,S,ye,O.predicate,ue,Ze);if((!Ie||this.collisionIndex.placeCollisionBox(Ie,W,M,z,F,T,S,xe,O.predicate,ue,Ze).placeable)&&Ye.placeable){let ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(ct=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:Fe,width:f,height:d,anchor:ze,textBoxScale:_,prevAnchor:ct},this.markUsedJustification(re,ze,Y,he),re.allowVerticalPlacement&&(this.markUsedOrientation(re,he,Y),this.placedOrientations[Y.crossTileID]=he),{shift:Ze,placedGlyphBoxes:Ye}}}placeLayerBucketPart(e,l,f){const{bucket:d,layout:_,translationText:S,translationIcon:T,posMatrix:M,unwrappedTileID:z,textLabelPlaneMatrix:F,labelToScreenMatrix:O,textPixelRatio:W,holdingForFade:Y,collisionBoxArray:re,partiallyEvaluatedTextSize:he,collisionGroup:ye}=e.parameters,xe=_.get("text-optional"),Ie=_.get("icon-optional"),ue=u.ar(_,"text-overlap","text-allow-overlap"),ze=ue==="always",Fe=u.ar(_,"icon-overlap","icon-allow-overlap"),Ze=Fe==="always",Ye=_.get("text-rotation-alignment")==="map",ct=_.get("text-pitch-alignment")==="map",vt=_.get("icon-text-fit")!=="none",kt=_.get("symbol-z-order")==="viewport-y",mt=ze&&(Ze||!d.hasIconData()||Ie),pt=Ze&&(ze||!d.hasTextData()||xe);!d.collisionArrays&&re&&d.deserializeCollisionBoxes(re);const Dt=this._getTerrainElevationFunc(this.retainedQueryData[d.bucketInstanceId].tileID),ti=(gt,xt,$t)=>{var Ji,oi;if(l[gt.crossTileID])return;if(Y)return void(this.placements[gt.crossTileID]=new Be(!1,!1,!1));let di=!1,Yi=!1,Dn=!0,Dr=null,Qi={box:null,placeable:!1,offscreen:null},Qn={placeable:!1},Gn=null,Rn=null,Wn=null,Jr=0,yo=0,Ya=0;xt.textFeatureIndex?Jr=xt.textFeatureIndex:gt.useRuntimeCollisionCircles&&(Jr=gt.featureIndex),xt.verticalTextFeatureIndex&&(yo=xt.verticalTextFeatureIndex);const vo=xt.textBox;if(vo){const wr=Mn=>{let Bn=u.ah.horizontal;if(d.allowVerticalPlacement&&!Mn&&this.prevPlacement){const fr=this.prevPlacement.placedOrientations[gt.crossTileID];fr&&(this.placedOrientations[gt.crossTileID]=fr,Bn=fr,this.markUsedOrientation(d,Bn,gt))}return Bn},Sr=(Mn,Bn)=>{if(d.allowVerticalPlacement&&gt.numVerticalGlyphVertices>0&&xt.verticalTextBox){for(const fr of d.writingModes)if(fr===u.ah.vertical?(Qi=Bn(),Qn=Qi):Qi=Mn(),Qi&&Qi.placeable)break}else Qi=Mn()},_s=gt.textAnchorOffsetStartIndex,Rr=gt.textAnchorOffsetEndIndex;if(Rr===_s){const Mn=(Bn,fr)=>{const mi=this.collisionIndex.placeCollisionBox(Bn,ue,W,M,z,ct,Ye,S,ye.predicate,Dt);return mi&&mi.placeable&&(this.markUsedOrientation(d,fr,gt),this.placedOrientations[gt.crossTileID]=fr),mi};Sr(()=>Mn(vo,u.ah.horizontal),()=>{const Bn=xt.verticalTextBox;return d.allowVerticalPlacement&&gt.numVerticalGlyphVertices>0&&Bn?Mn(Bn,u.ah.vertical):{box:null,offscreen:null}}),wr(Qi&&Qi.placeable)}else{let Mn=u.aq[(oi=(Ji=this.prevPlacement)===null||Ji===void 0?void 0:Ji.variableOffsets[gt.crossTileID])===null||oi===void 0?void 0:oi.anchor];const Bn=(mi,Os,bo)=>{const xo=mi.x2-mi.x1,Gc=mi.y2-mi.y1,hf=gt.textBoxScale,Wc=vt&&Fe==="never"?Os:null;let ys=null,Hc=ue==="never"?1:2,$a="never";Mn&&Hc++;for(let ta=0;ta<Hc;ta++){for(let el=_s;el<Rr;el++){const tl=d.textAnchorOffsets.get(el);if(Mn&&tl.textAnchor!==Mn)continue;const wo=this.attemptAnchorPlacement(tl,mi,xo,Gc,hf,Ye,ct,W,M,z,ye,$a,gt,d,bo,S,T,Wc,Dt);if(wo&&(ys=wo.placedGlyphBoxes,ys&&ys.placeable))return di=!0,Dr=wo.shift,ys}Mn?Mn=null:$a=ue}return f&&!ys&&(ys={box:this.collisionIndex.placeCollisionBox(vo,"always",W,M,z,ct,Ye,S,ye.predicate,Dt,new u.P(0,0)).box,offscreen:!1,placeable:!1}),ys};Sr(()=>Bn(vo,xt.iconBox,u.ah.horizontal),()=>{const mi=xt.verticalTextBox;return d.allowVerticalPlacement&&(!Qi||!Qi.placeable)&&gt.numVerticalGlyphVertices>0&&mi?Bn(mi,xt.verticalIconBox,u.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Qi&&(di=Qi.placeable,Dn=Qi.offscreen);const fr=wr(Qi&&Qi.placeable);if(!di&&this.prevPlacement){const mi=this.prevPlacement.variableOffsets[gt.crossTileID];mi&&(this.variableOffsets[gt.crossTileID]=mi,this.markUsedJustification(d,mi.anchor,gt,fr))}}}if(Gn=Qi,di=Gn&&Gn.placeable,Dn=Gn&&Gn.offscreen,gt.useRuntimeCollisionCircles){const wr=d.text.placedSymbolArray.get(gt.centerJustifiedTextSymbolIndex),Sr=u.ai(d.textSizeData,he,wr),_s=_.get("text-padding");Rn=this.collisionIndex.placeCollisionCircles(ue,wr,d.lineVertexArray,d.glyphOffsetArray,Sr,M,z,F,O,f,ct,ye.predicate,gt.collisionCircleDiameter,_s,S,Dt),Rn.circles.length&&Rn.collisionDetected&&!f&&u.w("Collisions detected, but collision boxes are not shown"),di=ze||Rn.circles.length>0&&!Rn.collisionDetected,Dn=Dn&&Rn.offscreen}if(xt.iconFeatureIndex&&(Ya=xt.iconFeatureIndex),xt.iconBox){const wr=Sr=>this.collisionIndex.placeCollisionBox(Sr,Fe,W,M,z,ct,Ye,T,ye.predicate,Dt,vt&&Dr?Dr:void 0);Qn&&Qn.placeable&&xt.verticalIconBox?(Wn=wr(xt.verticalIconBox),Yi=Wn.placeable):(Wn=wr(xt.iconBox),Yi=Wn.placeable),Dn=Dn&&Wn.offscreen}const xr=xe||gt.numHorizontalGlyphVertices===0&&gt.numVerticalGlyphVertices===0,Qa=Ie||gt.numIconVertices===0;xr||Qa?Qa?xr||(Yi=Yi&&di):di=Yi&&di:Yi=di=Yi&&di;const bu=Yi&&Wn.placeable;if(di&&Gn.placeable&&this.collisionIndex.insertCollisionBox(Gn.box,ue,_.get("text-ignore-placement"),d.bucketInstanceId,Qn&&Qn.placeable&&yo?yo:Jr,ye.ID),bu&&this.collisionIndex.insertCollisionBox(Wn.box,Fe,_.get("icon-ignore-placement"),d.bucketInstanceId,Ya,ye.ID),Rn&&di&&this.collisionIndex.insertCollisionCircles(Rn.circles,ue,_.get("text-ignore-placement"),d.bucketInstanceId,Jr,ye.ID),f&&this.storeCollisionData(d.bucketInstanceId,$t,xt,Gn,Wn,Rn),gt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[gt.crossTileID]=new Be(di||mt,Yi||pt,Dn||d.justReloaded),l[gt.crossTileID]=!0};if(kt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const gt=d.getSortedSymbolIndexes(this.transform.angle);for(let xt=gt.length-1;xt>=0;--xt){const $t=gt[xt];ti(d.symbolInstances.get($t),d.collisionArrays[$t],$t)}}else for(let gt=e.symbolInstanceStart;gt<e.symbolInstanceEnd;gt++)ti(d.symbolInstances.get(gt),d.collisionArrays[gt],gt);if(f&&d.bucketInstanceId in this.collisionCircleArrays){const gt=this.collisionCircleArrays[d.bucketInstanceId];u.as(gt.invProjMatrix,M),gt.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}storeCollisionData(e,l,f,d,_,S){if(f.textBox||f.iconBox){let T,M;this.collisionBoxArrays.has(e)?T=this.collisionBoxArrays.get(e):(T=new Map,this.collisionBoxArrays.set(e,T)),T.has(l)?M=T.get(l):(M={text:null,icon:null},T.set(l,M)),f.textBox&&(M.text=d.box),f.iconBox&&(M.icon=_.box)}if(S){let T=this.collisionCircleArrays[e];T===void 0&&(T=this.collisionCircleArrays[e]=new Yt);for(let M=0;M<S.circles.length;M+=4)T.circles.push(S.circles[M+0]),T.circles.push(S.circles[M+1]),T.circles.push(S.circles[M+2]),T.circles.push(S.collisionDetected?1:0)}}markUsedJustification(e,l,f,d){let _;_=d===u.ah.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[u.at(l)];const S=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const T of S)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=_>=0&&T!==_?0:f.crossTileID)}markUsedOrientation(e,l,f){const d=l===u.ah.horizontal||l===u.ah.horizontalOnly?l:0,_=l===u.ah.vertical?l:0,S=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const T of S)e.text.placedSymbolArray.get(T).placedOrientation=d;f.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const d=l?l.symbolFadeChange(e):1,_=l?l.opacities:{},S=l?l.variableOffsets:{},T=l?l.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],F=_[M];F?(this.opacities[M]=new en(F,d,z.text,z.icon),f=f||z.text!==F.text.placed||z.icon!==F.icon.placed):(this.opacities[M]=new en(null,d,z.text,z.icon,z.skipFade),f=f||z.text||z.icon)}for(const M in _){const z=_[M];if(!this.opacities[M]){const F=new en(z,d,!1,!1);F.isHidden()||(this.opacities[M]=F,f=f||z.text.placed||z.icon.placed)}}for(const M in S)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=S[M]);for(const M in T)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=T[M]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:e)}updateLayerOpacities(e,l){const f={};for(const d of l){const _=d.getBucket(e);_&&d.latestFeatureIndex&&e.id===_.layerIds[0]&&this.updateBucketOpacities(_,d.tileID,f,d.collisionBoxArray)}}updateBucketOpacities(e,l,f,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const _=e.layers[0],S=_.layout,T=new en(null,0,!1,!1,!0),M=S.get("text-allow-overlap"),z=S.get("icon-allow-overlap"),F=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),O=S.get("text-rotation-alignment")==="map",W=S.get("text-pitch-alignment")==="map",Y=S.get("icon-text-fit")!=="none",re=new en(null,0,M&&(z||!e.hasIconData()||S.get("icon-optional")),z&&(M||!e.hasTextData()||S.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const he=(xe,Ie,ue)=>{for(let ze=0;ze<Ie/4;ze++)xe.opacityVertexArray.emplaceBack(ue);xe.hasVisibleVertices=xe.hasVisibleVertices||ue!==Er},ye=this.collisionBoxArrays.get(e.bucketInstanceId);for(let xe=0;xe<e.symbolInstances.length;xe++){const Ie=e.symbolInstances.get(xe),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:ze,crossTileID:Fe}=Ie;let Ze=this.opacities[Fe];f[Fe]?Ze=T:Ze||(Ze=re,this.opacities[Fe]=Ze),f[Fe]=!0;const Ye=Ie.numIconVertices>0,ct=this.placedOrientations[Ie.crossTileID],vt=ct===u.ah.vertical,kt=ct===u.ah.horizontal||ct===u.ah.horizontalOnly;if(ue>0||ze>0){const pt=Zn(Ze.text);he(e.text,ue,vt?Er:pt),he(e.text,ze,kt?Er:pt);const Dt=Ze.text.isHidden();[Ie.rightJustifiedTextSymbolIndex,Ie.centerJustifiedTextSymbolIndex,Ie.leftJustifiedTextSymbolIndex].forEach(xt=>{xt>=0&&(e.text.placedSymbolArray.get(xt).hidden=Dt||vt?1:0)}),Ie.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Ie.verticalPlacedTextSymbolIndex).hidden=Dt||kt?1:0);const ti=this.variableOffsets[Ie.crossTileID];ti&&this.markUsedJustification(e,ti.anchor,Ie,ct);const gt=this.placedOrientations[Ie.crossTileID];gt&&(this.markUsedJustification(e,"left",Ie,gt),this.markUsedOrientation(e,gt,Ie))}if(Ye){const pt=Zn(Ze.icon),Dt=!(Y&&Ie.verticalPlacedIconSymbolIndex&&vt);Ie.placedIconSymbolIndex>=0&&(he(e.icon,Ie.numIconVertices,Dt?pt:Er),e.icon.placedSymbolArray.get(Ie.placedIconSymbolIndex).hidden=Ze.icon.isHidden()),Ie.verticalPlacedIconSymbolIndex>=0&&(he(e.icon,Ie.numVerticalIconVertices,Dt?Er:pt),e.icon.placedSymbolArray.get(Ie.verticalPlacedIconSymbolIndex).hidden=Ze.icon.isHidden())}const mt=ye&&ye.has(xe)?ye.get(xe):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const pt=e.collisionArrays[xe];if(pt){let Dt=new u.P(0,0);if(pt.textBox||pt.verticalTextBox){let ti=!0;if(F){const gt=this.variableOffsets[Fe];gt?(Dt=zi(gt.anchor,gt.width,gt.height,gt.textOffset,gt.textBoxScale),O&&Dt._rotate(W?this.transform.angle:-this.transform.angle)):ti=!1}if(pt.textBox||pt.verticalTextBox){let gt;pt.textBox&&(gt=vt),pt.verticalTextBox&&(gt=kt),qn(e.textCollisionBox.collisionVertexArray,Ze.text.placed,!ti||gt,mt.text,Dt.x,Dt.y)}}if(pt.iconBox||pt.verticalIconBox){const ti=!!(!kt&&pt.verticalIconBox);let gt;pt.iconBox&&(gt=ti),pt.verticalIconBox&&(gt=!ti),qn(e.iconCollisionBox.collisionVertexArray,Ze.icon.placed,gt,mt.icon,Y?Dt.x:0,Y?Dt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=xe.invProjMatrix,e.placementViewportMatrix=xe.viewportMatrix,e.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>e}setStale(){this.stale=!0}}function qn(y,e,l,f,d,_){f&&f.length!==0||(f=[0,0,0,0]);const S=f[0]-ni,T=f[1]-ni,M=f[2]-ni,z=f[3]-ni;y.emplaceBack(e?1:0,l?1:0,d||0,_||0,S,T),y.emplaceBack(e?1:0,l?1:0,d||0,_||0,M,T),y.emplaceBack(e?1:0,l?1:0,d||0,_||0,M,z),y.emplaceBack(e?1:0,l?1:0,d||0,_||0,S,z)}const qt=Math.pow(2,25),rs=Math.pow(2,24),An=Math.pow(2,17),En=Math.pow(2,16),nn=Math.pow(2,9),va=Math.pow(2,8),kn=Math.pow(2,1);function Zn(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const e=y.placed?1:0,l=Math.floor(127*y.opacity);return l*qt+e*rs+l*An+e*En+l*nn+e*va+l*kn+e}const Er=0;function ur(){return{isOccluded:(y,e,l)=>!1,getPitchedTextCorrection:(y,e,l)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(y,e,l,f){throw new Error("Not implemented.")},translatePosition:(y,e,l,f)=>function(d,_,S,T,M=!1){if(!S[0]&&!S[1])return[0,0];const z=M?T==="map"?d.angle:0:T==="viewport"?-d.angle:0;if(z){const F=Math.sin(z),O=Math.cos(z);S=[S[0]*O-S[1]*F,S[0]*F+S[1]*O]}return[M?S[0]:li(_,S[0],d.zoom),M?S[1]:li(_,S[1],d.zoom)]}(y,e,l,f),getCircleRadiusCorrection:y=>1}}class bi{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,l,f,d,_){const S=this._bucketParts;for(;this._currentTileIndex<e.length;)if(l.getBucketParts(S,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((T,M)=>T.sortKey-M.sortKey));this._currentPartIndex<S.length;)if(l.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,_())return!0;return!1}}class Bo{constructor(e,l,f,d,_,S,T,M){this.placement=new Xi(e,ur(),l,S,T,M),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(e,l,f){const d=C.now(),_=()=>!this._forceFullPlacement&&C.now()-d>2;for(;this._currentPlacementIndex>=0;){const S=l[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=T)&&(!S.maxzoom||S.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new bi(S)),this._inProgressLayer.continuePlacement(f[S.source],this.placement,this._showCollisionBoxes,S,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Mr=512/u.X/2;class gn{constructor(e,l,f){this.tileID=e,this.bucketInstanceId=f,this._symbolsByKey={};const d=new Map;for(let _=0;_<l.length;_++){const S=l.get(_),T=S.key,M=d.get(T);M?M.push(S):d.set(T,[S])}for(const[_,S]of d){const T={positions:S.map(M=>({x:Math.floor(M.anchorX*Mr),y:Math.floor(M.anchorY*Mr)})),crossTileIDs:S.map(M=>M.crossTileID)};if(T.positions.length>128){const M=new u.av(T.positions.length,16,Uint16Array);for(const{x:z,y:F}of T.positions)M.add(z,F);M.finish(),delete T.positions,T.index=M}this._symbolsByKey[_]=T}}getScaledCoordinates(e,l){const{x:f,y:d,z:_}=this.tileID.canonical,{x:S,y:T,z:M}=l.canonical,z=Mr/Math.pow(2,M-_),F=(T*u.X+e.anchorY)*z,O=d*u.X*Mr;return{x:Math.floor((S*u.X+e.anchorX)*z-f*u.X*Mr),y:Math.floor(F-O)}}findMatches(e,l,f){const d=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let _=0;_<e.length;_++){const S=e.get(_);if(S.crossTileID)continue;const T=this._symbolsByKey[S.key];if(!T)continue;const M=this.getScaledCoordinates(S,l);if(T.index){const z=T.index.range(M.x-d,M.y-d,M.x+d,M.y+d).sort();for(const F of z){const O=T.crossTileIDs[F];if(!f[O]){f[O]=!0,S.crossTileID=O;break}}}else if(T.positions)for(let z=0;z<T.positions.length;z++){const F=T.positions[z],O=T.crossTileIDs[z];if(Math.abs(F.x-M.x)<=d&&Math.abs(F.y-M.y)<=d&&!f[O]){f[O]=!0,S.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ba{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Lr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const l=Math.round((e-this.lng)/360);if(l!==0)for(const f in this.indexes){const d=this.indexes[f],_={};for(const S in d){const T=d[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+l),_[T.tileID.key]=T}this.indexes[f]=_}this.lng=e}addBucket(e,l,f){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let _=0;_<l.symbolInstances.length;_++)l.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const _ in this.indexes){const S=this.indexes[_];if(Number(_)>e.overscaledZ)for(const T in S){const M=S[T];M.tileID.isChildOf(e)&&M.findMatches(l.symbolInstances,e,d)}else{const T=S[e.scaledTo(Number(_)).key];T&&T.findMatches(l.symbolInstances,e,d)}}for(let _=0;_<l.symbolInstances.length;_++){const S=l.symbolInstances.get(_);S.crossTileID||(S.crossTileID=f.generate(),d[S.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new gn(e,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(e,l){for(const f of l.getCrossTileIDsLists())for(const d of f)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let l=!1;for(const f in this.indexes){const d=this.indexes[f];for(const _ in d)e[d[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,d[_]),delete d[_],l=!0)}return l}}class zl{constructor(){this.layerIndexes={},this.crossTileIDs=new ba,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,l,f){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new Lr);let _=!1;const S={};d.handleWrapJump(f);for(const T of l){const M=T.getBucket(e);M&&e.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(T.tileID,M,this.crossTileIDs)&&(_=!0),S[M.bucketInstanceId]=!0)}return d.removeStaleBuckets(S)&&(_=!0),_}pruneUnusedLayers(e){const l={};e.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}const Pr=(y,e)=>u.t(y,e&&e.filter(l=>l.identifier!=="source.canvas")),Nh=u.aw();class xa extends u.E{constructor(e,l={}){super(),this._rtlPluginLoaded=()=>{for(const f in this.sourceCaches){const d=this.sourceCaches[f].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[f].reload()}},this.map=e,this.dispatcher=new Zi(Di(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(f,d)=>this.getGlyphs(f,d)),this.dispatcher.registerMessageHandler("GI",(f,d)=>this.getImages(f,d)),this.imageManager=new ee,this.imageManager.setEventedParent(this),this.glyphManager=new Ce(e._requestManager,l.localIdeographFontFamily),this.lineAtlas=new ut(256,512),this.crossTileSymbolIndex=new zl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.ay()),Un().on(ot,this._rtlPluginLoaded),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const d=this.sourceCaches[f.sourceId];if(!d)return;const _=d.getSource();if(_&&_.vectorLayerIds)for(const S in this._layers){const T=this._layers[S];T.source===_.id&&this._validateLayer(T)}})}loadURL(e,l={},f){this.fire(new u.k("dataloading",{dataType:"style"})),l.validate=typeof l.validate!="boolean"||l.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;u.h(d,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,l,f)}).catch(S=>{this._loadStyleRequest=null,S&&!_.signal.aborted&&this.fire(new u.j(S))})}loadJSON(e,l={},f){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,l.validate=l.validate!==!1,this._load(e,l,f)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(Nh,{validate:!1})}_load(e,l,f){var d;const _=l.transformStyle?l.transformStyle(f,e):e;if(!l.validate||!Pr(this,u.u(_))){this._loaded=!0,this.stylesheet=_;for(const S in _.sources)this.addSource(S,_.sources[S],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new nt(this.stylesheet.light),this.sky=new at(this.stylesheet.sky),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const e=u.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(l=>l.id),this._layers={},this._serializedLayers=null;for(const l of e){const f=u.aA(l);f.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=f}}_loadSprite(e,l=!1,f=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,S,T,M){return u._(this,void 0,void 0,function*(){const z=Z(_),F=T>1?"@2x":"",O={},W={};for(const{id:Y,url:re}of z){const he=S.transformRequest(Q(re,F,".json"),"SpriteJSON");O[Y]=u.h(he,M);const ye=S.transformRequest(Q(re,F,".png"),"SpriteImage");W[Y]=Te.getImage(ye,M)}return yield Promise.all([...Object.values(O),...Object.values(W)]),function(Y,re){return u._(this,void 0,void 0,function*(){const he={};for(const ye in Y){he[ye]={};const xe=C.getImageCanvasContext((yield re[ye]).data),Ie=(yield Y[ye]).data;for(const ue in Ie){const{width:ze,height:Fe,x:Ze,y:Ye,sdf:ct,pixelRatio:vt,stretchX:kt,stretchY:mt,content:pt,textFitWidth:Dt,textFitHeight:ti}=Ie[ue];he[ye][ue]={data:null,pixelRatio:vt,sdf:ct,stretchX:kt,stretchY:mt,content:pt,textFitWidth:Dt,textFitHeight:ti,spriteData:{width:ze,height:Fe,x:Ze,y:Ye,context:xe}}}}return he})}(O,W)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const S in _){this._spritesImagesIds[S]=[];const T=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(M=>!(M in _)):[];for(const M of T)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in _[S]){const z=S==="default"?M:`${S}:${M}`;this._spritesImagesIds[S].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,_[S][M],!1):this.imageManager.addImage(z,_[S][M]),l&&(this._changedImages[z]=!0)}}}).catch(_=>{this._spriteRequest=null,d=_,this.fire(new u.j(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),l&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),f&&f(d)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(e){const l=this.sourceCaches[e.source];if(!l)return;const f=e.sourceLayer;if(!f)return;const d=l.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(f)===-1)&&this.fire(new u.j(new Error(`Source layer "${f}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,l=!1){const f=this._serializedAllLayers();if(!e||e.length===0)return Object.values(l?u.aB(f):f);const d=[];for(const _ of e)if(f[_]){const S=l?u.aB(f[_]):f[_];d.push(S)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const l=Object.keys(this._layers);for(const f of l){const d=this._layers[f];d.type!=="custom"&&(e[f]=d.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const l=this._changed;if(l){const d=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(d.length||_.length)&&this._updateWorkerLayers(d,_);for(const S in this._updatedSources){const T=this._updatedSources[S];if(T==="reload")this._reloadSource(S);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const f={};for(const d in this.sourceCaches){const _=this.sourceCaches[d];f[d]=_.used,_.used=!1}for(const d of this._order){const _=this._layers[d];_.recalculate(e,this._availableImages),!_.isHidden(e.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const d in f){const _=this.sourceCaches[d];!!f[d]!=!!_.used&&_.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,l&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,l){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,l={}){var f;this._checkLoaded();const d=this.serialize();if(e=l.transformStyle?l.transformStyle(d,e):e,((f=l.validate)===null||f===void 0||f)&&Pr(this,u.u(e)))return!1;(e=u.aB(e)).layers=u.az(e.layers);const _=u.aC(d,e),S=this._getOperationsToPerform(_);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const T of S.operations)T();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const l=[],f=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":l.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":l.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":l.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":l.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":l.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":l.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":l.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":l.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":l.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":l.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":l.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":l.push(()=>this.setSprite.apply(this,d.args));break;case"setSky":l.push(()=>this.setSky.apply(this,d.args));break;case"setTerrain":l.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setTransition":l.push(()=>{});break;default:f.push(d.command)}return{operations:l,unimplemented:f}}addImage(e,l){if(this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,l),this._afterImageUpdated(e)}updateImage(e,l){this.imageManager.updateImage(e,l)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,l,f={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(u.u.source,`sources.${e}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const d=this.sourceCaches[e]=new Ht(e,l,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===e)return this.fire(new u.j(new Error(`Source "${e}" cannot be removed while layer "${f}" is using it.`)));const l=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],l.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,l){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const f=this.sourceCaches[e].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(l),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,l,f={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new u.j(new Error(`Layer "${d}" already exists on this map.`)));let _;if(e.type==="custom"){if(Pr(this,u.aD(e)))return;_=u.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=u.aB(e),e=u.e(e,{source:d})),this._validate(u.u.layer,`layers.${d}`,e,{arrayIndex:-1},f))return;_=u.aA(e),this._validateLayer(_),_.setEventedParent(this,{layer:{id:d}})}const S=l?this._order.indexOf(l):this._order.length;if(l&&S===-1)this.fire(new u.j(new Error(`Cannot add layer "${d}" before non-existing layer "${l}".`)));else{if(this._order.splice(S,0,d),this._layerOrderChanged=!0,this._layers[d]=_,this._removedLayers[d]&&_.source&&_.type!=="custom"){const T=this._removedLayers[d];delete this._removedLayers[d],T.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(e,l){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new u.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===l)return;const f=this._order.indexOf(e);this._order.splice(f,1);const d=l?this._order.indexOf(l):this._order.length;l&&d===-1?this.fire(new u.j(new Error(`Cannot move layer "${e}" before non-existing layer "${l}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const l=this._layers[e];if(!l)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${e}".`)));l.setEventedParent(null);const f=this._order.indexOf(e);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=l,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],l.onRemove&&l.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,l,f){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===l&&d.maxzoom===f||(l!=null&&(d.minzoom=l),f!=null&&(d.maxzoom=f),this._updateLayer(d)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,l,f={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!u.aE(d.filter,l))return l==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(u.u.filter,`layers.${d.id}.filter`,l,null,f)||(d.filter=u.aB(l),this._updateLayer(d)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return u.aB(this.getLayer(e).filter)}setLayoutProperty(e,l,f,d={}){this._checkLoaded();const _=this.getLayer(e);_?u.aE(_.getLayoutProperty(l),f)||(_.setLayoutProperty(l,f,d),this._updateLayer(_)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,l){const f=this.getLayer(e);if(f)return f.getLayoutProperty(l);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,l,f,d={}){this._checkLoaded();const _=this.getLayer(e);_?u.aE(_.getPaintProperty(l),f)||(_.setPaintProperty(l,f,d)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,l){return this.getLayer(e).getPaintProperty(l)}setFeatureState(e,l){this._checkLoaded();const f=e.source,d=e.sourceLayer,_=this.sourceCaches[f];if(_===void 0)return void this.fire(new u.j(new Error(`The source '${f}' does not exist in the map's style.`)));const S=_.getSource().type;S==="geojson"&&d?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||d?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(d,e.id,l)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,l){this._checkLoaded();const f=e.source,d=this.sourceCaches[f];if(d===void 0)return void this.fire(new u.j(new Error(`The source '${f}' does not exist in the map's style.`)));const _=d.getSource().type,S=_==="vector"?e.sourceLayer:void 0;_!=="vector"||S?l&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(S,e.id,l):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const l=e.source,f=e.sourceLayer,d=this.sourceCaches[l];if(d!==void 0)return d.getSource().type!=="vector"||f?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),d.getFeatureState(f,e.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=u.aF(this.sourceCaches,_=>_.serialize()),l=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,d=this.stylesheet;return u.aG({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,sources:e,layers:l,terrain:f},_=>_!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const l=S=>this._layers[S].type==="fill-extrusion",f={},d=[];for(let S=this._order.length-1;S>=0;S--){const T=this._order[S];if(l(T)){f[T]=S;for(const M of e){const z=M[T];if(z)for(const F of z)d.push(F)}}}d.sort((S,T)=>T.intersectionZ-S.intersectionZ);const _=[];for(let S=this._order.length-1;S>=0;S--){const T=this._order[S];if(l(T))for(let M=d.length-1;M>=0;M--){const z=d[M].feature;if(f[z.layer.id]<S)break;_.push(z),d.pop()}else for(const M of e){const z=M[T];if(z)for(const F of z)_.push(F.feature)}}return _}queryRenderedFeatures(e,l,f){l&&l.filter&&this._validate(u.u.filter,"queryRenderedFeatures.filter",l.filter,null,l);const d={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const T of l.layers){const M=this._layers[T];if(!M)return this.fire(new u.j(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];d[M.source]=!0}}const _=[];l.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const T in this.sourceCaches)l.layers&&!d[T]||_.push(Ne(this.sourceCaches[T],this._layers,S,e,l,f));return this.placement&&_.push(function(T,M,z,F,O,W,Y){const re={},he=W.queryRenderedSymbols(F),ye=[];for(const xe of Object.keys(he).map(Number))ye.push(Y[xe]);ye.sort(yt);for(const xe of ye){const Ie=xe.featureIndex.lookupSymbolFeatures(he[xe.bucketInstanceId],M,xe.bucketIndex,xe.sourceLayerIndex,O.filter,O.layers,O.availableImages,T);for(const ue in Ie){const ze=re[ue]=re[ue]||[],Fe=Ie[ue];Fe.sort((Ze,Ye)=>{const ct=xe.featureSortOrder;if(ct){const vt=ct.indexOf(Ze.featureIndex);return ct.indexOf(Ye.featureIndex)-vt}return Ye.featureIndex-Ze.featureIndex});for(const Ze of Fe)ze.push(Ze)}}for(const xe in re)re[xe].forEach(Ie=>{const ue=Ie.feature,ze=z[T[xe].source].getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=ze});return re}(this._layers,S,this.sourceCaches,e,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(e,l){l&&l.filter&&this._validate(u.u.filter,"querySourceFeatures.filter",l.filter,null,l);const f=this.sourceCaches[e];return f?function(d,_){const S=d.getRenderableIds().map(z=>d.getTileByID(z)),T=[],M={};for(let z=0;z<S.length;z++){const F=S[z],O=F.tileID.canonical.key;M[O]||(M[O]=!0,F.querySourceFeatures(T,_))}return T}(f,l):[]}getLight(){return this.light.getLight()}setLight(e,l={}){this._checkLoaded();const f=this.light.getLight();let d=!1;for(const S in e)if(!u.aE(e[S],f[S])){d=!0;break}if(!d)return;const _={now:C.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,l),this.light.updateTransitions(_)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,l={}){const f=this.getSky();let d=!1;if(!e&&!f)return;if(e&&!f)d=!0;else if(!e&&f)d=!0;else for(const S in e)if(!u.aE(e[S],f[S])){d=!0;break}if(!d)return;const _={now:C.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,l),this.sky.updateTransitions(_)}_validate(e,l,f,d,_={}){return(!_||_.validate!==!1)&&Pr(this,e.call(u.u,u.e({key:l,style:this.serialize(),value:f,styleSpec:u.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Un().off(ot,this._rtlPluginLoaded);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this.sourceCaches){const f=this.sourceCaches[l];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const l in this.sourceCaches)this.sourceCaches[l].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,l,f,d,_=!1){let S=!1,T=!1;const M={};for(const z of this._order){const F=this._layers[z];if(F.type!=="symbol")continue;if(!M[F.source]){const W=this.sourceCaches[F.source];M[F.source]=W.getRenderableIds(!0).map(Y=>W.getTileByID(Y)).sort((Y,re)=>re.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(re.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(F,M[F.source],e.center.lng);S=S||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(C.now(),e.zoom))&&(this.pauseablePlacement=new Bo(e,this.map.terrain,this._order,_,l,f,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(C.now()),T=!0),S&&this.pauseablePlacement.placement.setStale()),T||S)for(const z of this._order){const F=this._layers[z];F.type==="symbol"&&this.placement.updateLayerOpacities(F,M[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(C.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,l){return u._(this,void 0,void 0,function*(){const f=yield this.imageManager.getImages(l.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[l.source];return d&&d.setDependencies(l.tileID.key,l.type,l.icons),f})}getGlyphs(e,l){return u._(this,void 0,void 0,function*(){const f=yield this.glyphManager.getGlyphs(l.stacks),d=this.sourceCaches[l.source];return d&&d.setDependencies(l.tileID.key,l.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,l={}){this._checkLoaded(),e&&this._validate(u.u.glyphs,"glyphs",e,null,l)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,l,f={},d){this._checkLoaded();const _=[{id:e,url:l}],S=[...Z(this.stylesheet.sprite),..._];this._validate(u.u.sprite,"sprite",S,null,f)||(this.stylesheet.sprite=S,this._loadSprite(_,!0,d))}removeSprite(e){this._checkLoaded();const l=Z(this.stylesheet.sprite);if(l.find(f=>f.id===e)){if(this._spritesImagesIds[e])for(const f of this._spritesImagesIds[e])this.imageManager.removeImage(f),this._changedImages[f]=!0;l.splice(l.findIndex(f=>f.id===e),1),this.stylesheet.sprite=l.length>0?l:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Z(this.stylesheet.sprite)}setSprite(e,l={},f){this._checkLoaded(),e&&this._validate(u.u.sprite,"sprite",e,null,l)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,f):(this._unloadSprite(),f&&f(null)))}}var Is=u.Y([{name:"a_pos",type:"Int16",components:2}]);const ms={prelude:Li(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Li(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Li(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Li(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Li("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Li(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Li(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Li("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Li("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Li("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Li(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Li(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Li(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Li(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Li(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Li(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Li(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Li(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Li(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Li(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Li(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Li(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Li(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Li(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Li("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Li("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Li("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Li("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Li(y,e){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=e.match(/attribute ([\w]+) ([\w]+)/g),d=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=_?_.concat(d):d,T={};return{fragmentSource:y=y.replace(l,(M,z,F,O,W)=>(T[W]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${F} ${O} ${W};
#else
uniform ${F} ${O} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${F} ${O} ${W} = u_${W};
#endif
`)),vertexSource:e=e.replace(l,(M,z,F,O,W)=>{const Y=O==="float"?"vec2":"vec4",re=W.match(/color/)?"color":Y;return T[W]?z==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${F} ${Y} a_${W};
varying ${F} ${O} ${W};
#else
uniform ${F} ${O} u_${W};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${F} ${O} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${re}(a_${W}, u_${W}_t);
#else
    ${F} ${O} ${W} = u_${W};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${F} ${Y} a_${W};
#else
uniform ${F} ${O} u_${W};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${F} ${O} ${W} = a_${W};
#else
    ${F} ${O} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${F} ${O} ${W} = unpack_mix_${re}(a_${W}, u_${W}_t);
#else
    ${F} ${O} ${W} = u_${W};
#endif
`}),staticAttributes:f,staticUniforms:S}}class Dl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,l,f,d,_,S,T,M,z){this.context=e;let F=this.boundPaintVertexBuffers.length!==d.length;for(let O=0;!F&&O<d.length;O++)this.boundPaintVertexBuffers[O]!==d[O]&&(F=!0);!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==f||F||this.boundIndexBuffer!==_||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==z?this.freshBind(l,f,d,_,S,T,M,z):(e.bindVertexArray.set(this.vao),T&&T.bind(),_&&_.dynamicDraw&&_.bind(),M&&M.bind(),z&&z.bind())}freshBind(e,l,f,d,_,S,T,M){const z=e.numAttributes,F=this.context,O=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=d,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=M,l.enableAttributes(O,e);for(const W of f)W.enableAttributes(O,e);S&&S.enableAttributes(O,e),T&&T.enableAttributes(O,e),M&&M.enableAttributes(O,e),l.bind(),l.setVertexAttribPointers(O,e,_);for(const W of f)W.bind(),W.setVertexAttribPointers(O,e,_);S&&(S.bind(),S.setVertexAttribPointers(O,e,_)),d&&d.bind(),T&&(T.bind(),T.setVertexAttribPointers(O,e,_)),M&&(M.bind(),M.setVertexAttribPointers(O,e,_)),F.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Rl=(y,e,l,f,d)=>({u_matrix:y,u_texture:0,u_ele_delta:e,u_fog_matrix:l,u_fog_color:f?f.properties.get("fog-color"):u.aM.white,u_fog_ground_blend:f?f.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?f.calculateFogBlendOpacity(d):0,u_horizon_color:f?f.properties.get("horizon-color"):u.aM.white,u_horizon_fog_blend:f?f.properties.get("horizon-fog-blend"):1});function Qs(y){const e=[];for(let l=0;l<y.length;l++){if(y[l]===null)continue;const f=y[l].split(" ");e.push(f.pop())}return e}class Bl{constructor(e,l,f,d,_,S){const T=e.gl;this.program=T.createProgram();const M=Qs(l.staticAttributes),z=f?f.getBinderAttributes():[],F=M.concat(z),O=ms.prelude.staticUniforms?Qs(ms.prelude.staticUniforms):[],W=l.staticUniforms?Qs(l.staticUniforms):[],Y=f?f.getBinderUniforms():[],re=O.concat(W).concat(Y),he=[];for(const Ze of re)he.indexOf(Ze)<0&&he.push(Ze);const ye=f?f.defines():[];_&&ye.push("#define OVERDRAW_INSPECTOR;"),S&&ye.push("#define TERRAIN3D;");const xe=ye.concat(ms.prelude.fragmentSource,l.fragmentSource).join(`
`),Ie=ye.concat(ms.prelude.vertexSource,l.vertexSource).join(`
`),ue=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(ue,xe),T.compileShader(ue),!T.getShaderParameter(ue,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(ue)}`);T.attachShader(this.program,ue);const ze=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(ze,Ie),T.compileShader(ze),!T.getShaderParameter(ze,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(ze)}`);T.attachShader(this.program,ze),this.attributes={};const Fe={};this.numAttributes=F.length;for(let Ze=0;Ze<this.numAttributes;Ze++)F[Ze]&&(T.bindAttribLocation(this.program,Ze,F[Ze]),this.attributes[F[Ze]]=Ze);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(ze),T.deleteShader(ue);for(let Ze=0;Ze<he.length;Ze++){const Ye=he[Ze];if(Ye&&!Fe[Ye]){const ct=T.getUniformLocation(this.program,Ye);ct&&(Fe[Ye]=ct)}}this.fixedUniforms=d(e,Fe),this.terrainUniforms=((Ze,Ye)=>({u_depth:new u.aH(Ze,Ye.u_depth),u_terrain:new u.aH(Ze,Ye.u_terrain),u_terrain_dim:new u.aI(Ze,Ye.u_terrain_dim),u_terrain_matrix:new u.aJ(Ze,Ye.u_terrain_matrix),u_terrain_unpack:new u.aK(Ze,Ye.u_terrain_unpack),u_terrain_exaggeration:new u.aI(Ze,Ye.u_terrain_exaggeration)}))(e,Fe),this.binderUniforms=f?f.getUniforms(e,Fe):[]}draw(e,l,f,d,_,S,T,M,z,F,O,W,Y,re,he,ye,xe,Ie){const ue=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(f),e.setStencilMode(d),e.setColorMode(_),e.setCullFace(S),M){e.activeTexture.set(ue.TEXTURE2),ue.bindTexture(ue.TEXTURE_2D,M.depthTexture),e.activeTexture.set(ue.TEXTURE3),ue.bindTexture(ue.TEXTURE_2D,M.texture);for(const Fe in this.terrainUniforms)this.terrainUniforms[Fe].set(M[Fe])}for(const Fe in this.fixedUniforms)this.fixedUniforms[Fe].set(T[Fe]);he&&he.setUniforms(e,this.binderUniforms,Y,{zoom:re});let ze=0;switch(l){case ue.LINES:ze=2;break;case ue.TRIANGLES:ze=3;break;case ue.LINE_STRIP:ze=1}for(const Fe of W.get()){const Ze=Fe.vaos||(Fe.vaos={});(Ze[z]||(Ze[z]=new Dl)).bind(e,this,F,he?he.getPaintVertexBuffers():[],O,Fe.vertexOffset,ye,xe,Ie),ue.drawElements(l,Fe.primitiveLength*ze,ue.UNSIGNED_SHORT,Fe.primitiveOffset*ze*2)}}}function wa(y,e,l){const f=1/li(l,1,e.transform.tileZoom),d=Math.pow(2,l.tileID.overscaledZ),_=l.tileSize*Math.pow(2,e.transform.tileZoom)/d,S=_*(l.tileID.canonical.x+l.tileID.wrap*d),T=_*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[f,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T]}}const Fo=(y,e,l,f)=>{const d=e.style.light,_=d.properties.get("position"),S=[_.x,_.y,_.z],T=function(){var z=new u.A(9);return u.A!=Float32Array&&(z[1]=0,z[2]=0,z[3]=0,z[5]=0,z[6]=0,z[7]=0),z[0]=1,z[4]=1,z[8]=1,z}();d.properties.get("anchor")==="viewport"&&function(z,F){var O=Math.sin(F),W=Math.cos(F);z[0]=W,z[1]=O,z[2]=0,z[3]=-O,z[4]=W,z[5]=0,z[6]=0,z[7]=0,z[8]=1}(T,-e.transform.angle),function(z,F,O){var W=F[0],Y=F[1],re=F[2];z[0]=W*O[0]+Y*O[3]+re*O[6],z[1]=W*O[1]+Y*O[4]+re*O[7],z[2]=W*O[2]+Y*O[5]+re*O[8]}(S,S,T);const M=d.properties.get("color");return{u_matrix:y,u_lightpos:S,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+l,u_opacity:f}},Sa=(y,e,l,f,d,_,S)=>u.e(Fo(y,e,l,f),wa(_,e,S),{u_height_factor:-Math.pow(2,d.overscaledZ)/S.tileSize/8}),$s=y=>({u_matrix:y}),fc=(y,e,l,f)=>u.e($s(y),wa(l,e,f)),Vh=(y,e)=>({u_matrix:y,u_world:e}),dc=(y,e,l,f,d)=>u.e(fc(y,e,l,f),{u_world:d}),jh=(y,e,l,f)=>{const d=y.transform;let _,S;if(f.paint.get("circle-pitch-alignment")==="map"){const T=li(l,1,d.zoom);_=!0,S=[T,T]}else _=!1,S=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(e.posMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:S}},Es=(y,e,l)=>({u_matrix:y,u_inv_matrix:e,u_camera_to_center_distance:l.cameraToCenterDistance,u_viewport_size:[l.width,l.height]}),Oo=(y,e,l=1)=>({u_matrix:y,u_color:e,u_overlay:0,u_overlay_scale:l}),Jn=y=>({u_matrix:y}),Yn=(y,e,l,f)=>({u_matrix:y,u_extrude_scale:li(e,1,l),u_intensity:f}),ka=(y,e,l,f)=>{const d=u.H();u.aP(d,0,y.width,y.height,0,0,1);const _=y.context.gl;return{u_matrix:d,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:l,u_color_ramp:f,u_opacity:e.paint.get("heatmap-opacity")}};function Ta(y,e){const l=Math.pow(2,e.canonical.z),f=e.canonical.y;return[new u.Z(0,f/l).toLngLat().lat,new u.Z(0,(f+1)/l).toLngLat().lat]}const Ca=(y,e,l,f)=>{const d=y.transform;return{u_matrix:gc(y,e,l,f),u_ratio:1/li(e,1,d.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},pc=(y,e,l,f,d)=>u.e(Ca(y,e,l,d),{u_image:0,u_image_height:f}),eo=(y,e,l,f,d)=>{const _=y.transform,S=mc(e,_);return{u_matrix:gc(y,e,l,d),u_texsize:e.imageAtlasTexture.size,u_ratio:1/li(e,1,_.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[S,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Uh=(y,e,l,f,d,_)=>{const S=y.lineAtlas,T=mc(e,y.transform),M=l.layout.get("line-cap")==="round",z=S.getDash(f.from,M),F=S.getDash(f.to,M),O=z.width*d.fromScale,W=F.width*d.toScale;return u.e(Ca(y,e,l,_),{u_patternscale_a:[T/O,-z.height/2],u_patternscale_b:[T/W,-F.height/2],u_sdfgamma:S.width/(256*Math.min(O,W)*y.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:F.y,u_mix:d.t})};function mc(y,e){return 1/li(y,1,e.tileZoom)}function gc(y,e,l,f){return y.translatePosMatrix(f?f.posMatrix:e.tileID.posMatrix,e,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const qh=(y,e,l,f,d)=>{return{u_matrix:y,u_tl_parent:e,u_scale_parent:l,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(S=d.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(_=d.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Zh(d.paint.get("raster-hue-rotate"))};var _,S};function Zh(y){y*=Math.PI/180;const e=Math.sin(y),l=Math.cos(y);return[(2*l+1)/3,(-Math.sqrt(3)*e-l+1)/3,(Math.sqrt(3)*e-l+1)/3]}const _c=(y,e,l,f,d,_,S,T,M,z,F,O,W,Y)=>{const re=S.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_pitch:re.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:re.width/re.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:M,u_coord_matrix:z,u_is_text:+O,u_pitch_with_map:+f,u_is_along_line:d,u_is_variable_anchor:_,u_texsize:W,u_texture:0,u_translation:F,u_pitched_scale:Y}},No=(y,e,l,f,d,_,S,T,M,z,F,O,W,Y,re)=>{const he=S.transform;return u.e(_c(y,e,l,f,d,_,S,T,M,z,F,O,W,re),{u_gamma_scale:f?Math.cos(he._pitch)*he.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:1})},Fl=(y,e,l,f,d,_,S,T,M,z,F,O,W,Y)=>u.e(No(y,e,l,f,d,_,S,T,M,z,F,!0,O,!0,Y),{u_texsize_icon:W,u_texture_icon:1}),Ia=(y,e,l)=>({u_matrix:y,u_opacity:e,u_color:l}),Ol=(y,e,l,f,d,_)=>u.e(function(S,T,M,z){const F=M.imageManager.getPattern(S.from.toString()),O=M.imageManager.getPattern(S.to.toString()),{width:W,height:Y}=M.imageManager.getPixelSize(),re=Math.pow(2,z.tileID.overscaledZ),he=z.tileSize*Math.pow(2,M.transform.tileZoom)/re,ye=he*(z.tileID.canonical.x+z.tileID.wrap*re),xe=he*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[W,Y],u_mix:T.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/li(z,1,M.transform.tileZoom),u_pixel_coord_upper:[ye>>16,xe>>16],u_pixel_coord_lower:[65535&ye,65535&xe]}}(f,_,l,d),{u_matrix:y,u_opacity:e}),Nl={fillExtrusion:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_lightpos:new u.aN(y,e.u_lightpos),u_lightintensity:new u.aI(y,e.u_lightintensity),u_lightcolor:new u.aN(y,e.u_lightcolor),u_vertical_gradient:new u.aI(y,e.u_vertical_gradient),u_opacity:new u.aI(y,e.u_opacity)}),fillExtrusionPattern:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_lightpos:new u.aN(y,e.u_lightpos),u_lightintensity:new u.aI(y,e.u_lightintensity),u_lightcolor:new u.aN(y,e.u_lightcolor),u_vertical_gradient:new u.aI(y,e.u_vertical_gradient),u_height_factor:new u.aI(y,e.u_height_factor),u_image:new u.aH(y,e.u_image),u_texsize:new u.aO(y,e.u_texsize),u_pixel_coord_upper:new u.aO(y,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(y,e.u_pixel_coord_lower),u_scale:new u.aN(y,e.u_scale),u_fade:new u.aI(y,e.u_fade),u_opacity:new u.aI(y,e.u_opacity)}),fill:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix)}),fillPattern:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_image:new u.aH(y,e.u_image),u_texsize:new u.aO(y,e.u_texsize),u_pixel_coord_upper:new u.aO(y,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(y,e.u_pixel_coord_lower),u_scale:new u.aN(y,e.u_scale),u_fade:new u.aI(y,e.u_fade)}),fillOutline:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_world:new u.aO(y,e.u_world)}),fillOutlinePattern:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_world:new u.aO(y,e.u_world),u_image:new u.aH(y,e.u_image),u_texsize:new u.aO(y,e.u_texsize),u_pixel_coord_upper:new u.aO(y,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(y,e.u_pixel_coord_lower),u_scale:new u.aN(y,e.u_scale),u_fade:new u.aI(y,e.u_fade)}),circle:(y,e)=>({u_camera_to_center_distance:new u.aI(y,e.u_camera_to_center_distance),u_scale_with_map:new u.aH(y,e.u_scale_with_map),u_pitch_with_map:new u.aH(y,e.u_pitch_with_map),u_extrude_scale:new u.aO(y,e.u_extrude_scale),u_device_pixel_ratio:new u.aI(y,e.u_device_pixel_ratio),u_matrix:new u.aJ(y,e.u_matrix)}),collisionBox:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_pixel_extrude_scale:new u.aO(y,e.u_pixel_extrude_scale)}),collisionCircle:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_inv_matrix:new u.aJ(y,e.u_inv_matrix),u_camera_to_center_distance:new u.aI(y,e.u_camera_to_center_distance),u_viewport_size:new u.aO(y,e.u_viewport_size)}),debug:(y,e)=>({u_color:new u.aL(y,e.u_color),u_matrix:new u.aJ(y,e.u_matrix),u_overlay:new u.aH(y,e.u_overlay),u_overlay_scale:new u.aI(y,e.u_overlay_scale)}),clippingMask:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix)}),heatmap:(y,e)=>({u_extrude_scale:new u.aI(y,e.u_extrude_scale),u_intensity:new u.aI(y,e.u_intensity),u_matrix:new u.aJ(y,e.u_matrix)}),heatmapTexture:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_world:new u.aO(y,e.u_world),u_image:new u.aH(y,e.u_image),u_color_ramp:new u.aH(y,e.u_color_ramp),u_opacity:new u.aI(y,e.u_opacity)}),hillshade:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_image:new u.aH(y,e.u_image),u_latrange:new u.aO(y,e.u_latrange),u_light:new u.aO(y,e.u_light),u_shadow:new u.aL(y,e.u_shadow),u_highlight:new u.aL(y,e.u_highlight),u_accent:new u.aL(y,e.u_accent)}),hillshadePrepare:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_image:new u.aH(y,e.u_image),u_dimension:new u.aO(y,e.u_dimension),u_zoom:new u.aI(y,e.u_zoom),u_unpack:new u.aK(y,e.u_unpack)}),line:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_ratio:new u.aI(y,e.u_ratio),u_device_pixel_ratio:new u.aI(y,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(y,e.u_units_to_pixels)}),lineGradient:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_ratio:new u.aI(y,e.u_ratio),u_device_pixel_ratio:new u.aI(y,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(y,e.u_units_to_pixels),u_image:new u.aH(y,e.u_image),u_image_height:new u.aI(y,e.u_image_height)}),linePattern:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_texsize:new u.aO(y,e.u_texsize),u_ratio:new u.aI(y,e.u_ratio),u_device_pixel_ratio:new u.aI(y,e.u_device_pixel_ratio),u_image:new u.aH(y,e.u_image),u_units_to_pixels:new u.aO(y,e.u_units_to_pixels),u_scale:new u.aN(y,e.u_scale),u_fade:new u.aI(y,e.u_fade)}),lineSDF:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_ratio:new u.aI(y,e.u_ratio),u_device_pixel_ratio:new u.aI(y,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(y,e.u_units_to_pixels),u_patternscale_a:new u.aO(y,e.u_patternscale_a),u_patternscale_b:new u.aO(y,e.u_patternscale_b),u_sdfgamma:new u.aI(y,e.u_sdfgamma),u_image:new u.aH(y,e.u_image),u_tex_y_a:new u.aI(y,e.u_tex_y_a),u_tex_y_b:new u.aI(y,e.u_tex_y_b),u_mix:new u.aI(y,e.u_mix)}),raster:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_tl_parent:new u.aO(y,e.u_tl_parent),u_scale_parent:new u.aI(y,e.u_scale_parent),u_buffer_scale:new u.aI(y,e.u_buffer_scale),u_fade_t:new u.aI(y,e.u_fade_t),u_opacity:new u.aI(y,e.u_opacity),u_image0:new u.aH(y,e.u_image0),u_image1:new u.aH(y,e.u_image1),u_brightness_low:new u.aI(y,e.u_brightness_low),u_brightness_high:new u.aI(y,e.u_brightness_high),u_saturation_factor:new u.aI(y,e.u_saturation_factor),u_contrast_factor:new u.aI(y,e.u_contrast_factor),u_spin_weights:new u.aN(y,e.u_spin_weights)}),symbolIcon:(y,e)=>({u_is_size_zoom_constant:new u.aH(y,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(y,e.u_is_size_feature_constant),u_size_t:new u.aI(y,e.u_size_t),u_size:new u.aI(y,e.u_size),u_camera_to_center_distance:new u.aI(y,e.u_camera_to_center_distance),u_pitch:new u.aI(y,e.u_pitch),u_rotate_symbol:new u.aH(y,e.u_rotate_symbol),u_aspect_ratio:new u.aI(y,e.u_aspect_ratio),u_fade_change:new u.aI(y,e.u_fade_change),u_matrix:new u.aJ(y,e.u_matrix),u_label_plane_matrix:new u.aJ(y,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(y,e.u_coord_matrix),u_is_text:new u.aH(y,e.u_is_text),u_pitch_with_map:new u.aH(y,e.u_pitch_with_map),u_is_along_line:new u.aH(y,e.u_is_along_line),u_is_variable_anchor:new u.aH(y,e.u_is_variable_anchor),u_texsize:new u.aO(y,e.u_texsize),u_texture:new u.aH(y,e.u_texture),u_translation:new u.aO(y,e.u_translation),u_pitched_scale:new u.aI(y,e.u_pitched_scale)}),symbolSDF:(y,e)=>({u_is_size_zoom_constant:new u.aH(y,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(y,e.u_is_size_feature_constant),u_size_t:new u.aI(y,e.u_size_t),u_size:new u.aI(y,e.u_size),u_camera_to_center_distance:new u.aI(y,e.u_camera_to_center_distance),u_pitch:new u.aI(y,e.u_pitch),u_rotate_symbol:new u.aH(y,e.u_rotate_symbol),u_aspect_ratio:new u.aI(y,e.u_aspect_ratio),u_fade_change:new u.aI(y,e.u_fade_change),u_matrix:new u.aJ(y,e.u_matrix),u_label_plane_matrix:new u.aJ(y,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(y,e.u_coord_matrix),u_is_text:new u.aH(y,e.u_is_text),u_pitch_with_map:new u.aH(y,e.u_pitch_with_map),u_is_along_line:new u.aH(y,e.u_is_along_line),u_is_variable_anchor:new u.aH(y,e.u_is_variable_anchor),u_texsize:new u.aO(y,e.u_texsize),u_texture:new u.aH(y,e.u_texture),u_gamma_scale:new u.aI(y,e.u_gamma_scale),u_device_pixel_ratio:new u.aI(y,e.u_device_pixel_ratio),u_is_halo:new u.aH(y,e.u_is_halo),u_translation:new u.aO(y,e.u_translation),u_pitched_scale:new u.aI(y,e.u_pitched_scale)}),symbolTextAndIcon:(y,e)=>({u_is_size_zoom_constant:new u.aH(y,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(y,e.u_is_size_feature_constant),u_size_t:new u.aI(y,e.u_size_t),u_size:new u.aI(y,e.u_size),u_camera_to_center_distance:new u.aI(y,e.u_camera_to_center_distance),u_pitch:new u.aI(y,e.u_pitch),u_rotate_symbol:new u.aH(y,e.u_rotate_symbol),u_aspect_ratio:new u.aI(y,e.u_aspect_ratio),u_fade_change:new u.aI(y,e.u_fade_change),u_matrix:new u.aJ(y,e.u_matrix),u_label_plane_matrix:new u.aJ(y,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(y,e.u_coord_matrix),u_is_text:new u.aH(y,e.u_is_text),u_pitch_with_map:new u.aH(y,e.u_pitch_with_map),u_is_along_line:new u.aH(y,e.u_is_along_line),u_is_variable_anchor:new u.aH(y,e.u_is_variable_anchor),u_texsize:new u.aO(y,e.u_texsize),u_texsize_icon:new u.aO(y,e.u_texsize_icon),u_texture:new u.aH(y,e.u_texture),u_texture_icon:new u.aH(y,e.u_texture_icon),u_gamma_scale:new u.aI(y,e.u_gamma_scale),u_device_pixel_ratio:new u.aI(y,e.u_device_pixel_ratio),u_is_halo:new u.aH(y,e.u_is_halo),u_translation:new u.aO(y,e.u_translation),u_pitched_scale:new u.aI(y,e.u_pitched_scale)}),background:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_opacity:new u.aI(y,e.u_opacity),u_color:new u.aL(y,e.u_color)}),backgroundPattern:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_opacity:new u.aI(y,e.u_opacity),u_image:new u.aH(y,e.u_image),u_pattern_tl_a:new u.aO(y,e.u_pattern_tl_a),u_pattern_br_a:new u.aO(y,e.u_pattern_br_a),u_pattern_tl_b:new u.aO(y,e.u_pattern_tl_b),u_pattern_br_b:new u.aO(y,e.u_pattern_br_b),u_texsize:new u.aO(y,e.u_texsize),u_mix:new u.aI(y,e.u_mix),u_pattern_size_a:new u.aO(y,e.u_pattern_size_a),u_pattern_size_b:new u.aO(y,e.u_pattern_size_b),u_scale_a:new u.aI(y,e.u_scale_a),u_scale_b:new u.aI(y,e.u_scale_b),u_pixel_coord_upper:new u.aO(y,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(y,e.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aI(y,e.u_tile_units_to_pixels)}),terrain:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_texture:new u.aH(y,e.u_texture),u_ele_delta:new u.aI(y,e.u_ele_delta),u_fog_matrix:new u.aJ(y,e.u_fog_matrix),u_fog_color:new u.aL(y,e.u_fog_color),u_fog_ground_blend:new u.aI(y,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.aI(y,e.u_fog_ground_blend_opacity),u_horizon_color:new u.aL(y,e.u_horizon_color),u_horizon_fog_blend:new u.aI(y,e.u_horizon_fog_blend)}),terrainDepth:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_ele_delta:new u.aI(y,e.u_ele_delta)}),terrainCoords:(y,e)=>({u_matrix:new u.aJ(y,e.u_matrix),u_texture:new u.aH(y,e.u_texture),u_terrain_coords_id:new u.aI(y,e.u_terrain_coords_id),u_ele_delta:new u.aI(y,e.u_ele_delta)}),sky:(y,e)=>({u_sky_color:new u.aL(y,e.u_sky_color),u_horizon_color:new u.aL(y,e.u_horizon_color),u_horizon:new u.aI(y,e.u_horizon),u_sky_horizon_blend:new u.aI(y,e.u_sky_horizon_blend)})};class Hr{constructor(e,l,f){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Gh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vl{constructor(e,l,f,d){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=d,this.context=e;const _=e.gl;this.buffer=_.createBuffer(),e.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,l){for(let f=0;f<this.attributes.length;f++){const d=l.attributes[this.attributes[f].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,l,f){for(let d=0;d<this.attributes.length;d++){const _=this.attributes[d],S=l.attributes[_.name];S!==void 0&&e.vertexAttribPointer(S,_.components,e[Gh[_.type]],!1,this.itemSize,_.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ms=new WeakMap;function gs(y){var e;if(Ms.has(y))return Ms.get(y);{const l=(e=y.getParameter(y.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ms.set(y,l),l}}class Ai{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ea extends Ai{getDefault(){return u.aM.transparent}set(e){const l=this.current;(e.r!==l.r||e.g!==l.g||e.b!==l.b||e.a!==l.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Wh extends Ai{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class to extends Ai{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Hh extends Ai{getDefault(){return[!0,!0,!0,!0]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||e[2]!==l[2]||e[3]!==l[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class yc extends Ai{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Xh extends Ai{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class vc extends Ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const l=this.current;(e.func!==l.func||e.ref!==l.ref||e.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class jl extends Ai{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||e[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class bc extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;e?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=e,this.dirty=!1}}class xc extends Ai{getDefault(){return[0,1]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class wc extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;e?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=e,this.dirty=!1}}class Sc extends Ai{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ls extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;e?l.enable(l.BLEND):l.disable(l.BLEND),this.current=e,this.dirty=!1}}class kc extends Ai{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Kh extends Ai{getDefault(){return u.aM.transparent}set(e){const l=this.current;(e.r!==l.r||e.g!==l.g||e.b!==l.b||e.a!==l.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Tc extends Ai{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Vo extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;e?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=e,this.dirty=!1}}class Jh extends Ai{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ma extends Ai{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Yh extends Ai{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Qh extends Ai{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Cc extends Ai{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||e[2]!==l[2]||e[3]!==l[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ic extends Ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Ec extends Ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ul extends Ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Mc extends Ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class La extends Ai{getDefault(){return null}set(e){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ss extends Ai{getDefault(){return null}set(e){var l;if(e===this.current&&!this.dirty)return;const f=this.gl;gs(f)?f.bindVertexArray(e):(l=f.getExtension("OES_vertex_array_object"))===null||l===void 0||l.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ql extends Ai{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Zl extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Gl extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Pa extends Ai{constructor(e,l){super(e),this.context=e,this.parent=l}getDefault(){return null}}class Wl extends Pa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Ps extends Pa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Hl extends Pa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class $h{constructor(e,l,f,d,_){this.context=e,this.width=l,this.height=f;const S=e.gl,T=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Wl(e,T),d)this.depthAttachment=_?new Hl(e,T):new Ps(e,T);else if(_)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,l=this.colorAttachment.get();if(l&&e.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&e.deleteRenderbuffer(f)}e.deleteFramebuffer(this.framebuffer)}}class dn{constructor(e,l,f){this.blendFunction=e,this.blendColor=l,this.mask=f}}dn.Replace=[1,0],dn.disabled=new dn(dn.Replace,u.aM.transparent,[!1,!1,!1,!1]),dn.unblended=new dn(dn.Replace,u.aM.transparent,[!0,!0,!0,!0]),dn.alphaBlended=new dn([1,771],u.aM.transparent,[!0,!0,!0,!0]);class ef{constructor(e){var l,f;if(this.gl=e,this.clearColor=new Ea(this),this.clearDepth=new Wh(this),this.clearStencil=new to(this),this.colorMask=new Hh(this),this.depthMask=new yc(this),this.stencilMask=new Xh(this),this.stencilFunc=new vc(this),this.stencilOp=new jl(this),this.stencilTest=new bc(this),this.depthRange=new xc(this),this.depthTest=new wc(this),this.depthFunc=new Sc(this),this.blend=new Ls(this),this.blendFunc=new kc(this),this.blendColor=new Kh(this),this.blendEquation=new Tc(this),this.cullFace=new Vo(this),this.cullFaceSide=new Jh(this),this.frontFace=new Ma(this),this.program=new Yh(this),this.activeTexture=new Qh(this),this.viewport=new Cc(this),this.bindFramebuffer=new Ic(this),this.bindRenderbuffer=new Ec(this),this.bindTexture=new Ul(this),this.bindVertexBuffer=new Mc(this),this.bindElementBuffer=new La(this),this.bindVertexArray=new ss(this),this.pixelStoreUnpack=new ql(this),this.pixelStoreUnpackPremultiplyAlpha=new Zl(this),this.pixelStoreUnpackFlipY=new Gl(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),gs(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(l=e.RGBA16F)!==null&&l!==void 0?l:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(f=e.RGB16F)!==null&&f!==void 0?f:d==null?void 0:d.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,l){return new Hr(this,e,l)}createVertexBuffer(e,l,f){return new Vl(this,e,l,f)}createRenderbuffer(e,l,f){const d=this.gl,_=d.createRenderbuffer();return this.bindRenderbuffer.set(_),d.renderbufferStorage(d.RENDERBUFFER,e,l,f),this.bindRenderbuffer.set(null),_}createFramebuffer(e,l,f,d){return new $h(this,e,l,f,d)}clear({color:e,depth:l,stencil:f}){const d=this.gl;let _=0;e&&(_|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(_|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f!==void 0&&(_|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),d.clear(_)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){u.aE(e.blendFunction,dn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return gs(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var l;return gs(this.gl)?this.gl.deleteVertexArray(e):(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ui{constructor(e,l,f){this.func=e,this.mask=l,this.range=f}}ui.ReadOnly=!1,ui.ReadWrite=!0,ui.disabled=new ui(519,ui.ReadOnly,[0,1]);const Aa=7680;class Gi{constructor(e,l,f,d,_,S){this.test=e,this.ref=l,this.mask=f,this.fail=d,this.depthFail=_,this.pass=S}}Gi.disabled=new Gi({func:519,mask:0},0,0,Aa,Aa,Aa);class Fi{constructor(e,l,f){this.enable=e,this.mode=l,this.frontFace=f}}let As;function jo(y,e,l,f,d){const _=y.context,S=_.gl,T=y.useProgram("collisionBox"),M=[];let z=0,F=0;for(let xe=0;xe<f.length;xe++){const Ie=f[xe],ue=e.getTile(Ie).getBucket(l);if(!ue)continue;const ze=d?ue.textCollisionBox:ue.iconCollisionBox,Fe=ue.collisionCircleArray;if(Fe.length>0){const Ze=u.H();u.aQ(Ze,ue.placementInvProjMatrix,y.transform.glCoordMatrix),u.aQ(Ze,Ze,ue.placementViewportMatrix),M.push({circleArray:Fe,circleOffset:F,transform:Ie.posMatrix,invTransform:Ze,coord:Ie}),z+=Fe.length/4,F=z}ze&&T.draw(_,S.LINES,ui.disabled,Gi.disabled,y.colorModeForRenderPass(),Fi.disabled,{u_matrix:Ie.posMatrix,u_pixel_extrude_scale:[1/(O=y.transform).width,1/O.height]},y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ie),l.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,y.transform.zoom,null,null,ze.collisionVertexBuffer)}var O;if(!d||!M.length)return;const W=y.useProgram("collisionCircle"),Y=new u.aR;Y.resize(4*z),Y._trim();let re=0;for(const xe of M)for(let Ie=0;Ie<xe.circleArray.length/4;Ie++){const ue=4*Ie,ze=xe.circleArray[ue+0],Fe=xe.circleArray[ue+1],Ze=xe.circleArray[ue+2],Ye=xe.circleArray[ue+3];Y.emplace(re++,ze,Fe,Ze,Ye,0),Y.emplace(re++,ze,Fe,Ze,Ye,1),Y.emplace(re++,ze,Fe,Ze,Ye,2),Y.emplace(re++,ze,Fe,Ze,Ye,3)}(!As||As.length<2*z)&&(As=function(xe){const Ie=2*xe,ue=new u.aT;ue.resize(Ie),ue._trim();for(let ze=0;ze<Ie;ze++){const Fe=6*ze;ue.uint16[Fe+0]=4*ze+0,ue.uint16[Fe+1]=4*ze+1,ue.uint16[Fe+2]=4*ze+2,ue.uint16[Fe+3]=4*ze+2,ue.uint16[Fe+4]=4*ze+3,ue.uint16[Fe+5]=4*ze+0}return ue}(z));const he=_.createIndexBuffer(As,!0),ye=_.createVertexBuffer(Y,u.aS.members,!0);for(const xe of M){const Ie=Es(xe.transform,xe.invTransform,y.transform);W.draw(_,S.TRIANGLES,ui.disabled,Gi.disabled,y.colorModeForRenderPass(),Fi.disabled,Ie,y.style.map.terrain&&y.style.map.terrain.getTerrainData(xe.coord),l.id,ye,he,u.a0.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,y.transform.zoom,null,null,null)}ye.destroy(),he.destroy()}Fi.disabled=new Fi(!1,1029,2305),Fi.backCCW=new Fi(!0,1029,2305);const Uo=u.an(new Float32Array(16));function Xl(y,e,l,f,d,_){const{horizontalAlign:S,verticalAlign:T}=u.au(y);return new u.P((-(S-.5)*e/d+f[0])*_,(-(T-.5)*l/d+f[1])*_)}function zs(y,e,l,f,d,_){const S=e.tileAnchorPoint.add(new u.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let T=f.mult(_);l||(T=T.rotate(-d));const M=S.add(T);return de(M.x,M.y,e.labelPlaneMatrix,e.getElevation).point}if(l){const T=Ke(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(y),M=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return y.add(f.rotate(M))}return y.add(f)}function io(y,e,l,f,d,_,S,T,M,z,F,O,W,Y){const re=y.text.placedSymbolArray,he=y.text.dynamicLayoutVertexArray,ye=y.icon.dynamicLayoutVertexArray,xe={};he.clear();for(let Ie=0;Ie<re.length;Ie++){const ue=re.get(Ie),ze=ue.hidden||!ue.crossTileID||y.allowVerticalPlacement&&!ue.placedOrientation?null:f[ue.crossTileID];if(ze){const Fe=new u.P(ue.anchorX,ue.anchorY),Ze={getElevation:Y,width:d.width,height:d.height,labelPlaneMatrix:_,pitchWithMap:l,projection:F,tileAnchorPoint:Fe,translation:O,unwrappedTileID:W},Ye=l?de(Fe.x,Fe.y,S,Y):Ke(Fe.x,Fe.y,Ze),ct=j(d.cameraToCenterDistance,Ye.signedDistanceFromCamera);let vt=u.ai(y.textSizeData,M,ue)*ct/u.ap;l&&(vt*=y.tilePixelRatio/T);const{width:kt,height:mt,anchor:pt,textOffset:Dt,textBoxScale:ti}=ze,gt=Xl(pt,kt,mt,Dt,ti,vt),xt=F.getPitchedTextCorrection(d,Fe.add(new u.P(O[0],O[1])),W),$t=zs(Ye.point,Ze,e,gt,d.angle,xt),Ji=y.allowVerticalPlacement&&ue.placedOrientation===u.ah.vertical?Math.PI/2:0;for(let oi=0;oi<ue.numGlyphs;oi++)u.aj(he,$t,Ji);z&&ue.associatedIconIndex>=0&&(xe[ue.associatedIconIndex]={shiftedAnchor:$t,angle:Ji})}else jt(ue.numGlyphs,he)}if(z){ye.clear();const Ie=y.icon.placedSymbolArray;for(let ue=0;ue<Ie.length;ue++){const ze=Ie.get(ue);if(ze.hidden)jt(ze.numGlyphs,ye);else{const Fe=xe[ue];if(Fe)for(let Ze=0;Ze<ze.numGlyphs;Ze++)u.aj(ye,Fe.shiftedAnchor,Fe.angle);else jt(ze.numGlyphs,ye)}}y.icon.dynamicLayoutVertexBuffer.updateData(ye)}y.text.dynamicLayoutVertexBuffer.updateData(he)}function yr(y,e,l){return l.iconsInText&&e?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Kl(y,e,l,f,d,_,S,T,M,z,F,O){const W=y.context,Y=W.gl,re=y.transform,he=ur(),ye=T==="map",xe=M==="map",Ie=T!=="viewport"&&l.layout.get("symbol-placement")!=="point",ue=ye&&!xe&&!Ie,ze=!xe&&Ie,Fe=!l.layout.get("symbol-sort-key").isConstant();let Ze=!1;const Ye=y.depthModeForSublayer(0,ui.ReadOnly),ct=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),vt=[],kt=he.getCircleRadiusCorrection(re);for(const mt of f){const pt=e.getTile(mt),Dt=pt.getBucket(l);if(!Dt)continue;const ti=d?Dt.text:Dt.icon;if(!ti||!ti.segments.get().length||!ti.hasVisibleVertices)continue;const gt=ti.programConfigurations.get(l.id),xt=d||Dt.sdfIcons,$t=d?Dt.textSizeData:Dt.iconSizeData,Ji=xe||re.pitch!==0,oi=y.useProgram(yr(xt,d,Dt),gt),di=u.ag($t,re.zoom),Yi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(mt);let Dn,Dr,Qi,Qn,Gn=[0,0],Rn=null;if(d)Dr=pt.glyphAtlasTexture,Qi=Y.LINEAR,Dn=pt.glyphAtlasTexture.size,Dt.iconsInText&&(Gn=pt.imageAtlasTexture.size,Rn=pt.imageAtlasTexture,Qn=Ji||y.options.rotating||y.options.zooming||$t.kind==="composite"||$t.kind==="camera"?Y.LINEAR:Y.NEAREST);else{const mi=l.layout.get("icon-size").constantOr(0)!==1||Dt.iconsNeedLinear;Dr=pt.imageAtlasTexture,Qi=xt||y.options.rotating||y.options.zooming||mi||Ji?Y.LINEAR:Y.NEAREST,Dn=pt.imageAtlasTexture.size}const Wn=li(pt,1,y.transform.zoom),Jr=ze?mt.posMatrix:Uo,yo=gr(Jr,xe,ye,y.transform,Wn),Ya=_r(Jr,xe,ye,y.transform,Wn),vo=_r(mt.posMatrix,xe,ye,y.transform,Wn),xr=he.translatePosition(y.transform,pt,_,S),Qa=ct&&Dt.hasTextData(),bu=l.layout.get("icon-text-fit")!=="none"&&Qa&&Dt.hasIconData();if(Ie){const mi=y.style.map.terrain?(bo,xo)=>y.style.map.terrain.getElevation(mt,bo,xo):null,Os=l.layout.get("text-rotation-alignment")==="map";J(Dt,mt.posMatrix,y,d,yo,vo,xe,z,Os,he,mt.toUnwrapped(),re.width,re.height,xr,mi)}const wr=mt.posMatrix,Sr=d&&ct||bu,_s=Ie||Sr?Uo:yo,Rr=Ya,Mn=xt&&l.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Bn;Bn=xt?Dt.iconsInText?Fl($t.kind,di,ue,xe,Ie,Sr,y,wr,_s,Rr,xr,Dn,Gn,kt):No($t.kind,di,ue,xe,Ie,Sr,y,wr,_s,Rr,xr,d,Dn,!0,kt):_c($t.kind,di,ue,xe,Ie,Sr,y,wr,_s,Rr,xr,d,Dn,kt);const fr={program:oi,buffers:ti,uniformValues:Bn,atlasTexture:Dr,atlasTextureIcon:Rn,atlasInterpolation:Qi,atlasInterpolationIcon:Qn,isSDF:xt,hasHalo:Mn};if(Fe&&Dt.canOverlap){Ze=!0;const mi=ti.segments.get();for(const Os of mi)vt.push({segments:new u.a0([Os]),sortKey:Os.sortKey,state:fr,terrainData:Yi})}else vt.push({segments:ti.segments,sortKey:0,state:fr,terrainData:Yi})}Ze&&vt.sort((mt,pt)=>mt.sortKey-pt.sortKey);for(const mt of vt){const pt=mt.state;if(W.activeTexture.set(Y.TEXTURE0),pt.atlasTexture.bind(pt.atlasInterpolation,Y.CLAMP_TO_EDGE),pt.atlasTextureIcon&&(W.activeTexture.set(Y.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),pt.isSDF){const Dt=pt.uniformValues;pt.hasHalo&&(Dt.u_is_halo=1,Jl(pt.buffers,mt.segments,l,y,pt.program,Ye,F,O,Dt,mt.terrainData)),Dt.u_is_halo=0}Jl(pt.buffers,mt.segments,l,y,pt.program,Ye,F,O,pt.uniformValues,mt.terrainData)}}function Jl(y,e,l,f,d,_,S,T,M,z){const F=f.context;d.draw(F,F.gl.TRIANGLES,_,S,T,Fi.disabled,M,z,l.id,y.layoutVertexBuffer,y.indexBuffer,e,l.paint,f.transform.zoom,y.programConfigurations.get(l.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Yl(y,e,l,f){const d=y.context,_=d.gl,S=Gi.disabled,T=new dn([_.ONE,_.ONE],u.aM.transparent,[!0,!0,!0,!0]),M=e.getBucket(l);if(!M)return;const z=f.key;let F=l.heatmapFbos.get(z);F||(F=qo(d,e.tileSize,e.tileSize),l.heatmapFbos.set(z,F)),d.bindFramebuffer.set(F.framebuffer),d.viewport.set([0,0,e.tileSize,e.tileSize]),d.clear({color:u.aM.transparent});const O=M.programConfigurations.get(l.id),W=y.useProgram("heatmap",O),Y=y.style.map.terrain.getTerrainData(f);W.draw(d,_.TRIANGLES,ui.disabled,S,T,Fi.disabled,Yn(f.posMatrix,e,y.transform.zoom,l.paint.get("heatmap-intensity")),Y,l.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,l.paint,y.transform.zoom,O)}function Ds(y,e,l){const f=y.context,d=f.gl;f.setColorMode(y.colorModeForRenderPass());const _=Zo(f,e),S=l.key,T=e.heatmapFbos.get(S);T&&(f.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,T.colorAttachment.get()),f.activeTexture.set(d.TEXTURE1),_.bind(d.LINEAR,d.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(f,d.TRIANGLES,ui.disabled,Gi.disabled,y.colorModeForRenderPass(),Fi.disabled,ka(y,e,0,1),null,e.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments,e.paint,y.transform.zoom),T.destroy(),e.heatmapFbos.delete(S))}function qo(y,e,l){var f,d;const _=y.gl,S=_.createTexture();_.bindTexture(_.TEXTURE_2D,S),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const T=(f=y.HALF_FLOAT)!==null&&f!==void 0?f:_.UNSIGNED_BYTE,M=(d=y.RGBA16F)!==null&&d!==void 0?d:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,M,e,l,0,_.RGBA,T,null);const z=y.createFramebuffer(e,l,!1,!1);return z.colorAttachment.set(S),z}function Zo(y,e){return e.colorRampTexture||(e.colorRampTexture=new D(y,e.colorRamp,y.gl.RGBA)),e.colorRampTexture}function no(y,e,l,f,d){if(!l||!f||!f.imageAtlas)return;const _=f.imageAtlas.patternPositions;let S=_[l.to.toString()],T=_[l.from.toString()];if(!S&&T&&(S=T),!T&&S&&(T=S),!S||!T){const M=d.getPaintProperty(e);S=_[M],T=_[M]}S&&T&&y.setConstantPatternPositions(S,T)}function Go(y,e,l,f,d,_,S){const T=y.context.gl,M="fill-pattern",z=l.paint.get(M),F=z&&z.constantOr(1),O=l.getCrossfadeParameters();let W,Y,re,he,ye;S?(Y=F&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=T.LINES):(Y=F?"fillPattern":"fill",W=T.TRIANGLES);const xe=z.constantOr(null);for(const Ie of f){const ue=e.getTile(Ie);if(F&&!ue.patternsLoaded())continue;const ze=ue.getBucket(l);if(!ze)continue;const Fe=ze.programConfigurations.get(l.id),Ze=y.useProgram(Y,Fe),Ye=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ie);F&&(y.context.activeTexture.set(T.TEXTURE0),ue.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Fe.updatePaintBuffers(O)),no(Fe,M,xe,ue,l);const ct=Ye?Ie:null,vt=y.translatePosMatrix(ct?ct.posMatrix:Ie.posMatrix,ue,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(S){he=ze.indexBuffer2,ye=ze.segments2;const kt=[T.drawingBufferWidth,T.drawingBufferHeight];re=Y==="fillOutlinePattern"&&F?dc(vt,y,O,ue,kt):Vh(vt,kt)}else he=ze.indexBuffer,ye=ze.segments,re=F?fc(vt,y,O,ue):$s(vt);Ze.draw(y.context,W,d,y.stencilModeForClipping(Ie),_,Fi.disabled,re,Ye,l.id,ze.layoutVertexBuffer,he,ye,l.paint,y.transform.zoom,Fe)}}function za(y,e,l,f,d,_,S){const T=y.context,M=T.gl,z="fill-extrusion-pattern",F=l.paint.get(z),O=F.constantOr(1),W=l.getCrossfadeParameters(),Y=l.paint.get("fill-extrusion-opacity"),re=F.constantOr(null);for(const he of f){const ye=e.getTile(he),xe=ye.getBucket(l);if(!xe)continue;const Ie=y.style.map.terrain&&y.style.map.terrain.getTerrainData(he),ue=xe.programConfigurations.get(l.id),ze=y.useProgram(O?"fillExtrusionPattern":"fillExtrusion",ue);O&&(y.context.activeTexture.set(M.TEXTURE0),ye.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ue.updatePaintBuffers(W)),no(ue,z,re,ye,l);const Fe=y.translatePosMatrix(he.posMatrix,ye,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Ze=l.paint.get("fill-extrusion-vertical-gradient"),Ye=O?Sa(Fe,y,Ze,Y,he,W,ye):Fo(Fe,y,Ze,Y);ze.draw(T,T.gl.TRIANGLES,d,_,S,Fi.backCCW,Ye,Ie,l.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,l.paint,y.transform.zoom,ue,y.style.map.terrain&&xe.centroidVertexBuffer)}}function ro(y,e,l,f,d,_,S){const T=y.context,M=T.gl,z=l.fbo;if(!z)return;const F=y.useProgram("hillshade"),O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(e);T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,z.colorAttachment.get()),F.draw(T,M.TRIANGLES,d,_,S,Fi.disabled,((W,Y,re,he)=>{const ye=re.paint.get("hillshade-shadow-color"),xe=re.paint.get("hillshade-highlight-color"),Ie=re.paint.get("hillshade-accent-color");let ue=re.paint.get("hillshade-illumination-direction")*(Math.PI/180);re.paint.get("hillshade-illumination-anchor")==="viewport"&&(ue-=W.transform.angle);const ze=!W.options.moving;return{u_matrix:he?he.posMatrix:W.transform.calculatePosMatrix(Y.tileID.toUnwrapped(),ze),u_image:0,u_latrange:Ta(0,Y.tileID),u_light:[re.paint.get("hillshade-exaggeration"),ue],u_shadow:ye,u_highlight:xe,u_accent:Ie}})(y,l,f,O?e:null),O,f.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function so(y,e,l,f,d,_){const S=y.context,T=S.gl,M=e.dem;if(M&&M.data){const z=M.dim,F=M.stride,O=M.getPixels();if(S.activeTexture.set(T.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||y.getTileTexture(F),e.demTexture){const Y=e.demTexture;Y.update(O,{premultiply:!1}),Y.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else e.demTexture=new D(S,O,T.RGBA,{premultiply:!1}),e.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);S.activeTexture.set(T.TEXTURE0);let W=e.fbo;if(!W){const Y=new D(S,{width:z,height:z,data:null},T.RGBA);Y.bind(T.LINEAR,T.CLAMP_TO_EDGE),W=e.fbo=S.createFramebuffer(z,z,!0,!1),W.colorAttachment.set(Y.texture)}S.bindFramebuffer.set(W.framebuffer),S.viewport.set([0,0,z,z]),y.useProgram("hillshadePrepare").draw(S,T.TRIANGLES,f,d,_,Fi.disabled,((Y,re)=>{const he=re.stride,ye=u.H();return u.aP(ye,0,u.X,-u.X,0,0,1),u.J(ye,ye,[0,-u.X,0]),{u_matrix:ye,u_image:1,u_dimension:[he,he],u_zoom:Y.overscaledZ,u_unpack:re.getUnpackVector()}})(e.tileID,M),null,l.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Lc(y,e,l,f,d,_){const S=f.paint.get("raster-fade-duration");if(!_&&S>0){const T=C.now(),M=(T-y.timeAdded)/S,z=e?(T-e.timeAdded)/S:-1,F=l.getSource(),O=d.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),W=!e||Math.abs(e.tileID.overscaledZ-O)>Math.abs(y.tileID.overscaledZ-O),Y=W&&y.refreshedUponExpiration?1:u.ac(W?M:1-z,0,1);return y.refreshedUponExpiration&&M>=1&&(y.refreshedUponExpiration=!1),e?{opacity:1,mix:1-Y}:{opacity:Y,mix:0}}return{opacity:1,mix:0}}const Ql=new u.aM(1,0,0,1),Ci=new u.aM(0,1,0,1),Da=new u.aM(0,0,1,1),tf=new u.aM(1,0,1,1),Pc=new u.aM(0,1,1,1);function oo(y,e,l,f){Ra(y,0,e+l/2,y.transform.width,l,f)}function Ac(y,e,l,f){Ra(y,e-l/2,0,l,y.transform.height,f)}function Ra(y,e,l,f,d,_){const S=y.context,T=S.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*y.pixelRatio,l*y.pixelRatio,f*y.pixelRatio,d*y.pixelRatio),S.clear({color:_}),T.disable(T.SCISSOR_TEST)}function zc(y,e,l){const f=y.context,d=f.gl,_=l.posMatrix,S=y.useProgram("debug"),T=ui.disabled,M=Gi.disabled,z=y.colorModeForRenderPass(),F="$debug",O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(l);f.activeTexture.set(d.TEXTURE0);const W=e.getTileByID(l.key).latestRawTileData,Y=Math.floor((W&&W.byteLength||0)/1024),re=e.getTile(l).tileSize,he=512/Math.min(re,512)*(l.overscaledZ/y.transform.zoom)*.5;let ye=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ye+=` => ${l.overscaledZ}`),function(xe,Ie){xe.initDebugOverlayCanvas();const ue=xe.debugOverlayCanvas,ze=xe.context.gl,Fe=xe.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,ue.width,ue.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(Ie,5,5),Fe.strokeText(Ie,5,5),xe.debugOverlayTexture.update(ue),xe.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(y,`${ye} ${Y}kB`),S.draw(f,d.TRIANGLES,T,M,dn.alphaBlended,Fi.disabled,Oo(_,u.aM.transparent,he),null,F,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),S.draw(f,d.LINE_STRIP,T,M,z,Fi.disabled,Oo(_,u.aM.red),O,F,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Dc(y,e,l){const f=y.context,d=f.gl,_=y.colorModeForRenderPass(),S=new ui(d.LEQUAL,ui.ReadWrite,y.depthRangeFor3D),T=y.useProgram("terrain"),M=e.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,y.width,y.height]);for(const z of l){const F=y.renderToTexture.getTexture(z),O=e.getTerrainData(z.tileID);f.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,F.texture);const W=y.transform.calculatePosMatrix(z.tileID.toUnwrapped()),Y=e.getMeshFrameDelta(y.transform.zoom),re=y.transform.calculateFogMatrix(z.tileID.toUnwrapped()),he=Rl(W,Y,re,y.style.sky,y.transform.pitch);T.draw(f,d.TRIANGLES,S,Gi.disabled,_,Fi.backCCW,he,O,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class Ba{constructor(e,l,f){this.vertexBuffer=e,this.indexBuffer=l,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Fa{constructor(e,l){this.context=new ef(e),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ht.maxUnderzooming+Ht.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zl}resize(e,l,f){if(this.width=Math.floor(e*f),this.height=Math.floor(l*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,l=new u.aX;l.emplaceBack(0,0),l.emplaceBack(u.X,0),l.emplaceBack(0,u.X),l.emplaceBack(u.X,u.X),this.tileExtentBuffer=e.createVertexBuffer(l,Is.members),this.tileExtentSegments=u.a0.simpleSegment(0,0,4,2);const f=new u.aX;f.emplaceBack(0,0),f.emplaceBack(u.X,0),f.emplaceBack(0,u.X),f.emplaceBack(u.X,u.X),this.debugBuffer=e.createVertexBuffer(f,Is.members),this.debugSegments=u.a0.simpleSegment(0,0,4,5);const d=new u.$;d.emplaceBack(0,0,0,0),d.emplaceBack(u.X,0,u.X,0),d.emplaceBack(0,u.X,0,u.X),d.emplaceBack(u.X,u.X,u.X,u.X),this.rasterBoundsBuffer=e.createVertexBuffer(d,jn.members),this.rasterBoundsSegments=u.a0.simpleSegment(0,0,4,2);const _=new u.aX;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(_,Is.members),this.viewportSegments=u.a0.simpleSegment(0,0,4,2);const S=new u.aZ;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);const T=new u.aY;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const M=this.context.gl;this.stencilClearMode=new Gi({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const e=this.context,l=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=u.H();u.aP(f,0,this.width,this.height,0,0,1),u.K(f,f,[l.drawingBufferWidth,l.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,l.TRIANGLES,ui.disabled,this.stencilClearMode,dn.disabled,Fi.disabled,Jn(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!l||!l.length)return;this.currentStencilSource=e.source;const f=this.context,d=f.gl;this.nextStencilID+l.length>256&&this.clearStencil(),f.setColorMode(dn.disabled),f.setDepthMode(ui.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of l){const T=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);_.draw(f,d.TRIANGLES,ui.disabled,new Gi({func:d.ALWAYS,mask:0},T,255,d.KEEP,d.KEEP,d.REPLACE),dn.disabled,Fi.disabled,Jn(S.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,l=this.context.gl;return new Gi({func:l.NOTEQUAL,mask:255},e,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(e){const l=this.context.gl;return new Gi({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(e){const l=this.context.gl,f=e.sort((S,T)=>T.overscaledZ-S.overscaledZ),d=f[f.length-1].overscaledZ,_=f[0].overscaledZ-d+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const S={};for(let T=0;T<_;T++)S[T+d]=new Gi({func:l.GEQUAL,mask:255},T+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=_,[S,f]}return[{[d]:Gi.disabled},f]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new dn([e.CONSTANT_COLOR,e.ONE],new u.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?dn.unblended:dn.alphaBlended}depthModeForSublayer(e,l,f){if(!this.opaquePassEnabledForLayer())return ui.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ui(f||this.context.gl.LEQUAL,l,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,l){this.style=e,this.options=l,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(C.now()),this.imageManager.beginFrame();const f=this.style._order,d=this.style.sourceCaches,_={},S={},T={};for(const M in d){const z=d[M];z.used&&z.prepare(this.context),_[M]=z.getVisibleCoordinates(),S[M]=_[M].slice().reverse(),T[M]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<f.length;M++)if(this.style._layers[f[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of f){const z=this.style._layers[M];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const F=S[z.source];(z.type==="custom"||F.length)&&this.renderLayer(this,d[z.source],z,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?u.aM.black:u.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(M,z){const F=M.context,O=F.gl,W=((xe,Ie,ue)=>({u_sky_color:xe.properties.get("sky-color"),u_horizon_color:xe.properties.get("horizon-color"),u_horizon:(Ie.height/2+Ie.getHorizon())*ue,u_sky_horizon_blend:xe.properties.get("sky-horizon-blend")*Ie.height/2*ue}))(z,M.style.map.transform,M.pixelRatio),Y=new ui(O.LEQUAL,ui.ReadWrite,[0,1]),re=Gi.disabled,he=M.colorModeForRenderPass(),ye=M.useProgram("sky");if(!z.mesh){const xe=new u.aX;xe.emplaceBack(-1,-1),xe.emplaceBack(1,-1),xe.emplaceBack(1,1),xe.emplaceBack(-1,1);const Ie=new u.aY;Ie.emplaceBack(0,1,2),Ie.emplaceBack(0,2,3),z.mesh=new Ba(F.createVertexBuffer(xe,Is.members),F.createIndexBuffer(Ie),u.a0.simpleSegment(0,0,xe.length,Ie.length))}ye.draw(F,O.TRIANGLES,Y,re,he,Fi.disabled,W,void 0,"sky",z.mesh.vertexBuffer,z.mesh.indexBuffer,z.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[f[this.currentLayer]],z=d[M.source],F=_[M.source];this._renderTileClippingMasks(M,F),this.renderLayer(this,z,M,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const M=this.style._layers[f[this.currentLayer]],z=d[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const F=(M.type==="symbol"?T:S)[M.source];this._renderTileClippingMasks(M,_[M.source]),this.renderLayer(this,z,M,F)}if(this.options.showTileBoundaries){const M=function(z,F){let O=null;const W=Object.values(z._layers).flatMap(ye=>ye.source&&!ye.isHidden(F)?[z.sourceCaches[ye.source]]:[]),Y=W.filter(ye=>ye.getSource().type==="vector"),re=W.filter(ye=>ye.getSource().type!=="vector"),he=ye=>{(!O||O.getSource().maxzoom<ye.getSource().maxzoom)&&(O=ye)};return Y.forEach(ye=>he(ye)),O||re.forEach(ye=>he(ye)),O}(this.style,this.transform.zoom);M&&function(z,F,O){for(let W=0;W<O.length;W++)zc(z,F,O[W])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const z=M.transform.padding;oo(M,M.transform.height-(z.top||0),3,Ql),oo(M,z.bottom||0,3,Ci),Ac(M,z.left||0,3,Da),Ac(M,M.transform.width-(z.right||0),3,tf);const F=M.transform.centerPoint;(function(O,W,Y,re){Ra(O,W-1,Y-10,2,20,re),Ra(O,W-10,Y-1,20,2,re)})(M,F.x,M.transform.height-F.y,Pc)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const l=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!u.a_(l,f):!u.a$(l,f)),d||(d=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),d&&(u.b0(l,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,S){const T=_.context,M=T.gl,z=dn.unblended,F=new ui(M.LEQUAL,ui.ReadWrite,[0,1]),O=S.getTerrainMesh(),W=S.sourceCache.getRenderableTiles(),Y=_.useProgram("terrainDepth");T.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),T.clear({color:u.aM.transparent,depth:1});for(const re of W){const he=S.getTerrainData(re.tileID),ye={u_matrix:_.transform.calculatePosMatrix(re.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};Y.draw(T,M.TRIANGLES,F,Gi.disabled,z,Fi.backCCW,ye,he,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,S){const T=_.context,M=T.gl,z=dn.unblended,F=new ui(M.LEQUAL,ui.ReadWrite,[0,1]),O=S.getTerrainMesh(),W=S.getCoordsTexture(),Y=S.sourceCache.getRenderableTiles(),re=_.useProgram("terrainCoords");T.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),T.clear({color:u.aM.transparent,depth:1}),S.coordsIndex=[];for(const he of Y){const ye=S.getTerrainData(he.tileID);T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,W.texture);const xe={u_matrix:_.transform.calculatePosMatrix(he.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};re.draw(T,M.TRIANGLES,F,Gi.disabled,z,Fi.backCCW,xe,ye,"terrain",O.vertexBuffer,O.indexBuffer,O.segments),S.coordsIndex.push(he.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(e,l,f,d){if(!f.isHidden(this.transform.zoom)&&(f.type==="background"||f.type==="custom"||(d||[]).length))switch(this.id=f.id,f.type){case"symbol":(function(_,S,T,M,z){if(_.renderPass!=="translucent")return;const F=Gi.disabled,O=_.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(W,Y,re,he,ye,xe,Ie,ue,ze){const Fe=Y.transform,Ze=ur(),Ye=ye==="map",ct=xe==="map";for(const vt of W){const kt=he.getTile(vt),mt=kt.getBucket(re);if(!mt||!mt.text||!mt.text.segments.get().length)continue;const pt=u.ag(mt.textSizeData,Fe.zoom),Dt=li(kt,1,Y.transform.zoom),ti=gr(vt.posMatrix,ct,Ye,Y.transform,Dt),gt=re.layout.get("icon-text-fit")!=="none"&&mt.hasIconData();if(pt){const xt=Math.pow(2,Fe.zoom-kt.tileID.overscaledZ),$t=Y.style.map.terrain?(oi,di)=>Y.style.map.terrain.getElevation(vt,oi,di):null,Ji=Ze.translatePosition(Fe,kt,Ie,ue);io(mt,Ye,ct,ze,Fe,ti,vt.posMatrix,xt,pt,gt,Ze,Ji,vt.toUnwrapped(),$t)}}}(M,_,T,S,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),z),T.paint.get("icon-opacity").constantOr(1)!==0&&Kl(_,S,T,M,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),F,O),T.paint.get("text-opacity").constantOr(1)!==0&&Kl(_,S,T,M,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),F,O),S.map.showCollisionBoxes&&(jo(_,S,T,M,!0),jo(_,S,T,M,!1))})(e,l,f,d,this.style.placement.variableOffsets);break;case"circle":(function(_,S,T,M){if(_.renderPass!=="translucent")return;const z=T.paint.get("circle-opacity"),F=T.paint.get("circle-stroke-width"),O=T.paint.get("circle-stroke-opacity"),W=!T.layout.get("circle-sort-key").isConstant();if(z.constantOr(1)===0&&(F.constantOr(1)===0||O.constantOr(1)===0))return;const Y=_.context,re=Y.gl,he=_.depthModeForSublayer(0,ui.ReadOnly),ye=Gi.disabled,xe=_.colorModeForRenderPass(),Ie=[];for(let ue=0;ue<M.length;ue++){const ze=M[ue],Fe=S.getTile(ze),Ze=Fe.getBucket(T);if(!Ze)continue;const Ye=Ze.programConfigurations.get(T.id),ct=_.useProgram("circle",Ye),vt=Ze.layoutVertexBuffer,kt=Ze.indexBuffer,mt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ze),pt={programConfiguration:Ye,program:ct,layoutVertexBuffer:vt,indexBuffer:kt,uniformValues:jh(_,ze,Fe,T),terrainData:mt};if(W){const Dt=Ze.segments.get();for(const ti of Dt)Ie.push({segments:new u.a0([ti]),sortKey:ti.sortKey,state:pt})}else Ie.push({segments:Ze.segments,sortKey:0,state:pt})}W&&Ie.sort((ue,ze)=>ue.sortKey-ze.sortKey);for(const ue of Ie){const{programConfiguration:ze,program:Fe,layoutVertexBuffer:Ze,indexBuffer:Ye,uniformValues:ct,terrainData:vt}=ue.state;Fe.draw(Y,re.TRIANGLES,he,ye,xe,Fi.disabled,ct,vt,T.id,Ze,Ye,ue.segments,T.paint,_.transform.zoom,ze)}})(e,l,f,d);break;case"heatmap":(function(_,S,T,M){if(T.paint.get("heatmap-opacity")===0)return;const z=_.context;if(_.style.map.terrain){for(const F of M){const O=S.getTile(F);S.hasRenderableParent(F)||(_.renderPass==="offscreen"?Yl(_,O,T,F):_.renderPass==="translucent"&&Ds(_,T,F))}z.viewport.set([0,0,_.width,_.height])}else _.renderPass==="offscreen"?function(F,O,W,Y){const re=F.context,he=re.gl,ye=Gi.disabled,xe=new dn([he.ONE,he.ONE],u.aM.transparent,[!0,!0,!0,!0]);(function(Ie,ue,ze){const Fe=Ie.gl;Ie.activeTexture.set(Fe.TEXTURE1),Ie.viewport.set([0,0,ue.width/4,ue.height/4]);let Ze=ze.heatmapFbos.get(u.aU);Ze?(Fe.bindTexture(Fe.TEXTURE_2D,Ze.colorAttachment.get()),Ie.bindFramebuffer.set(Ze.framebuffer)):(Ze=qo(Ie,ue.width/4,ue.height/4),ze.heatmapFbos.set(u.aU,Ze))})(re,F,W),re.clear({color:u.aM.transparent});for(let Ie=0;Ie<Y.length;Ie++){const ue=Y[Ie];if(O.hasRenderableParent(ue))continue;const ze=O.getTile(ue),Fe=ze.getBucket(W);if(!Fe)continue;const Ze=Fe.programConfigurations.get(W.id),Ye=F.useProgram("heatmap",Ze),{zoom:ct}=F.transform;Ye.draw(re,he.TRIANGLES,ui.disabled,ye,xe,Fi.disabled,Yn(ue.posMatrix,ze,ct,W.paint.get("heatmap-intensity")),null,W.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,W.paint,F.transform.zoom,Ze)}re.viewport.set([0,0,F.width,F.height])}(_,S,T,M):_.renderPass==="translucent"&&function(F,O){const W=F.context,Y=W.gl;W.setColorMode(F.colorModeForRenderPass());const re=O.heatmapFbos.get(u.aU);re&&(W.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,re.colorAttachment.get()),W.activeTexture.set(Y.TEXTURE1),Zo(W,O).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(W,Y.TRIANGLES,ui.disabled,Gi.disabled,F.colorModeForRenderPass(),Fi.disabled,ka(F,O,0,1),null,O.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,O.paint,F.transform.zoom))}(_,T)})(e,l,f,d);break;case"line":(function(_,S,T,M){if(_.renderPass!=="translucent")return;const z=T.paint.get("line-opacity"),F=T.paint.get("line-width");if(z.constantOr(1)===0||F.constantOr(1)===0)return;const O=_.depthModeForSublayer(0,ui.ReadOnly),W=_.colorModeForRenderPass(),Y=T.paint.get("line-dasharray"),re=T.paint.get("line-pattern"),he=re.constantOr(1),ye=T.paint.get("line-gradient"),xe=T.getCrossfadeParameters(),Ie=he?"linePattern":Y?"lineSDF":ye?"lineGradient":"line",ue=_.context,ze=ue.gl;let Fe=!0;for(const Ze of M){const Ye=S.getTile(Ze);if(he&&!Ye.patternsLoaded())continue;const ct=Ye.getBucket(T);if(!ct)continue;const vt=ct.programConfigurations.get(T.id),kt=_.context.program.get(),mt=_.useProgram(Ie,vt),pt=Fe||mt.program!==kt,Dt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ze),ti=re.constantOr(null);if(ti&&Ye.imageAtlas){const $t=Ye.imageAtlas,Ji=$t.patternPositions[ti.to.toString()],oi=$t.patternPositions[ti.from.toString()];Ji&&oi&&vt.setConstantPatternPositions(Ji,oi)}const gt=Dt?Ze:null,xt=he?eo(_,Ye,T,xe,gt):Y?Uh(_,Ye,T,Y,xe,gt):ye?pc(_,Ye,T,ct.lineClipsArray.length,gt):Ca(_,Ye,T,gt);if(he)ue.activeTexture.set(ze.TEXTURE0),Ye.imageAtlasTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),vt.updatePaintBuffers(xe);else if(Y&&(pt||_.lineAtlas.dirty))ue.activeTexture.set(ze.TEXTURE0),_.lineAtlas.bind(ue);else if(ye){const $t=ct.gradients[T.id];let Ji=$t.texture;if(T.gradientVersion!==$t.version){let oi=256;if(T.stepInterpolant){const di=S.getSource().maxzoom,Yi=Ze.canonical.z===di?Math.ceil(1<<_.transform.maxZoom-Ze.canonical.z):1;oi=u.ac(u.aV(ct.maxLineLength/u.X*1024*Yi),256,ue.maxTextureSize)}$t.gradient=u.aW({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:oi,image:$t.gradient||void 0,clips:ct.lineClipsArray}),$t.texture?$t.texture.update($t.gradient):$t.texture=new D(ue,$t.gradient,ze.RGBA),$t.version=T.gradientVersion,Ji=$t.texture}ue.activeTexture.set(ze.TEXTURE0),Ji.bind(T.stepInterpolant?ze.NEAREST:ze.LINEAR,ze.CLAMP_TO_EDGE)}mt.draw(ue,ze.TRIANGLES,O,_.stencilModeForClipping(Ze),W,Fi.disabled,xt,Dt,T.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,T.paint,_.transform.zoom,vt,ct.layoutVertexBuffer2),Fe=!1}})(e,l,f,d);break;case"fill":(function(_,S,T,M){const z=T.paint.get("fill-color"),F=T.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const O=_.colorModeForRenderPass(),W=T.paint.get("fill-pattern"),Y=_.opaquePassEnabledForLayer()&&!W.constantOr(1)&&z.constantOr(u.aM.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===Y){const re=_.depthModeForSublayer(1,_.renderPass==="opaque"?ui.ReadWrite:ui.ReadOnly);Go(_,S,T,M,re,O,!1)}if(_.renderPass==="translucent"&&T.paint.get("fill-antialias")){const re=_.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,ui.ReadOnly);Go(_,S,T,M,re,O,!0)}})(e,l,f,d);break;case"fill-extrusion":(function(_,S,T,M){const z=T.paint.get("fill-extrusion-opacity");if(z!==0&&_.renderPass==="translucent"){const F=new ui(_.context.gl.LEQUAL,ui.ReadWrite,_.depthRangeFor3D);if(z!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))za(_,S,T,M,F,Gi.disabled,dn.disabled),za(_,S,T,M,F,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const O=_.colorModeForRenderPass();za(_,S,T,M,F,Gi.disabled,O)}}})(e,l,f,d);break;case"hillshade":(function(_,S,T,M){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const z=_.context,F=_.depthModeForSublayer(0,ui.ReadOnly),O=_.colorModeForRenderPass(),[W,Y]=_.renderPass==="translucent"?_.stencilConfigForOverlap(M):[{},M];for(const re of Y){const he=S.getTile(re);he.needsHillshadePrepare!==void 0&&he.needsHillshadePrepare&&_.renderPass==="offscreen"?so(_,he,T,F,Gi.disabled,O):_.renderPass==="translucent"&&ro(_,re,he,T,F,W[re.overscaledZ],O)}z.viewport.set([0,0,_.width,_.height])})(e,l,f,d);break;case"raster":(function(_,S,T,M){if(_.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!M.length)return;const z=_.context,F=z.gl,O=S.getSource(),W=_.useProgram("raster"),Y=_.colorModeForRenderPass(),[re,he]=O instanceof Ir?[{},M]:_.stencilConfigForOverlap(M),ye=he[he.length-1].overscaledZ,xe=!_.options.moving;for(const Ie of he){const ue=_.depthModeForSublayer(Ie.overscaledZ-ye,T.paint.get("raster-opacity")===1?ui.ReadWrite:ui.ReadOnly,F.LESS),ze=S.getTile(Ie);ze.registerFadeDuration(T.paint.get("raster-fade-duration"));const Fe=S.findLoadedParent(Ie,0),Ze=S.findLoadedSibling(Ie),Ye=Lc(ze,Fe||Ze||null,S,T,_.transform,_.style.map.terrain);let ct,vt;const kt=T.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;z.activeTexture.set(F.TEXTURE0),ze.texture.bind(kt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),z.activeTexture.set(F.TEXTURE1),Fe?(Fe.texture.bind(kt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),ct=Math.pow(2,Fe.tileID.overscaledZ-ze.tileID.overscaledZ),vt=[ze.tileID.canonical.x*ct%1,ze.tileID.canonical.y*ct%1]):ze.texture.bind(kt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),ze.texture.useMipmap&&z.extTextureFilterAnisotropic&&_.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const mt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ie),pt=mt?Ie:null,Dt=pt?pt.posMatrix:_.transform.calculatePosMatrix(Ie.toUnwrapped(),xe),ti=qh(Dt,vt||[0,0],ct||1,Ye,T);O instanceof Ir?W.draw(z,F.TRIANGLES,ue,Gi.disabled,Y,Fi.disabled,ti,mt,T.id,O.boundsBuffer,_.quadTriangleIndexBuffer,O.boundsSegments):W.draw(z,F.TRIANGLES,ue,re[Ie.overscaledZ],Y,Fi.disabled,ti,mt,T.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(e,l,f,d);break;case"background":(function(_,S,T,M){const z=T.paint.get("background-color"),F=T.paint.get("background-opacity");if(F===0)return;const O=_.context,W=O.gl,Y=_.transform,re=Y.tileSize,he=T.paint.get("background-pattern");if(_.isPatternMissing(he))return;const ye=!he&&z.a===1&&F===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==ye)return;const xe=Gi.disabled,Ie=_.depthModeForSublayer(0,ye==="opaque"?ui.ReadWrite:ui.ReadOnly),ue=_.colorModeForRenderPass(),ze=_.useProgram(he?"backgroundPattern":"background"),Fe=M||Y.coveringTiles({tileSize:re,terrain:_.style.map.terrain});he&&(O.activeTexture.set(W.TEXTURE0),_.imageManager.bind(_.context));const Ze=T.getCrossfadeParameters();for(const Ye of Fe){const ct=M?Ye.posMatrix:_.transform.calculatePosMatrix(Ye.toUnwrapped()),vt=he?Ol(ct,F,_,he,{tileID:Ye,tileSize:re},Ze):Ia(ct,F,z),kt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ye);ze.draw(O,W.TRIANGLES,Ie,xe,ue,Fi.disabled,vt,kt,T.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(e,0,f,d);break;case"custom":(function(_,S,T){const M=_.context,z=T.implementation;if(_.renderPass==="offscreen"){const F=z.prerender;F&&(_.setCustomLayerDefaults(),M.setColorMode(_.colorModeForRenderPass()),F.call(z,M.gl,_.transform.customLayerMatrix()),M.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),M.setColorMode(_.colorModeForRenderPass()),M.setStencilMode(Gi.disabled);const F=z.renderingMode==="3d"?new ui(_.context.gl.LEQUAL,ui.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,ui.ReadOnly);M.setDepthMode(F),z.render(M.gl,_.transform.customLayerMatrix(),{farZ:_.transform.farZ,nearZ:_.transform.nearZ,fov:_.transform._fov,modelViewProjectionMatrix:_.transform.modelViewProjectionMatrix,projectionMatrix:_.transform.projectionMatrix}),M.setDirty(),_.setBaseState(),M.bindFramebuffer.set(null)}})(e,0,f)}}translatePosMatrix(e,l,f,d,_){if(!f[0]&&!f[1])return e;const S=_?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(S){const z=Math.sin(S),F=Math.cos(S);f=[f[0]*F-f[1]*z,f[0]*z+f[1]*F]}const T=[_?f[0]:li(l,f[0],this.transform.zoom),_?f[1]:li(l,f[1],this.transform.zoom),0],M=new Float32Array(16);return u.J(M,e,T),M}saveTileTexture(e){const l=this._tileTextures[e.size[0]];l?l.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const l=this._tileTextures[e];return l&&l.length>0?l.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const l=this.imageManager.getPattern(e.from.toString()),f=this.imageManager.getPattern(e.to.toString());return!l||!f}useProgram(e,l){this.cache=this.cache||{};const f=e+(l?l.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new Bl(this.context,ms[e],l,Nl[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new D(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:l}=this.context.gl;return this.width!==e||this.height!==l}}class ao{constructor(e,l){this.points=e,this.planes=l}static fromInvProjectionMatrix(e,l,f){const d=Math.pow(2,f),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const M=1/(T=u.af([],T,e))[3]/l*d;return u.b1(T,T,[M,M,1/T[3],M])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const M=function(W,Y){var re=Y[0],he=Y[1],ye=Y[2],xe=re*re+he*he+ye*ye;return xe>0&&(xe=1/Math.sqrt(xe)),W[0]=Y[0]*xe,W[1]=Y[1]*xe,W[2]=Y[2]*xe,W}([],function(W,Y,re){var he=Y[0],ye=Y[1],xe=Y[2],Ie=re[0],ue=re[1],ze=re[2];return W[0]=ye*ze-xe*ue,W[1]=xe*Ie-he*ze,W[2]=he*ue-ye*Ie,W}([],Ae([],_[T[0]],_[T[1]]),Ae([],_[T[2]],_[T[1]]))),z=-((F=M)[0]*(O=_[T[1]])[0]+F[1]*O[1]+F[2]*O[2]);var F,O;return M.concat(z)});return new ao(_,S)}}class lo{constructor(e,l){this.min=e,this.max=l,this.center=function(f,d,_){return f[0]=.5*d[0],f[1]=.5*d[1],f[2]=.5*d[2],f}([],function(f,d,_){return f[0]=d[0]+_[0],f[1]=d[1]+_[1],f[2]=d[2]+_[2],f}([],this.min,this.max))}quadrant(e){const l=[e%2==0,e<2],f=ve(this.min),d=ve(this.max);for(let _=0;_<l.length;_++)f[_]=l[_]?this.min[_]:this.center[_],d[_]=l[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new lo(f,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let d=0;d<e.planes.length;d++){const _=e.planes[d];let S=0;for(let T=0;T<l.length;T++)u.b2(_,l[T])>=0&&S++;if(S===0)return 0;S!==l.length&&(f=!1)}if(f)return 2;for(let d=0;d<3;d++){let _=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let T=0;T<e.points.length;T++){const M=e.points[T][d]-this.min[d];_=Math.min(_,M),S=Math.max(S,M)}if(S<0||_>this.max[d]-this.min[d])return 0}return 1}}class uo{constructor(e=0,l=0,f=0,d=0){if(isNaN(e)||e<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=l,this.left=f,this.right=d}interpolate(e,l,f){return l.top!=null&&e.top!=null&&(this.top=u.y.number(e.top,l.top,f)),l.bottom!=null&&e.bottom!=null&&(this.bottom=u.y.number(e.bottom,l.bottom,f)),l.left!=null&&e.left!=null&&(this.left=u.y.number(e.left,l.left,f)),l.right!=null&&e.right!=null&&(this.right=u.y.number(e.right,l.right,f)),this}getCenter(e,l){const f=u.ac((this.left+e-this.right)/2,0,e),d=u.ac((this.top+l-this.bottom)/2,0,l);return new u.P(f,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new uo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const $l=85.051129;class co{constructor(e,l,f,d,_){this.tileSize=512,this._renderWorldCopies=_===void 0||!!_,this._minZoom=e||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new uo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new co(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const l=-u.b3(e,-180,180)*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=function(){var f=new u.A(4);return u.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,d,_){var S=d[0],T=d[1],M=d[2],z=d[3],F=Math.sin(_),O=Math.cos(_);f[0]=S*O+M*F,f[1]=T*O+z*F,f[2]=S*-F+M*O,f[3]=T*-F+z*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const l=u.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const l=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this.tileZoom=Math.max(0,Math.floor(l)),this.scale=this.zoomScale(l),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,l,f){this._unmodified=!1,this._edgeInsets.interpolate(e,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const l=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(e){const l=[new u.b4(0,e)];if(this._renderWorldCopies){const f=this.pointCoordinate(new u.P(0,0)),d=this.pointCoordinate(new u.P(this.width,0)),_=this.pointCoordinate(new u.P(this.width,this.height)),S=this.pointCoordinate(new u.P(0,this.height)),T=Math.floor(Math.min(f.x,d.x,_.x,S.x)),M=Math.floor(Math.max(f.x,d.x,_.x,S.x)),z=1;for(let F=T-z;F<=M+z;F++)F!==0&&l.push(new u.b4(F,e))}return l}coveringTiles(e){var l,f;let d=this.coveringZoomLevel(e);const _=d;if(e.minzoom!==void 0&&d<e.minzoom)return[];e.maxzoom!==void 0&&d>e.maxzoom&&(d=e.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),T=u.Z.fromLngLat(this.center),M=Math.pow(2,d),z=[M*S.x,M*S.y,0],F=[M*T.x,M*T.y,0],O=ao.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,d);let W=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(W=d);const Y=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,re=ue=>({aabb:new lo([ue*M,0,0],[(ue+1)*M,M,0]),zoom:0,x:0,y:0,wrap:ue,fullyVisible:!1}),he=[],ye=[],xe=d,Ie=e.reparseOverscaled?_:d;if(this._renderWorldCopies)for(let ue=1;ue<=3;ue++)he.push(re(-ue)),he.push(re(ue));for(he.push(re(0));he.length>0;){const ue=he.pop(),ze=ue.x,Fe=ue.y;let Ze=ue.fullyVisible;if(!Ze){const mt=ue.aabb.intersects(O);if(mt===0)continue;Ze=mt===2}const Ye=e.terrain?z:F,ct=ue.aabb.distanceX(Ye),vt=ue.aabb.distanceY(Ye),kt=Math.max(Math.abs(ct),Math.abs(vt));if(ue.zoom===xe||kt>Y+(1<<xe-ue.zoom)-2&&ue.zoom>=W){const mt=xe-ue.zoom,pt=z[0]-.5-(ze<<mt),Dt=z[1]-.5-(Fe<<mt);ye.push({tileID:new u.S(ue.zoom===xe?Ie:ue.zoom,ue.wrap,ue.zoom,ze,Fe),distanceSq:B([F[0]-.5-ze,F[1]-.5-Fe]),tileDistanceToCamera:Math.sqrt(pt*pt+Dt*Dt)})}else for(let mt=0;mt<4;mt++){const pt=(ze<<1)+mt%2,Dt=(Fe<<1)+(mt>>1),ti=ue.zoom+1;let gt=ue.aabb.quadrant(mt);if(e.terrain){const xt=new u.S(ti,ue.wrap,ti,pt,Dt),$t=e.terrain.getMinMaxElevation(xt),Ji=(l=$t.minElevation)!==null&&l!==void 0?l:this.elevation,oi=(f=$t.maxElevation)!==null&&f!==void 0?f:this.elevation;gt=new lo([gt.min[0],gt.min[1],Ji],[gt.max[0],gt.max[1],oi])}he.push({aabb:gt,zoom:ti,x:pt,y:Dt,wrap:ue.wrap,fullyVisible:Ze})}}return ye.sort((ue,ze)=>ue.distanceSq-ze.distanceSq).map(ue=>ue.tileID)}resize(e,l){this.width=e,this.height=l,this.pixelsToGLUnits=[2/e,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const l=u.ac(e.lat,-85.051129,$l);return new u.P(u.O(e.lng)*this.worldSize,u.Q(l)*this.worldSize)}unproject(e){return new u.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const l=this.elevation,f=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,d=this.pointLocation(this.centerPoint,e),_=e.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-_))return;const S=f+l-_,T=Math.cos(this._pitch)*this.cameraToCenterDistance/S/u.b5(1,d.lat),M=this.scaleZoom(T/this.tileSize);this._elevation=_,this._center=d,this.zoom=M}setLocationAtPoint(e,l){const f=this.pointCoordinate(l),d=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(e),S=new u.Z(_.x-(f.x-d.x),_.y-(f.y-d.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,l){return l?this.coordinatePoint(this.locationCoordinate(e),l.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,l){return this.coordinateLocation(this.pointCoordinate(e,l))}locationCoordinate(e){return u.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,l){if(l){const W=l.pointCoordinate(e);if(W!=null)return W}const f=[e.x,e.y,0,1],d=[e.x,e.y,1,1];u.af(f,f,this.pixelMatrixInverse),u.af(d,d,this.pixelMatrixInverse);const _=f[3],S=d[3],T=f[1]/_,M=d[1]/S,z=f[2]/_,F=d[2]/S,O=z===F?0:(0-z)/(F-z);return new u.Z(u.y.number(f[0]/_,d[0]/S,O)/this.worldSize,u.y.number(T,M,O)/this.worldSize)}coordinatePoint(e,l=0,f=this.pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,l,1];return u.af(d,d,f),new u.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new je().extend(this.pointLocation(new u.P(0,e))).extend(this.pointLocation(new u.P(this.width,e))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new je([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,$l])}calculateTileMatrix(e){const l=e.canonical,f=this.worldSize/this.zoomScale(l.z),d=l.x+Math.pow(2,l.z)*e.wrap,_=u.an(new Float64Array(16));return u.J(_,_,[d*f,l.y*f,0]),u.K(_,_,[f/u.X,f/u.X,1]),_}calculatePosMatrix(e,l=!1){const f=e.key,d=l?this._alignedPosMatrixCache:this._posMatrixCache;if(d[f])return d[f];const _=this.calculateTileMatrix(e);return u.L(_,l?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,_),d[f]=new Float32Array(_),d[f]}calculateFogMatrix(e){const l=e.key,f=this._fogMatrixCache;if(f[l])return f[l];const d=this.calculateTileMatrix(e);return u.L(d,this.fogMatrix,d),f[l]=new Float32Array(d),f[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,l){l=u.ac(+l,this.minZoom,this.maxZoom);const f={center:new u.N(e.lng,e.lat),zoom:l};let d=this.lngRange;if(!this._renderWorldCopies&&d===null){const ue=179.9999999999;d=[-ue,ue]}const _=this.tileSize*this.zoomScale(f.zoom);let S=0,T=_,M=0,z=_,F=0,O=0;const{x:W,y:Y}=this.size;if(this.latRange){const ue=this.latRange;S=u.Q(ue[1])*_,T=u.Q(ue[0])*_,T-S<Y&&(F=Y/(T-S))}d&&(M=u.b3(u.O(d[0])*_,0,_),z=u.b3(u.O(d[1])*_,0,_),z<M&&(z+=_),z-M<W&&(O=W/(z-M)));const{x:re,y:he}=this.project.call({worldSize:_},e);let ye,xe;const Ie=Math.max(O||0,F||0);if(Ie){const ue=new u.P(O?(z+M)/2:re,F?(T+S)/2:he);return f.center=this.unproject.call({worldSize:_},ue).wrap(),f.zoom+=this.scaleZoom(Ie),f}if(this.latRange){const ue=Y/2;he-ue<S&&(xe=S+ue),he+ue>T&&(xe=T-ue)}if(d){const ue=(M+z)/2;let ze=re;this._renderWorldCopies&&(ze=u.b3(re,ue-_/2,ue+_/2));const Fe=W/2;ze-Fe<M&&(ye=M+Fe),ze+Fe>z&&(ye=z-Fe)}if(ye!==void 0||xe!==void 0){const ue=new u.P(ye??re,xe??he);f.center=this.unproject.call({worldSize:_},ue).wrap()}return f}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:l,zoom:f}=this.getConstrained(this.center,this.zoom);this.center=l,this.zoom=f,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,l=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b5(1,this.center.lat)*this.worldSize;let d=u.an(new Float64Array(16));u.K(d,d,[this.width/2,-this.height/2,1]),u.J(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=u.an(new Float64Array(16)),u.K(d,d,[1,-1,1]),u.J(d,d,[-1,-1,0]),u.K(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this.minElevationForCurrentTile),T=_-S*this._pixelPerMeter/Math.cos(this._pitch),M=S<0?T:_,z=Math.PI/2+this._pitch,F=this._fov*(.5+e.y/this.height),O=Math.sin(F)*M/Math.sin(u.ac(Math.PI-z-F,.01,Math.PI-.01)),W=this.getHorizon(),Y=2*Math.atan(W/this.cameraToCenterDistance)*(.5+e.y/(2*W)),re=Math.sin(Y)*M/Math.sin(u.ac(Math.PI-z-Y,.01,Math.PI-.01)),he=Math.min(O,re);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*he+M),this.nearZ=this.height/50,d=new Float64Array(16),u.b6(d,this._fov,this.width/this.height,this.nearZ,this.farZ),d[8]=2*-e.x/this.width,d[9]=2*e.y/this.height,this.projectionMatrix=u.ae(d),u.K(d,d,[1,-1,1]),u.J(d,d,[0,0,-this.cameraToCenterDistance]),u.b7(d,d,this._pitch),u.ad(d,d,this.angle),u.J(d,d,[-l,-f,0]),this.mercatorMatrix=u.K([],d,[this.worldSize,this.worldSize,this.worldSize]),u.K(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.L(new Float64Array(16),this.labelPlaneMatrix,d),u.J(d,d,[0,0,-this.elevation]),this.modelViewProjectionMatrix=d,this.invModelViewProjectionMatrix=u.as([],d),this.fogMatrix=new Float64Array(16),u.b6(this.fogMatrix,this._fov,this.width/this.height,_,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,u.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),u.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),u.b7(this.fogMatrix,this.fogMatrix,this._pitch),u.ad(this.fogMatrix,this.fogMatrix,this.angle),u.J(this.fogMatrix,this.fogMatrix,[-l,-f,0]),u.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),u.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=u.L(new Float64Array(16),this.labelPlaneMatrix,d);const ye=this.width%2/2,xe=this.height%2/2,Ie=Math.cos(this.angle),ue=Math.sin(this.angle),ze=l-Math.round(l)+Ie*ye+ue*xe,Fe=f-Math.round(f)+Ie*xe+ue*ye,Ze=new Float64Array(d);if(u.J(Ze,Ze,[ze>.5?ze-1:ze,Fe>.5?Fe-1:Fe,0]),this.alignedModelViewProjectionMatrix=Ze,d=u.as(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new u.P(0,0)),l=[e.x*this.worldSize,e.y*this.worldSize,0,1];return u.af(l,l,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,e))}getCameraQueryGeometry(e){const l=this.getCameraPoint();if(e.length===1)return[e[0],l];{let f=l.x,d=l.y,_=l.x,S=l.y;for(const T of e)f=Math.min(f,T.x),d=Math.min(d,T.y),_=Math.max(_,T.x),S=Math.max(S,T.y);return[new u.P(f,d),new u.P(_,d),new u.P(_,S),new u.P(f,S),new u.P(f,d)]}}lngLatToCameraDepth(e,l){const f=this.locationCoordinate(e),d=[f.x*this.worldSize,f.y*this.worldSize,l,1];return u.af(d,d,this.modelViewProjectionMatrix),d[2]/d[3]}}function Wo(y,e){let l,f=!1,d=null,_=null;const S=()=>{d=null,f&&(y.apply(_,l),d=setTimeout(S,e),f=!1)};return(...T)=>(f=!0,_=this,l=T,d||S(),d)}class Oa{constructor(e){this._getCurrentHash=()=>{const l=window.location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(f=d)}),(f&&f[1]||"").split("/")}return l.split("/")},this._onHashChange=()=>{const l=this._getCurrentHash();if(l.length>=3&&!l.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const l=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,l)},this._removeHash=()=>{const l=this._getCurrentHash();if(l.length===0)return;const f=l.join("/");let d=f;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${f}`);let _=window.location.hash.replace(d,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let S=window.location.href.replace(/(#.+)?$/,_);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=Wo(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const l=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,d=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,d),S=Math.round(l.lng*_)/_,T=Math.round(l.lat*_)/_,M=this._map.getBearing(),z=this._map.getPitch();let F="";if(F+=e?`/${S}/${T}/${f}`:`${f}/${T}/${S}`,(M||z)&&(F+="/"+Math.round(10*M)/10),z&&(F+=`/${Math.round(z)}`),this._hashName){const O=this._hashName;let W=!1;const Y=window.location.hash.slice(1).split("&").map(re=>{const he=re.split("=")[0];return he===O?(W=!0,`${he}=${F}`):re}).filter(re=>re);return W||Y.push(`${O}=${F}`),`#${Y.join("&")}`}return`#${F}`}}const Na={linearity:.3,easing:u.b8(0,0,.3,1)},eu=u.e({deceleration:2500,maxSpeed:1400},Na),nf=u.e({deceleration:20,maxSpeed:1400},Na),Rc=u.e({deceleration:1e3,maxSpeed:360},Na),Va=u.e({deceleration:1e3,maxSpeed:90},Na);class tu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:C.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,l=C.now();for(;e.length>0&&l-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)l.zoom+=_.zoomDelta||0,l.bearing+=_.bearingDelta||0,l.pitch+=_.pitchDelta||0,_.panDelta&&l.pan._add(_.panDelta),_.around&&(l.around=_.around),_.pinchAround&&(l.pinchAround=_.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(l.pan.mag()){const _=Xo(l.pan.mag(),f,u.e({},eu,e||{}));d.offset=l.pan.mult(_.amount/l.pan.mag()),d.center=this._map.transform.center,Ho(d,_)}if(l.zoom){const _=Xo(l.zoom,f,nf);d.zoom=this._map.transform.zoom+_.amount,Ho(d,_)}if(l.bearing){const _=Xo(l.bearing,f,Rc);d.bearing=this._map.transform.bearing+u.ac(_.amount,-179,179),Ho(d,_)}if(l.pitch){const _=Xo(l.pitch,f,Va);d.pitch=this._map.transform.pitch+_.amount,Ho(d,_)}if(d.zoom||d.bearing){const _=l.pinchAround===void 0?l.around:l.pinchAround;d.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),u.e(d,{noMoveStart:!0})}}function Ho(y,e){(!y.duration||y.duration<e.duration)&&(y.duration=e.duration,y.easing=e.easing)}function Xo(y,e,l){const{maxSpeed:f,linearity:d,deceleration:_}=l,S=u.ac(y*d/(e/1e3),-f,f),T=Math.abs(S)/(_*d);return{easing:l.easing,duration:1e3*T,amount:S*(T/2)}}class zn extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,l,f,d={}){const _=P.mousePos(l.getCanvas(),f),S=l.unproject(_);super(e,u.e({point:_,lngLat:S,originalEvent:f},d)),this._defaultPrevented=!1,this.target=l}}class Rs extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,l,f){const d=e==="touchend"?f.changedTouches:f.touches,_=P.touchPos(l.getCanvasContainer(),d),S=_.map(M=>l.unproject(M)),T=_.reduce((M,z,F,O)=>M.add(z.div(O.length)),new u.P(0,0));super(e,{points:_,point:T,lngLats:S,lngLat:l.unproject(T),originalEvent:f}),this._defaultPrevented=!1}}class Bc extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,l,f){super(e,{originalEvent:f}),this._defaultPrevented=!1}}class Fc{constructor(e,l){this._map=e,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Bc(e.type,this._map,e))}mousedown(e,l){return this._mousedownPos=l,this._firePreventable(new zn(e.type,this._map,e))}mouseup(e){this._map.fire(new zn(e.type,this._map,e))}click(e,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new zn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new zn(e.type,this._map,e))}mouseover(e){this._map.fire(new zn(e.type,this._map,e))}mouseout(e){this._map.fire(new zn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Rs(e.type,this._map,e))}touchmove(e){this._map.fire(new Rs(e.type,this._map,e))}touchend(e){this._map.fire(new Rs(e.type,this._map,e))}touchcancel(e){this._map.fire(new Rs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new zn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new zn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ar{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(u.P.convert(e),this._map.terrain)}}class cr{constructor(e,l){this._map=e,this._tr=new Ar(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,l){this.isEnabled()&&e.shiftKey&&e.button===0&&(P.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(e,l){if(!this._active)return;const f=l;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=f,this._box||(this._box=P.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const _=Math.min(d.x,f.x),S=Math.max(d.x,f.x),T=Math.min(d.y,f.y),M=Math.max(d.y,f.y);P.setTransform(this._box,`translate(${_}px,${T}px)`),this._box.style.width=S-_+"px",this._box.style.height=M-T+"px"}mouseupWindow(e,l){if(!this._active||e.button!==0)return;const f=this._startPos,d=l;if(this.reset(),P.suppressClick(),f.x!==d.x||f.y!==d.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:e})),{cameraAnimation:_=>_.fitScreenCoordinates(f,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,l){return this._map.fire(new u.k(e,{originalEvent:l}))}}function Ko(y,e){if(y.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${e.length}`);const l={};for(let f=0;f<y.length;f++)l[y[f].identifier]=e[f];return l}class iu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),f.length===this.numTouches&&(this.centroid=function(d){const _=new u.P(0,0);for(const S of d)_._add(S);return _.div(d.length)}(l),this.touches=Ko(f,l)))}touchmove(e,l,f){if(this.aborted||!this.centroid)return;const d=Ko(f,l);for(const _ in this.touches){const S=d[_];(!S||S.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(e,l,f){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class ja{constructor(e){this.singleTap=new iu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,l,f){this.singleTap.touchstart(e,l,f)}touchmove(e,l,f){this.singleTap.touchmove(e,l,f)}touchend(e,l,f){const d=this.singleTap.touchend(e,l,f);if(d){const _=e.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(d)<30;if(_&&S||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class ho{constructor(e){this._tr=new Ar(e),this._zoomIn=new ja({numTouches:1,numTaps:2}),this._zoomOut=new ja({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,l,f){this._zoomIn.touchstart(e,l,f),this._zoomOut.touchstart(e,l,f)}touchmove(e,l,f){this._zoomIn.touchmove(e,l,f),this._zoomOut.touchmove(e,l,f)}touchend(e,l,f){const d=this._zoomIn.touchend(e,l,f),_=this._zoomOut.touchend(e,l,f),S=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(d)},{originalEvent:e})}):_?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(_)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class os{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const l=this._moveFunction(...e);if(l.bearingDelta||l.pitchDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(e,l){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=l.length?l[0]:l,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,l){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=l.length?l[0]:l;return!this._moved&&d.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(f,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&P.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const nu={0:1,2:2};class Ua{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const l=P.mouseButton(e);this._eventButton=l}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(l,f){const d=nu[f];return l.buttons===void 0||(l.buttons&d)!==d}(e,this._eventButton)}isValidEndEvent(e){return P.mouseButton(e)===this._eventButton}}class ru{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const qa=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=e=>{e.preventDefault()}},su=({enable:y,clickTolerance:e,bearingDegreesPerPixelMoved:l=.8})=>{const f=new Ua({checkCorrectEvent:d=>P.mouseButton(d)===0&&d.ctrlKey||P.mouseButton(d)===2});return new os({clickTolerance:e,move:(d,_)=>({bearingDelta:(_.x-d.x)*l}),moveStateManager:f,enable:y,assignEvents:qa})},ou=({enable:y,clickTolerance:e,pitchDegreesPerPixelMoved:l=-.5})=>{const f=new Ua({checkCorrectEvent:d=>P.mouseButton(d)===0&&d.ctrlKey||P.mouseButton(d)===2});return new os({clickTolerance:e,move:(d,_)=>({pitchDelta:(_.y-d.y)*l}),moveStateManager:f,enable:y,assignEvents:qa})};class Bs{constructor(e,l){this._clickTolerance=e.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,l,f){return this._calculateTransform(e,l,f)}touchmove(e,l,f){if(this._active){if(!this._shouldBePrevented(f.length))return e.preventDefault(),this._calculateTransform(e,l,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,l,f){this._calculateTransform(e,l,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,l,f){f.length>0&&(this._active=!0);const d=Ko(f,l),_=new u.P(0,0),S=new u.P(0,0);let T=0;for(const z in d){const F=d[z],O=this._touches[z];O&&(_._add(F),S._add(F.sub(O)),T++,d[z]=F)}if(this._touches=d,this._shouldBePrevented(T)||!S.mag())return;const M=S.div(T);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(T),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Za{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(e,l,f){if(!this._firstTwoTouches)return;e.preventDefault();const[d,_]=this._firstTwoTouches,S=Jo(f,l,d),T=Jo(f,l,_);if(!S||!T)return;const M=this._aroundCenter?null:S.add(T).div(2);return this._move([S,T],M,e)}touchend(e,l,f){if(!this._firstTwoTouches)return;const[d,_]=this._firstTwoTouches,S=Jo(f,l,d),T=Jo(f,l,_);S&&T||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Jo(y,e,l){for(let f=0;f<y.length;f++)if(y[f].identifier===l)return e[f]}function au(y,e){return Math.log(y/e)/Math.LN2}class lu extends Za{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,l){const f=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(au(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:au(this._distance,f),pinchAround:l}}}function uu(y,e){return 180*y.angleWith(e)/Math.PI}class cu extends Za{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,l,f){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:uu(this._vector,d),pinchAround:l}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const l=25/(Math.PI*this._minDiameter)*360,f=uu(e,this._startVector);return Math.abs(f)<l}}function Ga(y){return Math.abs(y.y)>Math.abs(y.x)}class Yo extends Za{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,l,f){super.touchstart(e,l,f),this._currentTouchCount=f.length}_start(e){this._lastPoints=e,Ga(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,l,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),_=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,_,f.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(e,l,f){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,_=l.mag()>=2;if(!d&&!_)return;if(!d||!_)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const S=e.y>0==l.y>0;return Ga(e)&&Ga(l)&&S}}const Oc={panStep:100,bearingStep:15,pitchStep:10};class vr{constructor(e){this._tr=new Ar(e);const l=Oc;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let l=0,f=0,d=0,_=0,S=0;switch(e.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:e.shiftKey?f=-1:(e.preventDefault(),_=-1);break;case 39:e.shiftKey?f=1:(e.preventDefault(),_=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),S=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(f=0,d=0),{cameraAnimation:T=>{const M=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:Xr,zoom:l?Math.round(M.zoom)+l*(e.shiftKey?2:1):M.zoom,bearing:M.bearing+f*this._bearingStep,pitch:M.pitch+d*this._pitchStep,offset:[-_*this._panStep,-S*this._panStep],center:M.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xr(y){return y*(2-y)}const hu=4.000244140625;class zr{constructor(e,l){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=e,this._tr=new Ar(e),this._triggerRenderFrame=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let l=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const f=C.now(),d=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%hu==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),e.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=e,this._delta-=l,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=P.mousePos(this._map.getCanvas(),e),f=this._tr;this._around=l.y>f.transform.height/2-f.transform.getHorizon()?u.N.convert(this._aroundCenter?f.center:f.unproject(l)):u.N.convert(f.center),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>hu?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&z!==0&&(z=1/z);const F=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(F*z))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,f=this._startZoom,d=this._easing;let _,S=!1;const T=C.now()-this._lastWheelEventTime;if(this._type==="wheel"&&f&&d&&T){const M=Math.min(T/200,1),z=d(M);_=u.y.number(f,l,z),M<1?this._frameId||(this._frameId=!0):S=!0}else _=l,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:_-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let l=u.b9;if(this._prevEase){const f=this._prevEase,d=(C.now()-f.start)/f.duration,_=f.easing(d+.01)-f.easing(d),S=.27/Math.sqrt(_*_+1e-4)*.01,T=Math.sqrt(.0729-S*S);l=u.b8(S,T,.25,1)}return this._prevEase={start:C.now(),duration:e,easing:l},l}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Fs{constructor(e,l){this._clickZoom=e,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rf{constructor(e){this._tr=new Ar(e),this.reset()}reset(){this._active=!1}dblclick(e,l){return e.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(l)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sf{constructor(){this._tap=new ja({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,l,f){if(!this._swipePoint)if(this._tapTime){const d=l[0],_=e.timeStamp-this._tapTime<500,S=this._tapPoint.dist(d)<30;_&&S?f.length>0&&(this._swipePoint=d,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(e,l,f)}touchmove(e,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const d=l[0],_=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(e,l,f)}touchend(e,l,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const d=this._tap.touchend(e,l,f);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nc{constructor(e,l,f){this._el=e,this._mousePan=l,this._touchPan=f}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vc{constructor(e,l,f){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fu{constructor(e,l,f,d){this._el=e,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class fo{constructor(e,l){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=l,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=P.create("div","maplibregl-cooperative-gesture-screen",e);let l=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(l=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=l,this._container.appendChild(d);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=f,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(P.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,l){this._enabled&&(this._map.fire(new u.k("cooperativegestureprevented",{gestureType:e,originalEvent:l})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const br=y=>y.zoom||y.drag||y.pitch||y.rotate;class Et extends u.k{}function Wa(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class du{constructor(e,l){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,_)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=d.type==="renderFrame"?void 0:d,T={needsRenderFrame:!1},M={},z={},F=d.touches,O=F?this._getMapTouches(F):void 0,W=O?P.touchPos(this._map.getCanvas(),O):P.mousePos(this._map.getCanvas(),d);for(const{handlerName:he,handler:ye,allowed:xe}of this._handlers){if(!ye.isEnabled())continue;let Ie;this._blockedByActive(z,xe,he)?ye.reset():ye[_||d.type]&&(Ie=ye[_||d.type](d,W,O),this.mergeHandlerResult(T,M,Ie,he,S),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||ye.isActive())&&(z[he]=ye)}const Y={};for(const he in this._previousActiveHandlers)z[he]||(Y[he]=S);this._previousActiveHandlers=z,(Object.keys(Y).length||Wa(T))&&(this._changes.push([T,M,Y]),this._triggerRenderFrame()),(Object.keys(z).length||Wa(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:re}=T;re&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],re(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tu(e),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,_,S]of this._listeners)P.addEventListener(d,_,d===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[e,l,f]of this._listeners)P.removeEventListener(e,l,e===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(e){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new Fc(l,e));const d=l.boxZoom=new cr(l,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const _=l.cooperativeGestures=new fo(l,e.cooperativeGestures);this._add("cooperativeGestures",_),e.cooperativeGestures&&_.enable();const S=new ho(l),T=new rf(l);l.doubleClickZoom=new Fs(T,S),this._add("tapZoom",S),this._add("clickZoom",T),e.interactive&&e.doubleClickZoom&&l.doubleClickZoom.enable();const M=new sf;this._add("tapDragZoom",M);const z=l.touchPitch=new Yo(l);this._add("touchPitch",z),e.interactive&&e.touchPitch&&l.touchPitch.enable(e.touchPitch);const F=su(e),O=ou(e);l.dragRotate=new Vc(e,F,O),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]),e.interactive&&e.dragRotate&&l.dragRotate.enable();const W=(({enable:Ie,clickTolerance:ue})=>{const ze=new Ua({checkCorrectEvent:Fe=>P.mouseButton(Fe)===0&&!Fe.ctrlKey});return new os({clickTolerance:ue,move:(Fe,Ze)=>({around:Ze,panDelta:Ze.sub(Fe)}),activateOnStart:!0,moveStateManager:ze,enable:Ie,assignEvents:qa})})(e),Y=new Bs(e,l);l.dragPan=new Nc(f,W,Y),this._add("mousePan",W),this._add("touchPan",Y,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&l.dragPan.enable(e.dragPan);const re=new cu,he=new lu;l.touchZoomRotate=new fu(f,he,re,M),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",he,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&l.touchZoomRotate.enable(e.touchZoomRotate);const ye=l.scrollZoom=new zr(l,()=>this._triggerRenderFrame());this._add("scrollZoom",ye,["mousePan"]),e.interactive&&e.scrollZoom&&l.scrollZoom.enable(e.scrollZoom);const xe=l.keyboard=new vr(l);this._add("keyboard",xe),e.interactive&&e.keyboard&&l.keyboard.enable(),this._add("blockableMapEvent",new pn(l))}_add(e,l,f){this._handlers.push({handlerName:e,handler:l,allowed:f}),this._handlersById[e]=l}stop(e){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!br(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,l,f){for(const d in e)if(d!==f&&(!l||l.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const l=[];for(const f of e)this._el.contains(f.target)&&l.push(f);return l}mergeHandlerResult(e,l,f,d,_){if(!f)return;u.e(e,f);const S={handlerName:d,originalEvent:f.originalEvent||_};f.zoomDelta!==void 0&&(l.zoom=S),f.panDelta!==void 0&&(l.drag=S),f.pitchDelta!==void 0&&(l.pitch=S),f.bearingDelta!==void 0&&(l.rotate=S)}_applyChanges(){const e={},l={},f={};for(const[d,_,S]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new u.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),u.e(l,_),u.e(f,S);this._updateMapTransform(e,l,f),this._changes=[]}_updateMapTransform(e,l,f){const d=this._map,_=d._getTransformForUpdate(),S=d.terrain;if(!(Wa(e)||S&&this._terrainMovement))return this._fireEvents(l,f,!0);let{panDelta:T,zoomDelta:M,bearingDelta:z,pitchDelta:F,around:O,pinchAround:W}=e;W!==void 0&&(O=W),d._stop(!0),O=O||d.transform.centerPoint;const Y=_.pointLocation(T?O.sub(T):O);z&&(_.bearing+=z),F&&(_.pitch+=F),M&&(_.zoom+=M),S?this._terrainMovement||!l.drag&&!l.zoom?l.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(T)):_.setLocationAtPoint(Y,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(Y,O)):_.setLocationAtPoint(Y,O),d._applyUpdatedTransform(_),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(l,f,!0)}_fireEvents(e,l,f){const d=br(this._eventsInProgress),_=br(e),S={};for(const O in e){const{originalEvent:W}=e[O];this._eventsInProgress[O]||(S[`${O}start`]=W),this._eventsInProgress[O]=e[O]}!d&&_&&this._fireEvent("movestart",_.originalEvent);for(const O in S)this._fireEvent(O,S[O]);_&&this._fireEvent("move",_.originalEvent);for(const O in e){const{originalEvent:W}=e[O];this._fireEvent(O,W)}const T={};let M;for(const O in this._eventsInProgress){const{handlerName:W,originalEvent:Y}=this._eventsInProgress[O];this._handlersById[W].isActive()||(delete this._eventsInProgress[O],M=l[W]||Y,T[`${O}end`]=M)}for(const O in T)this._fireEvent(O,T[O]);const z=br(this._eventsInProgress),F=(d||_)&&!z;if(F&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const O=this._map._getTransformForUpdate();O.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(O)}if(f&&F){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!O||!O.essential&&C.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:M})),W(this._map.getBearing())&&this._map.resetNorth()):(W(O.bearing||this._map.getBearing())&&(O.bearing=0),O.freezeElevation=!0,this._map.easeTo(O,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(e,l){this._map.fire(new u.k(e,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Et("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class jc extends u.E{constructor(e,l){super(),this._renderFrameCallback=()=>{const f=Math.min((C.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,l){return this.jumpTo({center:e},l)}panBy(e,l,f){return e=u.P.convert(e).mult(-1),this.panTo(this.transform.center,u.e({offset:e},l),f)}panTo(e,l,f){return this.easeTo(u.e({center:e},l),f)}getZoom(){return this.transform.zoom}setZoom(e,l){return this.jumpTo({zoom:e},l),this}zoomTo(e,l,f){return this.easeTo(u.e({zoom:e},l),f)}zoomIn(e,l){return this.zoomTo(this.getZoom()+1,e,l),this}zoomOut(e,l){return this.zoomTo(this.getZoom()-1,e,l),this}getBearing(){return this.transform.bearing}setBearing(e,l){return this.jumpTo({bearing:e},l),this}getPadding(){return this.transform.padding}setPadding(e,l){return this.jumpTo({padding:e},l),this}rotateTo(e,l,f){return this.easeTo(u.e({bearing:e},l),f)}resetNorth(e,l){return this.rotateTo(0,u.e({duration:1e3},e),l),this}resetNorthPitch(e,l){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},e),l),this}snapToNorth(e,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,l):this}getPitch(){return this.transform.pitch}setPitch(e,l){return this.jumpTo({pitch:e},l),this}cameraForBounds(e,l){e=je.convert(e).adjustAntiMeridian();const f=l&&l.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),f,l)}_cameraForBoxAndBearing(e,l,f,d){const _={top:0,bottom:0,right:0,left:0};if(typeof(d=u.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const mt=d.padding;d.padding={top:mt,bottom:mt,right:mt,left:mt}}d.padding=u.e(_,d.padding);const S=this.transform,T=S.padding,M=new je(e,l),z=S.project(M.getNorthWest()),F=S.project(M.getNorthEast()),O=S.project(M.getSouthEast()),W=S.project(M.getSouthWest()),Y=u.ba(-f),re=z.rotate(Y),he=F.rotate(Y),ye=O.rotate(Y),xe=W.rotate(Y),Ie=new u.P(Math.max(re.x,he.x,xe.x,ye.x),Math.max(re.y,he.y,xe.y,ye.y)),ue=new u.P(Math.min(re.x,he.x,xe.x,ye.x),Math.min(re.y,he.y,xe.y,ye.y)),ze=Ie.sub(ue),Fe=(S.width-(T.left+T.right+d.padding.left+d.padding.right))/ze.x,Ze=(S.height-(T.top+T.bottom+d.padding.top+d.padding.bottom))/ze.y;if(Ze<0||Fe<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ye=Math.min(S.scaleZoom(S.scale*Math.min(Fe,Ze)),d.maxZoom),ct=u.P.convert(d.offset),vt=new u.P((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(u.ba(f)),kt=ct.add(vt).mult(S.scale/S.zoomScale(Ye));return{center:S.unproject(z.add(O).div(2).sub(kt)),zoom:Ye,bearing:f}}fitBounds(e,l,f){return this._fitInternal(this.cameraForBounds(e,l),l,f)}fitScreenCoordinates(e,l,f,d,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(e)),this.transform.pointLocation(u.P.convert(l)),f,d),d,_)}_fitInternal(e,l,f){return e?(delete(l=u.e(e,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(e,l){this.stop();const f=this._getTransformForUpdate();let d=!1,_=!1,S=!1;return"zoom"in e&&f.zoom!==+e.zoom&&(d=!0,f.zoom=+e.zoom),e.center!==void 0&&(f.center=u.N.convert(e.center)),"bearing"in e&&f.bearing!==+e.bearing&&(_=!0,f.bearing=+e.bearing),"pitch"in e&&f.pitch!==+e.pitch&&(S=!0,f.pitch=+e.pitch),e.padding==null||f.isPaddingEqual(e.padding)||(f.padding=e.padding),this._applyUpdatedTransform(f),this.fire(new u.k("movestart",l)).fire(new u.k("move",l)),d&&this.fire(new u.k("zoomstart",l)).fire(new u.k("zoom",l)).fire(new u.k("zoomend",l)),_&&this.fire(new u.k("rotatestart",l)).fire(new u.k("rotate",l)).fire(new u.k("rotateend",l)),S&&this.fire(new u.k("pitchstart",l)).fire(new u.k("pitch",l)).fire(new u.k("pitchend",l)),this.fire(new u.k("moveend",l))}calculateCameraOptionsFromTo(e,l,f,d=0){const _=u.Z.fromLngLat(e,l),S=u.Z.fromLngLat(f,d),T=S.x-_.x,M=S.y-_.y,z=S.z-_.z,F=Math.hypot(T,M,z);if(F===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(T,M),W=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),Y=180*Math.atan2(T,-M)/Math.PI;let re=180*Math.acos(O/F)/Math.PI;return re=z<0?90-re:90+re,{center:S.toLngLat(),zoom:W,pitch:re,bearing:Y}}easeTo(e,l){var f;this._stop(!1,e.easeId),((e=u.e({offset:[0,0],duration:500,easing:u.b9},e)).animate===!1||!e.essential&&C.prefersReducedMotion)&&(e.duration=0);const d=this._getTransformForUpdate(),_=d.zoom,S=d.bearing,T=d.pitch,M=d.padding,z="bearing"in e?this._normalizeBearing(e.bearing,S):S,F="pitch"in e?+e.pitch:T,O="padding"in e?e.padding:d.padding,W=u.P.convert(e.offset);let Y=d.centerPoint.add(W);const re=d.pointLocation(Y),{center:he,zoom:ye}=d.getConstrained(u.N.convert(e.center||re),(f=e.zoom)!==null&&f!==void 0?f:_);this._normalizeCenter(he,d);const xe=d.project(re),Ie=d.project(he).sub(xe),ue=d.zoomScale(ye-_);let ze,Fe;e.around&&(ze=u.N.convert(e.around),Fe=d.locationPoint(ze));const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ye!==_,this._rotating=this._rotating||S!==z,this._pitching=this._pitching||F!==T,this._padding=!d.isPaddingEqual(O),this._easeId=e.easeId,this._prepareEase(l,e.noMoveStart,Ze),this.terrain&&this._prepareElevation(he),this._ease(Ye=>{if(this._zooming&&(d.zoom=u.y.number(_,ye,Ye)),this._rotating&&(d.bearing=u.y.number(S,z,Ye)),this._pitching&&(d.pitch=u.y.number(T,F,Ye)),this._padding&&(d.interpolatePadding(M,O,Ye),Y=d.centerPoint.add(W)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ye),ze)d.setLocationAtPoint(ze,Fe);else{const ct=d.zoomScale(d.zoom-_),vt=ye>_?Math.min(2,ue):Math.max(.5,ue),kt=Math.pow(vt,1-Ye),mt=d.unproject(xe.add(Ie.mult(Ye*kt)).mult(ct));d.setLocationAtPoint(d.renderWorldCopies?mt.wrap():mt,Y)}this._applyUpdatedTransform(d),this._fireMoveEvents(l)},Ye=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(l,Ye)},e),this}_prepareEase(e,l,f={}){this._moving=!0,l||f.moving||this.fire(new u.k("movestart",e)),this._zooming&&!f.zooming&&this.fire(new u.k("zoomstart",e)),this._rotating&&!f.rotating&&this.fire(new u.k("rotatestart",e)),this._pitching&&!f.pitching&&this.fire(new u.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const l=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&l!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(f-(l-(f*e+this._elevationStart))/(1-e)),this._elevationTarget=l}this.transform.elevation=u.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const l=e.getCameraPosition(),f=this.terrain.getElevationForLngLatZoom(l.lngLat,e.zoom);if(l.altitude<f){const d=this.calculateCameraOptionsFromTo(l.lngLat,f,e.center,e.elevation);return{pitch:d.pitch,zoom:d.zoom}}return{}}_applyUpdatedTransform(e){const l=[];if(this.terrain&&l.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&l.push(d=>this.transformCameraUpdate(d)),!l.length)return;const f=e.clone();for(const d of l){const _=f.clone(),{center:S,zoom:T,pitch:M,bearing:z,elevation:F}=d(_);S&&(_.center=S),T!==void 0&&(_.zoom=T),M!==void 0&&(_.pitch=M),z!==void 0&&(_.bearing=z),F!==void 0&&(_.elevation=F),f.apply(_)}this.transform.apply(f)}_fireMoveEvents(e){this.fire(new u.k("move",e)),this._zooming&&this.fire(new u.k("zoom",e)),this._rotating&&this.fire(new u.k("rotate",e)),this._pitching&&this.fire(new u.k("pitch",e))}_afterEase(e,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId;const f=this._zooming,d=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new u.k("zoomend",e)),d&&this.fire(new u.k("rotateend",e)),_&&this.fire(new u.k("pitchend",e)),this.fire(new u.k("moveend",e))}flyTo(e,l){var f;if(!e.essential&&C.prefersReducedMotion){const xt=u.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(xt,l)}this.stop(),e=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.b9},e);const d=this._getTransformForUpdate(),_=d.zoom,S=d.bearing,T=d.pitch,M=d.padding,z="bearing"in e?this._normalizeBearing(e.bearing,S):S,F="pitch"in e?+e.pitch:T,O="padding"in e?e.padding:d.padding,W=u.P.convert(e.offset);let Y=d.centerPoint.add(W);const re=d.pointLocation(Y),{center:he,zoom:ye}=d.getConstrained(u.N.convert(e.center||re),(f=e.zoom)!==null&&f!==void 0?f:_);this._normalizeCenter(he,d);const xe=d.zoomScale(ye-_),Ie=d.project(re),ue=d.project(he).sub(Ie);let ze=e.curve;const Fe=Math.max(d.width,d.height),Ze=Fe/xe,Ye=ue.mag();if("minZoom"in e){const xt=u.ac(Math.min(e.minZoom,_,ye),d.minZoom,d.maxZoom),$t=Fe/d.zoomScale(xt-_);ze=Math.sqrt($t/Ye*2)}const ct=ze*ze;function vt(xt){const $t=(Ze*Ze-Fe*Fe+(xt?-1:1)*ct*ct*Ye*Ye)/(2*(xt?Ze:Fe)*ct*Ye);return Math.log(Math.sqrt($t*$t+1)-$t)}function kt(xt){return(Math.exp(xt)-Math.exp(-xt))/2}function mt(xt){return(Math.exp(xt)+Math.exp(-xt))/2}const pt=vt(!1);let Dt=function(xt){return mt(pt)/mt(pt+ze*xt)},ti=function(xt){return Fe*((mt(pt)*(kt($t=pt+ze*xt)/mt($t))-kt(pt))/ct)/Ye;var $t},gt=(vt(!0)-pt)/ze;if(Math.abs(Ye)<1e-6||!isFinite(gt)){if(Math.abs(Fe-Ze)<1e-6)return this.easeTo(e,l);const xt=Ze<Fe?-1:1;gt=Math.abs(Math.log(Ze/Fe))/ze,ti=()=>0,Dt=$t=>Math.exp(xt*ze*$t)}return e.duration="duration"in e?+e.duration:1e3*gt/("screenSpeed"in e?+e.screenSpeed/ze:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=S!==z,this._pitching=F!==T,this._padding=!d.isPaddingEqual(O),this._prepareEase(l,!1),this.terrain&&this._prepareElevation(he),this._ease(xt=>{const $t=xt*gt,Ji=1/Dt($t);d.zoom=xt===1?ye:_+d.scaleZoom(Ji),this._rotating&&(d.bearing=u.y.number(S,z,xt)),this._pitching&&(d.pitch=u.y.number(T,F,xt)),this._padding&&(d.interpolatePadding(M,O,xt),Y=d.centerPoint.add(W)),this.terrain&&!e.freezeElevation&&this._updateElevation(xt);const oi=xt===1?he:d.unproject(Ie.add(ue.mult(ti($t))).mult(Ji));d.setLocationAtPoint(d.renderWorldCopies?oi.wrap():oi,Y),this._applyUpdatedTransform(d),this._fireMoveEvents(l)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(l)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,l){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,l)}return e||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(e,l,f){f.animate===!1||f.duration===0?(e(1),l()):(this._easeStart=C.now(),this._easeOptions=f,this._onEaseFrame=e,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,l){e=u.b3(e,-180,180);const f=Math.abs(e-l);return Math.abs(e-360-l)<f&&(e-=360),Math.abs(e+360-l)<f&&(e+=360),e}_normalizeCenter(e,l){if(!l.renderWorldCopies||l.lngRange)return;const f=e.lng-l.center.lng;e.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(u.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const po={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class mo{constructor(e=po){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=l=>{!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"&&l.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,l){const f=this._map._getUIString(`AttributionControl.${l}`);e.title=f,e.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const l=this._map.style.sourceCaches;for(const d in l){const _=l[d];if(_.used||_.usedForTerrain){const S=_.getSource();S.attribution&&e.indexOf(S.attribution)<0&&e.push(S.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,_)=>d.length-_.length),e=e.filter((d,_)=>{for(let S=_+1;S<e.length;S++)if(e[S].indexOf(d)>=0)return!1;return!0});const f=e.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,e.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pu{constructor(e={}){this._updateCompact=()=>{const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl");const l=P.create("a","maplibregl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class pi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const l=++this._id;return this._queue.push({callback:e,id:l,cancelled:!1}),l}remove(e){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const d of f)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var mu=u.Y([{name:"a_pos3d",type:"Int16",components:3}]);class of extends u.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,l){this.sourceCache.update(e,l),this._renderableTilesKeys=[];const f={};for(const d of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l}))f[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),u.aP(d.posMatrix,0,u.X,0,u.X,0,1),this._tiles[d.key]=new Pn(d,this.tileSize));for(const d in this._tiles)f[d]||delete this._tiles[d]}freeRtt(e){for(const l in this._tiles){const f=this._tiles[l];(!e||f.tileID.equals(e)||f.tileID.isChildOf(e)||e.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const l={};for(const f of this._renderableTilesKeys){const d=this._tiles[f].tileID;if(d.canonical.equals(e.canonical)){const _=e.clone();_.posMatrix=new Float64Array(16),u.aP(_.posMatrix,0,u.X,0,u.X,0,1),l[f]=_}else if(d.canonical.isChildOf(e.canonical)){const _=e.clone();_.posMatrix=new Float64Array(16);const S=d.canonical.z-e.canonical.z,T=d.canonical.x-(d.canonical.x>>S<<S),M=d.canonical.y-(d.canonical.y>>S<<S),z=u.X>>S;u.aP(_.posMatrix,0,z,0,z,0,1),u.J(_.posMatrix,_.posMatrix,[-T*z,-M*z,0]),l[f]=_}else if(e.canonical.isChildOf(d.canonical)){const _=e.clone();_.posMatrix=new Float64Array(16);const S=e.canonical.z-d.canonical.z,T=e.canonical.x-(e.canonical.x>>S<<S),M=e.canonical.y-(e.canonical.y>>S<<S),z=u.X>>S;u.aP(_.posMatrix,0,u.X,0,u.X,0,1),u.J(_.posMatrix,_.posMatrix,[T*z,M*z,0]),u.K(_.posMatrix,_.posMatrix,[1/2**S,1/2**S,0]),l[f]=_}}return l}getSourceTile(e,l){const f=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>f.maxzoom&&(d=f.maxzoom),d<f.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!_||!_.dem)&&l)for(;d>=f.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(e.scaledTo(d--).key);return _}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(l=>l.timeAdded>=e)}}class gu{constructor(e,l,f){this.painter=e,this.sourceCache=new of(l),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,l,f,d=u.X){var _;if(!(l>=0&&l<d&&f>=0&&f<d))return 0;const S=this.getTerrainData(e),T=(_=S.tile)===null||_===void 0?void 0:_.dem;if(!T)return 0;const M=function(re,he,ye){var xe=he[0],Ie=he[1];return re[0]=ye[0]*xe+ye[4]*Ie+ye[12],re[1]=ye[1]*xe+ye[5]*Ie+ye[13],re}([],[l/d*u.X,f/d*u.X],S.u_terrain_matrix),z=[M[0]*T.dim,M[1]*T.dim],F=Math.floor(z[0]),O=Math.floor(z[1]),W=z[0]-F,Y=z[1]-O;return T.get(F,O)*(1-W)*(1-Y)+T.get(F+1,O)*W*(1-Y)+T.get(F,O+1)*(1-W)*Y+T.get(F+1,O+1)*W*Y}getElevationForLngLatZoom(e,l){if(!u.bb(l,e.wrap()))return 0;const{tileID:f,mercatorX:d,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(e,l);return this.getElevation(f,d%u.X,_%u.X,u.X)}getElevation(e,l,f,d=u.X){return this.getDEMElevation(e,l,f,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,_=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new D(d,_,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new D(d,new u.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.an([])}const l=this.sourceCache.getSourceTile(e,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const d=this.painter.context;l.demTexture=this.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new D(d,l.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),l.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const f=l&&l+l.tileID.key+e.key;if(f&&!this._demMatrixCache[f]){const d=this.sourceCache.sourceCache._source.maxzoom;let _=e.canonical.z-l.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?_=e.canonical.z-d:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=e.canonical.x-(e.canonical.x>>_<<_),T=e.canonical.y-(e.canonical.y>>_<<_),M=u.bc(new Float64Array(16),[1/(u.X<<_),1/(u.X<<_),0]);u.J(M,M,[S*u.X,T*u.X,0]),this._demMatrixCache[e.key]={matrix:M,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getFramebuffer(e){const l=this.painter,f=l.width/devicePixelRatio,d=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new D(l.context,{width:f,height:d,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new D(l.context,{width:f,height:d,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(f,d,!0,!1),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,f,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,S=0;_<this._coordsTextureSize;_++)for(let T=0;T<this._coordsTextureSize;T++,S+=4)l[S+0]=255&T,l[S+1]=255&_,l[S+2]=T>>8<<4|_>>8,l[S+3]=0;const f=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),d=new D(e,f,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const l=new Uint8Array(4),f=this.painter.context,d=f.gl,_=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(_,T-S-1,1,1,d.RGBA,d.UNSIGNED_BYTE,l),f.bindFramebuffer.set(null);const M=l[0]+(l[2]>>4<<8),z=l[1]+((15&l[2])<<8),F=this.coordsIndex[255-l[3]],O=F&&this.sourceCache.getTileByID(F);if(!O)return null;const W=this._coordsTextureSize,Y=(1<<O.tileID.canonical.z)*W;return new u.Z((O.tileID.canonical.x*W+M)/Y+O.tileID.wrap,(O.tileID.canonical.y*W+z)/Y,this.getElevation(O.tileID,M,z,W))}depthAtPoint(e){const l=new Uint8Array(4),f=this.painter.context,d=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,l),f.bindFramebuffer.set(null),(l[0]/16777216+l[1]/65536+l[2]/256+l[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,l=new u.bd,f=new u.aY,d=this.meshSize,_=u.X/d,S=d*d;for(let O=0;O<=d;O++)for(let W=0;W<=d;W++)l.emplaceBack(W*_,O*_,0);for(let O=0;O<S;O+=d+1)for(let W=0;W<d;W++)f.emplaceBack(W+O,d+W+O+1,d+W+O+2),f.emplaceBack(W+O,d+W+O+2,W+O+1);const T=l.length,M=T+2*(d+1);for(const O of[0,1])for(let W=0;W<=d;W++)for(const Y of[0,1])l.emplaceBack(W*_,O*u.X,Y);for(let O=0;O<2*d;O+=2)f.emplaceBack(M+O,M+O+1,M+O+3),f.emplaceBack(M+O,M+O+3,M+O+2),f.emplaceBack(T+O,T+O+3,T+O+1),f.emplaceBack(T+O,T+O+2,T+O+3);const z=l.length,F=z+2*(d+1);for(const O of[0,1])for(let W=0;W<=d;W++)for(const Y of[0,1])l.emplaceBack(O*u.X,W*_,Y);for(let O=0;O<2*d;O+=2)f.emplaceBack(z+O,z+O+1,z+O+3),f.emplaceBack(z+O,z+O+3,z+O+2),f.emplaceBack(F+O,F+O+3,F+O+1),f.emplaceBack(F+O,F+O+2,F+O+3);return this._mesh=new Ba(e.createVertexBuffer(l,mu.members),e.createIndexBuffer(f),u.a0.simpleSegment(0,0,l.length,f.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*u.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,l){var f;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,l);return(f=this.getMinMaxElevation(d).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(e){const l=this.getTerrainData(e).tile,f={minElevation:null,maxElevation:null};return l&&l.dem&&(f.minElevation=l.dem.min*this.exaggeration,f.maxElevation=l.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(e,l){const f=u.Z.fromLngLat(e.wrap()),d=(1<<l)*u.X,_=f.x*d,S=f.y*d,T=Math.floor(_/u.X),M=Math.floor(S/u.X);return{tileID:new u.S(l,0,l,T,M),mercatorX:_,mercatorY:S}}}class af{constructor(e,l,f){this._context=e,this._size=l,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const l=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new D(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),l.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),l.colorAttachment.set(f.texture),{id:e,fbo:l,texture:f,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(l=>e.id!==l),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const l of this._recentlyUsed)if(!this._objects[l].inUse)return this._objects[l];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const go={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Uc{constructor(e,l){this.painter=e,this.terrain=l,this.pool=new af(e.context,30,l.sourceCache.tileSize*l.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,l){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(f=>!e._layers[f].isHidden(l)),this._coordsDescendingInv={};for(const f in e.sourceCaches){this._coordsDescendingInv[f]={};const d=e.sourceCaches[f].getVisibleCoordinates();for(const _ of d){const S=this.terrain.sourceCache.getTerrainCoords(_);for(const T in S)this._coordsDescendingInv[f][T]||(this._coordsDescendingInv[f][T]=[]),this._coordsDescendingInv[f][T].push(S[T])}}this._coordsDescendingInvStr={};for(const f of e._order){const d=e._layers[f],_=d.source;if(go[d.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const S in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][S]=this._coordsDescendingInv[_][S].map(T=>T.key).sort().join()}}for(const f of this._renderableTiles)for(const d in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[d][f.tileID.key];_&&_!==f.rttCoords[d]&&(f.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const l=e.type,f=this.painter,d=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(go[l]&&(this._prevType&&go[this._prevType]||this._stacks.push([]),this._prevType=l,this._stacks[this._stacks.length-1].push(e.id),!d))return!0;if(go[this._prevType]||go[l]&&d){this._prevType=l;const _=this._stacks.length-1,S=this._stacks[_]||[];for(const T of this._renderableTiles){if(this.pool.isFull()&&(Dc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[_]){const z=this.pool.getObjectForId(T.rtt[_].id);if(z.stamp===T.rtt[_].stamp){this.pool.useObject(z);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),T.rtt[_]={id:M.id,stamp:M.stamp},f.context.bindFramebuffer.set(M.fbo.framebuffer),f.context.clear({color:u.aM.transparent,stencil:0}),f.currentStencilSource=void 0;for(let z=0;z<S.length;z++){const F=f.style._layers[S[z]],O=F.source?this._coordsDescendingInv[F.source][T.tileID.key]:[T.tileID];f.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),f._renderTileClippingMasks(F,O),f.renderLayer(f,f.style.sourceCaches[F.source],F,O),F.source&&(T.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][T.tileID.key])}}return Dc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),go[l]}return!1}}const _u={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},qc=w,lf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:po,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},yu=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},uf={showCompass:!0,showZoom:!0,visualizePitch:!1};class cf{constructor(e,l,f=!1){this.mousedown=S=>{this.startMouse(u.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),P.mousePos(this.element,S)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,P.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),P.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const d=e.dragRotate._mouseRotate.getClickTolerance(),_=e.dragRotate._mousePitch.getClickTolerance();this.element=l,this.mouseRotate=su({clickTolerance:d,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:T,bearingDegreesPerPixelMoved:M=.8})=>{const z=new ru;return new os({clickTolerance:T,move:(F,O)=>({bearingDelta:(O.x-F.x)*M}),moveStateManager:z,enable:S,assignEvents:yu})})({clickTolerance:d,enable:!0}),this.map=e,f&&(this.mousePitch=ou({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:T,pitchDegreesPerPixelMoved:M=-.5})=>{const z=new ru;return new os({clickTolerance:T,move:(F,O)=>({pitchDelta:(O.y-F.y)*M}),moveStateManager:z,enable:S,assignEvents:yu})})({clickTolerance:_,enable:!0})),P.addEventListener(l,"mousedown",this.mousedown),P.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(l,"touchcancel",this.reset)}startMouse(e,l){this.mouseRotate.dragStart(e,l),this.mousePitch&&this.mousePitch.dragStart(e,l),P.disableDrag()}startTouch(e,l){this.touchRotate.dragStart(e,l),this.touchPitch&&this.touchPitch.dragStart(e,l),P.disableDrag()}moveMouse(e,l){const f=this.map,{bearingDelta:d}=this.mouseRotate.dragMove(e,l)||{};if(d&&f.setBearing(f.getBearing()+d),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(e,l)||{};_&&f.setPitch(f.getPitch()+_)}}moveTouch(e,l){const f=this.map,{bearingDelta:d}=this.touchRotate.dragMove(e,l)||{};if(d&&f.setBearing(f.getBearing()+d),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(e,l)||{};_&&f.setPitch(f.getPitch()+_)}}off(){const e=this.element;P.removeEventListener(e,"mousedown",this.mousedown),P.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend),P.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend)}}let hr;function Ki(y,e,l){const f=new u.N(y.lng,y.lat);if(y=new u.N(y.lng,y.lat),e){const d=new u.N(y.lng-360,y.lat),_=new u.N(y.lng+360,y.lat),S=l.locationPoint(y).distSqr(e);l.locationPoint(d).distSqr(e)<S?y=d:l.locationPoint(_).distSqr(e)<S&&(y=_)}for(;Math.abs(y.lng-l.center.lng)>180;){const d=l.locationPoint(y);if(d.x>=0&&d.y>=0&&d.x<=l.width&&d.y<=l.height)break;y.lng>l.center.lng?y.lng-=360:y.lng+=360}return y.lng!==f.lng&&l.locationPoint(y).y>l.height/2-l.getHorizon()?y:f}const _o={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ha(y,e,l){const f=y.classList;for(const d in _o)f.remove(`maplibregl-${l}-anchor-${d}`);f.add(`maplibregl-${l}-anchor-${e}`)}class Xa extends u.E{constructor(e){if(super(),this._onKeyPress=l=>{const f=l.code,d=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=l=>{const f=l.originalEvent.target,d=this._element;this._popup&&(f===d||d.contains(f))&&this.togglePopup()},this._update=l=>{var f;if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((l==null?void 0:l.type)==="terrain"||(l==null?void 0:l.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ki(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||l&&l.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${_o[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${_}`),C.frameAsync(new AbortController).then(()=>{this._updateOpacity(l&&l.type==="moveend")}).catch(()=>{})},this._onMove=l=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=l=>{this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=u.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div");const l=P.createNS("http://www.w3.org/2000/svg","svg"),f=41,d=27;l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height",`${f}px`),l.setAttributeNS(null,"width",`${d}px`),l.setAttributeNS(null,"viewBox",`0 0 ${d} ${f}`);const _=P.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const S=P.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const T=P.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of M){const Ie=P.createNS("http://www.w3.org/2000/svg","ellipse");Ie.setAttributeNS(null,"opacity","0.04"),Ie.setAttributeNS(null,"cx","10.5"),Ie.setAttributeNS(null,"cy","5.80029008"),Ie.setAttributeNS(null,"rx",xe.rx),Ie.setAttributeNS(null,"ry",xe.ry),T.appendChild(Ie)}const z=P.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const F=P.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(F);const O=P.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const W=P.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(W);const Y=P.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const re=P.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(8.0, 8.0)");const he=P.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#000000"),he.setAttributeNS(null,"opacity","0.25"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962");const ye=P.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#FFFFFF"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962"),re.appendChild(he),re.appendChild(ye),S.appendChild(T),S.appendChild(z),S.appendChild(O),S.appendChild(Y),S.appendChild(re),l.appendChild(S),l.setAttributeNS(null,"height",f*this._scale+"px"),l.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(l),this._offset=u.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()}),Ha(this._element,this._anchor,"marker"),e&&e.className)for(const l of e.className.split(" "))this._element.classList.add(l);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=u.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var l,f;if(!(!((l=this._map)===null||l===void 0)&&l.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,_=d.terrain.depthAtPoint(this._pos),S=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,S)-_<.006)return void(this._element.style.opacity=this._opacity);const T=-this._offset.y/d.transform._pixelPerMeter,M=Math.sin(d.getPitch()*Math.PI/180)*T,z=d.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),F=d.transform.lngLatToCameraDepth(this._lngLat,S+M)-z>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=u.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,l){return e===void 0&&l===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),l!==void 0&&(this._opacityWhenCovered=l),this._map&&this._updateOpacity(!0),this}}const Zc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Qo=0,$o=!1;const Kr={maxWidth:100,unit:"metric"};function ea(y,e,l){const f=l&&l.maxWidth||100,d=y._container.clientHeight/2,_=y.unproject([0,d]),S=y.unproject([f,d]),T=_.distanceTo(S);if(l&&l.unit==="imperial"){const M=3.2808*T;M>5280?zt(e,f,M/5280,y._getUIString("ScaleControl.Miles")):zt(e,f,M,y._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?zt(e,f,T/1852,y._getUIString("ScaleControl.NauticalMiles")):T>=1e3?zt(e,f,T/1e3,y._getUIString("ScaleControl.Kilometers")):zt(e,f,T,y._getUIString("ScaleControl.Meters"))}function zt(y,e,l,f){const d=function(_){const S=Math.pow(10,`${Math.floor(_)}`.length-1);let T=_/S;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z}(T),S*T}(l);y.style.width=e*(d/l)+"px",y.innerHTML=`${d}&nbsp;${f}`}const Kt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Ka=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ja(y){if(y){if(typeof y=="number"){const e=Math.round(Math.abs(y)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,y),"top-left":new u.P(e,e),"top-right":new u.P(-e,e),bottom:new u.P(0,-y),"bottom-left":new u.P(e,-e),"bottom-right":new u.P(-e,-e),left:new u.P(y,0),right:new u.P(-y,0)}}if(y instanceof u.P||Array.isArray(y)){const e=u.P.convert(y);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:u.P.convert(y.center||[0,0]),top:u.P.convert(y.top||[0,0]),"top-left":u.P.convert(y["top-left"]||[0,0]),"top-right":u.P.convert(y["top-right"]||[0,0]),bottom:u.P.convert(y.bottom||[0,0]),"bottom-left":u.P.convert(y["bottom-left"]||[0,0]),"bottom-right":u.P.convert(y["bottom-right"]||[0,0]),left:u.P.convert(y.left||[0,0]),right:u.P.convert(y.right||[0,0])}}return Ja(new u.P(0,0))}const vu=w;m.AJAXError=u.bh,m.Evented=u.E,m.LngLat=u.N,m.MercatorCoordinate=u.Z,m.Point=u.P,m.addProtocol=u.bi,m.config=u.a,m.removeProtocol=u.bj,m.AttributionControl=mo,m.BoxZoomHandler=cr,m.CanvasSource=Mi,m.CooperativeGesturesHandler=fo,m.DoubleClickZoomHandler=Fs,m.DragPanHandler=Nc,m.DragRotateHandler=Vc,m.EdgeInsets=uo,m.FullscreenControl=class extends u.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var e;let l=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=l==null?void 0:l.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)l=l.shadowRoot.fullscreenElement;l===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=Ri,m.GeolocateControl=class extends u.E{constructor(y){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const l=new u.N(e.coords.longitude,e.coords.latitude),f=e.coords.accuracy,d=this._map.getBearing(),_=u.e({bearing:d},this.options.fitBoundsOptions),S=je.fromLngLat(l,f);this._map.fitBounds(S,_,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const l=new u.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&$o)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Xa({element:this._dotElement}),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")),this.fire(new u.k("userlocationlostfocus")))})}},this.options=u.e({},Zc,y)}onAdd(y){return this._map=y,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return u._(this,arguments,void 0,function*(e=!1){if(hr!==void 0&&!e)return hr;if(window.navigator.permissions===void 0)return hr=!!window.navigator.geolocation,hr;try{hr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{hr=!!window.navigator.geolocation}return hr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Qo=0,$o=!1}_isOutOfMapMaxBounds(y){const e=this._map.getMaxBounds(),l=y.coords;return e&&(l.longitude<e.getWest()||l.longitude>e.getEast()||l.latitude<e.getSouth()||l.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),e=y.getSouthEast(),l=y.getNorthEast(),f=e.distanceTo(l),d=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Qo--,$o=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart")),this.fire(new u.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Qo++,Qo>1?(y={maximumAge:6e5,timeout:0},$o=!0):(y=this.options.positionOptions,$o=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=Oa,m.ImageSource=Ir,m.KeyboardHandler=vr,m.LngLatBounds=je,m.LogoControl=pu,m.Map=class extends jc{constructor(y){u.bf.mark(u.bg.create);const e=Object.assign(Object.assign({},lf),y);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new co(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new pi,this._controls=[],this._mapId=u.a4(),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},_u),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Te.addThrottleControl(()=>this.isMoving()),this._requestManager=new Pe(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const f=Wo(d=>{this._trackResize&&!this._removed&&(this.resize(d),this.redraw())},50);this._resizeObserver=new ResizeObserver(d=>{l?f(d):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new du(this,e),this._hash=e.hash&&new Oa(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,u.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new mo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new pu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new u.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new u.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new u.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(y,e){if(e===void 0&&(e=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=y.onAdd(this);this._controls.push(y);const f=this._controlPositions[e];return e.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(y);return e>-1&&this._controls.splice(e,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,e,l,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,e,l,f)}resize(y){var e;const l=this._containerDimensions(),f=l[0],d=l[1],_=this._getClampedPixelRatio(f,d);if(this._resizeCanvas(f,d,_),this.painter.resize(f,d,_),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const M=this._getClampedPixelRatio(f,d);this._resizeCanvas(f,d,M),this.painter.resize(f,d,M)}this.transform.resize(f,d),(e=this._requestedCameraState)===null||e===void 0||e.resize(f,d);const S=!this._moving;return S&&(this.stop(),this.fire(new u.k("movestart",y)).fire(new u.k("move",y))),this.fire(new u.k("resize",y)),S&&this.fire(new u.k("moveend",y)),this}_getClampedPixelRatio(y,e){const{0:l,1:f}=this._maxCanvasSize,d=this.getPixelRatio(),_=y*d,S=e*d;return Math.min(_>l?l/_:1,S>f?f/S:1)*d}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(je.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(u.N.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(u.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,e,l){if(y==="mouseenter"||y==="mouseover"){let f=!1;return{layers:e,listener:l,delegates:{mousemove:_=>{const S=e.filter(M=>this.getLayer(M)),T=S.length!==0?this.queryRenderedFeatures(_.point,{layers:S}):[];T.length?f||(f=!0,l.call(this,new zn(y,this,_.originalEvent,{features:T}))):f=!1},mouseout:()=>{f=!1}}}}if(y==="mouseleave"||y==="mouseout"){let f=!1;return{layers:e,listener:l,delegates:{mousemove:S=>{const T=e.filter(M=>this.getLayer(M));(T.length!==0?this.queryRenderedFeatures(S.point,{layers:T}):[]).length?f=!0:f&&(f=!1,l.call(this,new zn(y,this,S.originalEvent)))},mouseout:S=>{f&&(f=!1,l.call(this,new zn(y,this,S.originalEvent)))}}}}{const f=d=>{const _=e.filter(T=>this.getLayer(T)),S=_.length!==0?this.queryRenderedFeatures(d.point,{layers:_}):[];S.length&&(d.features=S,l.call(this,d),delete d.features)};return{layers:e,listener:l,delegates:{[y]:f}}}}_saveDelegatedListener(y,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(e)}_removeDelegatedListener(y,e,l){if(!this._delegatedListeners||!this._delegatedListeners[y])return;const f=this._delegatedListeners[y];for(let d=0;d<f.length;d++){const _=f[d];if(_.listener===l&&_.layers.length===e.length&&_.layers.every(S=>e.includes(S))){for(const S in _.delegates)this.off(S,_.delegates[S]);return void f.splice(d,1)}}}on(y,e,l){if(l===void 0)return super.on(y,e);const f=this._createDelegatedListener(y,typeof e=="string"?[e]:e,l);this._saveDelegatedListener(y,f);for(const d in f.delegates)this.on(d,f.delegates[d]);return this}once(y,e,l){if(l===void 0)return super.once(y,e);const f=typeof e=="string"?[e]:e,d=this._createDelegatedListener(y,f,l);for(const _ in d.delegates){const S=d.delegates[_];d.delegates[_]=(...T)=>{this._removeDelegatedListener(y,f,l),S(...T)}}this._saveDelegatedListener(y,d);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(y,e,l){return l===void 0?super.off(y,e):(this._removeDelegatedListener(y,typeof e=="string"?[e]:e,l),this)}queryRenderedFeatures(y,e){if(!this.style)return[];let l;const f=y instanceof u.P||Array.isArray(y),d=f?y:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(f?{}:y)||{},d instanceof u.P||typeof d[0]=="number")l=[u.P.convert(d)];else{const _=u.P.convert(d[0]),S=u.P.convert(d[1]);l=[_,new u.P(S.x,_.y),S,new u.P(_.x,S.y),_]}return this.style.queryRenderedFeatures(l,e,this.transform)}querySourceFeatures(y,e){return this.style.querySourceFeatures(y,e)}setStyle(y,e){return(e=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(y,e))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const e=this._locale[y];if(e==null)throw new Error(`Missing UI string '${y}'`);return e}_updateStyle(y,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,e));const l=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new xa(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,e,l):this.style.loadJSON(y,e,l),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,e){if(typeof y=="string"){const l=this._requestManager.transformRequest(y,"Style");u.h(l,new AbortController).then(f=>{this._updateDiff(f.data,e)}).catch(f=>{f&&this.fire(new u.j(f))})}else typeof y=="object"&&this._updateDiff(y,e)}_updateDiff(y,e){try{this.style.setState(y,e)&&this._update(!0)}catch(l){u.w(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(y,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(y,e){return this._lazyInitEmptyStyle(),this.style.addSource(y,e),this._update(!0)}isSourceLoaded(y){const e=this.style&&this.style.sourceCaches[y];if(e!==void 0)return e.loaded();this.fire(new u.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const e=this.style.sourceCaches[y.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&e.reload();for(const l in this.style._layers){const f=this.style._layers[l];f.type==="hillshade"&&f.source===y.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gu(this.painter,e,y),this.painter.renderToTexture=new Uc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=l=>{l.dataType==="style"?this.terrain.sourceCache.freeRtt():l.dataType==="source"&&l.tile&&(l.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(l.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:y})),this}getTerrain(){var y,e;return(e=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const e in y){const l=y[e]._tiles;for(const f in l){const d=l[f];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,e,l={}){const{pixelRatio:f=1,sdf:d=!1,stretchX:_,stretchY:S,content:T,textFitWidth:M,textFitHeight:z}=l;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||u.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:F,height:O,data:W}=e,Y=e;return this.style.addImage(y,{data:new u.R({width:F,height:O},new Uint8Array(W)),pixelRatio:f,stretchX:_,stretchY:S,content:T,textFitWidth:M,textFitHeight:z,sdf:d,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,y),this}}{const{width:F,height:O,data:W}=C.getImageData(e);this.style.addImage(y,{data:new u.R({width:F,height:O},W),pixelRatio:f,stretchX:_,stretchY:S,content:T,textFitWidth:M,textFitHeight:z,sdf:d,version:0})}}updateImage(y,e){const l=this.style.getImage(y);if(!l)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=e instanceof HTMLImageElement||u.b(e)?C.getImageData(e):e,{width:d,height:_,data:S}=f;if(d===void 0||_===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==l.data.width||_!==l.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(e instanceof HTMLImageElement||u.b(e));return l.data.replace(S,T),this.style.updateImage(y,l),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return Te.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,e){return this._lazyInitEmptyStyle(),this.style.addLayer(y,e),this._update(!0)}moveLayer(y,e){return this.style.moveLayer(y,e),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,e,l){return this.style.setLayerZoomRange(y,e,l),this._update(!0)}setFilter(y,e,l={}){return this.style.setFilter(y,e,l),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,e,l,f={}){return this.style.setPaintProperty(y,e,l,f),this._update(!0)}getPaintProperty(y,e){return this.style.getPaintProperty(y,e)}setLayoutProperty(y,e,l,f={}){return this.style.setLayoutProperty(y,e,l,f),this._update(!0)}getLayoutProperty(y,e){return this.style.getLayoutProperty(y,e)}setGlyphs(y,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,e,l={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,e,l,f=>{f||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,e,l=>{l||this._update(!0)}),this}setLight(y,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(y){return this._lazyInitEmptyStyle(),this.style.setSky(y),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(y,e){return this.style.setFeatureState(y,e),this._update()}removeFeatureState(y,e){return this.style.removeFeatureState(y,e),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,e=0;return this._container&&(y=this._container.clientWidth||400,e=this._container.clientHeight||300),[y,e]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const e=this._canvasContainer=P.create("div","maplibregl-canvas-container",y);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const l=this._containerDimensions(),f=this._getClampedPixelRatio(l[0],l[1]);this._resizeCanvas(l[0],l[1],f);const d=this._controlContainer=P.create("div","maplibregl-control-container",y),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{_[S]=P.create("div",`maplibregl-ctrl-${S} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,e,l){this._canvas.width=Math.floor(l*y),this._canvas.height=Math.floor(l*e),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{e={requestedAttributes:y},f&&(e.statusMessage=f.statusMessage,e.type=f.type)},{once:!0});const l=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!l){const f="Failed to initialize WebGL";throw e?(e.message=f,new Error(JSON.stringify(e))):new Error(f)}this.painter=new Fa(l,this.transform),H.testSupport(l)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let l=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,_=C.now();this.style.zoomHistory.update(d,_);const S=new u.z(d,{now:_,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),T=S.crossFadingFactor();T===1&&T===this._crossFadingFactor||(l=!0,this._crossFadingFactor=T),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bf.mark(u.bg.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||l)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,u.bf.mark(u.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Te.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),u.bf.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(y=>{u.bf.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return qc}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=zn,m.MapTouchEvent=Rs,m.MapWheelEvent=Bc,m.Marker=Xa,m.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const e=this._map.getZoom(),l=e===this._map.getMaxZoom(),f=e===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,l)=>{const f=this._map._getUIString(`NavigationControl.${l}`);e.title=f,e.setAttribute("aria-label",f)},this.options=u.e({},uf,y),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),P.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),P.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,e){const l=P.create("button",y,this._container);return l.type="button",l.addEventListener("click",e),l}},m.Popup=class extends u.E{constructor(y){super(),this.remove=()=>(this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var l;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=P.create("div","maplibregl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ki(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._trackPointer&&!e)return;const f=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let d=this.options.anchor;const _=Ja(this.options.offset);if(!d){const T=this._container.offsetWidth,M=this._container.offsetHeight;let z;z=f.y+_.bottom.y<M?["top"]:f.y>this._map.transform.height-M?["bottom"]:[],f.x<T/2?z.push("left"):f.x>this._map.transform.width-T/2&&z.push("right"),d=z.length===0?"bottom":z.join("-")}let S=f.add(_[d]);this.options.subpixelPositioning||(S=S.round()),P.setTransform(this._container,`${_o[d]} translate(${S.x}px,${S.y}px)`),Ha(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(Kt),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=u.N.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const e=document.createDocumentFragment(),l=document.createElement("body");let f;for(l.innerHTML=y;f=l.firstChild,f;)e.appendChild(f);return this.setDOMContent(e)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){return this._container&&this._container.classList.add(y),this}removeClassName(y){return this._container&&this._container.classList.remove(y),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Ka);y&&y.focus()}},m.RasterDEMTileSource=Vt,m.RasterTileSource=Ge,m.ScaleControl=class{constructor(y){this._onMove=()=>{ea(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,ea(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Kr),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=zr,m.Style=xa,m.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Yo,m.TwoFingersTouchRotateHandler=cu,m.TwoFingersTouchZoomHandler=lu,m.TwoFingersTouchZoomRotateHandler=fu,m.VectorTileSource=Ei,m.VideoSource=si,m.addSourceType=(y,e)=>u._(void 0,void 0,void 0,function*(){if(ps(y))throw new Error(`A source type called "${y}" already exists.`);((l,f)=>{Ut[l]=f})(y,e)}),m.clearPrewarmedResources=function(){const y=Lt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(St),Lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return Un().getRTLTextPluginStatus()},m.getVersion=function(){return vu},m.getWorkerCount=function(){return It.workerCount},m.getWorkerUrl=function(){return u.a.WORKER_URL},m.importScriptInWorkers=function(y){return _i().broadcast("IS",y)},m.prewarm=function(){Di().acquire(St)},m.setMaxParallelImageRequests=function(y){u.a.MAX_PARALLEL_IMAGE_REQUESTS=y},m.setRTLTextPlugin=function(y,e){return Un().setRTLTextPlugin(y,e)},m.setWorkerCount=function(y){It.workerCount=y},m.setWorkerUrl=function(y){u.a.WORKER_URL=y}});var g=o;return g})})(X_);var J_=X_.exports;const Wr=ev(J_);function Cm(s){let i;return o=>{if(o)for(let a in o){let h=i==null?void 0:i[a],g=o[a];h!==g&&s(a,g,h)}else if(i)for(let a in i)s(a,void 0,i[a]);i=o}}function tv(s,...i){let o=[s];for(let a of i)if(a)Array.isArray(a)&&a[0]===s?o.push(...a.slice(1)):o.push(a);else continue;if(o.length!==1)return o.length===2?o[1]:o}function iv(s){return s===!0?["has","point_count"]:s===!1?["!",["has","point_count"]]:void 0}function ec(s,i){return["case",["boolean",["feature-state","hover"],!1],i,s]}var ga=nv;function nv(s){var i,o,a;if(s){if(Array.isArray(s)){for(i=[],o=s.length,a=0;a<o;a++){var h=s[a];h!=null&&i.push(h)}return i}if(typeof s=="object"){i={};var g=Object.keys(s);for(o=g.length,a=0;a<o;a++){var m=g[a],u=s[m];u!=null&&(i[m]=u)}return i}}}function Im(s){let i=s[0],o,a,h=Em(s);return{c(){h.c(),o=Kn()},m(g,m){h.m(g,m),ke(g,o,m),a=!0},p(g,m){m[0]&1&&Nt(i,i=g[0])?(ki(),Le(h,1,1,Tt),Ti(),h=Em(g),h.c(),be(h,1),h.m(o.parentNode,o)):h.p(g,m)},i(g){a||(be(h),a=!0)},o(g){Le(h),a=!1},d(g){g&&Se(o),h.d(g)}}}function Em(s){let i;const o=s[36].default,a=on(o,s,s[35],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g[1]&16)&&ln(a,o,h,h[35],i?an(o,h[35],g,null):un(h[35]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function rv(s){let i,o,a=s[0]&&Im(s);return{c(){a&&a.c(),i=Kn()},m(h,g){a&&a.m(h,g),ke(h,i,g),o=!0},p(h,g){h[0]?a?(a.p(h,g),g[0]&1&&be(a,1)):(a=Im(h),a.c(),be(a,1),a.m(i.parentNode,i)):a&&(ki(),Le(a,1,1,()=>{a=null}),Ti())},i(h){o||(be(a),o=!0)},o(h){Le(a),o=!1},d(h){h&&Se(i),a&&a.d(h)}}}function sv(s,i,o){let a,h,g,m,u,w,I,E,C,P,H,U,{$$slots:ie={},$$scope:se}=i,{id:ae=Pl("layer")}=i,{source:$=void 0}=i,{sourceLayer:Te=void 0}=i,{beforeId:Pe=void 0}=i,{beforeLayerType:ve=void 0}=i,{type:De}=i,{paint:Ae=void 0}=i,{layout:B=void 0}=i,{filter:Z=void 0}=i,{applyToClusters:Q=void 0}=i,{minzoom:D=void 0}=i,{maxzoom:N=void 0}=i,{manageHoverState:ee=!1}=i,{hovered:me=null}=i,{interactive:ne=!0}=i,{hoverCursor:pe=void 0}=i,{eventsIfTopMost:Ce=!1}=i;const fe=Ys(),{map:qe,source:nt,self:lt,minzoom:at,maxzoom:ut,eventTopMost:St,layerInfo:It}=K1();Pt(s,qe,Ne=>o(31,C=Ne)),Pt(s,nt,Ne=>o(32,P=Ne)),Pt(s,lt,Ne=>o(0,E=Ne)),Pt(s,at,Ne=>o(34,U=Ne)),Pt(s,ut,Ne=>o(33,H=Ne)),mr(()=>{E&&C&&(It.delete(E),C==null||C.removeLayer(E))});let st;function Lt(Ne){var $e,Ei;if(!ne||!E||!C||Ce&&St(Ne)!==E)return;let yt=Ne.features??[],Qt=(Ei=($e=yt[0])==null?void 0:$e.properties)==null?void 0:Ei.cluster_id,je={event:Ne,map:C,clusterId:Qt,layer:E,source:u,features:yt};fe(Ne.type,je)}function wi(Ne){var $e,Ei;if(!ne||!E||!C||Ce&&St(Ne)!==E)return;pe&&(C.getCanvas().style.cursor=pe);let yt=Ne.features??[];o(6,me=yt[0]??null);let Qt=(Ei=($e=yt[0])==null?void 0:$e.properties)==null?void 0:Ei.cluster_id;fe("mouseenter",{event:Ne,map:C,clusterId:Qt,layer:E,source:u,features:yt})}function Di(Ne){var $e,Ei,Ge;if(!ne||!C)return;if(Ce&&St(Ne)!==E){o(6,me=null),ee&&st!==void 0&&(C==null||C.setFeatureState({source:u,sourceLayer:Te,id:st},{hover:!1}),st=void 0);return}C.getCanvas().style.cursor=pe;let yt=Ne.features??[],Qt=(Ei=($e=yt[0])==null?void 0:$e.properties)==null?void 0:Ei.cluster_id,je=(Ge=yt[0])==null?void 0:Ge.id;je!==st&&(ee&&(st!==void 0&&(C==null||C.setFeatureState({source:u,id:st,sourceLayer:Te},{hover:!1})),C==null||C.setFeatureState({source:u,id:je,sourceLayer:Te},{hover:!0})),st=je,o(6,me=yt[0]??null)),fe("mousemove",{event:Ne,map:C,clusterId:Qt,layer:E,source:u,features:yt})}function Zi(Ne){if(!(!ne||!E||!C)){if(pe&&(C.getCanvas().style.cursor=""),o(6,me=null),ee&&st!==void 0){const yt={source:u,id:st,sourceLayer:Te};C==null||C.setFeatureState(yt,{hover:!1}),st=void 0}fe("mouseleave",{map:C,layer:E,source:u})}}let _i=!0;function Si(Ne){C&&(C.off("click",Ne,Lt),C.off("dblclick",Ne,Lt),C.off("contextmenu",Ne,Lt),C.off("mouseenter",Ne,wi),C.off("mousemove",Ne,Di),C.off("mouseleave",Ne,Zi))}return mr(()=>{C&&E&&Si(E)}),s.$$set=Ne=>{"id"in Ne&&o(7,ae=Ne.id),"source"in Ne&&o(8,$=Ne.source),"sourceLayer"in Ne&&o(9,Te=Ne.sourceLayer),"beforeId"in Ne&&o(10,Pe=Ne.beforeId),"beforeLayerType"in Ne&&o(11,ve=Ne.beforeLayerType),"type"in Ne&&o(12,De=Ne.type),"paint"in Ne&&o(13,Ae=Ne.paint),"layout"in Ne&&o(14,B=Ne.layout),"filter"in Ne&&o(15,Z=Ne.filter),"applyToClusters"in Ne&&o(16,Q=Ne.applyToClusters),"minzoom"in Ne&&o(17,D=Ne.minzoom),"maxzoom"in Ne&&o(18,N=Ne.maxzoom),"manageHoverState"in Ne&&o(19,ee=Ne.manageHoverState),"hovered"in Ne&&o(6,me=Ne.hovered),"interactive"in Ne&&o(20,ne=Ne.interactive),"hoverCursor"in Ne&&o(21,pe=Ne.hoverCursor),"eventsIfTopMost"in Ne&&o(22,Ce=Ne.eventsIfTopMost),"$$scope"in Ne&&o(35,se=Ne.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&65536&&o(30,a=iv(Q)),s.$$.dirty[0]&1073774592&&o(24,h=tv("all",a,Z)),s.$$.dirty[0]&131072|s.$$.dirty[1]&8&&o(26,g=D??U),s.$$.dirty[0]&262144|s.$$.dirty[1]&4&&o(25,m=N??H),s.$$.dirty[0]&256|s.$$.dirty[1]&2&&o(29,u=$||P),s.$$.dirty[0]&654343809|s.$$.dirty[1]&1&&C&&E!==ae&&u){E&&(Si(E),It.delete(E));let Ne=Pe;if(!Pe&&ve){let yt=C.getStyle().layers,Qt=typeof ve=="function"?ve:$e=>$e.type===ve,je=yt==null?void 0:yt.find(Qt);je&&(Ne=je.id)}xi(lt,E=ae,E),C.addLayer(ga({id:E,type:De,source:u,"source-layer":Te,filter:h,paint:Ae,layout:B,minzoom:g,maxzoom:m}),Ne),o(23,_i=!0),C.on("click",E,Lt),C.on("dblclick",E,Lt),C.on("contextmenu",E,Lt),C.on("mouseenter",E,wi),C.on("mousemove",E,Di),C.on("mouseleave",E,Zi)}s.$$.dirty[0]&1048577&&E&&It.set(E,{interactive:ne}),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&o(28,w=E?Cm((Ne,yt)=>{C!=null&&C.style._loaded?C.setPaintProperty(E,Ne,yt):C==null||C.once("styledata",()=>C==null?void 0:C.setPaintProperty(E,Ne,yt))}):void 0),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&o(27,I=E?Cm((Ne,yt)=>{C!=null&&C.style._loaded?C.setLayoutProperty(E,Ne,yt):C==null||C.once("styledata",()=>C==null?void 0:C.setLayoutProperty(E,Ne,yt))}):void 0),s.$$.dirty[0]&268443648&&(w==null||w(Ae)),s.$$.dirty[0]&134234112&&(I==null||I(B)),s.$$.dirty[0]&100663297|s.$$.dirty[1]&1&&E&&(C==null||C.setLayerZoomRange(E,g,m)),s.$$.dirty[0]&25165825|s.$$.dirty[1]&1&&E&&(_i?o(23,_i=!1):C==null||C.setFilter(E,h))},[E,qe,nt,lt,at,ut,me,ae,$,Te,Pe,ve,De,Ae,B,Z,Q,D,N,ee,ne,pe,Ce,_i,h,m,g,I,w,u,a,C,P,H,U,se,ie]}let Rh=class extends Wt{constructor(i){super(),Gt(this,i,sv,rv,Nt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function ov(s){let i;const o=s[16].default,a=on(o,s,s[24],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&16777216)&&ln(a,o,h,h[24],i?an(o,h[24],g,null):un(h[24]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function av(s){let i,o,a;function h(m){s[17](m)}let g={id:s[1],type:"circle",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],applyToClusters:s[9],minzoom:s[10],maxzoom:s[11],hoverCursor:s[12],manageHoverState:s[13],eventsIfTopMost:s[14],interactive:s[15],$$slots:{default:[ov]},$$scope:{ctx:s}};return s[0]!==void 0&&(g.hovered=s[0]),i=new Rh({props:g}),gi.push(()=>hn(i,"hovered",h)),i.$on("click",s[18]),i.$on("dblclick",s[19]),i.$on("contextmenu",s[20]),i.$on("mouseenter",s[21]),i.$on("mousemove",s[22]),i.$on("mouseleave",s[23]),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,[u]){const w={};u&2&&(w.id=m[1]),u&4&&(w.source=m[2]),u&8&&(w.sourceLayer=m[3]),u&16&&(w.beforeId=m[4]),u&32&&(w.beforeLayerType=m[5]),u&64&&(w.paint=m[6]),u&128&&(w.layout=m[7]),u&256&&(w.filter=m[8]),u&512&&(w.applyToClusters=m[9]),u&1024&&(w.minzoom=m[10]),u&2048&&(w.maxzoom=m[11]),u&4096&&(w.hoverCursor=m[12]),u&8192&&(w.manageHoverState=m[13]),u&16384&&(w.eventsIfTopMost=m[14]),u&32768&&(w.interactive=m[15]),u&16777216&&(w.$$scope={dirty:u,ctx:m}),!o&&u&1&&(o=!0,w.hovered=m[0],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function lv(s,i,o){let{$$slots:a={},$$scope:h}=i,{id:g=Pl("circle")}=i,{source:m=void 0}=i,{sourceLayer:u=void 0}=i,{beforeId:w=void 0}=i,{beforeLayerType:I=void 0}=i,{paint:E}=i,{layout:C=void 0}=i,{filter:P=void 0}=i,{applyToClusters:H=void 0}=i,{minzoom:U=void 0}=i,{maxzoom:ie=void 0}=i,{hoverCursor:se=void 0}=i,{manageHoverState:ae=!1}=i,{hovered:$=null}=i,{eventsIfTopMost:Te=!1}=i,{interactive:Pe=!0}=i;function ve(N){$=N,o(0,$)}function De(N){hi.call(this,s,N)}function Ae(N){hi.call(this,s,N)}function B(N){hi.call(this,s,N)}function Z(N){hi.call(this,s,N)}function Q(N){hi.call(this,s,N)}function D(N){hi.call(this,s,N)}return s.$$set=N=>{"id"in N&&o(1,g=N.id),"source"in N&&o(2,m=N.source),"sourceLayer"in N&&o(3,u=N.sourceLayer),"beforeId"in N&&o(4,w=N.beforeId),"beforeLayerType"in N&&o(5,I=N.beforeLayerType),"paint"in N&&o(6,E=N.paint),"layout"in N&&o(7,C=N.layout),"filter"in N&&o(8,P=N.filter),"applyToClusters"in N&&o(9,H=N.applyToClusters),"minzoom"in N&&o(10,U=N.minzoom),"maxzoom"in N&&o(11,ie=N.maxzoom),"hoverCursor"in N&&o(12,se=N.hoverCursor),"manageHoverState"in N&&o(13,ae=N.manageHoverState),"hovered"in N&&o(0,$=N.hovered),"eventsIfTopMost"in N&&o(14,Te=N.eventsIfTopMost),"interactive"in N&&o(15,Pe=N.interactive),"$$scope"in N&&o(24,h=N.$$scope)},[$,g,m,u,w,I,E,C,P,H,U,ie,se,ae,Te,Pe,a,ve,De,Ae,B,Z,Q,D,h]}let Y_=class extends Wt{constructor(i){super(),Gt(this,i,lv,av,Nt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function uv(s){let i,o;const a=s[7].default,h=on(a,s,s[6],null);return{c(){i=ge("div"),h&&h.c(),te(i,"class",s[1]),rr(i,"maplibregl-ctrl",s[0])},m(g,m){ke(g,i,m),h&&h.m(i,null),s[8](i),o=!0},p(g,[m]){h&&h.p&&(!o||m&64)&&ln(h,a,g,g[6],o?an(a,g[6],m,null):un(g[6]),null),(!o||m&2)&&te(i,"class",g[1]),(!o||m&3)&&rr(i,"maplibregl-ctrl",g[0])},i(g){o||(be(h,g),o=!0)},o(g){Le(h,g),o=!1},d(g){g&&Se(i),h&&h.d(g),s[8](null)}}}function cv(s,i,o){let a,{$$slots:h={},$$scope:g}=i,{defaultStyling:m=!0}=i,{position:u="top-right"}=i,{class:w=void 0}=i;const{map:I}=Do();Pt(s,I,H=>o(5,a=H));let E,C={onAdd(){return E},onRemove(){var H;(H=E==null?void 0:E.parentNode)==null||H.removeChild(E)}};mr(()=>{a==null||a.removeControl(C)});function P(H){gi[H?"unshift":"push"](()=>{E=H,o(2,E)})}return s.$$set=H=>{"defaultStyling"in H&&o(0,m=H.defaultStyling),"position"in H&&o(4,u=H.position),"class"in H&&o(1,w=H.class),"$$scope"in H&&o(6,g=H.$$scope)},s.$$.update=()=>{s.$$.dirty&52&&a&&E&&a.addControl(C,u)},[m,w,E,I,u,a,g,h,P]}class hv extends Wt{constructor(i){super(),Gt(this,i,cv,uv,Nt,{defaultStyling:0,position:4,class:1})}}function fv(s){let i;const o=s[15].default,a=on(o,s,s[23],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&8388608)&&ln(a,o,h,h[23],i?an(o,h[23],g,null):un(h[23]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function dv(s){let i,o,a;function h(m){s[16](m)}let g={id:s[1],type:"fill",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[fv]},$$scope:{ctx:s}};return s[0]!==void 0&&(g.hovered=s[0]),i=new Rh({props:g}),gi.push(()=>hn(i,"hovered",h)),i.$on("click",s[17]),i.$on("dblclick",s[18]),i.$on("contextmenu",s[19]),i.$on("mouseenter",s[20]),i.$on("mousemove",s[21]),i.$on("mouseleave",s[22]),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,[u]){const w={};u&2&&(w.id=m[1]),u&4&&(w.source=m[2]),u&8&&(w.sourceLayer=m[3]),u&16&&(w.beforeId=m[4]),u&32&&(w.beforeLayerType=m[5]),u&64&&(w.paint=m[6]),u&128&&(w.layout=m[7]),u&256&&(w.filter=m[8]),u&512&&(w.minzoom=m[9]),u&1024&&(w.maxzoom=m[10]),u&2048&&(w.hoverCursor=m[11]),u&4096&&(w.manageHoverState=m[12]),u&8192&&(w.eventsIfTopMost=m[13]),u&16384&&(w.interactive=m[14]),u&8388608&&(w.$$scope={dirty:u,ctx:m}),!o&&u&1&&(o=!0,w.hovered=m[0],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function pv(s,i,o){let{$$slots:a={},$$scope:h}=i,{id:g=Pl("fill")}=i,{source:m=void 0}=i,{sourceLayer:u=void 0}=i,{beforeId:w=void 0}=i,{beforeLayerType:I=void 0}=i,{paint:E}=i,{layout:C=void 0}=i,{filter:P=void 0}=i,{minzoom:H=void 0}=i,{maxzoom:U=void 0}=i,{hoverCursor:ie=void 0}=i,{manageHoverState:se=!1}=i,{hovered:ae=null}=i,{eventsIfTopMost:$=!1}=i,{interactive:Te=!0}=i;function Pe(D){ae=D,o(0,ae)}function ve(D){hi.call(this,s,D)}function De(D){hi.call(this,s,D)}function Ae(D){hi.call(this,s,D)}function B(D){hi.call(this,s,D)}function Z(D){hi.call(this,s,D)}function Q(D){hi.call(this,s,D)}return s.$$set=D=>{"id"in D&&o(1,g=D.id),"source"in D&&o(2,m=D.source),"sourceLayer"in D&&o(3,u=D.sourceLayer),"beforeId"in D&&o(4,w=D.beforeId),"beforeLayerType"in D&&o(5,I=D.beforeLayerType),"paint"in D&&o(6,E=D.paint),"layout"in D&&o(7,C=D.layout),"filter"in D&&o(8,P=D.filter),"minzoom"in D&&o(9,H=D.minzoom),"maxzoom"in D&&o(10,U=D.maxzoom),"hoverCursor"in D&&o(11,ie=D.hoverCursor),"manageHoverState"in D&&o(12,se=D.manageHoverState),"hovered"in D&&o(0,ae=D.hovered),"eventsIfTopMost"in D&&o(13,$=D.eventsIfTopMost),"interactive"in D&&o(14,Te=D.interactive),"$$scope"in D&&o(23,h=D.$$scope)},[ae,g,m,u,w,I,E,C,P,H,U,ie,se,$,Te,a,Pe,ve,De,Ae,B,Z,Q,h]}let Q_=class extends Wt{constructor(i){super(),Gt(this,i,pv,dv,Nt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function mv(s,i,o){let a;const{map:h}=Do();Pt(s,h,w=>o(4,a=w));let{position:g="top-left"}=i,{container:m=void 0}=i,u=null;return mr(()=>{a!=null&&a.loaded()&&u&&a.removeControl(u)}),s.$$set=w=>{"position"in w&&o(1,g=w.position),"container"in w&&o(2,m=w.container)},s.$$.update=()=>{if(s.$$.dirty&30&&a&&!u){let w;typeof m=="string"?w=document.querySelector(m)??void 0:w=m,o(3,u=new Wr.FullscreenControl({container:w})),a.addControl(u,g)}},[h,g,m,u,a]}class gv extends Wt{constructor(i){super(),Gt(this,i,mv,null,Nt,{position:1,container:2})}}function _v(s,i,o,a,h){let g=!1;s.getSource(i)&&(g=!0,s.removeSource(i));const m=()=>{a(i)&&(s.addSource(i,o),h())};if(g){const u=()=>{i&&(s.getSource(i)?setTimeout(u,1):m())};u()}else m()}function yv(s,i,o){q_().then(()=>{let a=F_(s);if(!a)return;a.getSource(i)===o&&a.removeSource(i)})}function Mm(s){let i=s[0],o,a,h=Lm(s);return{c(){h.c(),o=Kn()},m(g,m){h.m(g,m),ke(g,o,m),a=!0},p(g,m){m&1&&Nt(i,i=g[0])?(ki(),Le(h,1,1,Tt),Ti(),h=Lm(g),h.c(),be(h,1),h.m(o.parentNode,o)):h.p(g,m)},i(g){a||(be(h),a=!0)},o(g){Le(h),a=!1},d(g){g&&Se(o),h.d(g)}}}function Lm(s){let i;const o=s[19].default,a=on(o,s,s[18],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&262144)&&ln(a,o,h,h[18],i?an(o,h[18],g,null):un(h[18]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function vv(s){let i,o,a=s[0]&&Mm(s);return{c(){a&&a.c(),i=Kn()},m(h,g){a&&a.m(h,g),ke(h,i,g),o=!0},p(h,[g]){h[0]?a?(a.p(h,g),g&1&&be(a,1)):(a=Mm(h),a.c(),be(a,1),a.m(i.parentNode,i)):a&&(ki(),Le(a,1,1,()=>{a=null}),Ti())},i(h){o||(be(a),o=!0)},o(h){Le(a),o=!1},d(h){h&&Se(i),a&&a.d(h)}}}function bv(s,i,o){let a,h,g,{$$slots:m={},$$scope:u}=i,{id:w=Pl("geojson")}=i,{data:I}=i,{generateId:E=!1}=i,{promoteId:C=void 0}=i,{filter:P=void 0}=i,{lineMetrics:H=void 0}=i,{cluster:U=void 0}=i,{maxzoom:ie=void 0}=i,{attribution:se=void 0}=i,{buffer:ae=void 0}=i,{tolerance:$=void 0}=i;const{map:Te,cluster:Pe,self:ve}=X1();Pt(s,Te,B=>o(17,h=B)),Pt(s,Pe,B=>o(20,g=B)),Pt(s,ve,B=>o(0,a=B));let De,Ae=!0;return mr(()=>{a&&De&&h&&(yv(Te,a,De),xi(ve,a=null,a),o(15,De=void 0))}),s.$$set=B=>{"id"in B&&o(4,w=B.id),"data"in B&&o(5,I=B.data),"generateId"in B&&o(6,E=B.generateId),"promoteId"in B&&o(7,C=B.promoteId),"filter"in B&&o(8,P=B.filter),"lineMetrics"in B&&o(9,H=B.lineMetrics),"cluster"in B&&o(10,U=B.cluster),"maxzoom"in B&&o(11,ie=B.maxzoom),"attribution"in B&&o(12,se=B.attribution),"buffer"in B&&o(13,ae=B.buffer),"tolerance"in B&&o(14,$=B.tolerance),"$$scope"in B&&o(18,u=B.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&xi(Pe,g=U,g),s.$$.dirty&196593&&h&&a!==w&&(xi(ve,a=w,a),_v(h,a,ga({type:"geojson",data:I,filter:P,lineMetrics:H,generateId:E,promoteId:C,cluster:!!U,clusterMinPoints:U==null?void 0:U.minPoints,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius,clusterProperties:U==null?void 0:U.properties,maxzoom:ie,attribution:se,buffer:ae,tolerance:$}),B=>h&&B===a,()=>{a&&(o(15,De=h==null?void 0:h.getSource(a)),o(16,Ae=!0))})),s.$$.dirty&131088&&(h==null||h.on("style.load",()=>{o(15,De=h==null?void 0:h.getSource(w))})),s.$$.dirty&98336&&De&&(Ae?o(16,Ae=!1):De.setData(I)),s.$$.dirty&33792&&(De==null||De.setClusterOptions(ga({cluster:!!U,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius})))},[a,Te,Pe,ve,w,I,E,C,P,H,U,ie,se,ae,$,De,Ae,h,u,m]}let ds=class extends Wt{constructor(i){super(),Gt(this,i,bv,vv,Nt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function xv(s,i,o){let a;const{map:h}=Do();Pt(s,h,P=>o(8,a=P));let{position:g="top-left"}=i,{positionOptions:m=void 0}=i,{fitBoundsOptions:u=void 0}=i,{trackUserLocation:w=!1}=i,{showAccuracyCircle:I=!0}=i,{showUserLocation:E=!0}=i,{control:C=null}=i;return mr(()=>{a!=null&&a.loaded()&&C&&a.removeControl(C)}),s.$$set=P=>{"position"in P&&o(2,g=P.position),"positionOptions"in P&&o(3,m=P.positionOptions),"fitBoundsOptions"in P&&o(4,u=P.fitBoundsOptions),"trackUserLocation"in P&&o(5,w=P.trackUserLocation),"showAccuracyCircle"in P&&o(6,I=P.showAccuracyCircle),"showUserLocation"in P&&o(7,E=P.showUserLocation),"control"in P&&o(1,C=P.control)},s.$$.update=()=>{s.$$.dirty&510&&a&&!C&&(o(1,C=new Wr.GeolocateControl({positionOptions:m,fitBoundsOptions:u,trackUserLocation:w,showAccuracyCircle:I,showUserLocation:E})),a.addControl(C,g))},[h,C,g,m,u,w,I,E,a]}class wv extends Wt{constructor(i){super(),Gt(this,i,xv,null,Nt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function Sv(s){let i;const o=s[15].default,a=on(o,s,s[23],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&8388608)&&ln(a,o,h,h[23],i?an(o,h[23],g,null):un(h[23]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function kv(s){let i,o,a;function h(m){s[16](m)}let g={id:s[1],type:"line",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[Sv]},$$scope:{ctx:s}};return s[0]!==void 0&&(g.hovered=s[0]),i=new Rh({props:g}),gi.push(()=>hn(i,"hovered",h)),i.$on("click",s[17]),i.$on("dblclick",s[18]),i.$on("contextmenu",s[19]),i.$on("mouseenter",s[20]),i.$on("mousemove",s[21]),i.$on("mouseleave",s[22]),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,[u]){const w={};u&2&&(w.id=m[1]),u&4&&(w.source=m[2]),u&8&&(w.sourceLayer=m[3]),u&16&&(w.beforeId=m[4]),u&32&&(w.beforeLayerType=m[5]),u&64&&(w.paint=m[6]),u&128&&(w.layout=m[7]),u&256&&(w.filter=m[8]),u&512&&(w.minzoom=m[9]),u&1024&&(w.maxzoom=m[10]),u&2048&&(w.hoverCursor=m[11]),u&4096&&(w.manageHoverState=m[12]),u&8192&&(w.eventsIfTopMost=m[13]),u&16384&&(w.interactive=m[14]),u&8388608&&(w.$$scope={dirty:u,ctx:m}),!o&&u&1&&(o=!0,w.hovered=m[0],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function Tv(s,i,o){let{$$slots:a={},$$scope:h}=i,{id:g=Pl("line")}=i,{source:m=void 0}=i,{sourceLayer:u=void 0}=i,{beforeId:w=void 0}=i,{beforeLayerType:I=void 0}=i,{paint:E}=i,{layout:C=void 0}=i,{filter:P=void 0}=i,{minzoom:H=void 0}=i,{maxzoom:U=void 0}=i,{hoverCursor:ie=void 0}=i,{manageHoverState:se=!1}=i,{hovered:ae=null}=i,{eventsIfTopMost:$=!1}=i,{interactive:Te=!0}=i;function Pe(D){ae=D,o(0,ae)}function ve(D){hi.call(this,s,D)}function De(D){hi.call(this,s,D)}function Ae(D){hi.call(this,s,D)}function B(D){hi.call(this,s,D)}function Z(D){hi.call(this,s,D)}function Q(D){hi.call(this,s,D)}return s.$$set=D=>{"id"in D&&o(1,g=D.id),"source"in D&&o(2,m=D.source),"sourceLayer"in D&&o(3,u=D.sourceLayer),"beforeId"in D&&o(4,w=D.beforeId),"beforeLayerType"in D&&o(5,I=D.beforeLayerType),"paint"in D&&o(6,E=D.paint),"layout"in D&&o(7,C=D.layout),"filter"in D&&o(8,P=D.filter),"minzoom"in D&&o(9,H=D.minzoom),"maxzoom"in D&&o(10,U=D.maxzoom),"hoverCursor"in D&&o(11,ie=D.hoverCursor),"manageHoverState"in D&&o(12,se=D.manageHoverState),"hovered"in D&&o(0,ae=D.hovered),"eventsIfTopMost"in D&&o(13,$=D.eventsIfTopMost),"interactive"in D&&o(14,Te=D.interactive),"$$scope"in D&&o(23,h=D.$$scope)},[ae,g,m,u,w,I,E,C,P,H,U,ie,se,$,Te,a,Pe,ve,De,Ae,B,Z,Q,h]}let Ro=class extends Wt{constructor(i){super(),Gt(this,i,Tv,kv,Nt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function Cv(s,i,o){let a;const h=Ys();let{layer:g=void 0}=i;const{map:m}=Do();Pt(s,m,E=>o(2,a=E));function u(E){h(E.type,{...E,map:m})}const w=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],I=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return mr(()=>{if(a)if(g)for(const E of w)a.off(E,g,u);else for(const E of I)a.off(E,u)}),s.$$set=E=>{"layer"in E&&o(1,g=E.layer)},s.$$.update=()=>{if(s.$$.dirty&6&&a)if(g)for(const E of w)a.on(E,g,u);else for(const E of I)a.on(E,u)},[m,g,a]}class Ld extends Wt{constructor(i){super(),Gt(this,i,Cv,null,Nt,{layer:1})}}function Iv(s){let i=s.getCenter(),o=Math.round(s.getZoom()*100)/100,a=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,a),g=Math.round(i.lat*h)/h,m=Math.round(i.lng*h)/h,u=`${o}/${g}/${m}`,w=s.getBearing(),I=s.getPitch();return(w||I)&&(u+=`/${Math.round(w*10)/10}`),I&&(u+=`/${Math.round(I)}`),`#${u}`}function Ev(s){return s.replace("#","").split("/").map(parseFloat)}var gl=Pd;function Pd(s,i){return s===i||s!==s&&i!==i?!0:typeof s!=typeof i||{}.toString.call(s)!={}.toString.call(i)||s!==Object(s)||!s?!1:Array.isArray(s)?Pm(s,i):{}.toString.call(s)=="[object Set]"?Pm(Array.from(s),Array.from(i)):{}.toString.call(s)=="[object Object]"?Lv(s,i):Mv(s,i)}function Mv(s,i){return s.toString()===i.toString()}function Pm(s,i){var o=s.length;if(o!=i.length)return!1;for(var a=0;a<o;a++)if(!Pd(s[a],i[a]))return!1;return!0}function Lv(s,i){var o=Object.keys(s),a=o.length;if(a!=Object.keys(i).length)return!1;for(var h=0;h<a;h++){var g=o[h];if(!(i.hasOwnProperty(g)&&Pd(s[g],i[g])))return!1}return!0}function Pv(s,i,o){let a;const{map:h}=Do();Pt(s,h,E=>o(6,a=E));let{position:g="top-left"}=i,{showCompass:m=!0}=i,{showZoom:u=!0}=i,{visualizePitch:w=!1}=i,I=null;return mr(()=>{a!=null&&a.loaded()&&I&&a.removeControl(I)}),s.$$set=E=>{"position"in E&&o(1,g=E.position),"showCompass"in E&&o(2,m=E.showCompass),"showZoom"in E&&o(3,u=E.showZoom),"visualizePitch"in E&&o(4,w=E.visualizePitch)},s.$$.update=()=>{s.$$.dirty&126&&a&&!I&&(o(5,I=new Wr.NavigationControl({showCompass:m,showZoom:u,visualizePitch:w})),a.addControl(I,g))},[h,g,m,u,w,I,a]}class $_ extends Wt{constructor(i){super(),Gt(this,i,Pv,null,Nt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function Av(s,i,o){let a;const{map:h}=Do();Pt(s,h,I=>o(5,a=I));let{position:g="bottom-left"}=i,{maxWidth:m=void 0}=i,{unit:u="metric"}=i,w=null;return mr(()=>{a!=null&&a.loaded()&&w&&a.removeControl(w)}),s.$$set=I=>{"position"in I&&o(1,g=I.position),"maxWidth"in I&&o(2,m=I.maxWidth),"unit"in I&&o(3,u=I.unit)},s.$$.update=()=>{s.$$.dirty&62&&a&&!w&&(o(4,w=new Wr.ScaleControl({maxWidth:m,unit:u})),a.addControl(w,g))},[h,g,m,u,w,a]}class ey extends Wt{constructor(i){super(),Gt(this,i,Av,null,Nt,{position:1,maxWidth:2,unit:3})}}const{window:zv}=I1,Dv=s=>({map:s[0]&16,loadedImages:s[0]&32,allImagesLoaded:s[0]&64}),Am=s=>({map:s[4],loadedImages:s[5],allImagesLoaded:s[6]});function zm(s){let i,o,a=s[3]&&Dm(s);const h=s[46].default,g=on(h,s,s[45],Am);return{c(){a&&a.c(),i=He(),g&&g.c()},m(m,u){a&&a.m(m,u),ke(m,i,u),g&&g.m(m,u),o=!0},p(m,u){m[3]?a?(a.p(m,u),u[0]&8&&be(a,1)):(a=Dm(m),a.c(),be(a,1),a.m(i.parentNode,i)):a&&(ki(),Le(a,1,1,()=>{a=null}),Ti()),g&&g.p&&(!o||u[0]&112|u[1]&16384)&&ln(g,h,m,m[45],o?an(h,m[45],u,Dv):un(m[45]),Am)},i(m){o||(be(a),be(g,m),o=!0)},o(m){Le(a),Le(g,m),o=!1},d(m){m&&Se(i),a&&a.d(m),g&&g.d(m)}}}function Dm(s){let i,o,a,h,g,m,u,w;return i=new $_({props:{position:s[7]}}),a=new wv({props:{position:s[7],fitBoundsOptions:{maxZoom:12}}}),g=new gv({props:{position:s[7]}}),u=new ey({props:{position:s[7]}}),{c(){it(i.$$.fragment),o=He(),it(a.$$.fragment),h=He(),it(g.$$.fragment),m=He(),it(u.$$.fragment)},m(I,E){et(i,I,E),ke(I,o,E),et(a,I,E),ke(I,h,E),et(g,I,E),ke(I,m,E),et(u,I,E),w=!0},p(I,E){const C={};E[0]&128&&(C.position=I[7]),i.$set(C);const P={};E[0]&128&&(P.position=I[7]),a.$set(P);const H={};E[0]&128&&(H.position=I[7]),g.$set(H);const U={};E[0]&128&&(U.position=I[7]),u.$set(U)},i(I){w||(be(i.$$.fragment,I),be(a.$$.fragment,I),be(g.$$.fragment,I),be(u.$$.fragment,I),w=!0)},o(I){Le(i.$$.fragment,I),Le(a.$$.fragment,I),Le(g.$$.fragment,I),Le(u.$$.fragment,I),w=!1},d(I){I&&(Se(o),Se(h),Se(m)),tt(i,I),tt(a,I),tt(g,I),tt(u,I)}}}function Rv(s){let i,o,a,h,g,m=s[4]&&s[0]&&zm(s);return{c(){i=ge("div"),m&&m.c(),te(i,"class",o=Il(s[2])+" svelte-p00lfq"),te(i,"data-testid","map-container"),rr(i,"expand-map",!s[2])},m(u,w){ke(u,i,w),m&&m.m(i,null),s[47](i),a=!0,h||(g=[At(zv,"hashchange",s[11]),ld(s[10].call(null,i))],h=!0)},p(u,w){u[4]&&u[0]?m?(m.p(u,w),w[0]&17&&be(m,1)):(m=zm(u),m.c(),be(m,1),m.m(i,null)):m&&(ki(),Le(m,1,1,()=>{m=null}),Ti()),(!a||w[0]&4&&o!==(o=Il(u[2])+" svelte-p00lfq"))&&te(i,"class",o),(!a||w[0]&4)&&rr(i,"expand-map",!u[2])},i(u){a||(be(m),a=!0)},o(u){Le(m),a=!1},d(u){u&&Se(i),m&&m.d(),s[47](null),h=!1,xn(g)}}}function Bv(s,i,o){let a,h,g,m,{$$slots:u={},$$scope:w}=i,{map:I=null}=i,{mapContainer:E=void 0}=i,{class:C=void 0}=i,{style:P}=i,{diffStyleUpdates:H=!1}=i,{center:U=void 0}=i,{zoom:ie=void 0}=i,{pitch:se=0}=i,{bearing:ae=0}=i,{bounds:$=void 0}=i,{hash:Te=!1}=i,{updateHash:Pe=Ge=>{window.history.replaceState(window.history.state,"",Ge)}}=i,{loaded:ve=!1}=i,{minZoom:De=0}=i,{maxZoom:Ae=22}=i,{minPitch:B=0}=i,{maxPitch:Z=60}=i,{renderWorldCopies:Q=void 0}=i,{dragPan:D=void 0}=i,{dragRotate:N=void 0}=i,{pitchWithRotate:ee=void 0}=i,{antialias:me=void 0}=i,{zoomOnDoubleClick:ne=!0}=i,{locale:pe=void 0}=i,{interactive:Ce=!0}=i,{attributionControl:fe=!0}=i,{cooperativeGestures:qe=!1}=i,{preserveDrawingBuffer:nt=!1}=i,{maxBounds:lt=void 0}=i,{images:at=[]}=i,{standardControls:ut=!1}=i,{filterLayers:St=void 0}=i,{transformRequest:It=void 0}=i;const st=Ys(),{map:Lt,loadedImages:wi}=H1();Pt(s,Lt,Ge=>o(4,g=Ge)),Pt(s,wi,Ge=>o(5,m=Ge));let Di=new Set;async function Zi(Ge,Vt=!1){if(g&&!(!g.loaded()&&!Vt))if("url"in Ge){Di.add(Ge.id);try{let Ri=await g.loadImage(Ge.url);g==null||g.addImage(Ge.id,Ri.data,Ge.options),m.add(Ge.id),wi.set(m)}catch(Ri){st("error",Ri)}finally{Di.delete(Ge.id)}}else g.addImage(Ge.id,Ge.data,Ge.options),m.add(Ge.id),wi.set(m)}let _i,Si,Ne,yt;function Qt(Ge){return $e(),xi(Lt,g=new Wr.Map(ga({container:Ge,style:P,locale:pe,center:U,zoom:ie,pitch:se,bearing:ae,minZoom:De,maxZoom:Ae,minPitch:B,maxPitch:Z,renderWorldCopies:Q,dragPan:D,dragRotate:N,pitchWithRotate:ee,antialias:me,interactive:Ce,preserveDrawingBuffer:nt,maxBounds:lt,bounds:$,attributionControl:fe,transformRequest:It,cooperativeGestures:qe})),g),g.on("load",Vt=>{Vt.target.getContainer().setAttribute("data-testid","map"),Vt.target.getCanvas().setAttribute("data-testid","map-canvas"),o(0,ve=!0),st("load",g)}),g.on("error",Vt=>st("error",{...Vt,map:g})),g.on("movestart",Vt=>st("movestart",{...Vt,map:g})),g.on("moveend",Vt=>{if(o(12,U=Vt.target.getCenter()),o(13,ie=Vt.target.getZoom()),o(14,se=Vt.target.getPitch()),o(15,ae=Vt.target.getBearing()),o(16,$=Vt.target.getBounds()),st("moveend",{...Vt,map:g}),Te){let Ri=new URL(window.location.href.replace(/(#.+)?$/,Iv(g)));Pe(Ri)}}),g.on("click",Vt=>st("click",{...Vt,map:g})),g.on("dblclick",Vt=>st("dblclick",{...Vt,map:g})),g.on("contextmenu",Vt=>st("contextmenu",{...Vt,map:g})),g.on("zoomstart",Vt=>st("zoomstart",{...Vt,map:g})),g.on("zoom",Vt=>{st("zoom",{...Vt,map:g})}),g.on("zoomend",Vt=>{st("zoomend",{...Vt,map:g})}),g.on("style.load",()=>{if(g){const Vt=g.getStyle();if(o(42,_i=Vt.layers.map(Ri=>Ri.id)),o(43,Si=Object.keys(Vt.sources)),yt)for(const[Ri,jn]of Object.entries(yt))g.addSource(Ri,jn);if(Ne)for(const Ri of Ne)g.addLayer(Ri);for(const Ri of at)Zi(Ri,!0)}}),g.on("styledata",Vt=>{if(g&&St){const Ri=g.getStyle().layers;if(Ri)for(let jn of Ri)St(jn)||g.setLayoutProperty(jn.id,"visibility","none")}st("styledata",{...Vt,map:g})}),{destroy(){o(0,ve=!1),g==null||g.remove(),xi(Lt,g=null,g)}}}let je=P;function $e(){if(Te){let Ge=Ev(window.location.hash);Ge.length>=3&&(o(13,ie=Ge[0]),o(12,U=[Ge[2],Ge[1]])),Ge.length==5&&(o(15,ae=Ge[3]),o(14,se=Ge[4]))}}function Ei(Ge){gi[Ge?"unshift":"push"](()=>{E=Ge,o(1,E)})}return s.$$set=Ge=>{"map"in Ge&&o(17,I=Ge.map),"mapContainer"in Ge&&o(1,E=Ge.mapContainer),"class"in Ge&&o(2,C=Ge.class),"style"in Ge&&o(18,P=Ge.style),"diffStyleUpdates"in Ge&&o(19,H=Ge.diffStyleUpdates),"center"in Ge&&o(12,U=Ge.center),"zoom"in Ge&&o(13,ie=Ge.zoom),"pitch"in Ge&&o(14,se=Ge.pitch),"bearing"in Ge&&o(15,ae=Ge.bearing),"bounds"in Ge&&o(16,$=Ge.bounds),"hash"in Ge&&o(20,Te=Ge.hash),"updateHash"in Ge&&o(21,Pe=Ge.updateHash),"loaded"in Ge&&o(0,ve=Ge.loaded),"minZoom"in Ge&&o(22,De=Ge.minZoom),"maxZoom"in Ge&&o(23,Ae=Ge.maxZoom),"minPitch"in Ge&&o(24,B=Ge.minPitch),"maxPitch"in Ge&&o(25,Z=Ge.maxPitch),"renderWorldCopies"in Ge&&o(26,Q=Ge.renderWorldCopies),"dragPan"in Ge&&o(27,D=Ge.dragPan),"dragRotate"in Ge&&o(28,N=Ge.dragRotate),"pitchWithRotate"in Ge&&o(29,ee=Ge.pitchWithRotate),"antialias"in Ge&&o(30,me=Ge.antialias),"zoomOnDoubleClick"in Ge&&o(31,ne=Ge.zoomOnDoubleClick),"locale"in Ge&&o(32,pe=Ge.locale),"interactive"in Ge&&o(33,Ce=Ge.interactive),"attributionControl"in Ge&&o(34,fe=Ge.attributionControl),"cooperativeGestures"in Ge&&o(35,qe=Ge.cooperativeGestures),"preserveDrawingBuffer"in Ge&&o(36,nt=Ge.preserveDrawingBuffer),"maxBounds"in Ge&&o(37,lt=Ge.maxBounds),"images"in Ge&&o(38,at=Ge.images),"standardControls"in Ge&&o(3,ut=Ge.standardControls),"filterLayers"in Ge&&o(39,St=Ge.filterLayers),"transformRequest"in Ge&&o(40,It=Ge.transformRequest),"$$scope"in Ge&&o(45,w=Ge.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&8&&o(7,a=typeof ut=="boolean"?void 0:ut),s.$$.dirty[0]&16&&o(17,I=g),s.$$.dirty[0]&786448|s.$$.dirty[1]&14336&&g&&!gl(P,je)){const Ge=g.getStyle();if(_i&&(Ne=Ge.layers.filter(Vt=>!_i.includes(Vt.id))),Si){const Vt=Object.keys(Ge.sources).filter(Ri=>!Si.includes(Ri));yt={};for(const Ri of Vt)yt[Ri]=Ge.sources[Ri]}o(44,je=P),g.setStyle(P,{diff:H}),xi(wi,m=new Set,m),o(41,Di=new Set)}if(s.$$.dirty[0]&49|s.$$.dirty[1]&1152&&ve&&g!=null&&g.loaded())for(let Ge of at)!m.has(Ge.id)&&!Di.has(Ge.id)&&!g.hasImage(Ge.id)&&Zi(Ge);if(s.$$.dirty[0]&32|s.$$.dirty[1]&128&&o(6,h=at.every(Ge=>m.has(Ge.id))),s.$$.dirty[0]&61456&&g){let Ge={};U!=null&&!gl(U,g==null?void 0:g.getCenter())&&(Ge.center=U),ie!=null&&!gl(ie,g==null?void 0:g.getZoom())&&(Ge.zoom=ie),ae!=null&&!gl(ae,g==null?void 0:g.getBearing())&&(Ge.bearing=ae),se!=null&&!gl(se,g==null?void 0:g.getPitch())&&(Ge.pitch=se),Object.keys(Ge).length&&g.easeTo(Ge)}s.$$.dirty[0]&65552&&$&&!gl($,g==null?void 0:g.getBounds())&&(g==null||g.fitBounds($)),s.$$.dirty[0]&16|s.$$.dirty[1]&1&&(ne?g==null||g.doubleClickZoom.enable():g==null||g.doubleClickZoom.disable())},[ve,E,C,ut,g,m,h,a,Lt,wi,Qt,$e,U,ie,se,ae,$,I,P,H,Te,Pe,De,Ae,B,Z,Q,D,N,ee,me,ne,pe,Ce,fe,qe,nt,lt,at,St,It,Di,_i,Si,je,w,u,Ei]}class Fv extends Wt{constructor(i){super(),Gt(this,i,Bv,Rv,Nt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const Ov=s=>({marker:s&8}),Rm=s=>({marker:s[3]});function Nv(s){let i,o,a,h,g,m,u;const w=s[19].default,I=on(w,s,s[18],Rm);return{c(){i=ge("div"),I&&I.c(),te(i,"tabindex",o=s[1]?0:void 0),te(i,"role",a=s[1]?"button":void 0),Bi(i,"z-index",s[2])},m(E,C){ke(E,i,C),I&&I.m(i,null),g=!0,m||(u=[ld(s[7].call(null,i)),ld(h=Vv.call(null,i,s[0])),At(i,"click",Th(s[20])),At(i,"dblclick",Th(s[21])),At(i,"contextmenu",Th(N_(s[22]))),At(i,"mouseenter",s[23]),At(i,"mouseleave",s[24]),At(i,"mousemove",s[25]),At(i,"keydown",s[8])],m=!0)},p(E,[C]){I&&I.p&&(!g||C&262152)&&ln(I,w,E,E[18],g?an(w,E[18],C,Ov):un(E[18]),Rm),(!g||C&2&&o!==(o=E[1]?0:void 0))&&te(i,"tabindex",o),(!g||C&2&&a!==(a=E[1]?"button":void 0))&&te(i,"role",a),h&&sc(h.update)&&C&1&&h.update.call(null,E[0]),C&4&&Bi(i,"z-index",E[2])},i(E){g||(be(I,E),g=!0)},o(E){Le(I,E),g=!1},d(E){E&&Se(i),I&&I.d(E),m=!1,xn(u)}}}function Vv(s,i){const o=s.className;function a(h){h?s.className=`${o} ${h}`:s.className=o}return a(i),{update:a}}function jv(s,i,o){let a,h,g,{$$slots:m={},$$scope:u}=i,{marker:w=void 0}=i,{lngLat:I}=i,{class:E=void 0}=i,{interactive:C=!0}=i,{asButton:P=!1}=i,{draggable:H=!1}=i,{feature:U=null}=i,{offset:ie=void 0}=i,{zIndex:se=void 0}=i,{rotation:ae=0}=i,{opacity:$=1}=i;const Te=Ys(),{map:Pe,layerEvent:ve,self:De,markerClickManager:Ae}=J1();Pt(s,Pe,fe=>o(27,g=fe)),Pt(s,ve,fe=>o(26,a=fe)),Pt(s,De,fe=>o(3,h=fe));function B(fe){xi(De,h=new Wr.Marker({element:fe,rotation:ae,draggable:H,offset:ie,opacity:$.toString()}).setLngLat(I).addTo(g),h),o(11,w=h);const qe=()=>D("dragstart"),nt=()=>{Z(),D("drag")},lt=()=>{Z(),D("dragend")};return H&&(h.on("dragstart",qe),h.on("drag",nt),h.on("dragend",lt)),{destroy(){H&&(h==null||h.off("dragstart",qe),h==null||h.off("drag",nt),h==null||h.off("dragend",lt)),o(11,w=void 0),h==null||h.remove()}}}function Z(){let fe=h==null?void 0:h.getLngLat();fe&&(Array.isArray(I)?o(10,I=[fe.lng,fe.lat]):I&&"lon"in I?o(10,I={lon:fe.lng,lat:fe.lat}):o(10,I=fe))}function Q(fe){fe.key===" "&&(fe.preventDefault(),fe.stopPropagation(),D("click"))}function D(fe){if(!C)return;let qe=h==null?void 0:h.getLngLat();if(!qe)return;const nt=[qe.lng,qe.lat];let lt={map:g,marker:h,lngLat:nt,features:[{type:"Feature",properties:(U==null?void 0:U.properties)??{},geometry:{type:"Point",coordinates:nt}}]};(fe==="click"||fe==="contextmenu")&&Ae.handleClick(lt),xi(ve,a={...lt,layerType:"marker",type:fe},a),Te(fe,lt)}const N=()=>D("click"),ee=()=>D("dblclick"),me=()=>{D("contextmenu")},ne=()=>{D("mouseenter")},pe=()=>{D("mouseleave")},Ce=()=>D("mousemove");return s.$$set=fe=>{"marker"in fe&&o(11,w=fe.marker),"lngLat"in fe&&o(10,I=fe.lngLat),"class"in fe&&o(0,E=fe.class),"interactive"in fe&&o(12,C=fe.interactive),"asButton"in fe&&o(1,P=fe.asButton),"draggable"in fe&&o(13,H=fe.draggable),"feature"in fe&&o(14,U=fe.feature),"offset"in fe&&o(15,ie=fe.offset),"zIndex"in fe&&o(2,se=fe.zIndex),"rotation"in fe&&o(16,ae=fe.rotation),"opacity"in fe&&o(17,$=fe.opacity),"$$scope"in fe&&o(18,u=fe.$$scope)},s.$$.update=()=>{s.$$.dirty&1032&&(h==null||h.setLngLat(I)),s.$$.dirty&32776&&(h==null||h.setOffset(ie??[0,0])),s.$$.dirty&65544&&(h==null||h.setRotation(ae)),s.$$.dirty&131080&&(h==null||h.setOpacity($.toString()))},[E,P,se,h,Pe,ve,De,B,Q,D,I,w,C,H,U,ie,ae,$,u,m,N,ee,me,ne,pe,Ce]}class fd extends Wt{constructor(i){super(),Gt(this,i,jv,Nv,Nt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const Uv=s=>({features:s[0]&16,data:s[0]&16,map:s[0]&4,close:s[0]&1}),Bm=s=>{var i;return{features:s[4],data:((i=s[4])==null?void 0:i[0])??null,map:s[2],close:s[31]}};function Fm(s){var h;let i,o,a=(((h=s[4])==null?void 0:h.length)||s[3]instanceof Wr.Marker)&&Om(s);return{c(){i=ge("div"),a&&a.c()},m(g,m){ke(g,i,m),a&&a.m(i,null),s[32](i),o=!0},p(g,m){var u;(u=g[4])!=null&&u.length||g[3]instanceof Wr.Marker?a?(a.p(g,m),m[0]&24&&be(a,1)):(a=Om(g),a.c(),be(a,1),a.m(i,null)):a&&(ki(),Le(a,1,1,()=>{a=null}),Ti())},i(g){o||(be(a),o=!0)},o(g){Le(a),o=!1},d(g){g&&Se(i),a&&a.d(),s[32](null)}}}function Om(s){let i;const o=s[30].default,a=on(o,s,s[29],Bm);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g[0]&536870933)&&ln(a,o,h,h[29],i?an(o,h[29],g,Uv):un(h[29]),Bm)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function qv(s){let i,o,a=s[9].default&&Fm(s);return{c(){a&&a.c(),i=Kn()},m(h,g){a&&a.m(h,g),ke(h,i,g),o=!0},p(h,g){h[9].default?a?(a.p(h,g),g[0]&512&&be(a,1)):(a=Fm(h),a.c(),be(a,1),a.m(i.parentNode,i)):a&&(ki(),Le(a,1,1,()=>{a=null}),Ti())},i(h){o||(be(a),o=!0)},o(h){Le(a),o=!1},d(h){h&&Se(i),a&&a.d(h)}}}function Zv(s,i,o){let a,h,g,m,u,w,{$$slots:I={},$$scope:E}=i;const C=C1(I);let{closeButton:P=void 0}=i,{closeOnClickOutside:H=!0}=i,{closeOnClickInside:U=!1}=i,{closeOnMove:ie=!1}=i,{openOn:se="click"}=i,{openIfTopMost:ae=!0}=i,{focusAfterOpen:$=!0}=i,{anchor:Te=void 0}=i,{offset:Pe=void 0}=i,{popupClass:ve=void 0}=i,{maxWidth:De=void 0}=i,{lngLat:Ae=void 0}=i,{html:B=void 0}=i,{open:Z=!1}=i;const Q=Ys(),{map:D,popupTarget:N,layerEvent:ee,layer:me,eventTopMost:ne,markerClickManager:pe}=Do();Pt(s,D,$e=>o(2,g=$e)),Pt(s,N,$e=>o(3,u=$e)),Pt(s,ee,$e=>o(28,m=$e)),Pt(s,me,$e=>o(35,w=$e));const Ce=["click","dblclick","contextmenu"];let fe,qe=!1,nt;function lt(){if(!fe)return;let $e=fe.getElement();!$e||$e===nt||(nt=$e,se==="hover"&&(nt.style.pointerEvents="none"),nt.addEventListener("mouseenter",()=>{o(24,qe=!0)},{passive:!0}),nt.addEventListener("mouseleave",()=>{o(24,qe=!1)},{passive:!0}),nt.addEventListener("click",()=>{U&&o(0,Z=!1)},{passive:!0}))}ac(()=>{if(g)return g.on("click",Si),g.on("contextmenu",Si),pe.add(Ne),typeof u=="string"&&(g.on("click",u,st),g.on("dblclick",u,st),g.on("contextmenu",u,st),g.on("mousemove",u,_i),g.on("mouseleave",u,Zi),g.on("touchstart",u,wi),g.on("touchend",u,Di)),()=>{g!=null&&g.loaded()&&(fe==null||fe.remove(),g.off("click",Si),g.off("contextmenu",Si),pe.remove(Ne),u instanceof Wr.Marker?u.getPopup()===fe&&u.setPopup(void 0):typeof u=="string"&&(g.off("click",u,st),g.off("dblclick",u,st),g.off("contextmenu",u,st),g.off("mousemove",u,_i),g.off("mouseleave",u,Zi),g.off("touchstart",u,wi),g.off("touchend",u,Di)))}});function at($e){return ae?!("marker"in $e)&&!Y1($e)&&ne($e)!==w:!1}let ut=null,St="normal";function It($e){"layerType"in $e&&$e.layerType==="deckgl"?(o(10,Ae=$e.coordinate),o(4,ut=$e.object?[$e.object]:null)):(o(10,Ae=$e.lngLat),o(4,ut=$e.features??[]))}function st($e){$e.type!==se||at($e)||(It($e),setTimeout(()=>o(0,Z=!0)))}let Lt=null;function wi($e){Lt=$e.point}function Di($e){if(!Lt||se!=="hover")return;let Ei=Lt.dist($e.point);Lt=null,Ei<3&&(o(10,Ae=$e.lngLat),o(4,ut=$e.features??[]),fe.isOpen()?o(25,St="justOpened"):(o(25,St="opening"),o(0,Z=!0)))}function Zi($e){se!=="hover"||Lt||St!=="normal"||(o(0,Z=!1),o(4,ut=null))}function _i($e){if(!(se!=="hover"||Lt||St!=="normal")){if(at($e)){o(0,Z=!1),o(4,ut=null);return}o(0,Z=!0),o(4,ut=$e.features??[]),o(10,Ae=$e.lngLat)}}function Si($e){if(St==="justOpened"){o(25,St="normal");return}if(!H)return;let Ei=[nt,u instanceof Wr.Marker?u==null?void 0:u.getElement():null];Z&&fe.isOpen()&&!Ei.some(Ge=>Ge==null?void 0:Ge.contains($e.originalEvent.target))&&($e.type==="contextmenu"&&se==="contextmenu"||$e.type!=="contextmenu")&&o(0,Z=!1)}function Ne($e){H&&Z&&fe.isOpen()&&$e.marker!==u&&o(0,Z=!1)}mr(()=>{g&&(fe!=null&&fe.isOpen())&&fe.remove()});let yt;const Qt=()=>o(0,Z=!1);function je($e){gi[$e?"unshift":"push"](()=>{yt=$e,o(1,yt)})}return s.$$set=$e=>{"closeButton"in $e&&o(11,P=$e.closeButton),"closeOnClickOutside"in $e&&o(12,H=$e.closeOnClickOutside),"closeOnClickInside"in $e&&o(13,U=$e.closeOnClickInside),"closeOnMove"in $e&&o(14,ie=$e.closeOnMove),"openOn"in $e&&o(15,se=$e.openOn),"openIfTopMost"in $e&&o(16,ae=$e.openIfTopMost),"focusAfterOpen"in $e&&o(17,$=$e.focusAfterOpen),"anchor"in $e&&o(18,Te=$e.anchor),"offset"in $e&&o(19,Pe=$e.offset),"popupClass"in $e&&o(20,ve=$e.popupClass),"maxWidth"in $e&&o(21,De=$e.maxWidth),"lngLat"in $e&&o(10,Ae=$e.lngLat),"html"in $e&&o(22,B=$e.html),"open"in $e&&o(0,Z=$e.open),"$$scope"in $e&&o(29,E=$e.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&14336&&o(27,a=P??(!H&&!U)),s.$$.dirty[0]&146685952&&(fe||(o(23,fe=new Wr.Popup({closeButton:a,closeOnClick:!1,closeOnMove:ie,focusAfterOpen:$,maxWidth:De,className:ve,anchor:Te,offset:Pe})),nt=fe.getElement(),fe.on("open",()=>{o(0,Z=!0),lt(),Q("open",fe)}),fe.on("close",()=>{o(0,Z=!1),Q("close",fe)}),fe.on("hover",()=>{Q("hover",fe)}))),s.$$.dirty[0]&8421384&&fe&&u instanceof Wr.Marker&&(se==="click"?u.setPopup(fe):u.getPopup()===fe&&u.setPopup(void 0)),s.$$.dirty[0]&268468224&&Ce.includes(se)&&(m==null?void 0:m.type)===se&&(st(m),xi(ee,m=null,m)),s.$$.dirty[0]&268468224&&o(26,h=se==="hover"&&((m==null?void 0:m.type)==="mousemove"||(m==null?void 0:m.type)==="mouseenter")),s.$$.dirty[0]&352354304&&se==="hover"&&ee&&(h&&m&&It(m),o(0,Z=(h||qe)??!1)),s.$$.dirty[0]&12582914&&(yt?fe.setDOMContent(yt):B&&fe.setHTML(B)),s.$$.dirty[0]&8389632&&Ae&&fe.setLngLat(Ae),s.$$.dirty[0]&41943045&&g){let $e=fe.isOpen();Z&&!$e?(fe.addTo(g),St==="opening"&&o(25,St="justOpened")):!Z&&$e&&fe.remove()}},[Z,yt,g,u,ut,D,N,ee,me,C,Ae,P,H,U,ie,se,ae,$,Te,Pe,ve,De,B,fe,qe,St,h,a,m,E,I,Qt,je]}class Gv extends Wt{constructor(i){super(),Gt(this,i,Zv,qv,Nt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var lc=Uint8Array,ty=Uint16Array,Wv=Int32Array,Hv=new lc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Xv=new lc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),iy=function(s,i){for(var o=new ty(31),a=0;a<31;++a)o[a]=i+=1<<s[a-1];for(var h=new Wv(o[30]),a=1;a<30;++a)for(var g=o[a];g<o[a+1];++g)h[g]=g-o[a]<<5|a;return{b:o,r:h}},ny=iy(Hv,2),Kv=ny.b,Jv=ny.r;Kv[28]=258,Jv[258]=28;iy(Xv,0);var Yv=new ty(32768);for(Vi=0;Vi<32768;++Vi)Gs=(Vi&43690)>>1|(Vi&21845)<<1,Gs=(Gs&52428)>>2|(Gs&13107)<<2,Gs=(Gs&61680)>>4|(Gs&3855)<<4,Yv[Vi]=((Gs&65280)>>8|(Gs&255)<<8)>>1;var Gs,Vi,Bh=new lc(288);for(Vi=0;Vi<144;++Vi)Bh[Vi]=8;var Vi;for(Vi=144;Vi<256;++Vi)Bh[Vi]=9;var Vi;for(Vi=256;Vi<280;++Vi)Bh[Vi]=7;var Vi;for(Vi=280;Vi<288;++Vi)Bh[Vi]=8;var Vi,Qv=new lc(32);for(Vi=0;Vi<32;++Vi)Qv[Vi]=5;var Vi,$v=new lc(0),eb=typeof TextDecoder<"u"&&new TextDecoder,tb=0;try{eb.decode($v,{stream:!0}),tb=1}catch{}function ib(s){let i;const o=s[16].default,a=on(o,s,s[24],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&16777216)&&ln(a,o,h,h[24],i?an(o,h[24],g,null):un(h[24]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function nb(s){let i,o,a;function h(m){s[17](m)}let g={id:s[1],type:"symbol",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],applyToClusters:s[9],minzoom:s[10],maxzoom:s[11],hoverCursor:s[12],manageHoverState:s[13],eventsIfTopMost:s[14],interactive:s[15],$$slots:{default:[ib]},$$scope:{ctx:s}};return s[0]!==void 0&&(g.hovered=s[0]),i=new Rh({props:g}),gi.push(()=>hn(i,"hovered",h)),i.$on("click",s[18]),i.$on("dblclick",s[19]),i.$on("contextmenu",s[20]),i.$on("mouseenter",s[21]),i.$on("mousemove",s[22]),i.$on("mouseleave",s[23]),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,[u]){const w={};u&2&&(w.id=m[1]),u&4&&(w.source=m[2]),u&8&&(w.sourceLayer=m[3]),u&16&&(w.beforeId=m[4]),u&32&&(w.beforeLayerType=m[5]),u&64&&(w.paint=m[6]),u&128&&(w.layout=m[7]),u&256&&(w.filter=m[8]),u&512&&(w.applyToClusters=m[9]),u&1024&&(w.minzoom=m[10]),u&2048&&(w.maxzoom=m[11]),u&4096&&(w.hoverCursor=m[12]),u&8192&&(w.manageHoverState=m[13]),u&16384&&(w.eventsIfTopMost=m[14]),u&32768&&(w.interactive=m[15]),u&16777216&&(w.$$scope={dirty:u,ctx:m}),!o&&u&1&&(o=!0,w.hovered=m[0],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function rb(s,i,o){let{$$slots:a={},$$scope:h}=i,{id:g=Pl("symbol")}=i,{source:m=void 0}=i,{sourceLayer:u=void 0}=i,{beforeId:w=void 0}=i,{beforeLayerType:I=void 0}=i,{paint:E=void 0}=i,{layout:C=void 0}=i,{filter:P=void 0}=i,{applyToClusters:H=void 0}=i,{minzoom:U=void 0}=i,{maxzoom:ie=void 0}=i,{hoverCursor:se=void 0}=i,{manageHoverState:ae=!1}=i,{hovered:$=null}=i,{eventsIfTopMost:Te=!1}=i,{interactive:Pe=!0}=i;function ve(N){$=N,o(0,$)}function De(N){hi.call(this,s,N)}function Ae(N){hi.call(this,s,N)}function B(N){hi.call(this,s,N)}function Z(N){hi.call(this,s,N)}function Q(N){hi.call(this,s,N)}function D(N){hi.call(this,s,N)}return s.$$set=N=>{"id"in N&&o(1,g=N.id),"source"in N&&o(2,m=N.source),"sourceLayer"in N&&o(3,u=N.sourceLayer),"beforeId"in N&&o(4,w=N.beforeId),"beforeLayerType"in N&&o(5,I=N.beforeLayerType),"paint"in N&&o(6,E=N.paint),"layout"in N&&o(7,C=N.layout),"filter"in N&&o(8,P=N.filter),"applyToClusters"in N&&o(9,H=N.applyToClusters),"minzoom"in N&&o(10,U=N.minzoom),"maxzoom"in N&&o(11,ie=N.maxzoom),"hoverCursor"in N&&o(12,se=N.hoverCursor),"manageHoverState"in N&&o(13,ae=N.manageHoverState),"hovered"in N&&o(0,$=N.hovered),"eventsIfTopMost"in N&&o(14,Te=N.eventsIfTopMost),"interactive"in N&&o(15,Pe=N.interactive),"$$scope"in N&&o(24,h=N.$$scope)},[$,g,m,u,w,I,E,C,P,H,U,ie,se,ae,Te,Pe,a,ve,De,Ae,B,Z,Q,D,h]}class sb extends Wt{constructor(i){super(),Gt(this,i,rb,nb,Nt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var jr=63710088e-1,ob={centimeters:jr*100,centimetres:jr*100,degrees:360/(2*Math.PI),feet:jr*3.28084,inches:jr*39.37,kilometers:jr/1e3,kilometres:jr/1e3,meters:jr,metres:jr,miles:jr/1609.344,millimeters:jr*1e3,millimetres:jr*1e3,nauticalmiles:jr/1852,radians:1,yards:jr*1.0936};function dd(s,i,o={}){const a={type:"Feature"};return(o.id===0||o.id)&&(a.id=o.id),o.bbox&&(a.bbox=o.bbox),a.properties=i||{},a.geometry=s,a}function mh(s,i,o={}){if(!s)throw new Error("coordinates is required");if(!Array.isArray(s))throw new Error("coordinates must be an Array");if(s.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Vm(s[0])||!Vm(s[1]))throw new Error("coordinates must contain numbers");return dd({type:"Point",coordinates:s},i,o)}function ab(s,i="kilometers"){const o=ob[i];if(!o)throw new Error(i+" units is invalid");return s*o}function Nm(s){return s%(2*Math.PI)*180/Math.PI}function Sl(s){return s%360*Math.PI/180}function Vm(s){return!isNaN(s)&&s!==null&&!Array.isArray(s)}function lb(s,i){var o,a,h,g,m,u,w,I,E,C,P=0,H=s.type==="FeatureCollection",U=s.type==="Feature",ie=H?s.features.length:1;for(o=0;o<ie;o++){for(u=H?s.features[o].geometry:U?s.geometry:s,I=H?s.features[o].properties:U?s.properties:{},E=H?s.features[o].bbox:U?s.bbox:void 0,C=H?s.features[o].id:U?s.id:void 0,w=u?u.type==="GeometryCollection":!1,m=w?u.geometries.length:1,h=0;h<m;h++){if(g=w?u.geometries[h]:u,g===null){if(i(null,P,I,E,C)===!1)return!1;continue}switch(g.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(g,P,I,E,C)===!1)return!1;break}case"GeometryCollection":{for(a=0;a<g.geometries.length;a++)if(i(g.geometries[a],P,I,E,C)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}P++}}function ub(s,i){lb(s,function(o,a,h,g,m){var u=o===null?null:o.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return i(dd(o,h,{bbox:g,id:m}),a,0)===!1?!1:void 0}var w;switch(u){case"MultiPoint":w="Point";break;case"MultiLineString":w="LineString";break;case"MultiPolygon":w="Polygon";break}for(var I=0;I<o.coordinates.length;I++){var E=o.coordinates[I],C={type:w,coordinates:E};if(i(dd(C,h),a,I)===!1)return!1}})}function jm(s,i,o){const a=s.slice();return a[4]=i[o],a}function Um(s){let i,o=s[4]+"",a;return{c(){i=ge("option"),a=ft(o),i.__value=s[4],Ui(i,i.__value)},m(h,g){ke(h,i,g),oe(i,a)},p:Tt,d(h){h&&Se(i)}}}function cb(s){let i,o,a,h,g,m,u=bn(Object.keys(rc)),w=[];for(let I=0;I<u.length;I+=1)w[I]=Um(jm(s,u,I));return{c(){i=ge("div"),o=ge("h5"),a=He(),h=ge("select");for(let I=0;I<w.length;I+=1)w[I].c();te(o,"class","fa-solid fa-layer-group me-2 align-self-center"),te(h,"class","form-select"),s[0]===void 0&&Ml(()=>s[3].call(h)),te(i,"class","svelte-1ixzryq"),Bi(i,"bottom",s[1])},m(I,E){ke(I,i,E),oe(i,o),oe(i,a),oe(i,h);for(let C=0;C<w.length;C+=1)w[C]&&w[C].m(h,null);El(h,s[0],!0),g||(m=At(h,"change",s[3]),g=!0)},p(I,[E]){if(E&0){u=bn(Object.keys(rc));let C;for(C=0;C<u.length;C+=1){const P=jm(I,u,C);w[C]?w[C].p(P,E):(w[C]=Um(P),w[C].c(),w[C].m(h,null))}for(;C<w.length;C+=1)w[C].d(1);w.length=u.length}E&1&&El(h,I[0]),E&2&&Bi(i,"bottom",I[1])},i:Tt,o:Tt,d(I){I&&Se(i),Cs(w,I),g=!1,m()}}}function hb(s,i,o){let{choice:a}=i,{bottom:h="60px"}=i,{style:g=rc[a]}=i;function m(){a=Cd(this),o(0,a)}return s.$$set=u=>{"choice"in u&&o(0,a=u.choice),"bottom"in u&&o(1,h=u.bottom),"style"in u&&o(2,g=u.style)},s.$$.update=()=>{s.$$.dirty&1&&o(2,g=rc[a])},[a,h,g,m]}class fb extends Wt{constructor(i){super(),Gt(this,i,hb,cb,Nt,{choice:0,bottom:1,style:2})}}var db=Object.defineProperty,pb=(s,i,o)=>i in s?db(s,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[i]=o,Jt=(s,i,o)=>pb(s,typeof i!="symbol"?i+"":i,o);function tc(){}function ry(s){return s()}function qm(){return Object.create(null)}function Fh(s){s.forEach(ry)}function sy(s){return typeof s=="function"}function mb(s,i){return s!=s?i==i:s!==i||s&&typeof s=="object"||typeof s=="function"}function gb(s){return Object.keys(s).length===0}function _b(s,i){s.appendChild(i)}function yb(s,i,o){s.insertBefore(i,o||null)}function oy(s){s.parentNode&&s.parentNode.removeChild(s)}function Zm(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Lo(s,i,o){o==null?s.removeAttribute(i):s.getAttribute(i)!==o&&s.setAttribute(i,o)}function vb(s){return Array.from(s.childNodes)}function gh(s,i,o){s.classList.toggle(i,!!o)}let Ad;function Ju(s){Ad=s}const vl=[],Gm=[];let Cl=[];const Wm=[],bb=Promise.resolve();let pd=!1;function xb(){pd||(pd=!0,bb.then(ay))}function md(s){Cl.push(s)}const nd=new Set;let _l=0;function ay(){if(_l!==0)return;const s=Ad;do{try{for(;_l<vl.length;){const i=vl[_l];_l++,Ju(i),wb(i.$$)}}catch(i){throw vl.length=0,_l=0,i}for(Ju(null),vl.length=0,_l=0;Gm.length;)Gm.pop()();for(let i=0;i<Cl.length;i+=1){const o=Cl[i];nd.has(o)||(nd.add(o),o())}Cl.length=0}while(vl.length);for(;Wm.length;)Wm.pop()();pd=!1,nd.clear(),Ju(s)}function wb(s){if(s.fragment!==null){s.update(),Fh(s.before_update);const i=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,i),s.after_update.forEach(md)}}function Sb(s){const i=[],o=[];Cl.forEach(a=>s.indexOf(a)===-1?i.push(a):o.push(a)),o.forEach(a=>a()),Cl=i}const kb=new Set;function Tb(s,i){s&&s.i&&(kb.delete(s),s.i(i))}function Cb(s,i,o){const{fragment:a,after_update:h}=s.$$;a&&a.m(i,o),md(()=>{const g=s.$$.on_mount.map(ry).filter(sy);s.$$.on_destroy?s.$$.on_destroy.push(...g):Fh(g),s.$$.on_mount=[]}),h.forEach(md)}function Ib(s,i){const o=s.$$;o.fragment!==null&&(Sb(o.after_update),Fh(o.on_destroy),o.fragment&&o.fragment.d(i),o.on_destroy=o.fragment=null,o.ctx=[])}function Eb(s,i){s.$$.dirty[0]===-1&&(vl.push(s),xb(),s.$$.dirty.fill(0)),s.$$.dirty[i/31|0]|=1<<i%31}function Mb(s,i,o,a,h,g,m=null,u=[-1]){const w=Ad;Ju(s);const I=s.$$={fragment:null,ctx:[],props:g,update:tc,not_equal:h,bound:qm(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(w?w.$$.context:[])),callbacks:qm(),dirty:u,skip_bound:!1,root:i.target||w.$$.root};m&&m(I.root);let E=!1;if(I.ctx=o?o(s,i.props||{},(C,P,...H)=>{const U=H.length?H[0]:P;return I.ctx&&h(I.ctx[C],I.ctx[C]=U)&&(!I.skip_bound&&I.bound[C]&&I.bound[C](U),E&&Eb(s,C)),P}):[],I.update(),E=!0,Fh(I.before_update),I.fragment=a?a(I.ctx):!1,i.target){if(i.hydrate){const C=vb(i.target);I.fragment&&I.fragment.l(C),C.forEach(oy)}else I.fragment&&I.fragment.c();i.intro&&Tb(s.$$.fragment),Cb(s,i.target,i.anchor),ay()}Ju(w)}class Lb{constructor(){Jt(this,"$$"),Jt(this,"$$set")}$destroy(){Ib(this,1),this.$destroy=tc}$on(i,o){if(!sy(o))return tc;const a=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return a.push(o),()=>{const h=a.indexOf(o);h!==-1&&a.splice(h,1)}}$set(i){this.$$set&&!gb(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const Pb="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Pb);function Ab(s){let i,o,a;return{c(){i=Zm("svg"),o=Zm("path"),Lo(o,"stroke-width","4"),Lo(o,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Lo(o,"class","svelte-gzo3ar"),Lo(i,"width",a=s[0]==="list"?20:void 0),Lo(i,"viewBox","0 0 70 85"),Lo(i,"fill","none"),Lo(i,"class","svelte-gzo3ar"),gh(i,"in-map",s[0]!=="list"),gh(i,"list-icon",s[0]==="list")},m(h,g){yb(h,i,g),_b(i,o)},p(h,[g]){g&1&&a!==(a=h[0]==="list"?20:void 0)&&Lo(i,"width",a),g&1&&gh(i,"in-map",h[0]!=="list"),g&1&&gh(i,"list-icon",h[0]==="list")},i:tc,o:tc,d(h){h&&oy(i)}}}function zb(s,i,o){let{displayIn:a}=i;return s.$$set=h=>{"displayIn"in h&&o(0,a=h.displayIn)},[a]}class Db extends Lb{constructor(i){super(),Mb(this,i,zb,Ab,mb,{displayIn:0})}}function Hm(s){const i=[...s];return i[2]<i[0]&&(Math.abs((i[0]+i[2]+360)/2)>Math.abs((i[0]-360+i[2])/2)?i[0]-=360:i[2]+=360),i}const Rb=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Bb={decimalLatitude:40.123,decimalLongitude:-74.123},Fb=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],Ob=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Nb(){const s=[];return Rb.forEach(i=>{i.decimalLatitude?s.push(i):s.push({...i,...Bb})}),[...s,...Fb,...Ob]}const Vb=Nb();Vb.map(s=>s.verbatimCoordinates);function ic(s,i,o={}){const a={type:"Feature"};return(o.id===0||o.id)&&(a.id=o.id),o.bbox&&(a.bbox=o.bbox),a.properties=i||{},a.geometry=s,a}function zd(s,i,o={}){for(const a of s){if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(a[a.length-1].length!==a[0].length)throw new Error("First and last Position are not equivalent.");for(let h=0;h<a[a.length-1].length;h++)if(a[a.length-1][h]!==a[0][h])throw new Error("First and last Position are not equivalent.")}return ic({type:"Polygon",coordinates:s},i,o)}function nc(s,i={}){const o={type:"FeatureCollection"};return i.id&&(o.id=i.id),i.bbox&&(o.bbox=i.bbox),o.features=s,o}function ly(s,i,o={}){return ic({type:"MultiPolygon",coordinates:s},i,o)}var jb=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,rd=Math.ceil,ts=Math.floor,Tr="[BigNumber Error] ",Xm=Tr+"Number primitive has more than 15 significant digits: ",cs=1e14,ci=14,Km=9007199254740991,sd=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Po=1e7,Ur=1e9;function uy(s){var i,o,a,h=$.prototype={constructor:$,toString:null,valueOf:null},g=new $(1),m=20,u=4,w=-7,I=21,E=-1e7,C=1e7,P=!1,H=1,U=0,ie={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},se="0123456789abcdefghijklmnopqrstuvwxyz",ae=!0;function $(B,Z){var Q,D,N,ee,me,ne,pe,Ce,fe=this;if(!(fe instanceof $))return new $(B,Z);if(Z==null){if(B&&B._isBigNumber===!0){fe.s=B.s,!B.c||B.e>C?fe.c=fe.e=null:B.e<E?fe.c=[fe.e=0]:(fe.e=B.e,fe.c=B.c.slice());return}if((ne=typeof B=="number")&&B*0==0){if(fe.s=1/B<0?(B=-B,-1):1,B===~~B){for(ee=0,me=B;me>=10;me/=10,ee++);ee>C?fe.c=fe.e=null:(fe.e=ee,fe.c=[B]);return}Ce=String(B)}else{if(!jb.test(Ce=String(B)))return a(fe,Ce,ne);fe.s=Ce.charCodeAt(0)==45?(Ce=Ce.slice(1),-1):1}(ee=Ce.indexOf("."))>-1&&(Ce=Ce.replace(".","")),(me=Ce.search(/e/i))>0?(ee<0&&(ee=me),ee+=+Ce.slice(me+1),Ce=Ce.substring(0,me)):ee<0&&(ee=Ce.length)}else{if(yn(Z,2,se.length,"Base"),Z==10&&ae)return fe=new $(B),De(fe,m+fe.e+1,u);if(Ce=String(B),ne=typeof B=="number"){if(B*0!=0)return a(fe,Ce,ne,Z);if(fe.s=1/B<0?(Ce=Ce.slice(1),-1):1,$.DEBUG&&Ce.replace(/^0\.0*|\./,"").length>15)throw Error(Xm+B)}else fe.s=Ce.charCodeAt(0)===45?(Ce=Ce.slice(1),-1):1;for(Q=se.slice(0,Z),ee=me=0,pe=Ce.length;me<pe;me++)if(Q.indexOf(D=Ce.charAt(me))<0){if(D=="."){if(me>ee){ee=pe;continue}}else if(!N&&(Ce==Ce.toUpperCase()&&(Ce=Ce.toLowerCase())||Ce==Ce.toLowerCase()&&(Ce=Ce.toUpperCase()))){N=!0,me=-1,ee=0;continue}return a(fe,String(B),ne,Z)}ne=!1,Ce=o(Ce,Z,10,fe.s),(ee=Ce.indexOf("."))>-1?Ce=Ce.replace(".",""):ee=Ce.length}for(me=0;Ce.charCodeAt(me)===48;me++);for(pe=Ce.length;Ce.charCodeAt(--pe)===48;);if(Ce=Ce.slice(me,++pe)){if(pe-=me,ne&&$.DEBUG&&pe>15&&(B>Km||B!==ts(B)))throw Error(Xm+fe.s*B);if((ee=ee-me-1)>C)fe.c=fe.e=null;else if(ee<E)fe.c=[fe.e=0];else{if(fe.e=ee,fe.c=[],me=(ee+1)%ci,ee<0&&(me+=ci),me<pe){for(me&&fe.c.push(+Ce.slice(0,me)),pe-=ci;me<pe;)fe.c.push(+Ce.slice(me,me+=ci));me=ci-(Ce=Ce.slice(me)).length}else me-=pe;for(;me--;Ce+="0");fe.c.push(+Ce)}}else fe.c=[fe.e=0]}$.clone=uy,$.ROUND_UP=0,$.ROUND_DOWN=1,$.ROUND_CEIL=2,$.ROUND_FLOOR=3,$.ROUND_HALF_UP=4,$.ROUND_HALF_DOWN=5,$.ROUND_HALF_EVEN=6,$.ROUND_HALF_CEIL=7,$.ROUND_HALF_FLOOR=8,$.EUCLID=9,$.config=$.set=function(B){var Z,Q;if(B!=null)if(typeof B=="object"){if(B.hasOwnProperty(Z="DECIMAL_PLACES")&&(Q=B[Z],yn(Q,0,Ur,Z),m=Q),B.hasOwnProperty(Z="ROUNDING_MODE")&&(Q=B[Z],yn(Q,0,8,Z),u=Q),B.hasOwnProperty(Z="EXPONENTIAL_AT")&&(Q=B[Z],Q&&Q.pop?(yn(Q[0],-1e9,0,Z),yn(Q[1],0,Ur,Z),w=Q[0],I=Q[1]):(yn(Q,-1e9,Ur,Z),w=-(I=Q<0?-Q:Q))),B.hasOwnProperty(Z="RANGE"))if(Q=B[Z],Q&&Q.pop)yn(Q[0],-1e9,-1,Z),yn(Q[1],1,Ur,Z),E=Q[0],C=Q[1];else if(yn(Q,-1e9,Ur,Z),Q)E=-(C=Q<0?-Q:Q);else throw Error(Tr+Z+" cannot be zero: "+Q);if(B.hasOwnProperty(Z="CRYPTO"))if(Q=B[Z],Q===!!Q)if(Q)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))P=Q;else throw P=!Q,Error(Tr+"crypto unavailable");else P=Q;else throw Error(Tr+Z+" not true or false: "+Q);if(B.hasOwnProperty(Z="MODULO_MODE")&&(Q=B[Z],yn(Q,0,9,Z),H=Q),B.hasOwnProperty(Z="POW_PRECISION")&&(Q=B[Z],yn(Q,0,Ur,Z),U=Q),B.hasOwnProperty(Z="FORMAT"))if(Q=B[Z],typeof Q=="object")ie=Q;else throw Error(Tr+Z+" not an object: "+Q);if(B.hasOwnProperty(Z="ALPHABET"))if(Q=B[Z],typeof Q=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(Q))ae=Q.slice(0,10)=="0123456789",se=Q;else throw Error(Tr+Z+" invalid: "+Q)}else throw Error(Tr+"Object expected: "+B);return{DECIMAL_PLACES:m,ROUNDING_MODE:u,EXPONENTIAL_AT:[w,I],RANGE:[E,C],CRYPTO:P,MODULO_MODE:H,POW_PRECISION:U,FORMAT:ie,ALPHABET:se}},$.isBigNumber=function(B){if(!B||B._isBigNumber!==!0)return!1;if(!$.DEBUG)return!0;var Z,Q,D=B.c,N=B.e,ee=B.s;e:if({}.toString.call(D)=="[object Array]"){if((ee===1||ee===-1)&&N>=-1e9&&N<=Ur&&N===ts(N)){if(D[0]===0){if(N===0&&D.length===1)return!0;break e}if(Z=(N+1)%ci,Z<1&&(Z+=ci),String(D[0]).length==Z){for(Z=0;Z<D.length;Z++)if(Q=D[Z],Q<0||Q>=cs||Q!==ts(Q))break e;if(Q!==0)return!0}}}else if(D===null&&N===null&&(ee===null||ee===1||ee===-1))return!0;throw Error(Tr+"Invalid BigNumber: "+B)},$.maximum=$.max=function(){return Pe(arguments,-1)},$.minimum=$.min=function(){return Pe(arguments,1)},$.random=function(){var B=9007199254740992,Z=Math.random()*B&2097151?function(){return ts(Math.random()*B)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(Q){var D,N,ee,me,ne,pe=0,Ce=[],fe=new $(g);if(Q==null?Q=m:yn(Q,0,Ur),me=rd(Q/ci),P)if(crypto.getRandomValues){for(D=crypto.getRandomValues(new Uint32Array(me*=2));pe<me;)ne=D[pe]*131072+(D[pe+1]>>>11),ne>=9e15?(N=crypto.getRandomValues(new Uint32Array(2)),D[pe]=N[0],D[pe+1]=N[1]):(Ce.push(ne%1e14),pe+=2);pe=me/2}else if(crypto.randomBytes){for(D=crypto.randomBytes(me*=7);pe<me;)ne=(D[pe]&31)*281474976710656+D[pe+1]*1099511627776+D[pe+2]*4294967296+D[pe+3]*16777216+(D[pe+4]<<16)+(D[pe+5]<<8)+D[pe+6],ne>=9e15?crypto.randomBytes(7).copy(D,pe):(Ce.push(ne%1e14),pe+=7);pe=me/7}else throw P=!1,Error(Tr+"crypto unavailable");if(!P)for(;pe<me;)ne=Z(),ne<9e15&&(Ce[pe++]=ne%1e14);for(me=Ce[--pe],Q%=ci,me&&Q&&(ne=sd[ci-Q],Ce[pe]=ts(me/ne)*ne);Ce[pe]===0;Ce.pop(),pe--);if(pe<0)Ce=[ee=0];else{for(ee=-1;Ce[0]===0;Ce.splice(0,1),ee-=ci);for(pe=1,ne=Ce[0];ne>=10;ne/=10,pe++);pe<ci&&(ee-=ci-pe)}return fe.e=ee,fe.c=Ce,fe}}(),$.sum=function(){for(var B=1,Z=arguments,Q=new $(Z[0]);B<Z.length;)Q=Q.plus(Z[B++]);return Q},o=function(){var B="0123456789";function Z(Q,D,N,ee){for(var me,ne=[0],pe,Ce=0,fe=Q.length;Ce<fe;){for(pe=ne.length;pe--;ne[pe]*=D);for(ne[0]+=ee.indexOf(Q.charAt(Ce++)),me=0;me<ne.length;me++)ne[me]>N-1&&(ne[me+1]==null&&(ne[me+1]=0),ne[me+1]+=ne[me]/N|0,ne[me]%=N)}return ne.reverse()}return function(Q,D,N,ee,me){var ne,pe,Ce,fe,qe,nt,lt,at,ut=Q.indexOf("."),St=m,It=u;for(ut>=0&&(fe=U,U=0,Q=Q.replace(".",""),at=new $(D),nt=at.pow(Q.length-ut),U=fe,at.c=Z(Ws($r(nt.c),nt.e,"0"),10,N,B),at.e=at.c.length),lt=Z(Q,D,N,me?(ne=se,B):(ne=B,se)),Ce=fe=lt.length;lt[--fe]==0;lt.pop());if(!lt[0])return ne.charAt(0);if(ut<0?--Ce:(nt.c=lt,nt.e=Ce,nt.s=ee,nt=i(nt,at,St,It,N),lt=nt.c,qe=nt.r,Ce=nt.e),pe=Ce+St+1,ut=lt[pe],fe=N/2,qe=qe||pe<0||lt[pe+1]!=null,qe=It<4?(ut!=null||qe)&&(It==0||It==(nt.s<0?3:2)):ut>fe||ut==fe&&(It==4||qe||It==6&&lt[pe-1]&1||It==(nt.s<0?8:7)),pe<1||!lt[0])Q=qe?Ws(ne.charAt(1),-St,ne.charAt(0)):ne.charAt(0);else{if(lt.length=pe,qe)for(--N;++lt[--pe]>N;)lt[pe]=0,pe||(++Ce,lt=[1].concat(lt));for(fe=lt.length;!lt[--fe];);for(ut=0,Q="";ut<=fe;Q+=ne.charAt(lt[ut++]));Q=Ws(Q,Ce,ne.charAt(0))}return Q}}(),i=function(){function B(D,N,ee){var me,ne,pe,Ce,fe=0,qe=D.length,nt=N%Po,lt=N/Po|0;for(D=D.slice();qe--;)pe=D[qe]%Po,Ce=D[qe]/Po|0,me=lt*pe+Ce*nt,ne=nt*pe+me%Po*Po+fe,fe=(ne/ee|0)+(me/Po|0)+lt*Ce,D[qe]=ne%ee;return fe&&(D=[fe].concat(D)),D}function Z(D,N,ee,me){var ne,pe;if(ee!=me)pe=ee>me?1:-1;else for(ne=pe=0;ne<ee;ne++)if(D[ne]!=N[ne]){pe=D[ne]>N[ne]?1:-1;break}return pe}function Q(D,N,ee,me){for(var ne=0;ee--;)D[ee]-=ne,ne=D[ee]<N[ee]?1:0,D[ee]=ne*me+D[ee]-N[ee];for(;!D[0]&&D.length>1;D.splice(0,1));}return function(D,N,ee,me,ne){var pe,Ce,fe,qe,nt,lt,at,ut,St,It,st,Lt,wi,Di,Zi,_i,Si,Ne=D.s==N.s?1:-1,yt=D.c,Qt=N.c;if(!yt||!yt[0]||!Qt||!Qt[0])return new $(!D.s||!N.s||(yt?Qt&&yt[0]==Qt[0]:!Qt)?NaN:yt&&yt[0]==0||!Qt?Ne*0:Ne/0);for(ut=new $(Ne),St=ut.c=[],Ce=D.e-N.e,Ne=ee+Ce+1,ne||(ne=cs,Ce=is(D.e/ci)-is(N.e/ci),Ne=Ne/ci|0),fe=0;Qt[fe]==(yt[fe]||0);fe++);if(Qt[fe]>(yt[fe]||0)&&Ce--,Ne<0)St.push(1),qe=!0;else{for(Di=yt.length,_i=Qt.length,fe=0,Ne+=2,nt=ts(ne/(Qt[0]+1)),nt>1&&(Qt=B(Qt,nt,ne),yt=B(yt,nt,ne),_i=Qt.length,Di=yt.length),wi=_i,It=yt.slice(0,_i),st=It.length;st<_i;It[st++]=0);Si=Qt.slice(),Si=[0].concat(Si),Zi=Qt[0],Qt[1]>=ne/2&&Zi++;do{if(nt=0,pe=Z(Qt,It,_i,st),pe<0){if(Lt=It[0],_i!=st&&(Lt=Lt*ne+(It[1]||0)),nt=ts(Lt/Zi),nt>1)for(nt>=ne&&(nt=ne-1),lt=B(Qt,nt,ne),at=lt.length,st=It.length;Z(lt,It,at,st)==1;)nt--,Q(lt,_i<at?Si:Qt,at,ne),at=lt.length,pe=1;else nt==0&&(pe=nt=1),lt=Qt.slice(),at=lt.length;if(at<st&&(lt=[0].concat(lt)),Q(It,lt,st,ne),st=It.length,pe==-1)for(;Z(Qt,It,_i,st)<1;)nt++,Q(It,_i<st?Si:Qt,st,ne),st=It.length}else pe===0&&(nt++,It=[0]);St[fe++]=nt,It[0]?It[st++]=yt[wi]||0:(It=[yt[wi]],st=1)}while((wi++<Di||It[0]!=null)&&Ne--);qe=It[0]!=null,St[0]||St.splice(0,1)}if(ne==cs){for(fe=1,Ne=St[0];Ne>=10;Ne/=10,fe++);De(ut,ee+(ut.e=fe+Ce*ci-1)+1,me,qe)}else ut.e=Ce,ut.r=+qe;return ut}}();function Te(B,Z,Q,D){var N,ee,me,ne,pe;if(Q==null?Q=u:yn(Q,0,8),!B.c)return B.toString();if(N=B.c[0],me=B.e,Z==null)pe=$r(B.c),pe=D==1||D==2&&(me<=w||me>=I)?yh(pe,me):Ws(pe,me,"0");else if(B=De(new $(B),Z,Q),ee=B.e,pe=$r(B.c),ne=pe.length,D==1||D==2&&(Z<=ee||ee<=w)){for(;ne<Z;pe+="0",ne++);pe=yh(pe,ee)}else if(Z-=me,pe=Ws(pe,ee,"0"),ee+1>ne){if(--Z>0)for(pe+=".";Z--;pe+="0");}else if(Z+=ee-ne,Z>0)for(ee+1==ne&&(pe+=".");Z--;pe+="0");return B.s<0&&N?"-"+pe:pe}function Pe(B,Z){for(var Q,D,N=1,ee=new $(B[0]);N<B.length;N++)D=new $(B[N]),(!D.s||(Q=ua(ee,D))===Z||Q===0&&ee.s===Z)&&(ee=D);return ee}function ve(B,Z,Q){for(var D=1,N=Z.length;!Z[--N];Z.pop());for(N=Z[0];N>=10;N/=10,D++);return(Q=D+Q*ci-1)>C?B.c=B.e=null:Q<E?B.c=[B.e=0]:(B.e=Q,B.c=Z),B}a=function(){var B=/^(-?)0([xbo])(?=\w[\w.]*$)/i,Z=/^([^.]+)\.$/,Q=/^\.([^.]+)$/,D=/^-?(Infinity|NaN)$/,N=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(ee,me,ne,pe){var Ce,fe=ne?me:me.replace(N,"");if(D.test(fe))ee.s=isNaN(fe)?null:fe<0?-1:1;else{if(!ne&&(fe=fe.replace(B,function(qe,nt,lt){return Ce=(lt=lt.toLowerCase())=="x"?16:lt=="b"?2:8,!pe||pe==Ce?nt:qe}),pe&&(Ce=pe,fe=fe.replace(Z,"$1").replace(Q,"0.$1")),me!=fe))return new $(fe,Ce);if($.DEBUG)throw Error(Tr+"Not a"+(pe?" base "+pe:"")+" number: "+me);ee.s=null}ee.c=ee.e=null}}();function De(B,Z,Q,D){var N,ee,me,ne,pe,Ce,fe,qe=B.c,nt=sd;if(qe){e:{for(N=1,ne=qe[0];ne>=10;ne/=10,N++);if(ee=Z-N,ee<0)ee+=ci,me=Z,pe=qe[Ce=0],fe=ts(pe/nt[N-me-1]%10);else if(Ce=rd((ee+1)/ci),Ce>=qe.length)if(D){for(;qe.length<=Ce;qe.push(0));pe=fe=0,N=1,ee%=ci,me=ee-ci+1}else break e;else{for(pe=ne=qe[Ce],N=1;ne>=10;ne/=10,N++);ee%=ci,me=ee-ci+N,fe=me<0?0:ts(pe/nt[N-me-1]%10)}if(D=D||Z<0||qe[Ce+1]!=null||(me<0?pe:pe%nt[N-me-1]),D=Q<4?(fe||D)&&(Q==0||Q==(B.s<0?3:2)):fe>5||fe==5&&(Q==4||D||Q==6&&(ee>0?me>0?pe/nt[N-me]:0:qe[Ce-1])%10&1||Q==(B.s<0?8:7)),Z<1||!qe[0])return qe.length=0,D?(Z-=B.e+1,qe[0]=nt[(ci-Z%ci)%ci],B.e=-Z||0):qe[0]=B.e=0,B;if(ee==0?(qe.length=Ce,ne=1,Ce--):(qe.length=Ce+1,ne=nt[ci-ee],qe[Ce]=me>0?ts(pe/nt[N-me]%nt[me])*ne:0),D)for(;;)if(Ce==0){for(ee=1,me=qe[0];me>=10;me/=10,ee++);for(me=qe[0]+=ne,ne=1;me>=10;me/=10,ne++);ee!=ne&&(B.e++,qe[0]==cs&&(qe[0]=1));break}else{if(qe[Ce]+=ne,qe[Ce]!=cs)break;qe[Ce--]=0,ne=1}for(ee=qe.length;qe[--ee]===0;qe.pop());}B.e>C?B.c=B.e=null:B.e<E&&(B.c=[B.e=0])}return B}function Ae(B){var Z,Q=B.e;return Q===null?B.toString():(Z=$r(B.c),Z=Q<=w||Q>=I?yh(Z,Q):Ws(Z,Q,"0"),B.s<0?"-"+Z:Z)}return h.absoluteValue=h.abs=function(){var B=new $(this);return B.s<0&&(B.s=1),B},h.comparedTo=function(B,Z){return ua(this,new $(B,Z))},h.decimalPlaces=h.dp=function(B,Z){var Q,D,N,ee=this;if(B!=null)return yn(B,0,Ur),Z==null?Z=u:yn(Z,0,8),De(new $(ee),B+ee.e+1,Z);if(!(Q=ee.c))return null;if(D=((N=Q.length-1)-is(this.e/ci))*ci,N=Q[N])for(;N%10==0;N/=10,D--);return D<0&&(D=0),D},h.dividedBy=h.div=function(B,Z){return i(this,new $(B,Z),m,u)},h.dividedToIntegerBy=h.idiv=function(B,Z){return i(this,new $(B,Z),0,1)},h.exponentiatedBy=h.pow=function(B,Z){var Q,D,N,ee,me,ne,pe,Ce,fe,qe=this;if(B=new $(B),B.c&&!B.isInteger())throw Error(Tr+"Exponent not an integer: "+Ae(B));if(Z!=null&&(Z=new $(Z)),ne=B.e>14,!qe.c||!qe.c[0]||qe.c[0]==1&&!qe.e&&qe.c.length==1||!B.c||!B.c[0])return fe=new $(Math.pow(+Ae(qe),ne?B.s*(2-_h(B)):+Ae(B))),Z?fe.mod(Z):fe;if(pe=B.s<0,Z){if(Z.c?!Z.c[0]:!Z.s)return new $(NaN);D=!pe&&qe.isInteger()&&Z.isInteger(),D&&(qe=qe.mod(Z))}else{if(B.e>9&&(qe.e>0||qe.e<-1||(qe.e==0?qe.c[0]>1||ne&&qe.c[1]>=24e7:qe.c[0]<8e13||ne&&qe.c[0]<=9999975e7)))return ee=qe.s<0&&_h(B)?-0:0,qe.e>-1&&(ee=1/ee),new $(pe?1/ee:ee);U&&(ee=rd(U/ci+2))}for(ne?(Q=new $(.5),pe&&(B.s=1),Ce=_h(B)):(N=Math.abs(+Ae(B)),Ce=N%2),fe=new $(g);;){if(Ce){if(fe=fe.times(qe),!fe.c)break;ee?fe.c.length>ee&&(fe.c.length=ee):D&&(fe=fe.mod(Z))}if(N){if(N=ts(N/2),N===0)break;Ce=N%2}else if(B=B.times(Q),De(B,B.e+1,1),B.e>14)Ce=_h(B);else{if(N=+Ae(B),N===0)break;Ce=N%2}qe=qe.times(qe),ee?qe.c&&qe.c.length>ee&&(qe.c.length=ee):D&&(qe=qe.mod(Z))}return D?fe:(pe&&(fe=g.div(fe)),Z?fe.mod(Z):ee?De(fe,U,u,me):fe)},h.integerValue=function(B){var Z=new $(this);return B==null?B=u:yn(B,0,8),De(Z,Z.e+1,B)},h.isEqualTo=h.eq=function(B,Z){return ua(this,new $(B,Z))===0},h.isFinite=function(){return!!this.c},h.isGreaterThan=h.gt=function(B,Z){return ua(this,new $(B,Z))>0},h.isGreaterThanOrEqualTo=h.gte=function(B,Z){return(Z=ua(this,new $(B,Z)))===1||Z===0},h.isInteger=function(){return!!this.c&&is(this.e/ci)>this.c.length-2},h.isLessThan=h.lt=function(B,Z){return ua(this,new $(B,Z))<0},h.isLessThanOrEqualTo=h.lte=function(B,Z){return(Z=ua(this,new $(B,Z)))===-1||Z===0},h.isNaN=function(){return!this.s},h.isNegative=function(){return this.s<0},h.isPositive=function(){return this.s>0},h.isZero=function(){return!!this.c&&this.c[0]==0},h.minus=function(B,Z){var Q,D,N,ee,me=this,ne=me.s;if(B=new $(B,Z),Z=B.s,!ne||!Z)return new $(NaN);if(ne!=Z)return B.s=-Z,me.plus(B);var pe=me.e/ci,Ce=B.e/ci,fe=me.c,qe=B.c;if(!pe||!Ce){if(!fe||!qe)return fe?(B.s=-Z,B):new $(qe?me:NaN);if(!fe[0]||!qe[0])return qe[0]?(B.s=-Z,B):new $(fe[0]?me:u==3?-0:0)}if(pe=is(pe),Ce=is(Ce),fe=fe.slice(),ne=pe-Ce){for((ee=ne<0)?(ne=-ne,N=fe):(Ce=pe,N=qe),N.reverse(),Z=ne;Z--;N.push(0));N.reverse()}else for(D=(ee=(ne=fe.length)<(Z=qe.length))?ne:Z,ne=Z=0;Z<D;Z++)if(fe[Z]!=qe[Z]){ee=fe[Z]<qe[Z];break}if(ee&&(N=fe,fe=qe,qe=N,B.s=-B.s),Z=(D=qe.length)-(Q=fe.length),Z>0)for(;Z--;fe[Q++]=0);for(Z=cs-1;D>ne;){if(fe[--D]<qe[D]){for(Q=D;Q&&!fe[--Q];fe[Q]=Z);--fe[Q],fe[D]+=cs}fe[D]-=qe[D]}for(;fe[0]==0;fe.splice(0,1),--Ce);return fe[0]?ve(B,fe,Ce):(B.s=u==3?-1:1,B.c=[B.e=0],B)},h.modulo=h.mod=function(B,Z){var Q,D,N=this;return B=new $(B,Z),!N.c||!B.s||B.c&&!B.c[0]?new $(NaN):!B.c||N.c&&!N.c[0]?new $(N):(H==9?(D=B.s,B.s=1,Q=i(N,B,0,3),B.s=D,Q.s*=D):Q=i(N,B,0,H),B=N.minus(Q.times(B)),!B.c[0]&&H==1&&(B.s=N.s),B)},h.multipliedBy=h.times=function(B,Z){var Q,D,N,ee,me,ne,pe,Ce,fe,qe,nt,lt,at,ut,St,It=this,st=It.c,Lt=(B=new $(B,Z)).c;if(!st||!Lt||!st[0]||!Lt[0])return!It.s||!B.s||st&&!st[0]&&!Lt||Lt&&!Lt[0]&&!st?B.c=B.e=B.s=null:(B.s*=It.s,!st||!Lt?B.c=B.e=null:(B.c=[0],B.e=0)),B;for(D=is(It.e/ci)+is(B.e/ci),B.s*=It.s,pe=st.length,qe=Lt.length,pe<qe&&(at=st,st=Lt,Lt=at,N=pe,pe=qe,qe=N),N=pe+qe,at=[];N--;at.push(0));for(ut=cs,St=Po,N=qe;--N>=0;){for(Q=0,nt=Lt[N]%St,lt=Lt[N]/St|0,me=pe,ee=N+me;ee>N;)Ce=st[--me]%St,fe=st[me]/St|0,ne=lt*Ce+fe*nt,Ce=nt*Ce+ne%St*St+at[ee]+Q,Q=(Ce/ut|0)+(ne/St|0)+lt*fe,at[ee--]=Ce%ut;at[ee]=Q}return Q?++D:at.splice(0,1),ve(B,at,D)},h.negated=function(){var B=new $(this);return B.s=-B.s||null,B},h.plus=function(B,Z){var Q,D=this,N=D.s;if(B=new $(B,Z),Z=B.s,!N||!Z)return new $(NaN);if(N!=Z)return B.s=-Z,D.minus(B);var ee=D.e/ci,me=B.e/ci,ne=D.c,pe=B.c;if(!ee||!me){if(!ne||!pe)return new $(N/0);if(!ne[0]||!pe[0])return pe[0]?B:new $(ne[0]?D:N*0)}if(ee=is(ee),me=is(me),ne=ne.slice(),N=ee-me){for(N>0?(me=ee,Q=pe):(N=-N,Q=ne),Q.reverse();N--;Q.push(0));Q.reverse()}for(N=ne.length,Z=pe.length,N-Z<0&&(Q=pe,pe=ne,ne=Q,Z=N),N=0;Z;)N=(ne[--Z]=ne[Z]+pe[Z]+N)/cs|0,ne[Z]=cs===ne[Z]?0:ne[Z]%cs;return N&&(ne=[N].concat(ne),++me),ve(B,ne,me)},h.precision=h.sd=function(B,Z){var Q,D,N,ee=this;if(B!=null&&B!==!!B)return yn(B,1,Ur),Z==null?Z=u:yn(Z,0,8),De(new $(ee),B,Z);if(!(Q=ee.c))return null;if(N=Q.length-1,D=N*ci+1,N=Q[N]){for(;N%10==0;N/=10,D--);for(N=Q[0];N>=10;N/=10,D++);}return B&&ee.e+1>D&&(D=ee.e+1),D},h.shiftedBy=function(B){return yn(B,-9007199254740991,Km),this.times("1e"+B)},h.squareRoot=h.sqrt=function(){var B,Z,Q,D,N,ee=this,me=ee.c,ne=ee.s,pe=ee.e,Ce=m+4,fe=new $("0.5");if(ne!==1||!me||!me[0])return new $(!ne||ne<0&&(!me||me[0])?NaN:me?ee:1/0);if(ne=Math.sqrt(+Ae(ee)),ne==0||ne==1/0?(Z=$r(me),(Z.length+pe)%2==0&&(Z+="0"),ne=Math.sqrt(+Z),pe=is((pe+1)/2)-(pe<0||pe%2),ne==1/0?Z="5e"+pe:(Z=ne.toExponential(),Z=Z.slice(0,Z.indexOf("e")+1)+pe),Q=new $(Z)):Q=new $(ne+""),Q.c[0]){for(pe=Q.e,ne=pe+Ce,ne<3&&(ne=0);;)if(N=Q,Q=fe.times(N.plus(i(ee,N,Ce,1))),$r(N.c).slice(0,ne)===(Z=$r(Q.c)).slice(0,ne))if(Q.e<pe&&--ne,Z=Z.slice(ne-3,ne+1),Z=="9999"||!D&&Z=="4999"){if(!D&&(De(N,N.e+m+2,0),N.times(N).eq(ee))){Q=N;break}Ce+=4,ne+=4,D=1}else{(!+Z||!+Z.slice(1)&&Z.charAt(0)=="5")&&(De(Q,Q.e+m+2,1),B=!Q.times(Q).eq(ee));break}}return De(Q,Q.e+m+1,u,B)},h.toExponential=function(B,Z){return B!=null&&(yn(B,0,Ur),B++),Te(this,B,Z,1)},h.toFixed=function(B,Z){return B!=null&&(yn(B,0,Ur),B=B+this.e+1),Te(this,B,Z)},h.toFormat=function(B,Z,Q){var D,N=this;if(Q==null)B!=null&&Z&&typeof Z=="object"?(Q=Z,Z=null):B&&typeof B=="object"?(Q=B,B=Z=null):Q=ie;else if(typeof Q!="object")throw Error(Tr+"Argument not an object: "+Q);if(D=N.toFixed(B,Z),N.c){var ee,me=D.split("."),ne=+Q.groupSize,pe=+Q.secondaryGroupSize,Ce=Q.groupSeparator||"",fe=me[0],qe=me[1],nt=N.s<0,lt=nt?fe.slice(1):fe,at=lt.length;if(pe&&(ee=ne,ne=pe,pe=ee,at-=ee),ne>0&&at>0){for(ee=at%ne||ne,fe=lt.substr(0,ee);ee<at;ee+=ne)fe+=Ce+lt.substr(ee,ne);pe>0&&(fe+=Ce+lt.slice(ee)),nt&&(fe="-"+fe)}D=qe?fe+(Q.decimalSeparator||"")+((pe=+Q.fractionGroupSize)?qe.replace(new RegExp("\\d{"+pe+"}\\B","g"),"$&"+(Q.fractionGroupSeparator||"")):qe):fe}return(Q.prefix||"")+D+(Q.suffix||"")},h.toFraction=function(B){var Z,Q,D,N,ee,me,ne,pe,Ce,fe,qe,nt,lt=this,at=lt.c;if(B!=null&&(ne=new $(B),!ne.isInteger()&&(ne.c||ne.s!==1)||ne.lt(g)))throw Error(Tr+"Argument "+(ne.isInteger()?"out of range: ":"not an integer: ")+Ae(ne));if(!at)return new $(lt);for(Z=new $(g),Ce=Q=new $(g),D=pe=new $(g),nt=$r(at),ee=Z.e=nt.length-lt.e-1,Z.c[0]=sd[(me=ee%ci)<0?ci+me:me],B=!B||ne.comparedTo(Z)>0?ee>0?Z:Ce:ne,me=C,C=1/0,ne=new $(nt),pe.c[0]=0;fe=i(ne,Z,0,1),N=Q.plus(fe.times(D)),N.comparedTo(B)!=1;)Q=D,D=N,Ce=pe.plus(fe.times(N=Ce)),pe=N,Z=ne.minus(fe.times(N=Z)),ne=N;return N=i(B.minus(Q),D,0,1),pe=pe.plus(N.times(Ce)),Q=Q.plus(N.times(D)),pe.s=Ce.s=lt.s,ee=ee*2,qe=i(Ce,D,ee,u).minus(lt).abs().comparedTo(i(pe,Q,ee,u).minus(lt).abs())<1?[Ce,D]:[pe,Q],C=me,qe},h.toNumber=function(){return+Ae(this)},h.toPrecision=function(B,Z){return B!=null&&yn(B,1,Ur),Te(this,B,Z,2)},h.toString=function(B){var Z,Q=this,D=Q.s,N=Q.e;return N===null?D?(Z="Infinity",D<0&&(Z="-"+Z)):Z="NaN":(B==null?Z=N<=w||N>=I?yh($r(Q.c),N):Ws($r(Q.c),N,"0"):B===10&&ae?(Q=De(new $(Q),m+N+1,u),Z=Ws($r(Q.c),Q.e,"0")):(yn(B,2,se.length,"Base"),Z=o(Ws($r(Q.c),N,"0"),10,B,D,!0)),D<0&&Q.c[0]&&(Z="-"+Z)),Z},h.valueOf=h.toJSON=function(){return Ae(this)},h._isBigNumber=!0,h[Symbol.toStringTag]="BigNumber",h[Symbol.for("nodejs.util.inspect.custom")]=h.valueOf,s!=null&&$.set(s),$}function is(s){var i=s|0;return s>0||s===i?i:i-1}function $r(s){for(var i,o,a=1,h=s.length,g=s[0]+"";a<h;){for(i=s[a++]+"",o=ci-i.length;o--;i="0"+i);g+=i}for(h=g.length;g.charCodeAt(--h)===48;);return g.slice(0,h+1||1)}function ua(s,i){var o,a,h=s.c,g=i.c,m=s.s,u=i.s,w=s.e,I=i.e;if(!m||!u)return null;if(o=h&&!h[0],a=g&&!g[0],o||a)return o?a?0:-u:m;if(m!=u)return m;if(o=m<0,a=w==I,!h||!g)return a?0:!h^o?1:-1;if(!a)return w>I^o?1:-1;for(u=(w=h.length)<(I=g.length)?w:I,m=0;m<u;m++)if(h[m]!=g[m])return h[m]>g[m]^o?1:-1;return w==I?0:w>I^o?1:-1}function yn(s,i,o,a){if(s<i||s>o||s!==ts(s))throw Error(Tr+(a||"Argument")+(typeof s=="number"?s<i||s>o?" out of range: ":" not an integer: ":" not a primitive number: ")+String(s))}function _h(s){var i=s.c.length-1;return is(s.e/ci)==i&&s.c[i]%2!=0}function yh(s,i){return(s.length>1?s.charAt(0)+"."+s.slice(1):s)+(i<0?"e":"e+")+i}function Ws(s,i,o){var a,h;if(i<0){for(h=o+".";++i;h+=o);s=h+s}else if(a=s.length,++i>a){for(h=o,i-=a;--i;h+=o);s+=h}else i<a&&(s=s.slice(0,i)+"."+s.slice(i));return s}var ks=uy(),Ub=class{constructor(s){Jt(this,"key"),Jt(this,"left",null),Jt(this,"right",null),this.key=s}},Nu=class extends Ub{constructor(s){super(s)}},qb=class{constructor(){Jt(this,"size",0),Jt(this,"modificationCount",0),Jt(this,"splayCount",0)}splay(s){const i=this.root;if(i==null)return this.compare(s,s),-1;let o=null,a=null,h=null,g=null,m=i;const u=this.compare;let w;for(;;)if(w=u(m.key,s),w>0){let I=m.left;if(I==null||(w=u(I.key,s),w>0&&(m.left=I.right,I.right=m,m=I,I=m.left,I==null)))break;o==null?a=m:o.left=m,o=m,m=I}else if(w<0){let I=m.right;if(I==null||(w=u(I.key,s),w<0&&(m.right=I.left,I.left=m,m=I,I=m.right,I==null)))break;h==null?g=m:h.right=m,h=m,m=I}else break;return h!=null&&(h.right=m.left,m.left=g),o!=null&&(o.left=m.right,m.right=a),this.root!==m&&(this.root=m,this.splayCount++),w}splayMin(s){let i=s,o=i.left;for(;o!=null;){const a=o;i.left=a.right,a.right=i,i=a,o=i.left}return i}splayMax(s){let i=s,o=i.right;for(;o!=null;){const a=o;i.right=a.left,a.left=i,i=a,o=i.right}return i}_delete(s){if(this.root==null||this.splay(s)!=0)return null;let i=this.root;const o=i,a=i.left;if(this.size--,a==null)this.root=i.right;else{const h=i.right;i=this.splayMax(a),i.right=h,this.root=i}return this.modificationCount++,o}addNewRoot(s,i){this.size++,this.modificationCount++;const o=this.root;if(o==null){this.root=s;return}i<0?(s.left=o,s.right=o.right,o.right=null):(s.right=o,s.left=o.left,o.left=null),this.root=s}_first(){const s=this.root;return s==null?null:(this.root=this.splayMin(s),this.root)}_last(){const s=this.root;return s==null?null:(this.root=this.splayMax(s),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(s){return this.validKey(s)&&this.splay(s)==0}defaultCompare(){return(s,i)=>s<i?-1:s>i?1:0}wrap(){return{getRoot:()=>this.root,setRoot:s=>{this.root=s},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:s=>{this.splayCount=s},splay:s=>this.splay(s),has:s=>this.has(s)}}},Jm,Ym,Lh=class Wu extends qb{constructor(i,o){super(),Jt(this,"root",null),Jt(this,"compare"),Jt(this,"validKey"),Jt(this,Jm,"[object Set]"),this.compare=i??this.defaultCompare(),this.validKey=o??(a=>a!=null&&a!=null)}delete(i){return this.validKey(i)?this._delete(i)!=null:!1}deleteAll(i){for(const o of i)this.delete(o)}forEach(i){const o=this[Symbol.iterator]();let a;for(;a=o.next(),!a.done;)i(a.value,a.value,this)}add(i){const o=this.splay(i);return o!=0&&this.addNewRoot(new Nu(i),o),this}addAndReturn(i){const o=this.splay(i);return o!=0&&this.addNewRoot(new Nu(i),o),this.root.key}addAll(i){for(const o of i)this.add(o)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(i){if(i==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(i)<0)return this.root.key;let o=this.root.left;if(o==null)return null;let a=o.right;for(;a!=null;)o=a,a=o.right;return o.key}firstAfter(i){if(i==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(i)>0)return this.root.key;let o=this.root.right;if(o==null)return null;let a=o.left;for(;a!=null;)o=a,a=o.left;return o.key}retainAll(i){const o=new Wu(this.compare,this.validKey),a=this.modificationCount;for(const h of i){if(a!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(h)&&this.splay(h)==0&&o.add(this.root.key)}o.size!=this.size&&(this.root=o.root,this.size=o.size,this.modificationCount++)}lookup(i){return!this.validKey(i)||this.splay(i)!=0?null:this.root.key}intersection(i){const o=new Wu(this.compare,this.validKey);for(const a of this)i.has(a)&&o.add(a);return o}difference(i){const o=new Wu(this.compare,this.validKey);for(const a of this)i.has(a)||o.add(a);return o}union(i){const o=this.clone();return o.addAll(i),o}clone(){const i=new Wu(this.compare,this.validKey);return i.size=this.size,i.root=this.copyNode(this.root),i}copyNode(i){if(i==null)return null;function o(h,g){let m,u;do{if(m=h.left,u=h.right,m!=null){const w=new Nu(m.key);g.left=w,o(m,w)}if(u!=null){const w=new Nu(u.key);g.right=w,h=u,g=w}}while(u!=null)}const a=new Nu(i.key);return o(i,a),a}toSet(){return this.clone()}entries(){return new Gb(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Ym=Symbol.iterator,Jm=Symbol.toStringTag,Ym)](){return new Zb(this.wrap())}},cy=class{constructor(s){Jt(this,"tree"),Jt(this,"path",new Array),Jt(this,"modificationCount",null),Jt(this,"splayCount"),this.tree=s,this.splayCount=s.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const s=this.path[this.path.length-1];return this.getValue(s)}rebuildPath(s){this.path.splice(0,this.path.length),this.tree.splay(s),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(s){for(;s!=null;)this.path.push(s),s=s.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let o=this.tree.getRoot();for(;o!=null;)this.path.push(o),o=o.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let s=this.path[this.path.length-1],i=s.right;if(i!=null){for(;i!=null;)this.path.push(i),i=i.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===s;)s=this.path.pop();return this.path.length>0}},Zb=class extends cy{getValue(s){return s.key}},Gb=class extends cy{getValue(s){return[s.key,s.key]}},hy=s=>()=>s,gd=s=>{const i=s?(o,a)=>a.minus(o).abs().isLessThanOrEqualTo(s):hy(!1);return(o,a)=>i(o,a)?0:o.comparedTo(a)};function Wb(s){const i=s?(o,a,h,g,m)=>o.exponentiatedBy(2).isLessThanOrEqualTo(g.minus(a).exponentiatedBy(2).plus(m.minus(h).exponentiatedBy(2)).times(s)):hy(!1);return(o,a,h)=>{const g=o.x,m=o.y,u=h.x,w=h.y,I=m.minus(w).times(a.x.minus(u)).minus(g.minus(u).times(a.y.minus(w)));return i(I,g,m,u,w)?0:I.comparedTo(0)}}var Hb=s=>s,Xb=s=>{if(s){const i=new Lh(gd(s)),o=new Lh(gd(s)),a=(g,m)=>m.addAndReturn(g),h=g=>({x:a(g.x,i),y:a(g.y,o)});return h({x:new ks(0),y:new ks(0)}),h}return Hb},_d=s=>({set:i=>{Js=_d(i)},reset:()=>_d(s),compare:gd(s),snap:Xb(s),orient:Wb(s)}),Js=_d(),Vu=(s,i)=>s.ll.x.isLessThanOrEqualTo(i.x)&&i.x.isLessThanOrEqualTo(s.ur.x)&&s.ll.y.isLessThanOrEqualTo(i.y)&&i.y.isLessThanOrEqualTo(s.ur.y),yd=(s,i)=>{if(i.ur.x.isLessThan(s.ll.x)||s.ur.x.isLessThan(i.ll.x)||i.ur.y.isLessThan(s.ll.y)||s.ur.y.isLessThan(i.ll.y))return null;const o=s.ll.x.isLessThan(i.ll.x)?i.ll.x:s.ll.x,a=s.ur.x.isLessThan(i.ur.x)?s.ur.x:i.ur.x,h=s.ll.y.isLessThan(i.ll.y)?i.ll.y:s.ll.y,g=s.ur.y.isLessThan(i.ur.y)?s.ur.y:i.ur.y;return{ll:{x:o,y:h},ur:{x:a,y:g}}},Eh=(s,i)=>s.x.times(i.y).minus(s.y.times(i.x)),fy=(s,i)=>s.x.times(i.x).plus(s.y.times(i.y)),Ph=s=>fy(s,s).sqrt(),Kb=(s,i,o)=>{const a={x:i.x.minus(s.x),y:i.y.minus(s.y)},h={x:o.x.minus(s.x),y:o.y.minus(s.y)};return Eh(h,a).div(Ph(h)).div(Ph(a))},Jb=(s,i,o)=>{const a={x:i.x.minus(s.x),y:i.y.minus(s.y)},h={x:o.x.minus(s.x),y:o.y.minus(s.y)};return fy(h,a).div(Ph(h)).div(Ph(a))},Qm=(s,i,o)=>i.y.isZero()?null:{x:s.x.plus(i.x.div(i.y).times(o.minus(s.y))),y:o},$m=(s,i,o)=>i.x.isZero()?null:{x:o,y:s.y.plus(i.y.div(i.x).times(o.minus(s.x)))},Yb=(s,i,o,a)=>{if(i.x.isZero())return $m(o,a,s.x);if(a.x.isZero())return $m(s,i,o.x);if(i.y.isZero())return Qm(o,a,s.y);if(a.y.isZero())return Qm(s,i,o.y);const h=Eh(i,a);if(h.isZero())return null;const g={x:o.x.minus(s.x),y:o.y.minus(s.y)},m=Eh(g,i).div(h),u=Eh(g,a).div(h),w=s.x.plus(u.times(i.x)),I=o.x.plus(m.times(a.x)),E=s.y.plus(u.times(i.y)),C=o.y.plus(m.times(a.y)),P=w.plus(I).div(2),H=E.plus(C).div(2);return{x:P,y:H}},Ss=class dy{constructor(i,o){Jt(this,"point"),Jt(this,"isLeft"),Jt(this,"segment"),Jt(this,"otherSE"),Jt(this,"consumedBy"),i.events===void 0?i.events=[this]:i.events.push(this),this.point=i,this.isLeft=o}static compare(i,o){const a=dy.comparePoints(i.point,o.point);return a!==0?a:(i.point!==o.point&&i.link(o),i.isLeft!==o.isLeft?i.isLeft?1:-1:zh.compare(i.segment,o.segment))}static comparePoints(i,o){return i.x.isLessThan(o.x)?-1:i.x.isGreaterThan(o.x)?1:i.y.isLessThan(o.y)?-1:i.y.isGreaterThan(o.y)?1:0}link(i){if(i.point===this.point)throw new Error("Tried to link already linked events");const o=i.point.events;for(let a=0,h=o.length;a<h;a++){const g=o[a];this.point.events.push(g),g.point=this.point}this.checkForConsuming()}checkForConsuming(){const i=this.point.events.length;for(let o=0;o<i;o++){const a=this.point.events[o];if(a.segment.consumedBy===void 0)for(let h=o+1;h<i;h++){const g=this.point.events[h];g.consumedBy===void 0&&a.otherSE.point.events===g.otherSE.point.events&&a.segment.consume(g.segment)}}}getAvailableLinkedEvents(){const i=[];for(let o=0,a=this.point.events.length;o<a;o++){const h=this.point.events[o];h!==this&&!h.segment.ringOut&&h.segment.isInResult()&&i.push(h)}return i}getLeftmostComparator(i){const o=new Map,a=h=>{const g=h.otherSE;o.set(h,{sine:Kb(this.point,i.point,g.point),cosine:Jb(this.point,i.point,g.point)})};return(h,g)=>{o.has(h)||a(h),o.has(g)||a(g);const{sine:m,cosine:u}=o.get(h),{sine:w,cosine:I}=o.get(g);return m.isGreaterThanOrEqualTo(0)&&w.isGreaterThanOrEqualTo(0)?u.isLessThan(I)?1:u.isGreaterThan(I)?-1:0:m.isLessThan(0)&&w.isLessThan(0)?u.isLessThan(I)?-1:u.isGreaterThan(I)?1:0:w.isLessThan(m)?-1:w.isGreaterThan(m)?1:0}}},Qb=class vd{constructor(i){Jt(this,"events"),Jt(this,"poly"),Jt(this,"_isExteriorRing"),Jt(this,"_enclosingRing"),this.events=i;for(let o=0,a=i.length;o<a;o++)i[o].segment.ringOut=this;this.poly=null}static factory(i){const o=[];for(let a=0,h=i.length;a<h;a++){const g=i[a];if(!g.isInResult()||g.ringOut)continue;let m=null,u=g.leftSE,w=g.rightSE;const I=[u],E=u.point,C=[];for(;m=u,u=w,I.push(u),u.point!==E;)for(;;){const P=u.getAvailableLinkedEvents();if(P.length===0){const ie=I[0].point,se=I[I.length-1].point;throw new Error(`Unable to complete output ring starting at [${ie.x}, ${ie.y}]. Last matching segment found ends at [${se.x}, ${se.y}].`)}if(P.length===1){w=P[0].otherSE;break}let H=null;for(let ie=0,se=C.length;ie<se;ie++)if(C[ie].point===u.point){H=ie;break}if(H!==null){const ie=C.splice(H)[0],se=I.splice(ie.index);se.unshift(se[0].otherSE),o.push(new vd(se.reverse()));continue}C.push({index:I.length,point:u.point});const U=u.getLeftmostComparator(m);w=P.sort(U)[0].otherSE;break}o.push(new vd(I))}return o}getGeom(){let i=this.events[0].point;const o=[i];for(let I=1,E=this.events.length-1;I<E;I++){const C=this.events[I].point,P=this.events[I+1].point;Js.orient(C,i,P)!==0&&(o.push(C),i=C)}if(o.length===1)return null;const a=o[0],h=o[1];Js.orient(a,i,h)===0&&o.shift(),o.push(o[0]);const g=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:o.length-1,u=this.isExteriorRing()?o.length:-1,w=[];for(let I=m;I!=u;I+=g)w.push([o[I].x.toNumber(),o[I].y.toNumber()]);return w}isExteriorRing(){if(this._isExteriorRing===void 0){const i=this.enclosingRing();this._isExteriorRing=i?!i.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var i,o;let a=this.events[0];for(let m=1,u=this.events.length;m<u;m++){const w=this.events[m];Ss.compare(a,w)>0&&(a=w)}let h=a.segment.prevInResult(),g=h?h.prevInResult():null;for(;;){if(!h)return null;if(!g)return h.ringOut;if(g.ringOut!==h.ringOut)return((i=g.ringOut)==null?void 0:i.enclosingRing())!==h.ringOut?h.ringOut:(o=h.ringOut)==null?void 0:o.enclosingRing();h=g.prevInResult(),g=h?h.prevInResult():null}}},eg=class{constructor(s){Jt(this,"exteriorRing"),Jt(this,"interiorRings"),this.exteriorRing=s,s.poly=this,this.interiorRings=[]}addInterior(s){this.interiorRings.push(s),s.poly=this}getGeom(){const s=this.exteriorRing.getGeom();if(s===null)return null;const i=[s];for(let o=0,a=this.interiorRings.length;o<a;o++){const h=this.interiorRings[o].getGeom();h!==null&&i.push(h)}return i}},$b=class{constructor(s){Jt(this,"rings"),Jt(this,"polys"),this.rings=s,this.polys=this._composePolys(s)}getGeom(){const s=[];for(let i=0,o=this.polys.length;i<o;i++){const a=this.polys[i].getGeom();a!==null&&s.push(a)}return s}_composePolys(s){var i;const o=[];for(let a=0,h=s.length;a<h;a++){const g=s[a];if(!g.poly)if(g.isExteriorRing())o.push(new eg(g));else{const m=g.enclosingRing();m!=null&&m.poly||o.push(new eg(m)),(i=m==null?void 0:m.poly)==null||i.addInterior(g)}}return o}},ex=class{constructor(s,i=zh.compare){Jt(this,"queue"),Jt(this,"tree"),Jt(this,"segments"),this.queue=s,this.tree=new Lh(i),this.segments=[]}process(s){const i=s.segment,o=[];if(s.consumedBy)return s.isLeft?this.queue.delete(s.otherSE):this.tree.delete(i),o;s.isLeft&&this.tree.add(i);let a=i,h=i;do a=this.tree.lastBefore(a);while(a!=null&&a.consumedBy!=null);do h=this.tree.firstAfter(h);while(h!=null&&h.consumedBy!=null);if(s.isLeft){let g=null;if(a){const u=a.getIntersection(i);if(u!==null&&(i.isAnEndpoint(u)||(g=u),!a.isAnEndpoint(u))){const w=this._splitSafely(a,u);for(let I=0,E=w.length;I<E;I++)o.push(w[I])}}let m=null;if(h){const u=h.getIntersection(i);if(u!==null&&(i.isAnEndpoint(u)||(m=u),!h.isAnEndpoint(u))){const w=this._splitSafely(h,u);for(let I=0,E=w.length;I<E;I++)o.push(w[I])}}if(g!==null||m!==null){let u=null;g===null?u=m:m===null?u=g:u=Ss.comparePoints(g,m)<=0?g:m,this.queue.delete(i.rightSE),o.push(i.rightSE);const w=i.split(u);for(let I=0,E=w.length;I<E;I++)o.push(w[I])}o.length>0?(this.tree.delete(i),o.push(s)):(this.segments.push(i),i.prev=a)}else{if(a&&h){const g=a.getIntersection(h);if(g!==null){if(!a.isAnEndpoint(g)){const m=this._splitSafely(a,g);for(let u=0,w=m.length;u<w;u++)o.push(m[u])}if(!h.isAnEndpoint(g)){const m=this._splitSafely(h,g);for(let u=0,w=m.length;u<w;u++)o.push(m[u])}}}this.tree.delete(i)}return o}_splitSafely(s,i){this.tree.delete(s);const o=s.rightSE;this.queue.delete(o);const a=s.split(i);return a.push(o),s.consumedBy===void 0&&this.tree.add(s),a}},tx=class{constructor(){Jt(this,"type"),Jt(this,"numMultiPolys")}run(s,i,o){Hu.type=s;const a=[new ig(i,!0)];for(let w=0,I=o.length;w<I;w++)a.push(new ig(o[w],!1));if(Hu.numMultiPolys=a.length,Hu.type==="difference"){const w=a[0];let I=1;for(;I<a.length;)yd(a[I].bbox,w.bbox)!==null?I++:a.splice(I,1)}if(Hu.type==="intersection")for(let w=0,I=a.length;w<I;w++){const E=a[w];for(let C=w+1,P=a.length;C<P;C++)if(yd(E.bbox,a[C].bbox)===null)return[]}const h=new Lh(Ss.compare);for(let w=0,I=a.length;w<I;w++){const E=a[w].getSweepEvents();for(let C=0,P=E.length;C<P;C++)h.add(E[C])}const g=new ex(h);let m=null;for(h.size!=0&&(m=h.first(),h.delete(m));m;){const w=g.process(m);for(let I=0,E=w.length;I<E;I++){const C=w[I];C.consumedBy===void 0&&h.add(C)}h.size!=0?(m=h.first(),h.delete(m)):m=null}Js.reset();const u=Qb.factory(g.segments);return new $b(u).getGeom()}},Hu=new tx,Ah=Hu,ix=0,zh=class Mh{constructor(i,o,a,h){Jt(this,"id"),Jt(this,"leftSE"),Jt(this,"rightSE"),Jt(this,"rings"),Jt(this,"windings"),Jt(this,"ringOut"),Jt(this,"consumedBy"),Jt(this,"prev"),Jt(this,"_prevInResult"),Jt(this,"_beforeState"),Jt(this,"_afterState"),Jt(this,"_isInResult"),this.id=++ix,this.leftSE=i,i.segment=this,i.otherSE=o,this.rightSE=o,o.segment=this,o.otherSE=i,this.rings=a,this.windings=h}static compare(i,o){const a=i.leftSE.point.x,h=o.leftSE.point.x,g=i.rightSE.point.x,m=o.rightSE.point.x;if(m.isLessThan(a))return 1;if(g.isLessThan(h))return-1;const u=i.leftSE.point.y,w=o.leftSE.point.y,I=i.rightSE.point.y,E=o.rightSE.point.y;if(a.isLessThan(h)){if(w.isLessThan(u)&&w.isLessThan(I))return 1;if(w.isGreaterThan(u)&&w.isGreaterThan(I))return-1;const C=i.comparePoint(o.leftSE.point);if(C<0)return 1;if(C>0)return-1;const P=o.comparePoint(i.rightSE.point);return P!==0?P:-1}if(a.isGreaterThan(h)){if(u.isLessThan(w)&&u.isLessThan(E))return-1;if(u.isGreaterThan(w)&&u.isGreaterThan(E))return 1;const C=o.comparePoint(i.leftSE.point);if(C!==0)return C;const P=i.comparePoint(o.rightSE.point);return P<0?1:P>0?-1:1}if(u.isLessThan(w))return-1;if(u.isGreaterThan(w))return 1;if(g.isLessThan(m)){const C=o.comparePoint(i.rightSE.point);if(C!==0)return C}if(g.isGreaterThan(m)){const C=i.comparePoint(o.rightSE.point);if(C<0)return 1;if(C>0)return-1}if(!g.eq(m)){const C=I.minus(u),P=g.minus(a),H=E.minus(w),U=m.minus(h);if(C.isGreaterThan(P)&&H.isLessThan(U))return 1;if(C.isLessThan(P)&&H.isGreaterThan(U))return-1}return g.isGreaterThan(m)?1:g.isLessThan(m)||I.isLessThan(E)?-1:I.isGreaterThan(E)?1:i.id<o.id?-1:i.id>o.id?1:0}static fromRing(i,o,a){let h,g,m;const u=Ss.comparePoints(i,o);if(u<0)h=i,g=o,m=1;else if(u>0)h=o,g=i,m=-1;else throw new Error(`Tried to create degenerate segment at [${i.x}, ${i.y}]`);const w=new Ss(h,!0),I=new Ss(g,!1);return new Mh(w,I,[a],[m])}replaceRightSE(i){this.rightSE=i,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const i=this.leftSE.point.y,o=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:i.isLessThan(o)?i:o},ur:{x:this.rightSE.point.x,y:i.isGreaterThan(o)?i:o}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(i){return i.x.eq(this.leftSE.point.x)&&i.y.eq(this.leftSE.point.y)||i.x.eq(this.rightSE.point.x)&&i.y.eq(this.rightSE.point.y)}comparePoint(i){return Js.orient(this.leftSE.point,i,this.rightSE.point)}getIntersection(i){const o=this.bbox(),a=i.bbox(),h=yd(o,a);if(h===null)return null;const g=this.leftSE.point,m=this.rightSE.point,u=i.leftSE.point,w=i.rightSE.point,I=Vu(o,u)&&this.comparePoint(u)===0,E=Vu(a,g)&&i.comparePoint(g)===0,C=Vu(o,w)&&this.comparePoint(w)===0,P=Vu(a,m)&&i.comparePoint(m)===0;if(E&&I)return P&&!C?m:!P&&C?w:null;if(E)return C&&g.x.eq(w.x)&&g.y.eq(w.y)?null:g;if(I)return P&&m.x.eq(u.x)&&m.y.eq(u.y)?null:u;if(P&&C)return null;if(P)return m;if(C)return w;const H=Yb(g,this.vector(),u,i.vector());return H===null||!Vu(h,H)?null:Js.snap(H)}split(i){const o=[],a=i.events!==void 0,h=new Ss(i,!0),g=new Ss(i,!1),m=this.rightSE;this.replaceRightSE(g),o.push(g),o.push(h);const u=new Mh(h,m,this.rings.slice(),this.windings.slice());return Ss.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),Ss.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),a&&(h.checkForConsuming(),g.checkForConsuming()),o}swapEvents(){const i=this.rightSE;this.rightSE=this.leftSE,this.leftSE=i,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let o=0,a=this.windings.length;o<a;o++)this.windings[o]*=-1}consume(i){let o=this,a=i;for(;o.consumedBy;)o=o.consumedBy;for(;a.consumedBy;)a=a.consumedBy;const h=Mh.compare(o,a);if(h!==0){if(h>0){const g=o;o=a,a=g}if(o.prev===a){const g=o;o=a,a=g}for(let g=0,m=a.rings.length;g<m;g++){const u=a.rings[g],w=a.windings[g],I=o.rings.indexOf(u);I===-1?(o.rings.push(u),o.windings.push(w)):o.windings[I]+=w}a.rings=null,a.windings=null,a.consumedBy=o,a.leftSE.consumedBy=o.leftSE,a.rightSE.consumedBy=o.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const i=this.prev.consumedBy||this.prev;this._beforeState=i.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const i=this.beforeState();this._afterState={rings:i.rings.slice(0),windings:i.windings.slice(0),multiPolys:[]};const o=this._afterState.rings,a=this._afterState.windings,h=this._afterState.multiPolys;for(let u=0,w=this.rings.length;u<w;u++){const I=this.rings[u],E=this.windings[u],C=o.indexOf(I);C===-1?(o.push(I),a.push(E)):a[C]+=E}const g=[],m=[];for(let u=0,w=o.length;u<w;u++){if(a[u]===0)continue;const I=o[u],E=I.poly;if(m.indexOf(E)===-1)if(I.isExterior)g.push(E);else{m.indexOf(E)===-1&&m.push(E);const C=g.indexOf(I.poly);C!==-1&&g.splice(C,1)}}for(let u=0,w=g.length;u<w;u++){const I=g[u].multiPoly;h.indexOf(I)===-1&&h.push(I)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const i=this.beforeState().multiPolys,o=this.afterState().multiPolys;switch(Ah.type){case"union":{const a=i.length===0,h=o.length===0;this._isInResult=a!==h;break}case"intersection":{let a,h;i.length<o.length?(a=i.length,h=o.length):(a=o.length,h=i.length),this._isInResult=h===Ah.numMultiPolys&&a<h;break}case"xor":{const a=Math.abs(i.length-o.length);this._isInResult=a%2===1;break}case"difference":{const a=h=>h.length===1&&h[0].isSubject;this._isInResult=a(i)!==a(o);break}}return this._isInResult}},tg=class{constructor(s,i,o){if(Jt(this,"poly"),Jt(this,"isExterior"),Jt(this,"segments"),Jt(this,"bbox"),!Array.isArray(s)||s.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=o,this.segments=[],typeof s[0][0]!="number"||typeof s[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=Js.snap({x:new ks(s[0][0]),y:new ks(s[0][1])});this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};let h=a;for(let g=1,m=s.length;g<m;g++){if(typeof s[g][0]!="number"||typeof s[g][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const u=Js.snap({x:new ks(s[g][0]),y:new ks(s[g][1])});u.x.eq(h.x)&&u.y.eq(h.y)||(this.segments.push(zh.fromRing(h,u,this)),u.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.x),u.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.y),u.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.x),u.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.y),h=u)}(!a.x.eq(h.x)||!a.y.eq(h.y))&&this.segments.push(zh.fromRing(h,a,this))}getSweepEvents(){const s=[];for(let i=0,o=this.segments.length;i<o;i++){const a=this.segments[i];s.push(a.leftSE),s.push(a.rightSE)}return s}},nx=class{constructor(s,i){if(Jt(this,"multiPoly"),Jt(this,"exteriorRing"),Jt(this,"interiorRings"),Jt(this,"bbox"),!Array.isArray(s))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new tg(s[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let o=1,a=s.length;o<a;o++){const h=new tg(s[o],this,!1);h.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=h.bbox.ur.y),this.interiorRings.push(h)}this.multiPoly=i}getSweepEvents(){const s=this.exteriorRing.getSweepEvents();for(let i=0,o=this.interiorRings.length;i<o;i++){const a=this.interiorRings[i].getSweepEvents();for(let h=0,g=a.length;h<g;h++)s.push(a[h])}return s}},ig=class{constructor(s,i){if(Jt(this,"isSubject"),Jt(this,"polys"),Jt(this,"bbox"),!Array.isArray(s))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof s[0][0][0]=="number"&&(s=[s])}catch{}this.polys=[],this.bbox={ll:{x:new ks(Number.POSITIVE_INFINITY),y:new ks(Number.POSITIVE_INFINITY)},ur:{x:new ks(Number.NEGATIVE_INFINITY),y:new ks(Number.NEGATIVE_INFINITY)}};for(let o=0,a=s.length;o<a;o++){const h=new nx(s[o],this);h.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=h.bbox.ur.y),this.polys.push(h)}this.isSubject=i}getSweepEvents(){const s=[];for(let i=0,o=this.polys.length;i<o;i++){const a=this.polys[i].getSweepEvents();for(let h=0,g=a.length;h<g;h++)s.push(a[h])}return s}},rx=(s,...i)=>Ah.run("union",s,i),sx=(s,...i)=>Ah.run("difference",s,i);Js.set;function py(s,i,o){if(s!==null)for(var a,h,g,m,u,w,I,E=0,C=0,P,H=s.type,U=H==="FeatureCollection",ie=H==="Feature",se=U?s.features.length:1,ae=0;ae<se;ae++){I=U?s.features[ae].geometry:ie?s.geometry:s,P=I?I.type==="GeometryCollection":!1,u=P?I.geometries.length:1;for(var $=0;$<u;$++){var Te=0,Pe=0;if(m=P?I.geometries[$]:I,m!==null){w=m.coordinates;var ve=m.type;switch(E=0,ve){case null:break;case"Point":if(i(w,C,ae,Te,Pe)===!1)return!1;C++,Te++;break;case"LineString":case"MultiPoint":for(a=0;a<w.length;a++){if(i(w[a],C,ae,Te,Pe)===!1)return!1;C++,ve==="MultiPoint"&&Te++}ve==="LineString"&&Te++;break;case"Polygon":case"MultiLineString":for(a=0;a<w.length;a++){for(h=0;h<w[a].length-E;h++){if(i(w[a][h],C,ae,Te,Pe)===!1)return!1;C++}ve==="MultiLineString"&&Te++,ve==="Polygon"&&Pe++}ve==="Polygon"&&Te++;break;case"MultiPolygon":for(a=0;a<w.length;a++){for(Pe=0,h=0;h<w[a].length;h++){for(g=0;g<w[a][h].length-E;g++){if(i(w[a][h][g],C,ae,Te,Pe)===!1)return!1;C++}Pe++}Te++}break;case"GeometryCollection":for(a=0;a<m.geometries.length;a++)if(py(m.geometries[a],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Dd(s,i){var o,a,h,g,m,u,w,I,E,C,P=0,H=s.type==="FeatureCollection",U=s.type==="Feature",ie=H?s.features.length:1;for(o=0;o<ie;o++){for(u=H?s.features[o].geometry:U?s.geometry:s,I=H?s.features[o].properties:U?s.properties:{},E=H?s.features[o].bbox:U?s.bbox:void 0,C=H?s.features[o].id:U?s.id:void 0,w=u?u.type==="GeometryCollection":!1,m=w?u.geometries.length:1,h=0;h<m;h++){if(g=w?u.geometries[h]:u,g===null){if(i(null,P,I,E,C)===!1)return!1;continue}switch(g.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(g,P,I,E,C)===!1)return!1;break}case"GeometryCollection":{for(a=0;a<g.geometries.length;a++)if(i(g.geometries[a],P,I,E,C)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}P++}}function ox(s,i){Dd(s,function(o,a,h,g,m){var u=o===null?null:o.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return i(ic(o,h,{bbox:g,id:m}),a,0)===!1?!1:void 0}var w;switch(u){case"MultiPoint":w="Point";break;case"MultiLineString":w="LineString";break;case"MultiPolygon":w="Polygon";break}for(var I=0;I<o.coordinates.length;I++){var E=o.coordinates[I],C={type:w,coordinates:E};if(i(ic(C,h),a,I)===!1)return!1}})}function ax(s,i={}){const o=[];if(Dd(s,h=>{o.push(h.coordinates)}),o.length<2)throw new Error("Must have at least 2 geometries");const a=rx(o[0],...o.slice(1));return a.length===0?null:a.length===1?zd(a[0],i.properties):ly(a,i.properties)}var my=ax;function lx(s,i={}){if(s.bbox!=null&&i.recompute!==!0)return s.bbox;const o=[1/0,1/0,-1/0,-1/0];return py(s,a=>{o[0]>a[0]&&(o[0]=a[0]),o[1]>a[1]&&(o[1]=a[1]),o[2]<a[0]&&(o[2]=a[0]),o[3]<a[1]&&(o[3]=a[1])}),o}var ng=lx;function ux(s){const i=[];if(Dd(s,h=>{i.push(h.coordinates)}),i.length<2)throw new Error("Must have at least two features");const o=s.features[0].properties||{},a=sx(i[0],...i.slice(1));return a.length===0?null:a.length===1?zd(a[0],o):ly(a,o)}var cx=ux;function hx(s){if(!s)throw new Error("geojson is required");var i=[];return ox(s,function(o){i.push(o)}),nc(i)}var fx=hx;function rg(s,i){const o=cx(nc([zd([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),s]));if(!o)return;o.properties={isMask:!0};const a=Hm(ng(s)),h=(a[2]-a[0])/360/1e3,g=a[0]<-180,m=a[2]>180,u=fx(s);if(u.features.length>1&&(g||m))for(const w of u.features){const I=Hm(ng(w));if(m&&I[0]<-180+h)for(const E of w.geometry.coordinates)for(const C of E)C[0]+=360-h;if(g&&I[2]>180-h)for(const E of w.geometry.coordinates)for(const C of E)C[0]-=360-h}i(nc([u.features.length<2?s:my(u)??s,o]))}const sg={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},vh="mtlr-gc-full-geom",og="mtlr-gc-full-geom-fill",ag="mtlr-gc-full-geom-line";function dx(s,i,o=!0,a=!0,h={},g={},m=sg){let u;const w=[];let I,E,C;function P(){if(!s.loaded){s.once("load",P);return}const se=m?m===!0?sg:m:void 0;if(!(se!=null&&se.fill)&&!(se!=null&&se.line))return;const ae=s.getSource(vh);if(ae)ae.setData(C??nc([]));else if(C)s.addSource(vh,{type:"geojson",data:C});else return;!s.getLayer(og)&&se!=null&&se.fill&&s.addLayer({...se==null?void 0:se.fill,id:og,type:"fill",source:vh}),!s.getLayer(ag)&&se!=null&&se.line&&s.addLayer({...se==null?void 0:se.line,id:ag,type:"line",source:vh})}function H(se){C=se,P()}s.on("styledata",()=>{setTimeout(()=>{C&&P()})});const U=se=>{u==null||u({type:"mapClick",coordinates:[se.lngLat.lng,se.lngLat.lat]})};function ie(se=!1){if(!i)throw new Error;const ae=document.createElement("div");return se&&ae.classList.add("marker-interactive"),new Db({props:{displayIn:"maplibre"},target:ae}),new i.Marker({element:ae,offset:[1,-13]})}return{setEventHandler(se){se?(u=se,s.on("click",U)):(u=void 0,s.off("click",U))},flyTo(se,ae){s.flyTo({center:se,...ae?{zoom:ae}:{},...h})},fitBounds(se,ae,$){s.fitBounds([[se[0],se[1]],[se[2],se[3]]],{padding:ae,...$?{maxZoom:$}:{},...g})},indicateReverse(se){s.getCanvasContainer().style.cursor=se?"crosshair":""},setReverseMarker(se){!i||!o||(E?se?E.setLngLat(se):(E.remove(),E=void 0):se&&(o instanceof Function?E=o(s)??void 0:(E=(typeof o=="object"?new i.Marker(o):ie()).setLngLat(se).addTo(s),E.getElement().classList.add("marker-reverse"))))},setFeatures(se,ae,$){for(const Te of w)Te.remove();if(w.length=0,H(void 0),!!i){e:if(ae){let Te=!1;if(ae.geometry.type==="GeometryCollection"){const Pe=ae.geometry.geometries.filter(ve=>ve.type==="Polygon"||ve.type==="MultiPolygon");t:if(Pe.length>0){const ve=my(nc(Pe.map(De=>ic(De))));if(!ve)break t;rg({...ae,geometry:ve.geometry},H),Te=!0}else{const ve=ae.geometry.geometries.filter(De=>De.type==="LineString"||De.type==="MultiLineString");ve.length>0&&(H({...ae,geometry:{type:"GeometryCollection",geometries:ve}}),Te=!0)}}if(!Te){if(ae.geometry.type==="Polygon"||ae.geometry.type==="MultiPolygon")rg(ae,H);else if(ae.geometry.type==="LineString"||ae.geometry.type==="MultiLineString"){H(ae);break e}}if(!$&&!ae.geometry.type.endsWith("Point"))break e;if(o instanceof Function){const Pe=o(s,ae);Pe&&w.push(Pe)}else o&&w.push(typeof o=="object"?new i.Marker(o):ie().setLngLat(ae.center).addTo(s))}if(a)for(const Te of se??[]){if(Te===ae)continue;let Pe;if(a instanceof Function){if(Pe=a(s,Te),!Pe)continue}else Pe=(typeof a=="object"?new i.Marker(a):ie(!0)).setLngLat(Te.center).setPopup(new i.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Te.place_type[0]==="reverse"?Te.place_name:Te.place_name.replace(/,.*/,""))).addTo(s);const ve=Pe.getElement();ve.addEventListener("click",De=>{De.stopPropagation(),u==null||u({type:"markerClick",id:Te.id})}),ve.addEventListener("mouseenter",()=>{u==null||u({type:"markerMouseEnter",id:Te.id}),Pe.togglePopup()}),ve.addEventListener("mouseleave",()=>{u==null||u({type:"markerMouseLeave",id:Te.id}),Pe.togglePopup()}),w.push(Pe)}}},setSelectedMarker(se){I&&I.getElement().classList.toggle("marker-selected",!1),I=se>-1?w[se]:void 0,I==null||I.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const se=s.getCenter();return[s.getZoom(),se.lng,se.lat]}}}function px(s){let i,o;return{c(){i=Xs("svg"),o=Xs("path"),te(o,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),te(i,"viewBox","0 0 14 14"),te(i,"width","13"),te(i,"height","13"),te(i,"class","svelte-en2qvf")},m(a,h){ke(a,i,h),oe(i,o)},p:Tt,i:Tt,o:Tt,d(a){a&&Se(i)}}}class gy extends Wt{constructor(i){super(),Gt(this,i,null,px,Nt,{})}}function mx(s){let i,o;return{c(){i=Xs("svg"),o=Xs("path"),te(o,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),te(i,"viewBox","0 0 30 30"),te(i,"fill","none"),te(i,"xmlns","http://www.w3.org/2000/svg"),te(i,"class","svelte-d2loi5")},m(a,h){ke(a,i,h),oe(i,o)},p:Tt,i:Tt,o:Tt,d(a){a&&Se(i)}}}class _y extends Wt{constructor(i){super(),Gt(this,i,null,mx,Nt,{})}}function gx(s){let i,o;return{c(){i=ge("img"),sr(i.src,o=s[3]+"area.svg")||te(i,"src",o),te(i,"alt",s[7]),te(i,"title",s[7]),te(i,"class","svelte-w9y5n9")},m(a,h){ke(a,i,h)},p(a,h){h&8&&!sr(i.src,o=a[3]+"area.svg")&&te(i,"src",o),h&128&&te(i,"alt",a[7]),h&128&&te(i,"title",a[7])},d(a){a&&Se(i)}}}function _x(s){let i,o;return{c(){i=ge("img"),sr(i.src,o=s[3]+"reverse.svg")||te(i,"src",o),te(i,"alt",s[7]),te(i,"title",s[7]),te(i,"class","svelte-w9y5n9")},m(a,h){ke(a,i,h)},p(a,h){h&8&&!sr(i.src,o=a[3]+"reverse.svg")&&te(i,"src",o),h&128&&te(i,"alt",a[7]),h&128&&te(i,"title",a[7])},d(a){a&&Se(i)}}}function yx(s){let i,o;return{c(){i=ge("img"),sr(i.src,o=s[3]+"poi.svg")||te(i,"src",o),te(i,"alt",s[7]),te(i,"title",s[7]),te(i,"class","svelte-w9y5n9")},m(a,h){ke(a,i,h)},p(a,h){h&8&&!sr(i.src,o=a[3]+"poi.svg")&&te(i,"src",o),h&128&&te(i,"alt",a[7]),h&128&&te(i,"title",a[7])},d(a){a&&Se(i)}}}function vx(s){let i,o;return{c(){i=ge("img"),sr(i.src,o=s[3]+"postal_code.svg")||te(i,"src",o),te(i,"alt",s[7]),te(i,"title",s[7]),te(i,"class","svelte-w9y5n9")},m(a,h){ke(a,i,h)},p(a,h){h&8&&!sr(i.src,o=a[3]+"postal_code.svg")&&te(i,"src",o),h&128&&te(i,"alt",a[7]),h&128&&te(i,"title",a[7])},d(a){a&&Se(i)}}}function bx(s){let i,o;return{c(){i=ge("img"),sr(i.src,o=s[3]+"street.svg")||te(i,"src",o),te(i,"alt",s[7]),te(i,"title",s[7]),te(i,"class","svelte-w9y5n9")},m(a,h){ke(a,i,h)},p(a,h){h&8&&!sr(i.src,o=a[3]+"street.svg")&&te(i,"src",o),h&128&&te(i,"alt",a[7]),h&128&&te(i,"title",a[7])},d(a){a&&Se(i)}}}function xx(s){let i,o;return{c(){i=ge("img"),sr(i.src,o=s[3]+"road.svg")||te(i,"src",o),te(i,"alt",s[7]),te(i,"title",s[7]),te(i,"class","svelte-w9y5n9")},m(a,h){ke(a,i,h)},p(a,h){h&8&&!sr(i.src,o=a[3]+"road.svg")&&te(i,"src",o),h&128&&te(i,"alt",a[7]),h&128&&te(i,"title",a[7])},d(a){a&&Se(i)}}}function wx(s){let i,o;return{c(){i=ge("img"),sr(i.src,o=s[3]+"housenumber.svg")||te(i,"src",o),te(i,"alt",s[7]),te(i,"title",s[7]),te(i,"class","svelte-w9y5n9")},m(a,h){ke(a,i,h)},p(a,h){h&8&&!sr(i.src,o=a[3]+"housenumber.svg")&&te(i,"src",o),h&128&&te(i,"alt",a[7]),h&128&&te(i,"title",a[7])},d(a){a&&Se(i)}}}function Sx(s){let i,o,a,h;return{c(){i=ge("img"),sr(i.src,o=s[5])||te(i,"src",o),te(i,"alt",s[4]),te(i,"title",s[7]),te(i,"class","svelte-w9y5n9")},m(g,m){ke(g,i,m),a||(h=At(i,"error",s[14]),a=!0)},p(g,m){m&32&&!sr(i.src,o=g[5])&&te(i,"src",o),m&16&&te(i,"alt",g[4]),m&128&&te(i,"title",g[7])},d(g){g&&Se(i),a=!1,h()}}}function kx(s){let i,o;return{c(){i=ge("div"),te(i,"class","sprite-icon svelte-w9y5n9"),te(i,"style",o=`
        width: ${s[6].width/es}px;
        height: ${s[6].height/es}px;
        background-image: url(${s[3]}sprite${bd}.png);
        background-position: -${s[6].x/es}px -${s[6].y/es}px;
        background-size: ${fs.width/es}px ${fs.height/es}px;
      `),te(i,"title",s[7])},m(a,h){ke(a,i,h)},p(a,h){h&72&&o!==(o=`
        width: ${a[6].width/es}px;
        height: ${a[6].height/es}px;
        background-image: url(${a[3]}sprite${bd}.png);
        background-position: -${a[6].x/es}px -${a[6].y/es}px;
        background-size: ${fs.width/es}px ${fs.height/es}px;
      `)&&te(i,"style",o),h&128&&te(i,"title",a[7])},d(a){a&&Se(i)}}}function lg(s){let i,o;return{c(){i=ge("span"),o=ft(s[7]),te(i,"class","secondary svelte-w9y5n9")},m(a,h){ke(a,i,h),oe(i,o)},p(a,h){h&128&&rn(o,a[7])},d(a){a&&Se(i)}}}function Tx(s){let i,o,a,h,g,m,u,w,I,E=(s[8]?s[0].place_name:s[0].place_name.replace(/,.*/,""))+"",C,P,H=s[2]==="always"||s[2]!=="never"&&!s[0].address&&!s[0].id.startsWith("road.")&&!s[0].id.startsWith("address.")&&!s[0].id.startsWith("postal_code.")&&(!s[0].id.startsWith("poi.")||!s[5])&&!s[8],U,ie,se=(s[8]?"":s[0].place_name.replace(/[^,]*,?\s*/,""))+"",ae,$,Te,Pe,ve,De;function Ae(D,N){return N&1&&(o=null),N&1&&(a=null),N&1&&(h=null),N&1&&(g=null),fs&&D[6]?kx:D[5]?Sx:D[0].address?wx:(o==null&&(o=!!D[0].id.startsWith("road.")),o?xx:(a==null&&(a=!!D[0].id.startsWith("address.")),a?bx:(h==null&&(h=!!D[0].id.startsWith("postal_code.")),h?vx:(g==null&&(g=!!D[0].id.startsWith("poi.")),g?yx:D[8]?_x:gx))))}let B=Ae(s,-1),Z=B(s),Q=H&&lg(s);return{c(){i=ge("li"),Z.c(),m=He(),u=ge("span"),w=ge("span"),I=ge("span"),C=ft(E),P=He(),Q&&Q.c(),U=He(),ie=ge("span"),ae=ft(se),te(I,"class","primary svelte-w9y5n9"),te(w,"class","svelte-w9y5n9"),te(ie,"class","line2 svelte-w9y5n9"),te(u,"class","texts svelte-w9y5n9"),te(i,"tabindex","-1"),te(i,"role","option"),te(i,"aria-selected",$=s[1]==="selected"),te(i,"aria-checked",Te=s[1]==="picked"),te(i,"class",Pe=Il(s[1])+" svelte-w9y5n9")},m(D,N){ke(D,i,N),Z.m(i,null),oe(i,m),oe(i,u),oe(u,w),oe(w,I),oe(I,C),oe(w,P),Q&&Q.m(w,null),oe(u,U),oe(u,ie),oe(ie,ae),ve||(De=[At(i,"mouseenter",s[13]),At(i,"focus",s[15]),At(i,"click",s[16])],ve=!0)},p(D,[N]){B===(B=Ae(D,N))&&Z?Z.p(D,N):(Z.d(1),Z=B(D),Z&&(Z.c(),Z.m(i,m))),N&257&&E!==(E=(D[8]?D[0].place_name:D[0].place_name.replace(/,.*/,""))+"")&&rn(C,E),N&293&&(H=D[2]==="always"||D[2]!=="never"&&!D[0].address&&!D[0].id.startsWith("road.")&&!D[0].id.startsWith("address.")&&!D[0].id.startsWith("postal_code.")&&(!D[0].id.startsWith("poi.")||!D[5])&&!D[8]),H?Q?Q.p(D,N):(Q=lg(D),Q.c(),Q.m(w,null)):Q&&(Q.d(1),Q=null),N&257&&se!==(se=(D[8]?"":D[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&rn(ae,se),N&2&&$!==($=D[1]==="selected")&&te(i,"aria-selected",$),N&2&&Te!==(Te=D[1]==="picked")&&te(i,"aria-checked",Te),N&2&&Pe!==(Pe=Il(D[1])+" svelte-w9y5n9")&&te(i,"class",Pe)},i:Tt,o:Tt,d(D){D&&Se(i),Z.d(),Q&&Q.d(),ve=!1,xn(De)}}}const yy=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,bd=yy?"@2x":"",es=yy?2:1;let fs,bh;function Cx(s,i,o){let a,h,g,{feature:m}=i,{style:u="default"}=i,{showPlaceType:w}=i,{missingIconsCache:I}=i,{iconsBaseUrl:E}=i;const C=Ys();let P,H,U,ie;function se(){bh??(bh=fetch(`${E}sprite${bd}.json`).then(B=>B.json()).then(B=>{fs=B}).catch(()=>{fs=null}))}function ae(){H&&I.add(H),$()}function $(){fs!==void 0?Te():(se(),bh==null||bh.then(Te))}function Te(){do{if(ie--,o(4,P=a==null?void 0:a[ie]),o(6,U=P?fs==null?void 0:fs.icons[P]:void 0),U)break;o(5,H=P?E+P.replace(/ /g,"_")+".svg":void 0)}while(ie>-1&&(!H||I.has(H)))}function Pe(B){hi.call(this,s,B)}const ve=()=>ae(),De=()=>C("select",void 0),Ae=B=>{document.activeElement!==B.target&&C("select",void 0)};return s.$$set=B=>{"feature"in B&&o(0,m=B.feature),"style"in B&&o(1,u=B.style),"showPlaceType"in B&&o(2,w=B.showPlaceType),"missingIconsCache"in B&&o(11,I=B.missingIconsCache),"iconsBaseUrl"in B&&o(3,E=B.iconsBaseUrl)},s.$$.update=()=>{var B,Z,Q,D,N;s.$$.dirty&1&&o(12,a=(B=m.properties)==null?void 0:B.categories),s.$$.dirty&1&&o(8,h=m.place_type[0]==="reverse"),s.$$.dirty&1&&o(7,g=((Q=(Z=m.properties)==null?void 0:Z.categories)==null?void 0:Q.join(", "))??((N=(D=m.properties)==null?void 0:D.place_type_name)==null?void 0:N[0])??m.place_type[0]),s.$$.dirty&4096&&(ie=(a==null?void 0:a.length)??0,$())},[m,u,w,E,P,H,U,g,h,C,ae,I,a,Pe,ve,De,Ae]}class Ix extends Wt{constructor(i){super(),Gt(this,i,Cx,Tx,Nt,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}}function Ex(s){let i;return{c(){i=ge("div"),i.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="loading-icon svelte-1ocfouu"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',te(i,"class","svelte-1ocfouu")},m(o,a){ke(o,i,a)},p:Tt,i:Tt,o:Tt,d(o){o&&Se(i)}}}class Mx extends Wt{constructor(i){super(),Gt(this,i,null,Ex,Nt,{})}}function Lx(s){let i,o;return{c(){i=Xs("svg"),o=Xs("path"),te(o,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),te(i,"viewBox","0 0 60.006 21.412"),te(i,"width","14"),te(i,"height","20"),te(i,"class","svelte-en2qvf")},m(a,h){ke(a,i,h),oe(i,o)},p:Tt,i:Tt,o:Tt,d(a){a&&Se(i)}}}class Px extends Wt{constructor(i){super(),Gt(this,i,null,Lx,Nt,{})}}function Ax(s){let i,o,a;return{c(){i=Xs("svg"),o=Xs("circle"),a=Xs("path"),te(o,"cx","4.789"),te(o,"cy","4.787"),te(o,"r","3.85"),te(o,"class","svelte-1aq105l"),te(a,"d","M12.063 12.063 7.635 7.635"),te(a,"class","svelte-1aq105l"),te(i,"xmlns","http://www.w3.org/2000/svg"),te(i,"width","13"),te(i,"height","13"),te(i,"viewBox","0 0 13 13"),te(i,"class","svelte-1aq105l")},m(h,g){ke(h,i,g),oe(i,o),oe(i,a)},p:Tt,i:Tt,o:Tt,d(h){h&&Se(i)}}}class zx extends Wt{constructor(i){super(),Gt(this,i,null,Ax,Nt,{})}}function Dx(s,i,o){const a=i[1],h=i[0],g=a-h;return s===a&&o?s:((s-h)%g+g)%g+h}function ug(s){const i=[...s];return i[2]<i[0]&&(Math.abs((i[0]+i[2]+360)/2)>Math.abs((i[0]-360+i[2])/2)?i[0]-=360:i[2]+=360),i}let ju;async function Rx(s,i,o){const a=s==null?void 0:s.getCenterAndZoom();for(const h of i??[])if(!(a&&(h.minZoom!=null&&h.minZoom>a[0]||h.maxZoom!=null&&h.maxZoom<a[0]))){if(h.type==="fixed")return h.coordinates.join(",");e:if(h.type==="client-geolocation"){if(ju&&h.cachedLocationExpiry&&ju.time+h.cachedLocationExpiry>Date.now()){if(!ju.coords)break e;return ju.coords}let g;try{return g=await new Promise((m,u)=>{o.signal.addEventListener("abort",()=>{u(Error("aborted"))}),navigator.geolocation.getCurrentPosition(w=>{m([w.coords.longitude,w.coords.latitude].map(I=>I.toFixed(6)).join(","))},w=>{u(w)},h)}),g}catch{}finally{h.cachedLocationExpiry&&(ju={time:Date.now(),coords:g})}if(o.signal.aborted)return}if(h.type==="server-geolocation")return"ip";if(a&&h.type==="map-center")return a[1].toFixed(6)+","+a[2].toFixed(6)}}const Bx=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,cg=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,hg=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,fg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,dg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,pg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function Fx(s){if(!["DMS","DM","DD"].includes(s))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const i=this.decimalCoordinates.split(",").map(H=>Number(H.trim())),o=Number(i[0]),a=Number(i[1]),h=Math.abs(o),g=Math.abs(a),m=o>0?"N":"S",u=a>0?"E":"W";let w;s=="DD"&&(w=`${h} ${m}, ${g} ${u}`);const I=Math.floor(h),E=Math.floor(g),C=(h-I)*60,P=(g-E)*60;if(s=="DM"){let H=mg(C,3).toFixed(3).padStart(6,"0"),U=mg(P,3).toFixed(3).padStart(6,"0");H.endsWith(".000")&&U.endsWith(".000")&&(H=H.replace(/\.000$/,""),U=U.replace(/\.000$/,"")),w=`${I} ${H}' ${m}, ${E} ${U}' ${u}`}if(s=="DMS"){const H=Math.floor(C),U=Math.floor(P);let ie=((C-H)*60).toFixed(1).padStart(4,"0"),se=((P-U)*60).toFixed(1).padStart(4,"0");const ae=H.toString().padStart(2,"0"),$=U.toString().padStart(2,"0");ie.endsWith(".0")&&se.endsWith(".0")&&(ie=ie.replace(/\.0$/,""),se=se.replace(/\.0$/,"")),w=`${I} ${ae}' ${ie}" ${m}, ${E} ${$}' ${se}" ${u}`}return w}else throw new Error("no decimal coordinates to convert")}function mg(s,i){const o=Math.pow(10,i);return Math.round((s+Number.EPSILON)*o)/o}function Rd(s,i){i||(i=5),s=s.replace(/\s+/g," ").trim();let o=null,a=null,h="",g="",m=null,u=[],w=!1;if(Bx.test(s))throw new Error("invalid coordinate value");if(cg.test(s))if(u=cg.exec(s),w=Uu(u),w)o=Math.abs(u[1])+u[2]/60,Number(u[1])<0&&(o*=-1),a=Math.abs(u[3])+u[4]/60,Number(u[3])<0&&(a*=-1),m="DM";else throw new Error("invalid coordinate format");else if(hg.test(s))if(u=hg.exec(s),w=Uu(u),w){if(o=u[2],a=u[6],o.includes(",")&&(o=o.replace(",",".")),a.includes(",")&&(a=a.replace(",",".")),m="DD",Number(Math.round(o))==Number(o))throw new Error("integer only coordinate provided");if(Number(Math.round(a))==Number(a))throw new Error("integer only coordinate provided");u[1]?(h=u[1],g=u[5]):u[4]&&(h=u[4],g=u[8])}else throw new Error("invalid decimal coordinate format");else if(fg.test(s))if(u=fg.exec(s),w=Uu(u),w)o=Math.abs(parseInt(u[2])),u[4]&&(o+=u[4]/60,m="DM"),u[6]&&(o+=u[6].replace(",",".")/3600,m="DMS"),parseInt(u[2])<0&&(o=-1*o),a=Math.abs(parseInt(u[9])),u[11]&&(a+=u[11]/60),u[13]&&(a+=u[13].replace(",",".")/3600),parseInt(u[9])<0&&(a=-1*a),u[1]?(h=u[1],g=u[8]):u[7]&&(h=u[7],g=u[14]);else throw new Error("invalid DMS coordinates format");else if(dg.test(s))if(u=dg.exec(s),w=Uu(u),w)o=Math.abs(parseInt(u[2])),u[4]&&(o+=u[4]/60,m="DM"),u[6]&&(o+=u[6]/3600,m="DMS"),parseInt(u[2])<0&&(o=-1*o),a=Math.abs(parseInt(u[10])),u[12]&&(a+=u[12]/60),u[14]&&(a+=u[14]/3600),parseInt(u[10])<0&&(a=-1*a),u[1]?(h=u[1],g=u[9]):u[8]&&(h=u[8],g=u[16]);else throw new Error("invalid DMS coordinates format");else if(pg.test(s)){if(u=pg.exec(s),w=Uu(u),u.filter(I=>I).length<=5)throw new Error("invalid coordinates format");if(w)o=Math.abs(parseInt(u[2])),u[4]&&(o+=u[4].replace(",",".")/60,m="DM"),u[6]&&(o+=u[6].replace(",",".")/3600,m="DMS"),parseInt(u[2])<0&&(o=-1*o),a=Math.abs(parseInt(u[10])),u[12]&&(a+=u[12].replace(",",".")/60),u[14]&&(a+=u[14].replace(",",".")/3600),parseInt(u[10])<0&&(a=-1*a),u[1]?(h=u[1],g=u[9]):u[8]&&(h=u[8],g=u[16]);else throw new Error("invalid coordinates format")}if(w){if(Math.abs(a)>=180)throw new Error("invalid longitude value");if(Math.abs(o)>=90)throw new Error("invalid latitude value");if(h&&!g||!h&&g)throw new Error("invalid coordinates value");if(h&&h==g)throw new Error("invalid coordinates format");o.toString().includes(",")&&(o=o.replace(",",".")),a.toString().includes(",")&&(a=a.replace(",","."));let I=/S|SOUTH/i;I.test(h)&&o>0&&(o=-1*o),I=/W|WEST/i,I.test(g)&&a>0&&(a=-1*a);const E=u[0].trim();let C,P;const H=/[,/;\u0020]/g,U=E.match(H);if(U==null){const ae=Math.floor(s.length/2);C=E.substring(0,ae).trim(),P=E.substring(ae).trim()}else{let ae;U.length%2==1?ae=Math.floor(U.length/2):ae=U.length/2-1;let $=0;if(ae==0)$=E.indexOf(U[0]),C=E.substring(0,$).trim(),P=E.substring($+1).trim();else{let Te=0,Pe=0;for(;Te<=ae;)$=E.indexOf(U[Te],Pe),Pe=$+1,Te++;C=E.substring(0,$).trim(),P=E.substring($+1).trim()}}const ie=C.split(".");if(ie.length==2&&ie[1]==0&&ie[1].length!=2)throw new Error("invalid coordinates format");const se=P.split(".");if(se.length==2&&se[1]==0&&se[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(C)||/^\d+$/.test(P))throw new Error("degree only coordinate/s provided");return o=Number(Number(o).toFixed(i)),a=Number(Number(a).toFixed(i)),Object.freeze({verbatimCoordinates:E,verbatimLatitude:C,verbatimLongitude:P,decimalLatitude:o,decimalLongitude:a,decimalCoordinates:`${o},${a}`,originalFormat:m,closeEnough:Ox,toCoordinateFormat:Fx})}else throw new Error("coordinates pattern match failed")}function Uu(s){if(!isNaN(s[0]))return!1;const i=[...s];if(i.shift(),i.length%2>0)return!1;const o=/^[-+]?\d+([\.,]\d+)?$/,a=/[eastsouthnorthwest]+/i,h=i.length/2;for(let g=0;g<h;g++){const m=i[g],u=i[g+h],w=o.test(m)&&o.test(u),I=a.test(m)&&a.test(u),E=m==u;if(!(m==null&&u==null)){if(m==null||u==null)return!1;if(w||I||E)continue;return!1}}return!0}function gg(s,i){const o=Math.abs(s-i);return Number(o.toFixed(6))<=1e-5}function Ox(s){if(!s)throw new Error("coords must be provided");if(s.includes(",")){const i=s.split(",");if(Number(i[0])==NaN||Number(i[1])==NaN)throw new Error("coords are not valid decimals");return gg(this.decimalLatitude,Number(i[0]))&&gg(this.decimalLongitude,i[1])}else throw new Error("coords being tested must be separated by a comma")}const Nx=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Rd.to=Nx;const Vx=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],jx={decimalLatitude:40.123,decimalLongitude:-74.123},Ux=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],qx=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Zx(){const s=[];return Vx.forEach(i=>{i.decimalLatitude?s.push(i):s.push({...i,...jx})}),[...s,...Ux,...qx]}const Gx=Zx();Rd.formats=Gx.map(s=>s.verbatimCoordinates);const Wx=Rd;function _g(s,i,o){const a=s.slice();return a[97]=i[o],a[99]=o,a}function yg(s){let i,o,a,h,g;return o=new gy({}),{c(){i=ge("button"),it(o.$$.fragment),te(i,"type","button"),te(i,"title",s[3]),te(i,"class","svelte-bz0zu3")},m(m,u){ke(m,i,u),et(o,i,null),a=!0,h||(g=At(i,"click",s[78]),h=!0)},p(m,u){(!a||u[0]&8)&&te(i,"title",m[3])},i(m){a||(be(o.$$.fragment,m),a=!0)},o(m){Le(o.$$.fragment,m),a=!1},d(m){m&&Se(i),tt(o),h=!1,g()}}}function vg(s){let i,o;return i=new Mx({}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function bg(s){let i,o,a,h,g;return o=new Px({}),{c(){i=ge("button"),it(o.$$.fragment),te(i,"type","button"),te(i,"title",s[10]),te(i,"class","svelte-bz0zu3"),rr(i,"active",s[0])},m(m,u){ke(m,i,u),et(o,i,null),a=!0,h||(g=At(i,"click",s[79]),h=!0)},p(m,u){(!a||u[0]&1024)&&te(i,"title",m[10]),(!a||u[0]&1)&&rr(i,"active",m[0])},i(m){a||(be(o.$$.fragment,m),a=!0)},o(m){Le(o.$$.fragment,m),a=!1},d(m){m&&Se(i),tt(o),h=!1,g()}}}function Hx(s){let i,o=[],a=new Map,h,g,m,u=bn(s[13]);const w=I=>I[97].id+(I[97].address?","+I[97].address:"");for(let I=0;I<u.length;I+=1){let E=_g(s,u,I),C=w(E);a.set(C,o[I]=xg(C,E))}return{c(){i=ge("ul");for(let I=0;I<o.length;I+=1)o[I].c();te(i,"class","options svelte-bz0zu3"),te(i,"role","listbox")},m(I,E){ke(I,i,E);for(let C=0;C<o.length;C+=1)o[C]&&o[C].m(i,null);h=!0,g||(m=[At(i,"mouseleave",s[27]),At(i,"blur",s[83]),At(i,"keydown",s[23])],g=!0)},p(I,E){E[0]&102823936&&(u=bn(I[13]),ki(),o=D1(o,E,w,1,I,u,a,i,z1,xg,null,_g),Ti())},i(I){if(!h){for(let E=0;E<u.length;E+=1)be(o[E]);h=!0}},o(I){for(let E=0;E<o.length;E+=1)Le(o[E]);h=!1},d(I){I&&Se(i);for(let E=0;E<o.length;E+=1)o[E].d();g=!1,xn(m)}}}function Xx(s){let i,o,a,h,g,m;return o=new _y({}),{c(){i=ge("div"),it(o.$$.fragment),a=He(),h=ge("div"),g=ft(s[8]),te(h,"class","svelte-bz0zu3"),te(i,"class","no-results svelte-bz0zu3")},m(u,w){ke(u,i,w),et(o,i,null),oe(i,a),oe(i,h),oe(h,g),m=!0},p(u,w){(!m||w[0]&256)&&rn(g,u[8])},i(u){m||(be(o.$$.fragment,u),m=!0)},o(u){Le(o.$$.fragment,u),m=!1},d(u){u&&Se(i),tt(o)}}}function Kx(s){let i="",o;return{c(){o=ft(i)},m(a,h){ke(a,o,h)},p:Tt,i:Tt,o:Tt,d(a){a&&Se(o)}}}function Jx(s){let i,o,a,h,g,m,u,w,I,E,C;return o=new _y({}),w=new gy({}),{c(){i=ge("div"),it(o.$$.fragment),a=He(),h=ge("div"),g=ft(s[7]),m=He(),u=ge("button"),it(w.$$.fragment),te(h,"class","svelte-bz0zu3"),te(u,"class","svelte-bz0zu3"),te(i,"class","error svelte-bz0zu3")},m(P,H){ke(P,i,H),et(o,i,null),oe(i,a),oe(i,h),oe(h,g),oe(i,m),oe(i,u),et(w,u,null),I=!0,E||(C=At(u,"click",s[80]),E=!0)},p(P,H){(!I||H[0]&128)&&rn(g,P[7])},i(P){I||(be(o.$$.fragment,P),be(w.$$.fragment,P),I=!0)},o(P){Le(o.$$.fragment,P),Le(w.$$.fragment,P),I=!1},d(P){P&&Se(i),tt(o),tt(w),E=!1,C()}}}function xg(s,i){var u;let o,a,h;function g(){return i[81](i[99])}function m(){return i[82](i[97])}return a=new Ix({props:{feature:i[97],showPlaceType:i[11],style:i[15]===i[99]?"selected":((u=i[14])==null?void 0:u.id)===i[97].id?"picked":"default",missingIconsCache:i[21],iconsBaseUrl:i[12]}}),a.$on("mouseenter",g),a.$on("select",m),{key:s,first:null,c(){o=Kn(),it(a.$$.fragment),this.first=o},m(w,I){ke(w,o,I),et(a,w,I),h=!0},p(w,I){var C;i=w;const E={};I[0]&8192&&(E.feature=i[97]),I[0]&2048&&(E.showPlaceType=i[11]),I[0]&57344&&(E.style=i[15]===i[99]?"selected":((C=i[14])==null?void 0:C.id)===i[97].id?"picked":"default"),I[0]&4096&&(E.iconsBaseUrl=i[12]),a.$set(E)},i(w){h||(be(a.$$.fragment,w),h=!0)},o(w){Le(a.$$.fragment,w),h=!1},d(w){w&&Se(o),tt(a,w)}}}function Yx(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie,se,ae,$,Te,Pe=!1;g=new zx({});let ve=!s[20]&&yg(s),De=s[20]&&vg(),Ae=s[6]==="button"&&bg(s);const B=s[70].default,Z=on(B,s,s[69],null),Q=[Jx,Kx,Xx,Hx],D=[];function N(ee,me){var ne,pe;return ee[19]?0:!ee[16]&&!ee[4]?1:((ne=ee[13])==null?void 0:ne.length)===0?2:(pe=ee[13])!=null&&pe.length&&(ee[16]||ee[4])?3:-1}return~(U=N(s))&&(ie=D[U]=Q[U](s)),{c(){i=He(),o=ge("form"),a=ge("div"),h=ge("button"),it(g.$$.fragment),m=He(),u=ge("input"),w=He(),I=ge("div"),ve&&ve.c(),E=He(),De&&De.c(),C=He(),Ae&&Ae.c(),P=He(),Z&&Z.c(),H=He(),ie&&ie.c(),te(h,"class","search-button svelte-bz0zu3"),te(h,"type","button"),te(u,"placeholder",s[9]),te(u,"aria-label",s[9]),te(u,"class","svelte-bz0zu3"),te(I,"class","clear-button-container svelte-bz0zu3"),rr(I,"displayable",s[1]!==""),te(a,"class","input-group svelte-bz0zu3"),te(o,"class",se=Il(s[2])+" svelte-bz0zu3"),rr(o,"can-collapse",s[5]&&s[1]==="")},m(ee,me){ke(ee,i,me),ke(ee,o,me),oe(o,a),oe(a,h),et(g,h,null),oe(a,m),oe(a,u),s[72](u),Ui(u,s[1]),oe(a,w),oe(a,I),ve&&ve.m(I,null),oe(I,E),De&&De.m(I,null),oe(a,C),Ae&&Ae.m(a,null),oe(a,P),Z&&Z.m(a,null),oe(o,H),~U&&D[U].m(o,null),ae=!0,$||(Te=[At(h,"click",s[71]),At(u,"input",s[73]),At(u,"focus",s[74]),At(u,"blur",s[75]),At(u,"click",s[76]),At(u,"keydown",s[23]),At(u,"input",s[24]),At(u,"change",s[77]),At(o,"submit",N_(s[22]))],$=!0)},p(ee,me){(!ae||me[0]&512)&&te(u,"placeholder",ee[9]),(!ae||me[0]&512)&&te(u,"aria-label",ee[9]),me[0]&2&&u.value!==ee[1]&&Ui(u,ee[1]),ee[20]?ve&&(ki(),Le(ve,1,1,()=>{ve=null}),Ti()):ve?(ve.p(ee,me),me[0]&1048576&&be(ve,1)):(ve=yg(ee),ve.c(),be(ve,1),ve.m(I,E)),ee[20]?De?me[0]&1048576&&be(De,1):(De=vg(),De.c(),be(De,1),De.m(I,null)):De&&(ki(),Le(De,1,1,()=>{De=null}),Ti()),(!ae||me[0]&2)&&rr(I,"displayable",ee[1]!==""),ee[6]==="button"?Ae?(Ae.p(ee,me),me[0]&64&&be(Ae,1)):(Ae=bg(ee),Ae.c(),be(Ae,1),Ae.m(a,P)):Ae&&(ki(),Le(Ae,1,1,()=>{Ae=null}),Ti()),Z&&Z.p&&(!ae||me[2]&128)&&ln(Z,B,ee,ee[69],ae?an(B,ee[69],me,null):un(ee[69]),null);let ne=U;U=N(ee),U===ne?~U&&D[U].p(ee,me):(ie&&(ki(),Le(D[ne],1,1,()=>{D[ne]=null}),Ti()),~U?(ie=D[U],ie?ie.p(ee,me):(ie=D[U]=Q[U](ee),ie.c()),be(ie,1),ie.m(o,null)):ie=null),(!ae||me[0]&4&&se!==(se=Il(ee[2])+" svelte-bz0zu3"))&&te(o,"class",se),(!ae||me[0]&38)&&rr(o,"can-collapse",ee[5]&&ee[1]==="")},i(ee){ae||(be(Pe),be(g.$$.fragment,ee),be(ve),be(De),be(Ae),be(Z,ee),be(ie),ae=!0)},o(ee){Le(Pe),Le(g.$$.fragment,ee),Le(ve),Le(De),Le(Ae),Le(Z,ee),Le(ie),ae=!1},d(ee){ee&&(Se(i),Se(o)),tt(g),s[72](null),ve&&ve.d(),De&&De.d(),Ae&&Ae.d(),Z&&Z.d(ee),~U&&D[U].d(),$=!1,xn(Te)}}}function Qx(s,i,o){let a,h,g,{$$slots:m={},$$scope:u}=i;const w={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:I=void 0}=i,{apiKey:E=void 0}=i,{bbox:C=void 0}=i,{clearButtonTitle:P="clear"}=i,{clearOnBlur:H=!1}=i,{clearListOnPick:U=!1}=i,{keepListOpen:ie=!1}=i,{collapsed:se=!1}=i,{country:ae=void 0}=i,{debounceSearch:$=200}=i,{enableReverse:Te="never"}=i,{errorMessage:Pe="Something went wrong"}=i,{filter:ve=()=>!0}=i,{flyTo:De=!0}=i,{fuzzyMatch:Ae=!0}=i,{language:B=void 0}=i,{limit:Z=void 0}=i;const Q=41415112612;let{reverseGeocodingLimit:D=Q}=i,{mapController:N=void 0}=i,{minLength:ee=2}=i,{noResultsMessage:me="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=i,{placeholder:ne="Search"}=i,{proximity:pe=[{type:"server-geolocation"}]}=i,{reverseActive:Ce=Te==="always"}=i,{reverseButtonTitle:fe="toggle reverse geocoding"}=i,{searchValue:qe=""}=i,{pickedResultStyle:nt="full-geometry"}=i,{showPlaceType:lt="if-needed"}=i,{showResultsWhileTyping:at=!0}=i,{selectFirst:ut=!0}=i,{flyToSelected:St=!1}=i,{markerOnSelected:It=!0}=i,{types:st=void 0}=i;const Lt=[];let{reverseGeocodingTypes:wi=Lt}=i,{exhaustiveReverseGeocoding:Di=!1}=i,{excludeTypes:Zi=!1}=i;const _i=void 0;let{reverseGeocodingExcludeTypes:Si=_i}=i,{zoom:Ne=w}=i,{apiUrl:yt="https://api.maptiler.com/geocoding"}=i,{fetchParameters:Qt={}}=i,{iconsBaseUrl:je="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.7/icons/"}=i,{adjustUrlQuery:$e=()=>{}}=i,{adjustUrl:Ei=()=>{}}=i;function Ge(Be){ot.focus(Be)}function Vt(){ot.blur()}function Ri(Be,Yt=!0,ri=!1){o(1,qe=Be),Yt?(o(15,fi=-1),ar()):(le(void 0,!ri,ri),setTimeout(()=>{ot.focus(),ot.select()}))}function jn(){o(13,si=void 0),o(14,Ut=void 0),o(15,fi=-1)}function Ir(){o(64,Mi=[]),o(14,Ut=void 0)}let si,Mi,Ut,ps="",ot,fi=-1,Hi,Un=[],Pn,ht,ii,Ht,tn=!1;const or=new Set,Xt=Ys();mr(()=>{N&&(N.setEventHandler(void 0),N.indicateReverse(!1),N.setSelectedMarker(-1),N.setFeatures(void 0,void 0,!1))});function ar(Be){if(o(17,tn=!1),ht&&(clearTimeout(ht),ht=void 0),fi>-1&&si)o(14,Ut=si[fi]),o(1,qe=Ut.place_type[0]==="reverse"?Ut.place_name:Ut.place_name.replace(/,.*/,"")),o(19,Hi=void 0),o(64,Mi=void 0),o(15,fi=-1);else if(qe){const Yt=Be||!lr(qe);gr(qe,{exact:!0}).then(()=>{o(64,Mi=si),o(14,Ut=void 0),Yt&&_r()}).catch(ri=>o(19,Hi=ri))}}function lr(Be){try{return Wx(Be,6)}catch{return!1}}async function gr(Be,{byId:Yt=!1,exact:ri=!1}={}){var zi,Xi,qn;o(19,Hi=void 0),Pn==null||Pn.abort();const Pi=new AbortController;o(20,Pn=Pi);try{const qt=lr(Be),rs=new URL(yt+"/"+encodeURIComponent(qt?qt.decimalLongitude+","+qt.decimalLatitude:Be)+".json"),An=rs.searchParams;B!==void 0&&An.set("language",Array.isArray(B)?B.join(","):B??"");const[En]=(N==null?void 0:N.getCenterAndZoom())??[];let nn=(zi=!qt||wi===Lt?st:wi)==null?void 0:zi.map(bi=>typeof bi=="string"?bi:En===void 0||(bi[0]??0)<=En&&En<(bi[1]??1/0)?bi[2]:void 0).filter(bi=>bi!==void 0);nn&&(nn=[...new Set(nn)],An.set("types",nn.join(",")));const va=!qt||Si===_i?Zi:Si;if(va&&An.set("excludeTypes",String(va)),C&&An.set("bbox",C.map(bi=>bi.toFixed(6)).join(",")),ae&&An.set("country",Array.isArray(ae)?ae.join(","):ae),!Yt&&!qt){const bi=await Rx(N,pe,Pi);bi&&An.set("proximity",bi),(ri||!at)&&An.set("autocomplete","false"),An.set("fuzzyMatch",String(Ae))}const kn=D===Q?Z:D;kn!==void 0&&kn>1&&(nn==null?void 0:nn.length)!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),qt?(kn===1||kn!==void 0&&(Di||(nn==null?void 0:nn.length)===1))&&An.set("limit",String(kn)):Z!==void 0&&An.set("limit",String(Z)),E&&An.set("key",E),$e(An),Ei(rs);const Zn=rs.searchParams.get("types")===""&&rs.searchParams.get("excludeTypes")!=="true",Er=rs.toString();if(Er===ps){Yt?(U&&o(13,si=void 0),o(14,Ut=Un[0])):(o(13,si=Un),((Xi=si[fi])==null?void 0:Xi.id)!==(h==null?void 0:h.id)&&o(15,fi=-1));return}ps=Er;let ur;if(Zn)ur={type:"FeatureCollection",features:[]};else{const bi=await fetch(Er,{signal:Pi.signal,...Qt});if(!bi.ok)throw new Error(await bi.text());ur=await bi.json()}Xt("response",{url:Er,featureCollection:ur}),Yt?(U&&o(13,si=void 0),o(14,Ut=ur.features[0]),Un=[Ut]):(o(13,si=ur.features.filter(ve)),qt&&si.unshift({type:"Feature",properties:{},id:"reverse_"+qt.decimalLongitude+"_"+qt.decimalLatitude,text:qt.decimalLatitude+", "+qt.decimalLongitude,place_name:qt.decimalLatitude+", "+qt.decimalLongitude,place_type:["reverse"],center:[qt.decimalLongitude,qt.decimalLatitude],bbox:[qt.decimalLongitude,qt.decimalLatitude,qt.decimalLongitude,qt.decimalLatitude],geometry:{type:"Point",coordinates:[qt.decimalLongitude,qt.decimalLatitude]}}),Un=si,((qn=si[fi])==null?void 0:qn.id)!==(h==null?void 0:h.id)&&o(15,fi=-1),qt&&ot.focus())}catch(qt){if(qt&&typeof qt=="object"&&"name"in qt&&qt.name==="AbortError")return;throw qt}finally{Pi===Pn&&o(20,Pn=void 0)}}function _r(){var Pi;if(!(Mi!=null&&Mi.length)||!De)return;const Be=[180,90,-180,-90],Yt=!Mi.some(zi=>!zi.matching_text);let ri;for(const zi of Mi){const Xi=j(zi);if(ri=ri===void 0?Xi:Xi===void 0?ri:Math.max(ri,Xi),Yt||!zi.matching_text)for(const qn of[0,1,2,3])Be[qn]=Math[qn<2?"min":"max"](Be[qn],((Pi=zi.bbox)==null?void 0:Pi[qn])??zi.center[qn%2])}N&&Mi.length>0&&(Ut&&Be[0]===Be[2]&&Be[1]===Be[3]?N.flyTo(Ut.center,j(Ut)):N.fitBounds(ug(Be),50,ri))}function de(){!Ut||!N||(!Ut.bbox||Ut.bbox[0]===Ut.bbox[2]&&Ut.bbox[1]===Ut.bbox[3]?N.flyTo(Ut.center,j(Ut)):N.fitBounds(ug(Ut.bbox),50,j(Ut)))}function j(Be){var ri;if(!Be.bbox||Be.bbox[0]!==Be.bbox[2]&&Be.bbox[1]!==Be.bbox[3])return;const Yt=Be.id.replace(/\..*/,"");return(Array.isArray((ri=Be.properties)==null?void 0:ri.categories)?Be.properties.categories.reduce((Pi,zi)=>{const Xi=Ne[Yt+"."+zi];return Pi===void 0?Xi:Xi===void 0?Pi:Math.max(Pi,Xi)},void 0):void 0)??Ne[Yt]}function q(Be){o(0,Ce=Te==="always"),o(13,si=void 0),o(14,Ut=void 0),o(15,fi=-1),Ri(Be[1].toFixed(6)+", "+Dx(Be[0],[-180,180],!0).toFixed(6),!1,!0)}function J(Be){if(!si)return;let Yt=Be.key==="ArrowDown"?1:Be.key==="ArrowUp"?-1:0;Yt&&(ot.focus(),o(17,tn=!0),Be.preventDefault(),Ut&&fi===-1&&o(15,fi=si.findIndex(ri=>ri.id===(Ut==null?void 0:Ut.id))),fi===(Ut||ut?0:-1)&&Yt===-1&&o(15,fi=si.length),o(15,fi+=Yt),fi>=si.length&&o(15,fi=-1),fi<0&&(Ut||ut)&&o(15,fi=0))}function le(Be,Yt=!0,ri=!1){if(o(19,Hi=void 0),o(14,Ut=void 0),o(17,tn=!0),at||ri){if(ht&&clearTimeout(ht),qe.length<ee)return;const Pi=qe;ht=window.setTimeout(()=>{gr(Pi).catch(zi=>o(19,Hi=zi))},Yt?$:0)}else o(13,si=void 0),o(19,Hi=void 0)}function Ee(Be){Ut&&(Ut==null?void 0:Ut.id)===(Be==null?void 0:Be.id)?de():(o(14,Ut=Be),o(1,qe=Be.place_name))}function Re(Be){o(15,fi=Be)}function Ve(){(!ut||Ut)&&o(15,fi=-1),St&&de()}const we=()=>ot.focus();function Ke(Be){gi[Be?"unshift":"push"](()=>{ot=Be,o(18,ot)})}function Qe(){qe=this.value,o(1,qe),o(17,tn),o(31,H),o(16,ii)}const We=()=>o(17,tn=!0),dt=()=>o(17,tn=!1),Ft=()=>o(17,tn=!0),jt=()=>o(14,Ut=void 0),yi=()=>{o(1,qe=""),o(14,Ut=void 0),ot.focus()},ni=()=>o(0,Ce=!Ce),vi=()=>o(19,Hi=void 0),li=Be=>Re(Be),fn=Be=>Ee(Be),en=()=>{};return s.$$set=Be=>{"class"in Be&&o(2,I=Be.class),"apiKey"in Be&&o(29,E=Be.apiKey),"bbox"in Be&&o(30,C=Be.bbox),"clearButtonTitle"in Be&&o(3,P=Be.clearButtonTitle),"clearOnBlur"in Be&&o(31,H=Be.clearOnBlur),"clearListOnPick"in Be&&o(32,U=Be.clearListOnPick),"keepListOpen"in Be&&o(4,ie=Be.keepListOpen),"collapsed"in Be&&o(5,se=Be.collapsed),"country"in Be&&o(33,ae=Be.country),"debounceSearch"in Be&&o(34,$=Be.debounceSearch),"enableReverse"in Be&&o(6,Te=Be.enableReverse),"errorMessage"in Be&&o(7,Pe=Be.errorMessage),"filter"in Be&&o(35,ve=Be.filter),"flyTo"in Be&&o(36,De=Be.flyTo),"fuzzyMatch"in Be&&o(37,Ae=Be.fuzzyMatch),"language"in Be&&o(38,B=Be.language),"limit"in Be&&o(39,Z=Be.limit),"reverseGeocodingLimit"in Be&&o(40,D=Be.reverseGeocodingLimit),"mapController"in Be&&o(41,N=Be.mapController),"minLength"in Be&&o(42,ee=Be.minLength),"noResultsMessage"in Be&&o(8,me=Be.noResultsMessage),"placeholder"in Be&&o(9,ne=Be.placeholder),"proximity"in Be&&o(43,pe=Be.proximity),"reverseActive"in Be&&o(0,Ce=Be.reverseActive),"reverseButtonTitle"in Be&&o(10,fe=Be.reverseButtonTitle),"searchValue"in Be&&o(1,qe=Be.searchValue),"pickedResultStyle"in Be&&o(44,nt=Be.pickedResultStyle),"showPlaceType"in Be&&o(11,lt=Be.showPlaceType),"showResultsWhileTyping"in Be&&o(45,at=Be.showResultsWhileTyping),"selectFirst"in Be&&o(46,ut=Be.selectFirst),"flyToSelected"in Be&&o(47,St=Be.flyToSelected),"markerOnSelected"in Be&&o(48,It=Be.markerOnSelected),"types"in Be&&o(49,st=Be.types),"reverseGeocodingTypes"in Be&&o(50,wi=Be.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in Be&&o(51,Di=Be.exhaustiveReverseGeocoding),"excludeTypes"in Be&&o(52,Zi=Be.excludeTypes),"reverseGeocodingExcludeTypes"in Be&&o(53,Si=Be.reverseGeocodingExcludeTypes),"zoom"in Be&&o(54,Ne=Be.zoom),"apiUrl"in Be&&o(55,yt=Be.apiUrl),"fetchParameters"in Be&&o(56,Qt=Be.fetchParameters),"iconsBaseUrl"in Be&&o(12,je=Be.iconsBaseUrl),"adjustUrlQuery"in Be&&o(57,$e=Be.adjustUrlQuery),"adjustUrl"in Be&&o(58,Ei=Be.adjustUrl),"$$scope"in Be&&o(69,u=Be.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&64&&o(0,Ce=Te==="always"),s.$$.dirty[0]&16384|s.$$.dirty[1]&8192&&nt!=="marker-only"&&Ut&&!Ut.address&&Ut.geometry.type==="Point"&&Ut.place_type[0]!=="reverse"&&gr(Ut.id,{byId:!0}).catch(Be=>o(19,Hi=Be)),s.$$.dirty[0]&16384|s.$$.dirty[1]&1058|s.$$.dirty[2]&8&&(N&&Ut&&Ut.id!==Ht&&De&&(de(),U&&o(13,si=void 0),o(64,Mi=void 0),o(15,fi=-1)),o(65,Ht=Ut==null?void 0:Ut.id)),s.$$.dirty[0]&196608|s.$$.dirty[1]&1&&setTimeout(()=>{o(16,ii=tn),H&&!ii&&o(1,qe="")}),s.$$.dirty[0]&8194|s.$$.dirty[1]&2048&&qe.length<ee&&(o(13,si=void 0),o(19,Hi=void 0),o(64,Mi=si)),s.$$.dirty[0]&57344|s.$$.dirty[1]&32768&&ut&&si!=null&&si.length&&fi==-1&&!Ut&&o(15,fi=0),s.$$.dirty[0]&8192|s.$$.dirty[2]&4&&Mi!==si&&o(64,Mi=void 0),s.$$.dirty[0]&73729|s.$$.dirty[1]&1024|s.$$.dirty[2]&4&&N&&N.setEventHandler(Be=>{switch(Be.type){case"mapClick":Ce&&q(Be.coordinates);break;case"markerClick":{const Yt=si==null?void 0:si.find(ri=>ri.id===Be.id);Yt&&Ee(Yt)}break;case"markerMouseEnter":Mi&&o(15,fi=ii?(si==null?void 0:si.findIndex(Yt=>Yt.id===Be.id))??-1:-1);break;case"markerMouseLeave":Mi&&o(15,fi=-1);break}}),s.$$.dirty[0]&40960&&o(66,h=si==null?void 0:si[fi]),s.$$.dirty[1]&66592|s.$$.dirty[2]&16&&N&&h&&De&&St&&N.flyTo(h.center,j(h)),s.$$.dirty[1]&8192&&o(68,a=nt==="full-geometry-including-polygon-center-marker"),s.$$.dirty[1]&132096|s.$$.dirty[2]&64&&(It||N==null||N.setFeatures(void 0,void 0,a)),s.$$.dirty[0]&16384|s.$$.dirty[1]&132096|s.$$.dirty[2]&84&&N&&It&&!Mi&&(N.setFeatures(h?[h]:void 0,Ut,a),N.setSelectedMarker(h?0:-1)),s.$$.dirty[0]&16384|s.$$.dirty[1]&1024|s.$$.dirty[2]&68&&N&&N.setFeatures(Mi,Ut,a),s.$$.dirty[0]&32768|s.$$.dirty[1]&1024|s.$$.dirty[2]&4&&Mi&&N&&N.setSelectedMarker(fi),s.$$.dirty[0]&2|s.$$.dirty[1]&1024&&N){const Be=lr(qe);N.setReverseMarker(Be?[Be.decimalLongitude,Be.decimalLatitude]:void 0)}s.$$.dirty[2]&16&&Xt("select",{feature:h}),s.$$.dirty[0]&16384&&Xt("pick",{feature:Ut}),s.$$.dirty[0]&73744&&o(67,g=!!(si!=null&&si.length)&&(ii||ie)),s.$$.dirty[2]&32&&Xt("optionsvisibilitychange",{optionsVisible:g}),s.$$.dirty[0]&8192&&Xt("featureslisted",{features:si}),s.$$.dirty[2]&4&&Xt("featuresmarked",{features:Mi}),s.$$.dirty[0]&1&&Xt("reversetoggle",{reverse:Ce}),s.$$.dirty[0]&2&&Xt("querychange",{query:qe}),s.$$.dirty[0]&1|s.$$.dirty[1]&1024&&N&&N.indicateReverse(Ce)},[Ce,qe,I,P,ie,se,Te,Pe,me,ne,fe,lt,je,si,Ut,fi,ii,tn,ot,Hi,Pn,or,ar,J,le,Ee,Re,Ve,w,E,C,H,U,ae,$,ve,De,Ae,B,Z,D,N,ee,pe,nt,at,ut,St,It,st,wi,Di,Zi,Si,Ne,yt,Qt,$e,Ei,Ge,Vt,Ri,jn,Ir,Mi,Ht,h,g,a,u,m,we,Ke,Qe,We,dt,Ft,jt,yi,ni,vi,li,fn,en]}class $x extends Wt{constructor(i){super(),Gt(this,i,Qx,Yx,Nt,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}}function wg(s){let i,o,a;return o=new $x({props:{mapController:s[2],apiKey:s[0],country:s[1],types:s[3],proximity:[{type:"map-center"}]}}),{c(){i=ge("div"),it(o.$$.fragment),te(i,"class","svelte-ixhnie")},m(h,g){ke(h,i,g),et(o,i,null),a=!0},p(h,g){const m={};g&4&&(m.mapController=h[2]),g&1&&(m.apiKey=h[0]),g&2&&(m.country=h[1]),o.$set(m)},i(h){a||(be(o.$$.fragment,h),a=!0)},o(h){Le(o.$$.fragment,h),a=!1},d(h){h&&Se(i),tt(o)}}}function ew(s){let i,o,a=s[2]&&wg(s);return{c(){a&&a.c(),i=Kn()},m(h,g){a&&a.m(h,g),ke(h,i,g),o=!0},p(h,[g]){h[2]?a?(a.p(h,g),g&4&&be(a,1)):(a=wg(h),a.c(),be(a,1),a.m(i.parentNode,i)):a&&(ki(),Le(a,1,1,()=>{a=null}),Ti())},i(h){o||(be(a),o=!0)},o(h){Le(a),o=!1},d(h){h&&Se(i),a&&a.d(h)}}}function tw(s,i,o){let a,{apiKey:h}=i,{map:g}=i,{country:m}=i,u=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function w(I){return I?dx(I,Wr,!0,!0,{duration:1e3},{duration:1e3}):null}return s.$$set=I=>{"apiKey"in I&&o(0,h=I.apiKey),"map"in I&&o(4,g=I.map),"country"in I&&o(1,m=I.country)},s.$$.update=()=>{s.$$.dirty&16&&o(2,a=w(g))},[h,m,a,u,g]}class iw extends Wt{constructor(i){super(),Gt(this,i,tw,ew,Nt,{apiKey:0,map:4,country:1})}}function nw(s){let i,o,a,h,g,m,u,w,I,E;return i=new Ld({}),i.$on("contextmenu",s[1]),{c(){it(i.$$.fragment),o=He(),a=ge("div"),h=ge("div"),g=ge("button"),g.textContent="Streetview",m=He(),u=ge("button"),u.textContent="OSM",te(g,"class","btn btn-primary"),te(u,"class","btn btn-primary"),te(h,"class","d-grid gap-2")},m(C,P){et(i,C,P),ke(C,o,P),ke(C,a,P),oe(a,h),oe(h,g),oe(h,m),oe(h,u),s[5](a),w=!0,I||(E=[At(g,"click",s[2]),At(u,"click",s[3])],I=!0)},p:Tt,i(C){w||(be(i.$$.fragment,C),w=!0)},o(C){Le(i.$$.fragment,C),w=!1},d(C){C&&(Se(o),Se(a)),tt(i,C),s[5](null),I=!1,xn(E)}}}function rw(s,i,o){let{map:a}=i,h,g=new J_.Popup({closeButton:!1,className:"popup-box"});mr(()=>{a&&(g!=null&&g.isOpen())&&g.remove()});function m(E){a&&g.setLngLat(E.detail.lngLat).addTo(a)}function u(){let{lng:E,lat:C}=g.getLngLat();window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${C},${E}&cbp=11,0,0,0,0`,"_blank")}function w(){let{lng:E,lat:C}=g.getLngLat();window.open(`https://www.openstreetmap.org/#map=17/${C}/${E}`,"_blank")}function I(E){gi[E?"unshift":"push"](()=>{h=E,o(0,h)})}return s.$$set=E=>{"map"in E&&o(4,a=E.map)},s.$$.update=()=>{s.$$.dirty&1&&h&&g.setDOMContent(h)},[h,m,u,w,a,I]}class sw extends Wt{constructor(i){super(),Gt(this,i,rw,nw,Nt,{map:4})}}const ow=s=>({props:s&8,features:s&8}),Sg=s=>({props:uw(s[3]),features:s[3]});function aw(s){let i;const o=s[1].default,a=on(o,s,s[2],Sg);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&12)&&ln(a,o,h,h[2],i?an(o,h[2],g,ow):un(h[2]),Sg)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function lw(s){let i,o;return i=new Gv({props:{openOn:s[0],$$slots:{default:[aw,({features:a})=>({3:a}),({features:a})=>a?8:0]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&1&&(g.openOn=a[0]),h&12&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function uw(s){return s?s[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function cw(s,i,o){let{$$slots:a={},$$scope:h}=i,{openOn:g="hover"}=i;return s.$$set=m=>{"openOn"in m&&o(0,g=m.openOn),"$$scope"in m&&o(2,h=m.$$scope)},[g,a,h]}class Oh extends Wt{constructor(i){super(),Gt(this,i,cw,lw,Nt,{openOn:0})}}function hw(s){let i,o,a,h;return i=new $_({props:{showCompass:!1}}),a=new ey({}),{c(){it(i.$$.fragment),o=He(),it(a.$$.fragment)},m(g,m){et(i,g,m),ke(g,o,m),et(a,g,m),h=!0},p:Tt,i(g){h||(be(i.$$.fragment,g),be(a.$$.fragment,g),h=!0)},o(g){Le(i.$$.fragment,g),Le(a.$$.fragment,g),h=!1},d(g){g&&Se(o),tt(i,g),tt(a,g)}}}function fw(s,i,o){let{map:a}=i;return s.$$set=h=>{"map"in h&&o(0,a=h.map)},s.$$.update=()=>{s.$$.dirty&1&&a&&(a.keyboard.disableRotation(),a.dragRotate.disable(),a.touchZoomRotate.disableRotation())},[a]}class dw extends Wt{constructor(i){super(),Gt(this,i,fw,hw,Nt,{map:0})}}const pw=["==",["geometry-type"],"Polygon"],mw=["==",["geometry-type"],"LineString"];function Ll(s,i,o){let a=["match",s];for(let[h,g]of Object.entries(i))a.push(h),a.push(g);return a.push(o),a}function ns(s,i,o){let a=["step",s];for(let h=1;h<i.length;h++)a.push(o[h-1]),a.push(i[h]);return a.push(o[o.length-1]),a}function kg(){return{type:"FeatureCollection",features:[]}}let bl="MZEJTanw3WpxRvt7qDfo",Tg=`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${bl}`,rc={Blank:{version:8,sources:{},layers:[],glyphs:Tg},"Maptiler Streets":`https://api.maptiler.com/maps/streets-v2/style.json?key=${bl}`,"Maptiler Dataviz":`https://api.maptiler.com/maps/dataviz/style.json?key=${bl}`,"Maptiler Hybrid":`https://api.maptiler.com/maps/hybrid/style.json?key=${bl}`,"Maptiler OpenStreetMap":`https://api.maptiler.com/maps/openstreetmap/style.json?key=${bl}`,"Maptiler OS Open Zoomstack":`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${bl}`,"ESRI World Imagery":{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"ESRI &copy; <a href='http://www.esri.com' target='_blank'>ESRI</a>",minzoom:0,maxzoom:18}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:Tg}};const Ao={Footway:"black",WithTraffic:"grey","Crossing(Signalized)":"green","Crossing(Zebra)":"green","Crossing(Other)":"green",Severance:"red"},Yu={Signalized:"yellow",Zebra:"white",Other:"brown"},Hs=["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],vy=[1,4,7,10,13,15];let xd=["#267300","#FFAA00","#E60000","#A80000","#730000","#000000"],wd=[0,3,5,8,10,20,100];const gw=s=>({}),Cg=s=>({}),_w=s=>({}),Ig=s=>({}),yw=s=>({}),Eg=s=>({});function vw(s){let i,o,a,h,g,m,u,w;const I=s[1].top,E=on(I,s,s[0],Eg),C=s[1].left,P=on(C,s,s[0],Ig),H=s[1].main,U=on(H,s,s[0],Cg);return{c(){i=ge("div"),o=ge("div"),E&&E.c(),a=He(),h=ge("div"),g=ge("div"),P&&P.c(),m=He(),u=ge("div"),U&&U.c(),te(o,"class","top svelte-29q570"),te(g,"class","left svelte-29q570"),te(u,"class","main svelte-29q570"),te(h,"class","content svelte-29q570"),te(i,"class","flex-container svelte-29q570")},m(ie,se){ke(ie,i,se),oe(i,o),E&&E.m(o,null),oe(i,a),oe(i,h),oe(h,g),P&&P.m(g,null),oe(h,m),oe(h,u),U&&U.m(u,null),w=!0},p(ie,[se]){E&&E.p&&(!w||se&1)&&ln(E,I,ie,ie[0],w?an(I,ie[0],se,yw):un(ie[0]),Eg),P&&P.p&&(!w||se&1)&&ln(P,C,ie,ie[0],w?an(C,ie[0],se,_w):un(ie[0]),Ig),U&&U.p&&(!w||se&1)&&ln(U,H,ie,ie[0],w?an(H,ie[0],se,gw):un(ie[0]),Cg)},i(ie){w||(be(E,ie),be(P,ie),be(U,ie),w=!0)},o(ie){Le(E,ie),Le(P,ie),Le(U,ie),w=!1},d(ie){ie&&Se(i),E&&E.d(ie),P&&P.d(ie),U&&U.d(ie)}}}function bw(s,i,o){let{$$slots:a={},$$scope:h}=i;return s.$$set=g=>{"$$scope"in g&&o(0,h=g.$$scope)},[h,a]}class xw extends Wt{constructor(i){super(),Gt(this,i,bw,vw,Nt,{})}}const ww=s=>({}),Mg=s=>({}),Sw=s=>({}),Lg=s=>({}),kw=s=>({}),Pg=s=>({});function Tw(s){let i,o,a,h,g,m;const u=s[4].top,w=on(u,s,s[3],Pg),I=s[4].sidebar,E=on(I,s,s[3],Lg),C=s[4].map,P=on(C,s,s[3],Mg);return{c(){i=ge("div"),w&&w.c(),o=He(),a=ge("div"),E&&E.c(),h=He(),g=ge("div"),P&&P.c()},m(H,U){ke(H,i,U),w&&w.m(i,null),s[5](i),ke(H,o,U),ke(H,a,U),E&&E.m(a,null),s[6](a),ke(H,h,U),ke(H,g,U),P&&P.m(g,null),s[7](g),m=!0},p(H,[U]){w&&w.p&&(!m||U&8)&&ln(w,u,H,H[3],m?an(u,H[3],U,kw):un(H[3]),Pg),E&&E.p&&(!m||U&8)&&ln(E,I,H,H[3],m?an(I,H[3],U,Sw):un(H[3]),Lg),P&&P.p&&(!m||U&8)&&ln(P,C,H,H[3],m?an(C,H[3],U,ww):un(H[3]),Mg)},i(H){m||(be(w,H),be(E,H),be(P,H),m=!0)},o(H){Le(w,H),Le(E,H),Le(P,H),m=!1},d(H){H&&(Se(i),Se(o),Se(a),Se(h),Se(g)),w&&w.d(H),s[5](null),E&&E.d(H),s[6](null),P&&P.d(H),s[7](null)}}}function Cw(s,i,o){let a,h,g;Pt(s,Ag,C=>o(0,a=C)),Pt(s,Sd,C=>o(1,h=C)),Pt(s,kd,C=>o(2,g=C));let{$$slots:m={},$$scope:u}=i;function w(C){gi[C?"unshift":"push"](()=>{a=C,Ag.set(a)})}function I(C){gi[C?"unshift":"push"](()=>{h=C,Sd.set(h)})}function E(C){gi[C?"unshift":"push"](()=>{g=C,kd.set(g)})}return s.$$set=C=>{"$$scope"in C&&o(3,u=C.$$scope)},[a,h,g,u,m,w,I,E]}class ya extends Wt{constructor(i){super(),Gt(this,i,Cw,Tw,Nt,{})}}let Ag=qi(null),Sd=qi(null),kd=qi(null);function Iw(s){let i,o,a,h,g,m,u;const w=s[2].default,I=on(w,s,s[1],null);return{c(){i=ge("div"),o=ge("label"),a=ge("input"),h=He(),I&&I.c(),te(a,"class","form-check-input"),te(a,"type","checkbox"),te(o,"class","form-check-label"),te(i,"class","form-check")},m(E,C){ke(E,i,C),oe(i,o),oe(o,a),a.checked=s[0],oe(o,h),I&&I.m(o,null),g=!0,m||(u=At(a,"change",s[3]),m=!0)},p(E,[C]){C&1&&(a.checked=E[0]),I&&I.p&&(!g||C&2)&&ln(I,w,E,E[1],g?an(w,E[1],C,null):un(E[1]),null)},i(E){g||(be(I,E),g=!0)},o(E){Le(I,E),g=!1},d(E){E&&Se(i),I&&I.d(E),m=!1,u()}}}function Ew(s,i,o){let{$$slots:a={},$$scope:h}=i,{checked:g}=i;function m(){g=this.checked,o(0,g)}return s.$$set=u=>{"checked"in u&&o(0,g=u.checked),"$$scope"in u&&o(1,h=u.$$scope)},[g,h,a,m]}class _a extends Wt{constructor(i){super(),Gt(this,i,Ew,Iw,Nt,{checked:0})}}function zg(s){let i,o,a,h=s[1]!=null&&Dg(s);return{c(){i=ge("div"),o=ft(s[0]),a=He(),h&&h.c(),te(i,"class","cover svelte-1w7hi45")},m(g,m){ke(g,i,m),oe(i,o),oe(i,a),h&&h.m(i,null)},p(g,m){m&1&&rn(o,g[0]),g[1]!=null?h?h.p(g,m):(h=Dg(g),h.c(),h.m(i,null)):h&&(h.d(1),h=null)},d(g){g&&Se(i),h&&h.d()}}}function Dg(s){let i,o;return{c(){i=ge("div"),o=ge("progress"),o.value=s[1],Bi(o,"width","100%")},m(a,h){ke(a,i,h),oe(i,o)},p(a,h){h&2&&(o.value=a[1])},d(a){a&&Se(i)}}}function Mw(s){let i,o=s[0]&&zg(s);return{c(){o&&o.c(),i=Kn()},m(a,h){o&&o.m(a,h),ke(a,i,h)},p(a,[h]){a[0]?o?o.p(a,h):(o=zg(a),o.c(),o.m(i.parentNode,i)):o&&(o.d(1),o=null)},i:Tt,o:Tt,d(a){a&&Se(i),o&&o.d(a)}}}function Lw(s,i,o){let{loading:a}=i,{progress:h=null}=i;return s.$$set=g=>{"loading"in g&&o(0,a=g.loading),"progress"in g&&o(1,h=g.progress)},[a,h]}class Pw extends Wt{constructor(i){super(),Gt(this,i,Lw,Mw,Nt,{loading:0,progress:1})}}function Aw(s){let i,o,a,h,g;const m=s[5].default,u=on(m,s,s[4],null);return{c(){i=ge("dialog"),o=ge("div"),u&&u.c(),te(o,"class","svelte-y9d9eu"),te(i,"class","svelte-y9d9eu")},m(w,I){ke(w,i,I),oe(i,o),u&&u.m(o,null),s[6](i),a=!0,h||(g=[At(i,"click",Th(s[1])),At(i,"keydown",s[2])],h=!0)},p(w,[I]){u&&u.p&&(!a||I&16)&&ln(u,m,w,w[4],a?an(m,w[4],I,null):un(w[4]),null)},i(w){a||(be(u,w),a=!0)},o(w){Le(u,w),a=!1},d(w){w&&Se(i),u&&u.d(w),s[6](null),h=!1,xn(g)}}}function zw(s,i,o){let{$$slots:a={},$$scope:h}=i,{show:g=!1}=i,m;function u(E){E.target==m&&o(3,g=!1)}function w(E){(E.key=="Escape"||E.key=="Enter")&&(E.stopPropagation(),o(3,g=!1))}function I(E){gi[E?"unshift":"push"](()=>{m=E,o(0,m)})}return s.$$set=E=>{"show"in E&&o(3,g=E.show),"$$scope"in E&&o(4,h=E.$$scope)},s.$$.update=()=>{s.$$.dirty&9&&m&&(g?m.showModal():m.close())},[m,u,w,g,h,a,I]}class Bd extends Wt{constructor(i){super(),Gt(this,i,zw,Aw,Nt,{show:3})}}function Rg(s,i,o){const a=s.slice();return a[1]=i[o][0],a[2]=i[o][1],a}function Bg(s){let i,o,a=s[1]+"",h,g,m,u=s[2]+"",w,I;return{c(){i=ge("tr"),o=ge("td"),h=ft(a),g=He(),m=ge("td"),w=ft(u),I=He()},m(E,C){ke(E,i,C),oe(i,o),oe(o,h),oe(i,g),oe(i,m),oe(m,w),oe(i,I)},p(E,C){C&1&&a!==(a=E[1]+"")&&rn(h,a),C&1&&u!==(u=E[2]+"")&&rn(w,u)},d(E){E&&Se(i)}}}function Dw(s){let i,o,a=bn(Object.entries(s[0])),h=[];for(let g=0;g<a.length;g+=1)h[g]=Bg(Rg(s,a,g));return{c(){i=ge("table"),o=ge("tbody");for(let g=0;g<h.length;g+=1)h[g].c();te(i,"class","svelte-lh2o9l")},m(g,m){ke(g,i,m),oe(i,o);for(let u=0;u<h.length;u+=1)h[u]&&h[u].m(o,null)},p(g,[m]){if(m&1){a=bn(Object.entries(g[0]));let u;for(u=0;u<a.length;u+=1){const w=Rg(g,a,u);h[u]?h[u].p(w,m):(h[u]=Bg(w),h[u].c(),h[u].m(o,null))}for(;u<h.length;u+=1)h[u].d(1);h.length=a.length}},i:Tt,o:Tt,d(g){g&&Se(i),Cs(h,g)}}}function Rw(s,i,o){let{properties:a}=i;return s.$$set=h=>{"properties"in h&&o(0,a=h.properties)},[a]}class Bw extends Wt{constructor(i){super(),Gt(this,i,Rw,Dw,Nt,{properties:0})}}function Fg(s,i,o){const a=s.slice();return a[4]=i[o][0],a[5]=i[o][1],a}function Og(s){let i,o,a,h,g=s[4]+"",m,u;return{c(){i=ge("div"),o=ge("span"),h=He(),m=ft(g),u=He(),te(o,"class",a="color-swatch "+s[1]+" svelte-1enycr6"),Bi(o,"background",s[5]),Bi(i,"display","flex"),Bi(i,"align-items","center"),Bi(i,"gap","6px")},m(w,I){ke(w,i,I),oe(i,o),oe(i,h),oe(i,m),oe(i,u)},p(w,I){I&2&&a!==(a="color-swatch "+w[1]+" svelte-1enycr6")&&te(o,"class",a),I&1&&Bi(o,"background",w[5]),I&1&&g!==(g=w[4]+"")&&rn(m,g)},d(w){w&&Se(i)}}}function Fw(s){let i,o=bn(Object.entries(s[0])),a=[];for(let h=0;h<o.length;h+=1)a[h]=Og(Fg(s,o,h));return{c(){i=ge("div");for(let h=0;h<a.length;h+=1)a[h].c();Bi(i,"display","grid"),Bi(i,"grid-template-columns","repeat(auto-fill, calc("+s[2]+" - 10px))"),Bi(i,"gap","10px")},m(h,g){ke(h,i,g);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(i,null)},p(h,[g]){if(g&3){o=bn(Object.entries(h[0]));let m;for(m=0;m<o.length;m+=1){const u=Fg(h,o,m);a[m]?a[m].p(u,g):(a[m]=Og(u),a[m].c(),a[m].m(i,null))}for(;m<a.length;m+=1)a[m].d(1);a.length=o.length}g&4&&Bi(i,"grid-template-columns","repeat(auto-fill, calc("+h[2]+" - 10px))")},i:Tt,o:Tt,d(h){h&&Se(i),Cs(a,h)}}}function Ow(s,i,o){let a,{labelColors:h}=i,{swatchClass:g="rectangle"}=i,{itemsPerRow:m=2}=i;return s.$$set=u=>{"labelColors"in u&&o(0,h=u.labelColors),"swatchClass"in u&&o(1,g=u.swatchClass),"itemsPerRow"in u&&o(3,m=u.itemsPerRow)},s.$$.update=()=>{s.$$.dirty&8&&o(2,a=`${100/m}%`)},[h,g,a,m]}class by extends Wt{constructor(i){super(),Gt(this,i,Ow,Fw,Nt,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function Ng(s,i,o){const a=s.slice();return a[4]=i[o],a}function Vg(s,i,o){const a=s.slice();return a[7]=i[o],a}function jg(s){let i,o;return{c(){i=ge("span"),o=ft(""),te(i,"class","bucket svelte-3plrz9"),Bi(i,"background",s[7])},m(a,h){ke(a,i,h),oe(i,o)},p(a,h){h&1&&Bi(i,"background",a[7])},d(a){a&&Se(i)}}}function Ug(s){let i,o=s[4]+"",a;return{c(){i=ge("span"),a=ft(o),te(i,"class","svelte-3plrz9")},m(h,g){ke(h,i,g),oe(i,a)},p(h,g){g&6&&o!==(o=h[4]+"")&&rn(a,o)},d(h){h&&Se(i)}}}function Nw(s){let i,o,a,h,g=bn(s[0]),m=[];for(let I=0;I<g.length;I+=1)m[I]=jg(Vg(s,g,I));let u=bn(qg(s[1],s[2])),w=[];for(let I=0;I<u.length;I+=1)w[I]=Ug(Ng(s,u,I));return{c(){i=ge("div"),o=ge("div");for(let I=0;I<m.length;I+=1)m[I].c();a=He(),h=ge("div");for(let I=0;I<w.length;I+=1)w[I].c();te(o,"class","colors svelte-3plrz9"),te(h,"class","labels svelte-3plrz9"),te(i,"class","svelte-3plrz9"),rr(i,"full-width-bucket-legend",s[3]),rr(i,"bucketed",s[1].hasOwnProperty("buckets")),rr(i,"limits",s[1].hasOwnProperty("limits"))},m(I,E){ke(I,i,E),oe(i,o);for(let C=0;C<m.length;C+=1)m[C]&&m[C].m(o,null);oe(i,a),oe(i,h);for(let C=0;C<w.length;C+=1)w[C]&&w[C].m(h,null)},p(I,[E]){if(E&1){g=bn(I[0]);let C;for(C=0;C<g.length;C+=1){const P=Vg(I,g,C);m[C]?m[C].p(P,E):(m[C]=jg(P),m[C].c(),m[C].m(o,null))}for(;C<m.length;C+=1)m[C].d(1);m.length=g.length}if(E&6){u=bn(qg(I[1],I[2]));let C;for(C=0;C<u.length;C+=1){const P=Ng(I,u,C);w[C]?w[C].p(P,E):(w[C]=Ug(P),w[C].c(),w[C].m(h,null))}for(;C<w.length;C+=1)w[C].d(1);w.length=u.length}E&8&&rr(i,"full-width-bucket-legend",I[3]),E&2&&rr(i,"bucketed",I[1].hasOwnProperty("buckets")),E&2&&rr(i,"limits",I[1].hasOwnProperty("limits"))},i:Tt,o:Tt,d(I){I&&Se(i),Cs(m,I),Cs(w,I)}}}function qg(s,i){return("limits"in s?s.limits:s.buckets).map(a=>typeof a=="number"?i>0?a.toFixed(i):a.toLocaleString():a)}function Vw(s,i,o){let{colorScale:a}=i,{labels:h}=i,{decimalPlaces:g=0}=i,{fullWidthBucketLegend:m=!1}=i;return s.$$set=u=>{"colorScale"in u&&o(0,a=u.colorScale),"labels"in u&&o(1,h=u.labels),"decimalPlaces"in u&&o(2,g=u.decimalPlaces),"fullWidthBucketLegend"in u&&o(3,m=u.fullWidthBucketLegend)},[a,h,g,m]}class uc extends Wt{constructor(i){super(),Gt(this,i,Vw,Nw,Nt,{colorScale:0,labels:1,decimalPlaces:2,fullWidthBucketLegend:3})}}function xy(s,i){let o=document.createElement("a");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(i)),o.setAttribute("download",s),document.body.appendChild(o),o.click(),document.body.removeChild(o)}function zo(s){if(s==null||s==null)throw new Error("Oops, notNull given something null");return s}function kl(s){if(!s)throw new Error("coord is required");if(!Array.isArray(s)){if(s.type==="Feature"&&s.geometry!==null&&s.geometry.type==="Point")return[...s.geometry.coordinates];if(s.type==="Point")return[...s.coordinates]}if(Array.isArray(s)&&s.length>=2&&!Array.isArray(s[0])&&!Array.isArray(s[1]))return[...s];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function jw(s){if(Array.isArray(s))return s;if(s.type==="Feature"){if(s.geometry!==null)return s.geometry.coordinates}else if(s.coordinates)return s.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function da(s,i,o={}){var a=kl(s),h=kl(i),g=Sl(h[1]-a[1]),m=Sl(h[0]-a[0]),u=Sl(a[1]),w=Sl(h[1]),I=Math.pow(Math.sin(g/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(u)*Math.cos(w);return ab(2*Math.atan2(Math.sqrt(I),Math.sqrt(1-I)),o.units)}var Uw=Object.defineProperty,qw=Object.defineProperties,Zw=Object.getOwnPropertyDescriptors,Zg=Object.getOwnPropertySymbols,Gw=Object.prototype.hasOwnProperty,Ww=Object.prototype.propertyIsEnumerable,Gg=(s,i,o)=>i in s?Uw(s,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[i]=o,Wg=(s,i)=>{for(var o in i||(i={}))Gw.call(i,o)&&Gg(s,o,i[o]);if(Zg)for(var o of Zg(i))Ww.call(i,o)&&Gg(s,o,i[o]);return s},Hg=(s,i)=>qw(s,Zw(i));function Hw(s,i,o={}){if(!s||!i)throw new Error("lines and pt are required arguments");const a=kl(i);let h=mh([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),g=0;return ub(s,function(m,u,w){const I=jw(m);for(let E=0;E<I.length-1;E++){const C=mh(I[E]);C.properties.dist=da(i,C,o);const P=kl(C),H=mh(I[E+1]);H.properties.dist=da(i,H,o);const U=kl(H),ie=da(C,H,o);let se,ae;P[0]===a[0]&&P[1]===a[1]?[se,,ae]=[P,void 0,!1]:U[0]===a[0]&&U[1]===a[1]?[se,,ae]=[U,void 0,!0]:[se,,ae]=Jw(C.geometry.coordinates,H.geometry.coordinates,kl(i));let $;se&&($=mh(se,{dist:da(i,se,o),multiFeatureIndex:w,location:g+da(C,se,o)})),$&&$.properties.dist<h.properties.dist&&(h=Hg(Wg({},$),{properties:Hg(Wg({},$.properties),{index:ae?E+1:E})})),g+=ie}}),h}function Xw(s,i){const[o,a,h]=s,[g,m,u]=i;return o*g+a*m+h*u}function Kw(s,i){const[o,a,h]=s,[g,m,u]=i;return[a*u-h*m,h*g-o*u,o*m-a*g]}function Xg(s){return Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)+Math.pow(s[2],2))}function ca(s,i){const o=Xw(s,i)/(Xg(s)*Xg(i));return Math.acos(Math.min(Math.max(o,-1),1))}function od(s){const i=Sl(s[1]),o=Sl(s[0]);return[Math.cos(i)*Math.cos(o),Math.cos(i)*Math.sin(o),Math.sin(i)]}function ha(s){const[i,o,a]=s,h=Nm(Math.asin(a));return[Nm(Math.atan2(o,i)),h]}function Jw(s,i,o){const a=od(s),h=od(i),g=od(o),[m,u,w]=g,[I,E,C]=Kw(a,h),P=E*w-C*u,H=C*m-I*w,U=I*u-E*m,ie=U*E-H*C,se=P*C-U*I,ae=H*I-P*E,$=1/Math.sqrt(Math.pow(ie,2)+Math.pow(se,2)+Math.pow(ae,2)),Te=[ie*$,se*$,ae*$],Pe=[-1*ie*$,-1*se*$,-1*ae*$],ve=ca(a,h),De=ca(a,Te),Ae=ca(h,Te),B=ca(a,Pe),Z=ca(h,Pe);let Q;return De<B&&De<Z||Ae<B&&Ae<Z?Q=Te:Q=Pe,ca(a,Q)>ve||ca(h,Q)>ve?da(ha(Q),ha(a))<=da(ha(Q),ha(h))?[ha(a),!0,!1]:[ha(h),!1,!0]:[ha(Q),!1,!1]}var Yw=Hw;const Qw=["==",["geometry-type"],"Polygon"],$w=["==",["geometry-type"],"LineString"],e2=["==",["geometry-type"],"Point"];function wy(){return{type:"FeatureCollection",features:[]}}function ad(s){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Sy(s)}}}function Sy(s){return[Math.round(s[0]*1e7)/1e7,Math.round(s[1]*1e7)/1e7]}const ky=qi(wy()),Ty=qi(0),t2=100;class i2{constructor(i){Sn(this,"map");Sn(this,"active");Sn(this,"eventListenersSuccess");Sn(this,"eventListenersUpdated");Sn(this,"eventListenersFailure");Sn(this,"points");Sn(this,"cursor");Sn(this,"hover");Sn(this,"dragFrom");Sn(this,"previousStates");Sn(this,"onMouseMove",i=>{if(this.active&&!this.dragFrom)this.recalculateHovering(i);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let o=this.dragFrom[0]-i.lngLat.lng,a=this.dragFrom[1]-i.lngLat.lat;for(let h of this.points)h[0]-=o,h[1]-=a}else this.points[this.hover]=i.lngLat.toArray();this.dragFrom=i.lngLat.toArray(),this.redraw()}});Sn(this,"onClick",i=>{if(this.beforeUpdate(),this.active&&this.cursor){let o=[];if(Kg(this.points).forEach((a,h)=>{o.push([h+1,Yw(a,this.cursor).properties.dist])}),o.sort((a,h)=>a[1]-h[1]),o.length>0){let a=o[0][0];this.points.splice(a,0,this.cursor.geometry.coordinates),this.hover=a}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(i))});Sn(this,"onDoubleClick",i=>{this.active&&(i.preventDefault(),this.cursor=ad(i.lngLat.toArray()),this.onClick(i),this.finish())});Sn(this,"onMouseDown",i=>{this.active&&!this.dragFrom&&this.hover!=null&&(i.preventDefault(),this.cursor=null,this.dragFrom=i.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Sn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Sn(this,"onKeypress",i=>{if(!this.active)return;let o=i.target.tagName;o=="INPUT"||o=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="z"&&i.ctrlKey&&this.undo())});Sn(this,"onKeyDown",i=>{if(!this.active)return;let o=i.target.tagName;o=="INPUT"||o=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())});this.map=i,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let i=this.polygonFeature();if(i)for(let o of this.eventListenersSuccess)o(i);else for(let o of this.eventListenersFailure)o();this.stop()}cancel(){for(let i of this.eventListenersFailure)i();this.stop()}addEventListenerSuccess(i){this.eventListenersSuccess.push(i)}addEventListenerUpdated(i){this.eventListenersUpdated.push(i)}addEventListenerFailure(i){this.eventListenersFailure.push(i)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(i){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(i.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let i=wy();this.points.forEach((h,g)=>{let m=ad(h);m.properties.hover=this.hover==g,m.properties.idx=g,i.features.push(m)}),i.features=i.features.concat(Kg(this.points));let o=this.polygonFeature();o&&(o.properties.hover=this.hover=="polygon",i.features.push(o)),ky.set(i);let a="crosshair";this.hover!=null&&(a=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=a,Ty.set(this.previousStates.length)}pointsUpdated(){let i=this.polygonFeature();if(i)for(let o of this.eventListenersUpdated)o(i)}recalculateHovering(i){this.cursor=null,this.hover=null;for(let o of this.map.queryRenderedFeatures(i.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(o.geometry.type=="Polygon"){this.hover="polygon";break}else if(o.geometry.type=="Point"&&Object.hasOwn(o.properties,"idx")){this.hover=o.properties.idx;break}this.hover==null&&(this.cursor=ad(i.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let i=this.points.map(Sy),o=[JSON.parse(JSON.stringify(i))];return o[0].push(JSON.parse(JSON.stringify(o[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:o},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>t2&&this.previousStates.shift()}}function Kg(s){let i=[];for(let o=0;o<s.length-1;o++)i.push({type:"Feature",geometry:{type:"LineString",coordinates:[s[o],s[o+1]]},properties:{}});return s.length>=3&&i.push({type:"Feature",geometry:{type:"LineString",coordinates:[s[s.length-1],s[0]]},properties:{}}),i}function n2(s){let i,o,a;return{c(){i=ft("Undo ("),o=ft(s[1]),a=ft(")")},m(h,g){ke(h,i,g),ke(h,o,g),ke(h,a,g)},p(h,g){g&2&&rn(o,h[1])},d(h){h&&(Se(i),Se(o),Se(a))}}}function r2(s){let i;return{c(){i=ft("Undo")},m(o,a){ke(o,i,a)},p:Tt,d(o){o&&Se(i)}}}function s2(s){let i,o,a,h,g,m,u,w,I,E,C;function P(ie,se){return ie[1]==0?r2:n2}let H=P(s),U=H(s);return{c(){i=ge("div"),o=ge("button"),o.textContent="Finish",a=He(),h=ge("button"),h.textContent="Cancel",g=He(),m=ge("button"),U.c(),w=He(),I=ge("ul"),I.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,m.disabled=u=s[1]==0,Bi(i,"display","flex"),Bi(i,"justify-content","space-between")},m(ie,se){ke(ie,i,se),oe(i,o),oe(i,a),oe(i,h),oe(i,g),oe(i,m),U.m(m,null),ke(ie,w,se),ke(ie,I,se),E||(C=[At(o,"click",s[2]),At(h,"click",s[3]),At(m,"click",s[4])],E=!0)},p(ie,[se]){H===(H=P(ie))&&U?U.p(ie,se):(U.d(1),U=H(ie),U&&(U.c(),U.m(m,null))),se&2&&u!==(u=ie[1]==0)&&(m.disabled=u)},i:Tt,o:Tt,d(ie){ie&&(Se(i),Se(w),Se(I)),U.d(),E=!1,xn(C)}}}function o2(s,i,o){let a;Pt(s,Ty,w=>o(1,a=w));let{polygonTool:h}=i;const g=()=>h.finish(),m=()=>h.cancel(),u=()=>h.undo();return s.$$set=w=>{"polygonTool"in w&&o(0,h=w.polygonTool)},[h,a,g,m,u]}class a2 extends Wt{constructor(i){super(),Gt(this,i,o2,s2,Nt,{polygonTool:0})}}let l2=Date.now();function cc(s){return`${s}-${l2++}`}const Cy=Symbol.for("svelte-maplibre");function u2(){return V_(Cy)}function Jg(s){return{subscribe:s.subscribe}}function Iy({key:s,setPopupTarget:i=!1,setCluster:o=!1,setMouseEvent:a=!1}){let h=u2(),g=qi(null),m=Jg(g),u={...h,[s]:Jg(g)};if(i&&(u.popupTarget=m),a){let w=qi(null);u.layerEvent=w,h.layerEvent=w}return o&&(u.cluster=qi()),Id(Cy,u),{...h,self:g}}function c2(){return Iy({key:"source",setCluster:!0})}function h2(s=!0){return Iy({key:"layer",setPopupTarget:s,setMouseEvent:s})}function Yg(s){let i;return o=>{if(o)for(let a in o){let h=i==null?void 0:i[a],g=o[a];h!==g&&s(a,g,h)}else if(i)for(let a in i)s(a,void 0,i[a]);i=o}}function f2(s,...i){let o=[s];for(let a of i)if(a)Array.isArray(a)&&a[0]===s?o.push(...a.slice(1)):o.push(a);else continue;if(o.length!==1)return o.length===2?o[1]:o}function d2(s){return s===!0?["has","point_count"]:s===!1?["!",["has","point_count"]]:void 0}function Qg(s){let i=s[0],o,a,h=$g(s);return{c(){h.c(),o=Kn()},m(g,m){h.m(g,m),ke(g,o,m),a=!0},p(g,m){m[0]&1&&Nt(i,i=g[0])?(ki(),Le(h,1,1,Tt),Ti(),h=$g(g),h.c(),be(h,1),h.m(o.parentNode,o)):h.p(g,m)},i(g){a||(be(h),a=!0)},o(g){Le(h),a=!1},d(g){g&&Se(o),h.d(g)}}}function $g(s){let i;const o=s[36].default,a=on(o,s,s[35],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g[1]&16)&&ln(a,o,h,h[35],i?an(o,h[35],g,null):un(h[35]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function p2(s){let i,o,a=s[0]&&Qg(s);return{c(){a&&a.c(),i=Kn()},m(h,g){a&&a.m(h,g),ke(h,i,g),o=!0},p(h,g){h[0]?a?(a.p(h,g),g[0]&1&&be(a,1)):(a=Qg(h),a.c(),be(a,1),a.m(i.parentNode,i)):a&&(ki(),Le(a,1,1,()=>{a=null}),Ti())},i(h){o||(be(a),o=!0)},o(h){Le(a),o=!1},d(h){h&&Se(i),a&&a.d(h)}}}function m2(s,i,o){let a,h,g,m,u,w,I,E,C,P,H,U,{$$slots:ie={},$$scope:se}=i,{id:ae=cc("layer")}=i,{source:$=void 0}=i,{sourceLayer:Te=void 0}=i,{beforeId:Pe=void 0}=i,{beforeLayerType:ve=void 0}=i,{type:De}=i,{paint:Ae=void 0}=i,{layout:B=void 0}=i,{filter:Z=void 0}=i,{applyToClusters:Q=void 0}=i,{minzoom:D=void 0}=i,{maxzoom:N=void 0}=i,{manageHoverState:ee=!1}=i,{hovered:me=null}=i,{interactive:ne=!0}=i,{hoverCursor:pe=void 0}=i,{eventsIfTopMost:Ce=!1}=i;const fe=Ys(),{map:qe,source:nt,self:lt,minzoom:at,maxzoom:ut,eventTopMost:St,layerInfo:It}=h2();Pt(s,qe,Ne=>o(31,C=Ne)),Pt(s,nt,Ne=>o(32,P=Ne)),Pt(s,lt,Ne=>o(0,E=Ne)),Pt(s,at,Ne=>o(34,U=Ne)),Pt(s,ut,Ne=>o(33,H=Ne)),mr(()=>{E&&C&&(It.delete(E),C==null||C.removeLayer(E))});let st;function Lt(Ne){var $e,Ei;if(!ne||!E||!C||Ce&&St(Ne)!==E)return;let yt=Ne.features??[],Qt=(Ei=($e=yt[0])==null?void 0:$e.properties)==null?void 0:Ei.cluster_id,je={event:Ne,map:C,clusterId:Qt,layer:E,source:u,features:yt};fe(Ne.type,je)}function wi(Ne){var $e,Ei;if(!ne||!E||!C||Ce&&St(Ne)!==E)return;pe&&(C.getCanvas().style.cursor=pe);let yt=Ne.features??[];o(6,me=yt[0]??null);let Qt=(Ei=($e=yt[0])==null?void 0:$e.properties)==null?void 0:Ei.cluster_id;fe("mouseenter",{event:Ne,map:C,clusterId:Qt,layer:E,source:u,features:yt})}function Di(Ne){var $e,Ei,Ge;if(!ne||!C)return;if(Ce&&St(Ne)!==E){o(6,me=null),ee&&st!==void 0&&(C==null||C.setFeatureState({source:u,sourceLayer:Te,id:st},{hover:!1}),st=void 0);return}C.getCanvas().style.cursor=pe;let yt=Ne.features??[],Qt=(Ei=($e=yt[0])==null?void 0:$e.properties)==null?void 0:Ei.cluster_id,je=(Ge=yt[0])==null?void 0:Ge.id;je!==st&&(ee&&(st!==void 0&&(C==null||C.setFeatureState({source:u,id:st,sourceLayer:Te},{hover:!1})),C==null||C.setFeatureState({source:u,id:je,sourceLayer:Te},{hover:!0})),st=je,o(6,me=yt[0]??null)),fe("mousemove",{event:Ne,map:C,clusterId:Qt,layer:E,source:u,features:yt})}function Zi(Ne){if(!(!ne||!E||!C)){if(pe&&(C.getCanvas().style.cursor=""),o(6,me=null),ee&&st!==void 0){const yt={source:u,id:st,sourceLayer:Te};C==null||C.setFeatureState(yt,{hover:!1}),st=void 0}fe("mouseleave",{map:C,layer:E,source:u})}}let _i=!0;function Si(Ne){C&&(C.off("click",Ne,Lt),C.off("dblclick",Ne,Lt),C.off("contextmenu",Ne,Lt),C.off("mouseenter",Ne,wi),C.off("mousemove",Ne,Di),C.off("mouseleave",Ne,Zi))}return mr(()=>{C&&E&&Si(E)}),s.$$set=Ne=>{"id"in Ne&&o(7,ae=Ne.id),"source"in Ne&&o(8,$=Ne.source),"sourceLayer"in Ne&&o(9,Te=Ne.sourceLayer),"beforeId"in Ne&&o(10,Pe=Ne.beforeId),"beforeLayerType"in Ne&&o(11,ve=Ne.beforeLayerType),"type"in Ne&&o(12,De=Ne.type),"paint"in Ne&&o(13,Ae=Ne.paint),"layout"in Ne&&o(14,B=Ne.layout),"filter"in Ne&&o(15,Z=Ne.filter),"applyToClusters"in Ne&&o(16,Q=Ne.applyToClusters),"minzoom"in Ne&&o(17,D=Ne.minzoom),"maxzoom"in Ne&&o(18,N=Ne.maxzoom),"manageHoverState"in Ne&&o(19,ee=Ne.manageHoverState),"hovered"in Ne&&o(6,me=Ne.hovered),"interactive"in Ne&&o(20,ne=Ne.interactive),"hoverCursor"in Ne&&o(21,pe=Ne.hoverCursor),"eventsIfTopMost"in Ne&&o(22,Ce=Ne.eventsIfTopMost),"$$scope"in Ne&&o(35,se=Ne.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&65536&&o(30,a=d2(Q)),s.$$.dirty[0]&1073774592&&o(24,h=f2("all",a,Z)),s.$$.dirty[0]&131072|s.$$.dirty[1]&8&&o(26,g=D??U),s.$$.dirty[0]&262144|s.$$.dirty[1]&4&&o(25,m=N??H),s.$$.dirty[0]&256|s.$$.dirty[1]&2&&o(29,u=$||P),s.$$.dirty[0]&654343809|s.$$.dirty[1]&1&&C&&E!==ae&&u){E&&(Si(E),It.delete(E));let Ne=Pe;if(!Pe&&ve){let yt=C.getStyle().layers,Qt=typeof ve=="function"?ve:$e=>$e.type===ve,je=yt==null?void 0:yt.find(Qt);je&&(Ne=je.id)}xi(lt,E=ae,E),C.addLayer(ga({id:E,type:De,source:u,"source-layer":Te,filter:h,paint:Ae,layout:B,minzoom:g,maxzoom:m}),Ne),o(23,_i=!0),C.on("click",E,Lt),C.on("dblclick",E,Lt),C.on("contextmenu",E,Lt),C.on("mouseenter",E,wi),C.on("mousemove",E,Di),C.on("mouseleave",E,Zi)}s.$$.dirty[0]&1048577&&E&&It.set(E,{interactive:ne}),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&o(28,w=E?Yg((Ne,yt)=>C==null?void 0:C.setPaintProperty(E,Ne,yt)):void 0),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&o(27,I=E?Yg((Ne,yt)=>C==null?void 0:C.setLayoutProperty(E,Ne,yt)):void 0),s.$$.dirty[0]&268443648&&(w==null||w(Ae)),s.$$.dirty[0]&134234112&&(I==null||I(B)),s.$$.dirty[0]&100663297|s.$$.dirty[1]&1&&E&&(C==null||C.setLayerZoomRange(E,g,m)),s.$$.dirty[0]&25165825|s.$$.dirty[1]&1&&E&&(_i?o(23,_i=!1):C==null||C.setFilter(E,h))},[E,qe,nt,lt,at,ut,me,ae,$,Te,Pe,ve,De,Ae,B,Z,Q,D,N,ee,ne,pe,Ce,_i,h,m,g,I,w,u,a,C,P,H,U,se,ie]}class Fd extends Wt{constructor(i){super(),Gt(this,i,m2,p2,Nt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function g2(s){let i;const o=s[16].default,a=on(o,s,s[24],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&16777216)&&ln(a,o,h,h[24],i?an(o,h[24],g,null):un(h[24]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function _2(s){let i,o,a;function h(m){s[17](m)}let g={id:s[1],type:"circle",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],applyToClusters:s[9],minzoom:s[10],maxzoom:s[11],hoverCursor:s[12],manageHoverState:s[13],eventsIfTopMost:s[14],interactive:s[15],$$slots:{default:[g2]},$$scope:{ctx:s}};return s[0]!==void 0&&(g.hovered=s[0]),i=new Fd({props:g}),gi.push(()=>hn(i,"hovered",h)),i.$on("click",s[18]),i.$on("dblclick",s[19]),i.$on("contextmenu",s[20]),i.$on("mouseenter",s[21]),i.$on("mousemove",s[22]),i.$on("mouseleave",s[23]),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,[u]){const w={};u&2&&(w.id=m[1]),u&4&&(w.source=m[2]),u&8&&(w.sourceLayer=m[3]),u&16&&(w.beforeId=m[4]),u&32&&(w.beforeLayerType=m[5]),u&64&&(w.paint=m[6]),u&128&&(w.layout=m[7]),u&256&&(w.filter=m[8]),u&512&&(w.applyToClusters=m[9]),u&1024&&(w.minzoom=m[10]),u&2048&&(w.maxzoom=m[11]),u&4096&&(w.hoverCursor=m[12]),u&8192&&(w.manageHoverState=m[13]),u&16384&&(w.eventsIfTopMost=m[14]),u&32768&&(w.interactive=m[15]),u&16777216&&(w.$$scope={dirty:u,ctx:m}),!o&&u&1&&(o=!0,w.hovered=m[0],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function y2(s,i,o){let{$$slots:a={},$$scope:h}=i,{id:g=cc("circle")}=i,{source:m=void 0}=i,{sourceLayer:u=void 0}=i,{beforeId:w=void 0}=i,{beforeLayerType:I=void 0}=i,{paint:E}=i,{layout:C=void 0}=i,{filter:P=void 0}=i,{applyToClusters:H=void 0}=i,{minzoom:U=void 0}=i,{maxzoom:ie=void 0}=i,{hoverCursor:se=void 0}=i,{manageHoverState:ae=!1}=i,{hovered:$=null}=i,{eventsIfTopMost:Te=!1}=i,{interactive:Pe=!0}=i;function ve(N){$=N,o(0,$)}function De(N){hi.call(this,s,N)}function Ae(N){hi.call(this,s,N)}function B(N){hi.call(this,s,N)}function Z(N){hi.call(this,s,N)}function Q(N){hi.call(this,s,N)}function D(N){hi.call(this,s,N)}return s.$$set=N=>{"id"in N&&o(1,g=N.id),"source"in N&&o(2,m=N.source),"sourceLayer"in N&&o(3,u=N.sourceLayer),"beforeId"in N&&o(4,w=N.beforeId),"beforeLayerType"in N&&o(5,I=N.beforeLayerType),"paint"in N&&o(6,E=N.paint),"layout"in N&&o(7,C=N.layout),"filter"in N&&o(8,P=N.filter),"applyToClusters"in N&&o(9,H=N.applyToClusters),"minzoom"in N&&o(10,U=N.minzoom),"maxzoom"in N&&o(11,ie=N.maxzoom),"hoverCursor"in N&&o(12,se=N.hoverCursor),"manageHoverState"in N&&o(13,ae=N.manageHoverState),"hovered"in N&&o(0,$=N.hovered),"eventsIfTopMost"in N&&o(14,Te=N.eventsIfTopMost),"interactive"in N&&o(15,Pe=N.interactive),"$$scope"in N&&o(24,h=N.$$scope)},[$,g,m,u,w,I,E,C,P,H,U,ie,se,ae,Te,Pe,a,ve,De,Ae,B,Z,Q,D,h]}class v2 extends Wt{constructor(i){super(),Gt(this,i,y2,_2,Nt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function b2(s){let i;const o=s[15].default,a=on(o,s,s[23],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&8388608)&&ln(a,o,h,h[23],i?an(o,h[23],g,null):un(h[23]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function x2(s){let i,o,a;function h(m){s[16](m)}let g={id:s[1],type:"fill",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[b2]},$$scope:{ctx:s}};return s[0]!==void 0&&(g.hovered=s[0]),i=new Fd({props:g}),gi.push(()=>hn(i,"hovered",h)),i.$on("click",s[17]),i.$on("dblclick",s[18]),i.$on("contextmenu",s[19]),i.$on("mouseenter",s[20]),i.$on("mousemove",s[21]),i.$on("mouseleave",s[22]),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,[u]){const w={};u&2&&(w.id=m[1]),u&4&&(w.source=m[2]),u&8&&(w.sourceLayer=m[3]),u&16&&(w.beforeId=m[4]),u&32&&(w.beforeLayerType=m[5]),u&64&&(w.paint=m[6]),u&128&&(w.layout=m[7]),u&256&&(w.filter=m[8]),u&512&&(w.minzoom=m[9]),u&1024&&(w.maxzoom=m[10]),u&2048&&(w.hoverCursor=m[11]),u&4096&&(w.manageHoverState=m[12]),u&8192&&(w.eventsIfTopMost=m[13]),u&16384&&(w.interactive=m[14]),u&8388608&&(w.$$scope={dirty:u,ctx:m}),!o&&u&1&&(o=!0,w.hovered=m[0],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function w2(s,i,o){let{$$slots:a={},$$scope:h}=i,{id:g=cc("fill")}=i,{source:m=void 0}=i,{sourceLayer:u=void 0}=i,{beforeId:w=void 0}=i,{beforeLayerType:I=void 0}=i,{paint:E}=i,{layout:C=void 0}=i,{filter:P=void 0}=i,{minzoom:H=void 0}=i,{maxzoom:U=void 0}=i,{hoverCursor:ie=void 0}=i,{manageHoverState:se=!1}=i,{hovered:ae=null}=i,{eventsIfTopMost:$=!1}=i,{interactive:Te=!0}=i;function Pe(D){ae=D,o(0,ae)}function ve(D){hi.call(this,s,D)}function De(D){hi.call(this,s,D)}function Ae(D){hi.call(this,s,D)}function B(D){hi.call(this,s,D)}function Z(D){hi.call(this,s,D)}function Q(D){hi.call(this,s,D)}return s.$$set=D=>{"id"in D&&o(1,g=D.id),"source"in D&&o(2,m=D.source),"sourceLayer"in D&&o(3,u=D.sourceLayer),"beforeId"in D&&o(4,w=D.beforeId),"beforeLayerType"in D&&o(5,I=D.beforeLayerType),"paint"in D&&o(6,E=D.paint),"layout"in D&&o(7,C=D.layout),"filter"in D&&o(8,P=D.filter),"minzoom"in D&&o(9,H=D.minzoom),"maxzoom"in D&&o(10,U=D.maxzoom),"hoverCursor"in D&&o(11,ie=D.hoverCursor),"manageHoverState"in D&&o(12,se=D.manageHoverState),"hovered"in D&&o(0,ae=D.hovered),"eventsIfTopMost"in D&&o(13,$=D.eventsIfTopMost),"interactive"in D&&o(14,Te=D.interactive),"$$scope"in D&&o(23,h=D.$$scope)},[ae,g,m,u,w,I,E,C,P,H,U,ie,se,$,Te,a,Pe,ve,De,Ae,B,Z,Q,h]}class S2 extends Wt{constructor(i){super(),Gt(this,i,w2,x2,Nt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function k2(s,i,o,a,h){let g=!1;s.getSource(i)&&(g=!0,s.removeSource(i));const m=()=>{a(i)&&(s.addSource(i,o),h())};if(g){const u=()=>{i&&(s.getSource(i)?setTimeout(u,1):m())};u()}else m()}function T2(s,i,o){q_().then(()=>{let a=F_(s);if(!a)return;a.getSource(i)===o&&a.removeSource(i)})}function e_(s){let i=s[0],o,a,h=t_(s);return{c(){h.c(),o=Kn()},m(g,m){h.m(g,m),ke(g,o,m),a=!0},p(g,m){m&1&&Nt(i,i=g[0])?(ki(),Le(h,1,1,Tt),Ti(),h=t_(g),h.c(),be(h,1),h.m(o.parentNode,o)):h.p(g,m)},i(g){a||(be(h),a=!0)},o(g){Le(h),a=!1},d(g){g&&Se(o),h.d(g)}}}function t_(s){let i;const o=s[15].default,a=on(o,s,s[14],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&16384)&&ln(a,o,h,h[14],i?an(o,h[14],g,null):un(h[14]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function C2(s){let i,o,a=s[0]&&e_(s);return{c(){a&&a.c(),i=Kn()},m(h,g){a&&a.m(h,g),ke(h,i,g),o=!0},p(h,[g]){h[0]?a?(a.p(h,g),g&1&&be(a,1)):(a=e_(h),a.c(),be(a,1),a.m(i.parentNode,i)):a&&(ki(),Le(a,1,1,()=>{a=null}),Ti())},i(h){o||(be(a),o=!0)},o(h){Le(a),o=!1},d(h){h&&Se(i),a&&a.d(h)}}}function I2(s,i,o){let a,h,g,{$$slots:m={},$$scope:u}=i,{id:w=cc("geojson")}=i,{data:I}=i,{generateId:E=!1}=i,{promoteId:C=void 0}=i,{filter:P=void 0}=i,{lineMetrics:H=void 0}=i,{cluster:U=void 0}=i;const{map:ie,cluster:se,self:ae}=c2();Pt(s,ie,Pe=>o(13,h=Pe)),Pt(s,se,Pe=>o(16,g=Pe)),Pt(s,ae,Pe=>o(0,a=Pe));let $,Te=!0;return mr(()=>{a&&$&&h&&(T2(ie,a,$),xi(ae,a=null,a),o(11,$=void 0))}),s.$$set=Pe=>{"id"in Pe&&o(4,w=Pe.id),"data"in Pe&&o(5,I=Pe.data),"generateId"in Pe&&o(6,E=Pe.generateId),"promoteId"in Pe&&o(7,C=Pe.promoteId),"filter"in Pe&&o(8,P=Pe.filter),"lineMetrics"in Pe&&o(9,H=Pe.lineMetrics),"cluster"in Pe&&o(10,U=Pe.cluster),"$$scope"in Pe&&o(14,u=Pe.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&xi(se,g=U,g),s.$$.dirty&12273&&h&&a!==w&&(xi(ae,a=w,a),k2(h,a,ga({type:"geojson",data:I,filter:P,lineMetrics:H,generateId:E,promoteId:C,cluster:!!U,clusterMinPoints:U==null?void 0:U.minPoints,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius,clusterProperties:U==null?void 0:U.properties}),Pe=>h&&Pe===a,()=>{a&&(o(11,$=h==null?void 0:h.getSource(a)),o(12,Te=!0))})),s.$$.dirty&8208&&(h==null||h.on("style.load",()=>{o(11,$=h==null?void 0:h.getSource(w))})),s.$$.dirty&6176&&$&&(Te?o(12,Te=!1):$.setData(I)),s.$$.dirty&3072&&($==null||$.setClusterOptions(ga({cluster:!!U,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius})))},[a,ie,se,ae,w,I,E,C,P,H,U,$,Te,h,u,m]}class E2 extends Wt{constructor(i){super(),Gt(this,i,I2,C2,Nt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function M2(s){let i;const o=s[15].default,a=on(o,s,s[23],null);return{c(){a&&a.c()},m(h,g){a&&a.m(h,g),i=!0},p(h,g){a&&a.p&&(!i||g&8388608)&&ln(a,o,h,h[23],i?an(o,h[23],g,null):un(h[23]),null)},i(h){i||(be(a,h),i=!0)},o(h){Le(a,h),i=!1},d(h){a&&a.d(h)}}}function L2(s){let i,o,a;function h(m){s[16](m)}let g={id:s[1],type:"line",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[M2]},$$scope:{ctx:s}};return s[0]!==void 0&&(g.hovered=s[0]),i=new Fd({props:g}),gi.push(()=>hn(i,"hovered",h)),i.$on("click",s[17]),i.$on("dblclick",s[18]),i.$on("contextmenu",s[19]),i.$on("mouseenter",s[20]),i.$on("mousemove",s[21]),i.$on("mouseleave",s[22]),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,[u]){const w={};u&2&&(w.id=m[1]),u&4&&(w.source=m[2]),u&8&&(w.sourceLayer=m[3]),u&16&&(w.beforeId=m[4]),u&32&&(w.beforeLayerType=m[5]),u&64&&(w.paint=m[6]),u&128&&(w.layout=m[7]),u&256&&(w.filter=m[8]),u&512&&(w.minzoom=m[9]),u&1024&&(w.maxzoom=m[10]),u&2048&&(w.hoverCursor=m[11]),u&4096&&(w.manageHoverState=m[12]),u&8192&&(w.eventsIfTopMost=m[13]),u&16384&&(w.interactive=m[14]),u&8388608&&(w.$$scope={dirty:u,ctx:m}),!o&&u&1&&(o=!0,w.hovered=m[0],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function P2(s,i,o){let{$$slots:a={},$$scope:h}=i,{id:g=cc("line")}=i,{source:m=void 0}=i,{sourceLayer:u=void 0}=i,{beforeId:w=void 0}=i,{beforeLayerType:I=void 0}=i,{paint:E}=i,{layout:C=void 0}=i,{filter:P=void 0}=i,{minzoom:H=void 0}=i,{maxzoom:U=void 0}=i,{hoverCursor:ie=void 0}=i,{manageHoverState:se=!1}=i,{hovered:ae=null}=i,{eventsIfTopMost:$=!1}=i,{interactive:Te=!0}=i;function Pe(D){ae=D,o(0,ae)}function ve(D){hi.call(this,s,D)}function De(D){hi.call(this,s,D)}function Ae(D){hi.call(this,s,D)}function B(D){hi.call(this,s,D)}function Z(D){hi.call(this,s,D)}function Q(D){hi.call(this,s,D)}return s.$$set=D=>{"id"in D&&o(1,g=D.id),"source"in D&&o(2,m=D.source),"sourceLayer"in D&&o(3,u=D.sourceLayer),"beforeId"in D&&o(4,w=D.beforeId),"beforeLayerType"in D&&o(5,I=D.beforeLayerType),"paint"in D&&o(6,E=D.paint),"layout"in D&&o(7,C=D.layout),"filter"in D&&o(8,P=D.filter),"minzoom"in D&&o(9,H=D.minzoom),"maxzoom"in D&&o(10,U=D.maxzoom),"hoverCursor"in D&&o(11,ie=D.hoverCursor),"manageHoverState"in D&&o(12,se=D.manageHoverState),"hovered"in D&&o(0,ae=D.hovered),"eventsIfTopMost"in D&&o(13,$=D.eventsIfTopMost),"interactive"in D&&o(14,Te=D.interactive),"$$scope"in D&&o(23,h=D.$$scope)},[ae,g,m,u,w,I,E,C,P,H,U,ie,se,$,Te,a,Pe,ve,De,Ae,B,Z,Q,h]}class A2 extends Wt{constructor(i){super(),Gt(this,i,P2,L2,Nt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function z2(s){let i,o,a,h,g,m;return i=new S2({props:{id:"edit-polygon-fill",filter:Qw,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),a=new A2({props:{id:"edit-polygon-lines",filter:$w,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),g=new v2({props:{id:"edit-polygon-vertices",filter:e2,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){it(i.$$.fragment),o=He(),it(a.$$.fragment),h=He(),it(g.$$.fragment)},m(u,w){et(i,u,w),ke(u,o,w),et(a,u,w),ke(u,h,w),et(g,u,w),m=!0},p:Tt,i(u){m||(be(i.$$.fragment,u),be(a.$$.fragment,u),be(g.$$.fragment,u),m=!0)},o(u){Le(i.$$.fragment,u),Le(a.$$.fragment,u),Le(g.$$.fragment,u),m=!1},d(u){u&&(Se(o),Se(h)),tt(i,u),tt(a,u),tt(g,u)}}}function D2(s){let i,o;return i=new E2({props:{data:s[0],$$slots:{default:[z2]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&1&&(g.data=a[0]),h&2&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function R2(s,i,o){let a;return Pt(s,ky,h=>o(0,a=h)),[a]}class B2 extends Wt{constructor(i){super(),Gt(this,i,R2,D2,Nt,{})}}function F2(s){let i,o,a,h,g,m,u;return{c(){i=ge("button"),i.textContent="Import current view",o=He(),a=ge("p"),a.textContent="or...",h=He(),g=ge("button"),g.textContent="Draw an area to import on the map",te(i,"class","btn btn-primary"),te(i,"type","button"),te(a,"class","fst-italic my-3"),te(g,"class","btn btn-primary"),te(g,"type","button")},m(w,I){ke(w,i,I),ke(w,o,I),ke(w,a,I),ke(w,h,I),ke(w,g,I),m||(u=[At(i,"click",s[2]),At(g,"click",s[3])],m=!0)},p:Tt,i:Tt,o:Tt,d(w){w&&(Se(i),Se(o),Se(a),Se(h),Se(g)),m=!1,xn(u)}}}function O2(s){let i,o;return i=new a2({props:{polygonTool:s[0]}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&1&&(g.polygonTool=a[0]),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function N2(s){let i;return{c(){i=ft("Save a copy of the osm.xml after importing")},m(o,a){ke(o,i,a)},d(o){o&&Se(i)}}}function V2(s){let i,o,a,h,g,m;const u=[O2,F2],w=[];function I(P,H){return P[0]?0:1}i=I(s),o=w[i]=u[i](s);function E(P){s[5](P)}let C={$$slots:{default:[N2]},$$scope:{ctx:s}};return s[1]!==void 0&&(C.checked=s[1]),h=new _a({props:C}),gi.push(()=>hn(h,"checked",E)),{c(){o.c(),a=He(),it(h.$$.fragment)},m(P,H){w[i].m(P,H),ke(P,a,H),et(h,P,H),m=!0},p(P,[H]){let U=i;i=I(P),i===U?w[i].p(P,H):(ki(),Le(w[U],1,1,()=>{w[U]=null}),Ti(),o=w[i],o?o.p(P,H):(o=w[i]=u[i](P),o.c()),be(o,1),o.m(a.parentNode,a));const ie={};H&512&&(ie.$$scope={dirty:H,ctx:P}),!g&&H&2&&(g=!0,ie.checked=P[1],cn(()=>g=!1)),h.$set(ie)},i(P){m||(be(o),be(h.$$.fragment,P),m=!0)},o(P){Le(o),Le(h.$$.fragment,P),m=!1},d(P){P&&Se(a),w[i].d(P),tt(h,P)}}}function qu(s){return[s.lng,s.lat]}function j2(s,i,o){let{map:a}=i;const h=Ys();let g=null,m=!1;async function u(P){try{h("loading","Loading from Overpass");let U=await(await fetch(Ey(P))).text();m&&xy("osm.xml",U),h("gotXml",{xml:U,boundary:P})}catch(H){h("error",H.toString())}}function w(){let P=a.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[qu(P.getSouthWest()),qu(P.getNorthWest()),qu(P.getNorthEast()),qu(P.getSouthEast()),qu(P.getSouthWest())]],type:"Polygon"}}}async function I(){if(a){if(a.getZoom()<13){h("error","Zoom in more to import");return}await u(w())}}function E(){a&&(o(0,g=new i2(a)),g.startNew(),g.addEventListenerSuccess(async P=>{o(0,g=null),await u(P)}),g.addEventListenerFailure(()=>{o(0,g=null)}))}function C(P){m=P,o(1,m)}return s.$$set=P=>{"map"in P&&o(4,a=P.map)},[g,m,I,E,a,C]}class U2 extends Wt{constructor(i){super(),Gt(this,i,j2,V2,Nt,{map:4})}}function Ey(s){let i='poly:"';if(s.geometry.type=="Polygon")for(let[a,h]of s.geometry.coordinates[0])i+=`${h} ${a} `;else if(s.geometry.type=="MultiPolygon")for(let[a,h]of s.geometry.coordinates[0][0])i+=`${h} ${a} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return i=i.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${i}); node(w)->.x; <;); out meta;`}`}function q2(s){let i=s.defaultValue,o=new URLSearchParams(window.location.search).get(s.name);if(o!=null)try{i=s.parse(o)}catch(h){console.warn(`Parsing URL parameter ${s.name}=${o} failed, using default value: ${h}`)}let a=qi(i);return a.subscribe(h=>{let g=new URL(window.location.href),m=s.stringify(h);m==null?g.searchParams.delete(s.name):g.searchParams.set(s.name,m),window.history.replaceState(null,"",g.toString())}),a}function Z2(s){return i=>{if(s.includes(i))return i;throw new Error(`${i} isn't in ${s}`)}}let G2="MZEJTanw3WpxRvt7qDfo",Cr=qi(null),hc=qi(null),Zr=qi({kind:"title"});Zr.subscribe(s=>{if(s.kind=="title")return;let i=new URL(window.location.href);i.searchParams.set("mode",s.kind),window.history.replaceState(null,"",i.toString())});let Qu=qi(!0),xl=q2({name:"profile",defaultValue:"USA",stringify:s=>s,parse:Z2(["USA","SidewalksOnHighways","SeparateWays"])}),Ts=qi(null),ma=qi(null),xh=qi(0),wh=qi(100),i_=qi(15),Al=qi({obey_crossings:!0,base_speed_mph:3,use_gradient:!1,delay_signalized:30,delay_zebra:0,delay_other:10}),My=qi({obey_crossings:!1,base_speed_mph:3,use_gradient:!1,delay_signalized:30,delay_zebra:0,delay_other:10});function n_(s){const i=s[4][0].geometry.coordinates[0];s[5]=i[0],s[6]=i[1]}function W2(s){let i,o,a,h,g,m,u,w;return{c(){i=ge("div"),o=ge("h2"),o.textContent="Debug mode",a=He(),h=ge("p"),h.textContent="Hover to see a segment's properties, and click to open OSM",g=He(),m=ge("button"),m.textContent="Update OSM data",te(m,"class","btn btn-secondary"),te(i,"slot","sidebar")},m(I,E){ke(I,i,E),oe(i,o),oe(i,a),oe(i,h),oe(i,g),oe(i,m),u||(w=At(m,"click",s[2]),u=!0)},p:Tt,d(I){I&&Se(i),u=!1,w()}}}function H2(s){n_(s);let i,o,a=s[3].kind+"",h,g,m,u,w,I,E,C,P,H,U,ie,se,ae,$,Te,Pe=s[3].gradient.toFixed(1)+"",ve,De;return{c(){i=ge("h2"),o=ft("Classified as "),h=ft(a),g=He(),m=ge("a"),u=ft("OSM"),I=ft(`,
          `),E=ge("a"),C=ft("Google StreetView"),H=ft(`,
          `),U=ge("a"),ie=ft("Bing Streetside"),ae=He(),$=ge("p"),Te=ft("Gradient: "),ve=ft(Pe),De=ft("%"),te(m,"href",w=s[3].url),te(m,"target","_blank"),te(E,"href",P=`http://maps.google.com/maps?q=&layer=c&cbll=${s[6]},${s[5]}&cbp=11,0,0,0,0`),te(E,"target","_blank"),te(U,"href",se=`https://www.bing.com/maps?cp=${s[6]}~${s[5]}&style=x`),te(U,"target","_blank")},m(Ae,B){ke(Ae,i,B),oe(i,o),oe(i,h),ke(Ae,g,B),ke(Ae,m,B),oe(m,u),ke(Ae,I,B),ke(Ae,E,B),oe(E,C),ke(Ae,H,B),ke(Ae,U,B),oe(U,ie),ke(Ae,ae,B),ke(Ae,$,B),oe($,Te),oe($,ve),oe($,De)},p(Ae,B){n_(Ae),B&8&&a!==(a=Ae[3].kind+"")&&rn(h,a),B&8&&w!==(w=Ae[3].url)&&te(m,"href",w),B&16&&P!==(P=`http://maps.google.com/maps?q=&layer=c&cbll=${Ae[6]},${Ae[5]}&cbp=11,0,0,0,0`)&&te(E,"href",P),B&16&&se!==(se=`https://www.bing.com/maps?cp=${Ae[6]}~${Ae[5]}&style=x`)&&te(U,"href",se),B&8&&Pe!==(Pe=Ae[3].gradient.toFixed(1)+"")&&rn(ve,Pe)},d(Ae){Ae&&(Se(i),Se(g),Se(m),Se(I),Se(E),Se(H),Se(U),Se(ae),Se($))}}}function X2(s){let i,o;return i=new Oh({props:{openOn:"click",$$slots:{default:[H2,({props:a,features:h})=>({3:a,4:h}),({props:a,features:h})=>(a?8:0)|(h?16:0)]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&152&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function K2(s){let i,o;return i=new Ro({props:{beforeId:"Road labels",paint:{"line-width":ec(5,7),"line-color":Ll(["get","kind"],Ao,"yellow"),"line-opacity":s[0]/100},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[X2]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&1&&(g.paint={"line-width":ec(5,7),"line-color":Ll(["get","kind"],Ao,"yellow"),"line-opacity":a[0]/100}),h&128&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function J2(s){let i,o,a;return o=new ds({props:{data:JSON.parse(zo(s[1]).render()),generateId:!0,$$slots:{default:[K2]},$$scope:{ctx:s}}}),{c(){i=ge("div"),it(o.$$.fragment),te(i,"slot","map")},m(h,g){ke(h,i,g),et(o,i,null),a=!0},p(h,g){const m={};g&2&&(m.data=JSON.parse(zo(h[1]).render())),g&129&&(m.$$scope={dirty:g,ctx:h}),o.$set(m)},i(h){a||(be(o.$$.fragment,h),a=!0)},o(h){Le(o.$$.fragment,h),a=!1},d(h){h&&Se(i),tt(o)}}}function Y2(s){let i,o;return i=new ya({props:{$$slots:{map:[J2],sidebar:[W2]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&131&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Q2(s,i,o){let a;Pt(s,Cr,m=>o(1,a=m));let{opacity:h}=i;async function g(){let m=JSON.parse(a.getInvertedBoundary()),u=m.geometry.coordinates.pop();m.geometry.coordinates=[u];let I=await(await fetch(Ey(m))).text();xy("updated_osm.xml",I)}return s.$$set=m=>{"opacity"in m&&o(0,h=m.opacity)},[h,a,g]}class $2 extends Wt{constructor(i){super(),Gt(this,i,Q2,Y2,Nt,{opacity:0})}}function r_(s,i,o){const a=s.slice();return a[2]=i[o],a}function s_(s){let i,o,a=o_(s[2])+"",h,g;return{c(){i=ge("li"),o=ge("a"),g=He(),te(o,"href",h=s[2].way),te(o,"target","_blank")},m(m,u){ke(m,i,u),oe(i,o),o.innerHTML=a,oe(i,g)},p(m,u){u&1&&a!==(a=o_(m[2])+"")&&(o.innerHTML=a),u&1&&h!==(h=m[2].way)&&te(o,"href",h)},d(m){m&&Se(i)}}}function eS(s){let i,o,a,h=(s[0].route_length/s[0].direct_length).toFixed(1)+"",g,m,u,w,I,E,C,P=Sh(s[0].active_duration_s+s[0].waiting_duration_s)+"",H,U,ie=Sh(s[0].waiting_duration_s)+"",se,ae,$,Te,Pe=s[1](s[0])+"",ve,De,Ae,B,Z,Q,D,N=bn(s[0].directions),ee=[];for(let me=0;me<N.length;me+=1)ee[me]=s_(r_(s,N,me));return{c(){i=ge("p"),o=ft("Detour factor: "),a=ge("b"),g=ft(h),m=ft("x"),u=ft(" longer than straight line"),w=He(),I=ge("p"),E=ft("Duration: "),C=ge("b"),H=ft(P),U=ft(`
  (`),se=ft(ie),ae=ft(" waiting at crossings)"),$=He(),Te=ge("p"),ve=ft(Pe),De=ft(" changes in level"),Ae=He(),B=ge("details"),Z=ge("summary"),Z.textContent="Route directions",Q=He(),D=ge("ol");for(let me=0;me<ee.length;me+=1)ee[me].c()},m(me,ne){ke(me,i,ne),oe(i,o),oe(i,a),oe(a,g),oe(a,m),oe(i,u),ke(me,w,ne),ke(me,I,ne),oe(I,E),oe(I,C),oe(C,H),oe(I,U),oe(I,se),oe(I,ae),ke(me,$,ne),ke(me,Te,ne),oe(Te,ve),oe(Te,De),ke(me,Ae,ne),ke(me,B,ne),oe(B,Z),oe(B,Q),oe(B,D);for(let pe=0;pe<ee.length;pe+=1)ee[pe]&&ee[pe].m(D,null)},p(me,[ne]){if(ne&1&&h!==(h=(me[0].route_length/me[0].direct_length).toFixed(1)+"")&&rn(g,h),ne&1&&P!==(P=Sh(me[0].active_duration_s+me[0].waiting_duration_s)+"")&&rn(H,P),ne&1&&ie!==(ie=Sh(me[0].waiting_duration_s)+"")&&rn(se,ie),ne&1&&Pe!==(Pe=me[1](me[0])+"")&&rn(ve,Pe),ne&1){N=bn(me[0].directions);let pe;for(pe=0;pe<N.length;pe+=1){const Ce=r_(me,N,pe);ee[pe]?ee[pe].p(Ce,ne):(ee[pe]=s_(Ce),ee[pe].c(),ee[pe].m(D,null))}for(;pe<ee.length;pe+=1)ee[pe].d(1);ee.length=N.length}},i:Tt,o:Tt,d(me){me&&(Se(i),Se(w),Se(I),Se($),Se(Te),Se(Ae),Se(B)),Cs(ee,me)}}}function o_(s){let i=parseInt(s.layer),o="&nbsp;".repeat(3*Math.abs(i));return s.name?`${o}[${i}] ${s.kind} (${s.name})`:`${o}[${i}] ${s.kind}`}function Sh(s){if(s<60)return Math.round(s)+"s";let i=Math.floor(s/3600),o=Math.floor((s-i*3600)/60),a=Math.round(s-i*3600-o*60);return i>0?`${i}h${o}m${a}s`:`${o}m${a}s`}function tS(s,i,o){let{route_gj:a}=i;function h(g){let m=0;for(let u=0;u<g.directions.length-1;u++){let w=a.directions[u].layer,I=a.directions[u+1].layer;w!=I&&m++}return m}return s.$$set=g=>{"route_gj"in g&&o(0,a=g.route_gj)},[a,h]}class iS extends Wt{constructor(i){super(),Gt(this,i,tS,eS,Nt,{route_gj:0})}}function nS(s){let i;return{c(){i=ft("Obey crossings (otherwise, can cross severances anywhere)")},m(o,a){ke(o,i,a)},d(o){o&&Se(i)}}}function rS(s){let i,o,a;return{c(){i=ft("Adjust speed for gradient ("),o=ge("a"),o.textContent="Tobler",a=ft(")"),te(o,"href","https://en.wikipedia.org/wiki/Tobler's_hiking_function"),te(o,"target","_blank")},m(h,g){ke(h,i,g),ke(h,o,g),ke(h,a,g)},p:Tt,d(h){h&&(Se(i),Se(o),Se(a))}}}function sS(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie,se,ae,$,Te,Pe,ve,De,Ae,B,Z,Q,D,N,ee,me,ne,pe,Ce,fe;function qe(ut){s[3](ut)}let nt={$$slots:{default:[nS]},$$scope:{ctx:s}};s[2].obey_crossings!==void 0&&(nt.checked=s[2].obey_crossings),h=new _a({props:nt}),gi.push(()=>hn(h,"checked",qe));function lt(ut){s[5](ut)}let at={$$slots:{default:[rS]},$$scope:{ctx:s}};return s[2].use_gradient!==void 0&&(at.checked=s[2].use_gradient),P=new _a({props:at}),gi.push(()=>hn(P,"checked",lt)),{c(){i=ge("details"),o=ge("summary"),o.textContent="Settings",a=He(),it(h.$$.fragment),m=He(),u=ge("div"),w=ge("label"),I=ft(`Base walking speed (mph)
      `),E=ge("input"),C=He(),it(P.$$.fragment),U=He(),ie=ge("div"),se=ge("label"),ae=ge("span"),$=ft(`
      Delay at signalized crossings (s)
      `),Te=ge("input"),Pe=He(),ve=ge("div"),De=ge("label"),Ae=ge("span"),B=ft(`
      Delay at zebra crossings (s)
      `),Z=ge("input"),Q=He(),D=ge("div"),N=ge("label"),ee=ge("span"),me=ft(`
      Delay at other crossings (s)
      `),ne=ge("input"),te(E,"class","form-control"),te(E,"type","number"),te(E,"min","0.1"),te(E,"max","3.5"),te(E,"step","0.1"),te(w,"class","form-label"),te(u,"class","my-3"),te(ae,"class","circle svelte-t3ac37"),Bi(ae,"background",Yu.Signalized),te(Te,"class","form-control"),te(Te,"type","number"),te(Te,"min","0"),te(Te,"max","60"),te(Te,"step","1"),te(se,"class","form-label"),te(ie,"class","my-3"),te(Ae,"class","circle svelte-t3ac37"),Bi(Ae,"background",Yu.Zebra),te(Z,"class","form-control"),te(Z,"type","number"),te(Z,"min","0"),te(Z,"max","60"),te(Z,"step","1"),te(De,"class","form-label"),te(ee,"class","circle svelte-t3ac37"),Bi(ee,"background",Yu.Other),te(ne,"class","form-control"),te(ne,"type","number"),te(ne,"min","0"),te(ne,"max","60"),te(ne,"step","1"),te(N,"class","form-label"),i.open=s[0]},m(ut,St){ke(ut,i,St),oe(i,o),oe(i,a),et(h,i,null),oe(i,m),oe(i,u),oe(u,w),oe(w,I),oe(w,E),Ui(E,s[2].base_speed_mph),oe(i,C),et(P,i,null),oe(i,U),oe(i,ie),oe(ie,se),oe(se,ae),oe(se,$),oe(se,Te),Ui(Te,s[2].delay_signalized),oe(i,Pe),oe(i,ve),oe(ve,De),oe(De,Ae),oe(De,B),oe(De,Z),Ui(Z,s[2].delay_zebra),oe(i,Q),oe(i,D),oe(D,N),oe(N,ee),oe(N,me),oe(N,ne),Ui(ne,s[2].delay_other),pe=!0,Ce||(fe=[At(E,"input",s[4]),At(Te,"input",s[6]),At(Z,"input",s[7]),At(ne,"input",s[8])],Ce=!0)},p(ut,[St]){const It={};St&512&&(It.$$scope={dirty:St,ctx:ut}),!g&&St&4&&(g=!0,It.checked=ut[2].obey_crossings,cn(()=>g=!1)),h.$set(It),St&4&&Gr(E.value)!==ut[2].base_speed_mph&&Ui(E,ut[2].base_speed_mph);const st={};St&512&&(st.$$scope={dirty:St,ctx:ut}),!H&&St&4&&(H=!0,st.checked=ut[2].use_gradient,cn(()=>H=!1)),P.$set(st),St&4&&Gr(Te.value)!==ut[2].delay_signalized&&Ui(Te,ut[2].delay_signalized),St&4&&Gr(Z.value)!==ut[2].delay_zebra&&Ui(Z,ut[2].delay_zebra),St&4&&Gr(ne.value)!==ut[2].delay_other&&Ui(ne,ut[2].delay_other),(!pe||St&1)&&(i.open=ut[0])},i(ut){pe||(be(h.$$.fragment,ut),be(P.$$.fragment,ut),pe=!0)},o(ut){Le(h.$$.fragment,ut),Le(P.$$.fragment,ut),pe=!1},d(ut){ut&&Se(i),tt(h),tt(P),Ce=!1,xn(fe)}}}function oS(s,i,o){let a,h=Tt,g=()=>(h(),h=Td(u,U=>o(2,a=U)),u);s.$$.on_destroy.push(()=>h());let{open:m}=i,{settings:u}=i;g();function w(U){s.$$.not_equal(a.obey_crossings,U)&&(a.obey_crossings=U,u.set(a))}function I(){a.base_speed_mph=Gr(this.value),u.set(a)}function E(U){s.$$.not_equal(a.use_gradient,U)&&(a.use_gradient=U,u.set(a))}function C(){a.delay_signalized=Gr(this.value),u.set(a)}function P(){a.delay_zebra=Gr(this.value),u.set(a)}function H(){a.delay_other=Gr(this.value),u.set(a)}return s.$$set=U=>{"open"in U&&o(0,m=U.open),"settings"in U&&g(o(1,u=U.settings))},[m,u,a,w,I,E,C,P,H]}class Dh extends Wt{constructor(i){super(),Gt(this,i,oS,sS,Nt,{open:0,settings:1})}}function a_(s){let i,o;return{c(){i=ge("p"),o=ft(s[3])},m(a,h){ke(a,i,h),oe(i,o)},p(a,h){h&8&&rn(o,a[3])},d(a){a&&Se(i)}}}function l_(s){let i,o;return i=new iS({props:{route_gj:s[2]}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&4&&(g.route_gj=a[2]),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function aS(s){let i,o,a,h,g,m,u,w,I,E=s[3]&&a_(s),C=s[2]&&l_(s);return w=new Dh({props:{open:!0,settings:Al}}),{c(){i=ge("div"),o=ge("h2"),o.textContent="Route mode",a=He(),h=ge("p"),h.innerHTML="Move the <b>A</b> and <b>B</b> pins to find a route",g=He(),E&&E.c(),m=He(),C&&C.c(),u=He(),it(w.$$.fragment),te(i,"slot","sidebar")},m(P,H){ke(P,i,H),oe(i,o),oe(i,a),oe(i,h),oe(i,g),E&&E.m(i,null),oe(i,m),C&&C.m(i,null),oe(i,u),et(w,i,null),I=!0},p(P,H){P[3]?E?E.p(P,H):(E=a_(P),E.c(),E.m(i,m)):E&&(E.d(1),E=null),P[2]?C?(C.p(P,H),H&4&&be(C,1)):(C=l_(P),C.c(),be(C,1),C.m(i,u)):C&&(ki(),Le(C,1,1,()=>{C=null}),Ti())},i(P){I||(be(C),be(w.$$.fragment,P),I=!0)},o(P){Le(C),Le(w.$$.fragment,P),I=!1},d(P){P&&Se(i),E&&E.d(),C&&C.d(),tt(w)}}}function u_(s){let i,o,a,h,g,m;function u(C){s[6](C)}let w={draggable:!0,$$slots:{default:[lS]},$$scope:{ctx:s}};s[1]!==void 0&&(w.lngLat=s[1]),i=new fd({props:w}),gi.push(()=>hn(i,"lngLat",u));function I(C){s[7](C)}let E={draggable:!0,$$slots:{default:[uS]},$$scope:{ctx:s}};return s[0]!==void 0&&(E.lngLat=s[0]),h=new fd({props:E}),gi.push(()=>hn(h,"lngLat",I)),{c(){it(i.$$.fragment),a=He(),it(h.$$.fragment)},m(C,P){et(i,C,P),ke(C,a,P),et(h,C,P),m=!0},p(C,P){const H={};P&256&&(H.$$scope={dirty:P,ctx:C}),!o&&P&2&&(o=!0,H.lngLat=C[1],cn(()=>o=!1)),i.$set(H);const U={};P&256&&(U.$$scope={dirty:P,ctx:C}),!g&&P&1&&(g=!0,U.lngLat=C[0],cn(()=>g=!1)),h.$set(U)},i(C){m||(be(i.$$.fragment,C),be(h.$$.fragment,C),m=!0)},o(C){Le(i.$$.fragment,C),Le(h.$$.fragment,C),m=!1},d(C){C&&Se(a),tt(i,C),tt(h,C)}}}function lS(s){let i;return{c(){i=ge("span"),i.textContent="A",te(i,"class","dot svelte-1ej0v4r")},m(o,a){ke(o,i,a)},p:Tt,d(o){o&&Se(i)}}}function uS(s){let i;return{c(){i=ge("span"),i.textContent="B",te(i,"class","dot svelte-1ej0v4r")},m(o,a){ke(o,i,a)},p:Tt,d(o){o&&Se(i)}}}function c_(s){let i,o;return i=new ds({props:{data:s[2],$$slots:{default:[cS]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&4&&(g.data=a[2]),h&256&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function cS(s){let i,o;return i=new Ro({props:{id:"route",beforeId:"network",paint:{"line-width":20,"line-color":"cyan","line-opacity":.5}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p:Tt,i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function hS(s){let i,o,a,h=s[1]&&s[0]&&u_(s),g=s[2]&&c_(s);return{c(){i=ge("div"),h&&h.c(),o=He(),g&&g.c(),te(i,"slot","map")},m(m,u){ke(m,i,u),h&&h.m(i,null),oe(i,o),g&&g.m(i,null),a=!0},p(m,u){m[1]&&m[0]?h?(h.p(m,u),u&3&&be(h,1)):(h=u_(m),h.c(),be(h,1),h.m(i,o)):h&&(ki(),Le(h,1,1,()=>{h=null}),Ti()),m[2]?g?(g.p(m,u),u&4&&be(g,1)):(g=c_(m),g.c(),be(g,1),g.m(i,null)):g&&(ki(),Le(g,1,1,()=>{g=null}),Ti())},i(m){a||(be(h),be(g),a=!0)},o(m){Le(h),Le(g),a=!1},d(m){m&&Se(i),h&&h.d(),g&&g.d()}}}function fS(s){let i,o;return i=new ya({props:{$$slots:{map:[hS],sidebar:[aS]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&271&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function kh(s,i,o){return i+s*(o-i)}function dS(s,i,o){let a,h,g,m;Pt(s,Al,C=>o(4,a=C)),Pt(s,ma,C=>o(0,h=C)),Pt(s,Ts,C=>o(1,g=C)),Pt(s,Cr,C=>o(5,m=C));let u=null,w="";ac(()=>{if(g)return;let C=Array.from(m.getBounds());xi(Ts,g=[kh(.4,C[0],C[2]),kh(.4,C[1],C[3])],g),xi(ma,h=[kh(.6,C[0],C[2]),kh(.6,C[1],C[3])],h)});function I(C){g=C,Ts.set(g)}function E(C){h=C,ma.set(h)}return s.$$.update=()=>{if(s.$$.dirty&51&&g&&h)try{o(2,u=JSON.parse(m.compareRoute({x1:g[0],y1:g[1],x2:h[0],y2:h[1],settings:a}))),o(3,w="")}catch(C){o(2,u=null),o(3,w=C.toString())}},[h,g,u,w,a,m,I,E]}class pS extends Wt{constructor(i){super(),Gt(this,i,dS,fS,Nt,{})}}function mS(s){let i;return{c(){i=ft("Compare two cases")},m(o,a){ke(o,i,a)},d(o){o&&Se(i)}}}function gS(s){let i,o;return i=new Dh({props:{open:!1,settings:Al}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p:Tt,i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function _S(s){let i,o,a,h,g,m,u;function w(E){s[15](E)}let I={$$slots:{default:[yS]},$$scope:{ctx:s}};return s[4]!==void 0&&(I.show=s[4]),a=new Bd({props:I}),gi.push(()=>hn(a,"show",w)),{c(){i=ge("button"),i.textContent="Route settings",o=He(),it(a.$$.fragment),te(i,"class","btn btn-secondary")},m(E,C){ke(E,i,C),ke(E,o,C),et(a,E,C),g=!0,m||(u=At(i,"click",s[14]),m=!0)},p(E,C){const P={};C&262144&&(P.$$scope={dirty:C,ctx:E}),!h&&C&16&&(h=!0,P.show=E[4],cn(()=>h=!1)),a.$set(P)},i(E){g||(be(a.$$.fragment,E),g=!0)},o(E){Le(a.$$.fragment,E),g=!1},d(E){E&&(Se(i),Se(o)),tt(a,E),m=!1,u()}}}function yS(s){let i,o,a,h,g,m,u,w,I,E,C;return g=new Dh({props:{open:!0,settings:Al}}),E=new Dh({props:{open:!0,settings:My}}),{c(){i=ge("div"),o=ge("div"),a=ge("h2"),a.textContent="Original",h=He(),it(g.$$.fragment),m=He(),u=ge("div"),w=ge("h2"),w.textContent="Comparison",I=He(),it(E.$$.fragment),Bi(i,"display","flex"),Bi(i,"gap","150px")},m(P,H){ke(P,i,H),oe(i,o),oe(o,a),oe(o,h),et(g,o,null),oe(i,m),oe(i,u),oe(u,w),oe(u,I),et(E,u,null),C=!0},p:Tt,i(P){C||(be(g.$$.fragment,P),be(E.$$.fragment,P),C=!0)},o(P){Le(g.$$.fragment,P),Le(E.$$.fragment,P),C=!1},d(P){P&&Se(i),tt(g),tt(E)}}}function vS(s){let i,o;return i=new uc({props:{colorScale:Hs,labels:{limits:s[7].map(p_)}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&128&&(g.labels={limits:a[7].map(p_)}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function bS(s){let i,o;return i=new uc({props:{colorScale:s[8],labels:{limits:s[6].map(d_)}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&64&&(g.labels={limits:a[6].map(d_)}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function xS(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie,se,ae,$,Te,Pe,ve,De,Ae,B,Z,Q,D,N,ee;function me(at){s[13](at)}let ne={$$slots:{default:[mS]},$$scope:{ctx:s}};s[1]!==void 0&&(ne.checked=s[1]),h=new _a({props:ne}),gi.push(()=>hn(h,"checked",me));const pe=[_S,gS],Ce=[];function fe(at,ut){return at[1]?0:1}u=fe(s),w=Ce[u]=pe[u](s);const qe=[bS,vS],nt=[];function lt(at,ut){return at[1]?0:1}return Z=lt(s),Q=nt[Z]=qe[Z](s),{c(){i=ge("div"),o=ge("h2"),o.textContent="Isochrone mode",a=He(),it(h.$$.fragment),m=He(),w.c(),I=He(),E=ge("hr"),C=He(),P=ge("div"),H=ge("label"),U=ft(`Draw:
        `),ie=ge("select"),se=ge("option"),se.textContent="Roads",ae=ge("option"),ae.textContent="Grid",$=ge("option"),$.textContent="Contours",Te=ge("option"),Te.textContent="Dasymetric",Pe=He(),ve=ge("label"),De=ft(`Minutes away
      `),Ae=ge("input"),B=He(),Q.c(),se.__value="Roads",Ui(se,se.__value),ae.__value="Grid",Ui(ae,ae.__value),$.__value="Contours",Ui($,$.__value),Te.__value="Dasymetric",Ui(Te,Te.__value),te(ie,"class","form-select"),s[0]===void 0&&Ml(()=>s[16].call(ie)),te(H,"class","form-label"),te(Ae,"class","form-control"),te(Ae,"type","number"),te(Ae,"min","1"),te(Ae,"max","30"),te(ve,"class","form-label"),te(i,"slot","sidebar")},m(at,ut){ke(at,i,ut),oe(i,o),oe(i,a),et(h,i,null),oe(i,m),Ce[u].m(i,null),oe(i,I),oe(i,E),oe(i,C),oe(i,P),oe(P,H),oe(H,U),oe(H,ie),oe(ie,se),oe(ie,ae),oe(ie,$),oe(ie,Te),El(ie,s[0],!0),oe(i,Pe),oe(i,ve),oe(ve,De),oe(ve,Ae),Ui(Ae,s[2]),oe(i,B),nt[Z].m(i,null),D=!0,N||(ee=[At(ie,"change",s[16]),At(Ae,"input",s[17])],N=!0)},p(at,ut){const St={};ut&262144&&(St.$$scope={dirty:ut,ctx:at}),!g&&ut&2&&(g=!0,St.checked=at[1],cn(()=>g=!1)),h.$set(St);let It=u;u=fe(at),u===It?Ce[u].p(at,ut):(ki(),Le(Ce[It],1,1,()=>{Ce[It]=null}),Ti(),w=Ce[u],w?w.p(at,ut):(w=Ce[u]=pe[u](at),w.c()),be(w,1),w.m(i,I)),ut&1&&El(ie,at[0]),ut&4&&Gr(Ae.value)!==at[2]&&Ui(Ae,at[2]);let st=Z;Z=lt(at),Z===st?nt[Z].p(at,ut):(ki(),Le(nt[st],1,1,()=>{nt[st]=null}),Ti(),Q=nt[Z],Q?Q.p(at,ut):(Q=nt[Z]=qe[Z](at),Q.c()),be(Q,1),Q.m(i,null))},i(at){D||(be(h.$$.fragment,at),be(w),be(Q),D=!0)},o(at){Le(h.$$.fragment,at),Le(w),Le(Q),D=!1},d(at){at&&Se(i),tt(h),Ce[u].d(),nt[Z].d(),N=!1,xn(ee)}}}function h_(s){let i,o,a;function h(m){s[12](m)}let g={draggable:!0,$$slots:{default:[wS]},$$scope:{ctx:s}};return s[3]!==void 0&&(g.lngLat=s[3]),i=new fd({props:g}),gi.push(()=>hn(i,"lngLat",h)),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,u){const w={};u&262144&&(w.$$scope={dirty:u,ctx:m}),!o&&u&8&&(o=!0,w.lngLat=m[3],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function wS(s){let i;return{c(){i=ge("span"),i.textContent="X",te(i,"class","dot svelte-1ej0v4r")},m(o,a){ke(o,i,a)},p:Tt,d(o){o&&Se(i)}}}function SS(s){let i,o,a,h;return i=new Ro({props:{id:"isochrone-roads",beforeId:"Road labels",filter:mw,paint:{"line-width":2,"line-color":s[1]?ns(["-",["get","cost2"],["get","cost1"]],s[6],s[8]):ns(["get","cost1"],s[7],Hs)}}}),a=new Q_({props:{id:"isochrone-polygons",beforeId:"Road labels",filter:pw,paint:{"fill-color":s[1]?ns(["-",["get","cost2"],["get","cost1"]],s[6],s[8]):ns(["get","cost1"],s[7],Hs),"fill-opacity":s[0]=="Dasymetric"?1:.5}}}),{c(){it(i.$$.fragment),o=He(),it(a.$$.fragment)},m(g,m){et(i,g,m),ke(g,o,m),et(a,g,m),h=!0},p(g,m){const u={};m&194&&(u.paint={"line-width":2,"line-color":g[1]?ns(["-",["get","cost2"],["get","cost1"]],g[6],g[8]):ns(["get","cost1"],g[7],Hs)}),i.$set(u);const w={};m&195&&(w.paint={"fill-color":g[1]?ns(["-",["get","cost2"],["get","cost1"]],g[6],g[8]):ns(["get","cost1"],g[7],Hs),"fill-opacity":g[0]=="Dasymetric"?1:.5}),a.$set(w)},i(g){h||(be(i.$$.fragment,g),be(a.$$.fragment,g),h=!0)},o(g){Le(i.$$.fragment,g),Le(a.$$.fragment,g),h=!1},d(g){g&&Se(o),tt(i,g),tt(a,g)}}}function kS(s){let i,o,a,h,g=s[3]&&h_(s);return a=new ds({props:{data:s[5],$$slots:{default:[SS]},$$scope:{ctx:s}}}),{c(){i=ge("div"),g&&g.c(),o=He(),it(a.$$.fragment),te(i,"slot","map")},m(m,u){ke(m,i,u),g&&g.m(i,null),oe(i,o),et(a,i,null),h=!0},p(m,u){m[3]?g?(g.p(m,u),u&8&&be(g,1)):(g=h_(m),g.c(),be(g,1),g.m(i,o)):g&&(ki(),Le(g,1,1,()=>{g=null}),Ti());const w={};u&32&&(w.data=m[5]),u&262339&&(w.$$scope={dirty:u,ctx:m}),a.$set(w)},i(m){h||(be(g),be(a.$$.fragment,m),h=!0)},o(m){Le(g),Le(a.$$.fragment,m),h=!1},d(m){m&&Se(i),g&&g.d(),tt(a)}}}function TS(s){let i,o;return i=new ya({props:{$$slots:{map:[kS],sidebar:[xS]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&262399&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function f_(s,i,o){return i+s*(o-i)}const d_=s=>s/60,p_=s=>s/60;function CS(s,i,o){let a,h,g,m,u,w,I;Pt(s,My,ve=>o(9,g=ve)),Pt(s,Al,ve=>o(10,m=ve)),Pt(s,i_,ve=>o(2,u=ve)),Pt(s,Ts,ve=>o(3,w=ve)),Pt(s,Cr,ve=>o(11,I=ve));let E="Roads",C=!1,P=!1,H=["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],U=kg();ac(()=>{if(w)return;let ve=Array.from(I.getBounds());xi(Ts,w=[f_(.4,ve[0],ve[2]),f_(.4,ve[1],ve[3])],w)});function ie(ve){w=ve,Ts.set(w)}function se(ve){C=ve,o(1,C)}const ae=()=>o(4,P=!0);function $(ve){P=ve,o(4,P)}function Te(){E=Cd(this),o(0,E)}function Pe(){u=Gr(this.value),i_.set(u)}return s.$$.update=()=>{if(s.$$.dirty&4&&o(7,a=Array.from(Array(6).keys()).map(ve=>u*60/5*ve)),s.$$.dirty&4&&o(6,h=[-u,-Math.floor(u/2),-1,Math.floor(u/2),u].map(ve=>ve*60)),s.$$.dirty&3599&&w)try{o(5,U=JSON.parse(I.isochrone({x:w[0],y:w[1],style:E,time_limit:u,settings1:m,settings2:C?g:null})))}catch(ve){console.error(ve),o(5,U=kg())}},[E,C,u,w,P,U,h,a,H,g,m,I,ie,se,ae,$,Te,Pe]}class IS extends Wt{constructor(i){super(),Gt(this,i,CS,TS,Nt,{})}}const ES="/severance_snape/assets/logo-3MjkCCFo.svg";function m_(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie,se,ae,$,Te,Pe,ve,De,Ae,B,Z,Q,D;return{c(){i=ge("button"),i.textContent="Change study area",o=He(),a=ge("button"),h=ft("Score"),m=He(),u=ge("button"),w=ft("Route"),E=He(),C=ge("button"),P=ft("Isochrone"),U=He(),ie=ge("button"),se=ft("Crossings"),$=He(),Te=ge("button"),Pe=ft("Network disconnections"),De=He(),Ae=ge("button"),B=ft("Debug network"),te(i,"class","btn btn-secondary"),te(a,"class","btn btn-secondary"),a.disabled=g=s[0].kind=="score",te(u,"class","btn btn-secondary"),u.disabled=I=s[0].kind=="route",te(C,"class","btn btn-secondary"),C.disabled=H=s[0].kind=="isochrone",te(ie,"class","btn btn-secondary"),ie.disabled=ae=s[0].kind=="crossings",te(Te,"class","btn btn-secondary"),Te.disabled=ve=s[0].kind=="disconnected",te(Ae,"class","btn btn-secondary"),Ae.disabled=Z=s[0].kind=="debug"},m(N,ee){ke(N,i,ee),ke(N,o,ee),ke(N,a,ee),oe(a,h),ke(N,m,ee),ke(N,u,ee),oe(u,w),ke(N,E,ee),ke(N,C,ee),oe(C,P),ke(N,U,ee),ke(N,ie,ee),oe(ie,se),ke(N,$,ee),ke(N,Te,ee),oe(Te,Pe),ke(N,De,ee),ke(N,Ae,ee),oe(Ae,B),Q||(D=[At(i,"click",s[2]),At(a,"click",s[4]),At(u,"click",s[5]),At(C,"click",s[6]),At(ie,"click",s[7]),At(Te,"click",s[8]),At(Ae,"click",s[9])],Q=!0)},p(N,ee){ee&1&&g!==(g=N[0].kind=="score")&&(a.disabled=g),ee&1&&I!==(I=N[0].kind=="route")&&(u.disabled=I),ee&1&&H!==(H=N[0].kind=="isochrone")&&(C.disabled=H),ee&1&&ae!==(ae=N[0].kind=="crossings")&&(ie.disabled=ae),ee&1&&ve!==(ve=N[0].kind=="disconnected")&&(Te.disabled=ve),ee&1&&Z!==(Z=N[0].kind=="debug")&&(Ae.disabled=Z)},d(N){N&&(Se(i),Se(o),Se(a),Se(m),Se(u),Se(E),Se(C),Se(U),Se(ie),Se($),Se(Te),Se(De),Se(Ae)),Q=!1,xn(D)}}}function MS(s){let i,o,a,h,g,m,u,w=s[0].kind!="title"&&m_(s);return{c(){i=ge("nav"),o=ge("div"),a=ge("div"),h=ge("button"),h.innerHTML=`<img src="${ES}" style="height: 30px" alt="A/B Street logo"/>`,g=He(),w&&w.c(),te(h,"class","btn"),te(a,"class","navbar-nav"),te(o,"class","container-fluid"),te(i,"class","navbar navbar-expand-lg bg-body-tertiary")},m(I,E){ke(I,i,E),oe(i,o),oe(o,a),oe(a,h),oe(a,g),w&&w.m(a,null),m||(u=At(h,"click",s[3]),m=!0)},p(I,[E]){I[0].kind!="title"?w?w.p(I,E):(w=m_(I),w.c(),w.m(a,null)):w&&(w.d(1),w=null)},i:Tt,o:Tt,d(I){I&&Se(i),w&&w.d(),m=!1,u()}}}function LS(s,i,o){let a,h,g,m;Pt(s,Zr,ie=>o(0,a=ie)),Pt(s,ma,ie=>o(10,h=ie)),Pt(s,Ts,ie=>o(11,g=ie)),Pt(s,Qu,ie=>o(1,m=ie));function u(){let ie=new URL(window.location.href);ie.searchParams.delete("study_area"),window.history.replaceState(null,"",ie.toString()),xi(Ts,g=null,g),xi(ma,h=null,h),xi(Zr,a={kind:"title"},a)}return[a,m,u,()=>xi(Qu,m=!0,m),()=>xi(Zr,a={kind:"score"},a),()=>xi(Zr,a={kind:"route"},a),()=>xi(Zr,a={kind:"isochrone"},a),()=>xi(Zr,a={kind:"crossings"},a),()=>xi(Zr,a={kind:"disconnected"},a),()=>xi(Zr,a={kind:"debug"},a)]}class PS extends Wt{constructor(i){super(),Gt(this,i,LS,MS,Nt,{})}}function g_(s){let i,o,a,h=s[2].properties.score.toFixed(1)+"",g,m,u;return{c(){i=ge("p"),o=ft("Detour factor: "),a=ge("b"),g=ft(h),m=ft("x"),u=ft(`
        longer than straight line`)},m(w,I){ke(w,i,I),oe(i,o),oe(i,a),oe(a,g),oe(a,m),oe(i,u)},p(w,I){I&4&&h!==(h=w[2].properties.score.toFixed(1)+"")&&rn(g,h)},d(w){w&&Se(i)}}}function AS(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie,se,ae,$,Te,Pe,ve,De,Ae,B,Z,Q;m=new uc({props:{colorScale:Hs,labels:{limits:vy}}});let D=s[2]&&g_(s);return{c(){i=ge("div"),o=ge("h2"),o.textContent="Score mode",a=He(),h=ge("p"),h.innerHTML=`The desire lines are coloured based on their detour factor. <b>Click</b> one
      to see the route`,g=He(),it(m.$$.fragment),u=He(),w=ge("label"),I=ft("Show desire lines with scores "),E=ft(s[0]),C=ft("-"),P=ft(s[1]),H=ft(`:
      `),U=ge("input"),ie=ft(`
      to
      `),se=ge("input"),ae=He(),$=ge("hr"),Te=He(),Pe=ge("button"),ve=ft("See this route in detail"),Ae=He(),D&&D.c(),te(U,"class","form-control"),te(U,"type","range"),te(U,"min","0"),te(U,"max",s[5]),te(se,"class","form-control"),te(se,"type","range"),te(se,"min","0"),te(se,"max",s[5]),te(w,"class","form-label"),te(Pe,"class","btn btn-secondary"),Pe.disabled=De=s[2]==null,te(i,"slot","sidebar")},m(N,ee){ke(N,i,ee),oe(i,o),oe(i,a),oe(i,h),oe(i,g),et(m,i,null),oe(i,u),oe(i,w),oe(w,I),oe(w,E),oe(w,C),oe(w,P),oe(w,H),oe(w,U),Ui(U,s[0]),oe(w,ie),oe(w,se),Ui(se,s[1]),oe(i,ae),oe(i,$),oe(i,Te),oe(i,Pe),oe(Pe,ve),oe(i,Ae),D&&D.m(i,null),B=!0,Z||(Q=[At(U,"change",s[9]),At(U,"input",s[9]),At(se,"change",s[10]),At(se,"input",s[10]),At(Pe,"click",s[8])],Z=!0)},p(N,ee){(!B||ee&1)&&rn(E,N[0]),(!B||ee&2)&&rn(P,N[1]),ee&1&&Ui(U,N[0]),ee&2&&Ui(se,N[1]),(!B||ee&4&&De!==(De=N[2]==null))&&(Pe.disabled=De),N[2]?D?D.p(N,ee):(D=g_(N),D.c(),D.m(i,null)):D&&(D.d(1),D=null)},i(N){B||(be(m.$$.fragment,N),B=!0)},o(N){Le(m.$$.fragment,N),B=!1},d(N){N&&Se(i),tt(m),D&&D.d(),Z=!1,xn(Q)}}}function zS(s){let i,o=s[17].score.toFixed(1)+"",a,h;return{c(){i=ge("span"),a=ft(o),h=ft("x"),Bi(i,"font-size","26px")},m(g,m){ke(g,i,m),oe(i,a),oe(i,h)},p(g,m){m&131072&&o!==(o=g[17].score.toFixed(1)+"")&&rn(a,o)},d(g){g&&Se(i)}}}function DS(s){let i,o;return i=new Oh({props:{openOn:"hover",$$slots:{default:[zS,({props:a})=>({17:a}),({props:a})=>a?131072:0]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&393216&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function RS(s){let i,o;return i=new Ro({props:{id:"scores",filter:["all",[">=",["get","score"],s[0]],["<=",["get","score"],s[1]]],paint:{"line-width":8,"line-color":ns(["get","score"],vy,Hs)},$$slots:{default:[DS]},$$scope:{ctx:s}}}),i.$on("click",s[6]),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&3&&(g.filter=["all",[">=",["get","score"],a[0]],["<=",["get","score"],a[1]]]),h&262144&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function __(s){let i,o;return i=new ds({props:{data:s[3],$$slots:{default:[BS]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&8&&(g.data=a[3]),h&262144&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function BS(s){let i,o;return i=new Ro({props:{id:"route",beforeId:"network",paint:{"line-width":20,"line-color":"cyan","line-opacity":.5}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p:Tt,i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function FS(s){let i,o,a,h,g,m;o=new Ld({}),o.$on("click",s[7]),h=new ds({props:{data:s[4],$$slots:{default:[RS]},$$scope:{ctx:s}}});let u=s[3]&&__(s);return{c(){i=ge("div"),it(o.$$.fragment),a=He(),it(h.$$.fragment),g=He(),u&&u.c(),te(i,"slot","map")},m(w,I){ke(w,i,I),et(o,i,null),oe(i,a),et(h,i,null),oe(i,g),u&&u.m(i,null),m=!0},p(w,I){const E={};I&262147&&(E.$$scope={dirty:I,ctx:w}),h.$set(E),w[3]?u?(u.p(w,I),I&8&&be(u,1)):(u=__(w),u.c(),be(u,1),u.m(i,null)):u&&(ki(),Le(u,1,1,()=>{u=null}),Ti())},i(w){m||(be(o.$$.fragment,w),be(h.$$.fragment,w),be(u),m=!0)},o(w){Le(o.$$.fragment,w),Le(h.$$.fragment,w),Le(u),m=!1},d(w){w&&Se(i),tt(o),tt(h),u&&u.d()}}}function OS(s){let i,o;return i=new ya({props:{$$slots:{map:[FS],sidebar:[AS]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&262159&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function NS(s,i,o){let a,h,g,m,u,w,I,E;Pt(s,Zr,Pe=>o(11,a=Pe)),Pt(s,ma,Pe=>o(12,h=Pe)),Pt(s,Ts,Pe=>o(13,g=Pe)),Pt(s,hc,Pe=>o(14,m=Pe)),Pt(s,Al,Pe=>o(15,u=Pe)),Pt(s,Cr,Pe=>o(16,w=Pe)),Pt(s,xh,Pe=>o(0,I=Pe)),Pt(s,wh,Pe=>o(1,E=Pe));let C=JSON.parse(w.scoreDetours()),P=Math.round(Math.max(...C.features.map(Pe=>Pe.properties.score)));E>P&&(xi(xh,I=0,I),xi(wh,E=P,E));let H=null,U=null;function ie(Pe){try{o(2,H=Pe.detail.features[0]);let ve=H.geometry.coordinates;o(3,U=JSON.parse(w.compareRoute({x1:ve[0][0],y1:ve[0][1],x2:ve[1][0],y2:ve[1][1],settings:u})))}catch(ve){window.alert(`No route: ${ve}`),o(2,H=null),o(3,U=null)}}function se(Pe){m.queryRenderedFeatures(Pe.detail.point,{layers:["scores"]}).length>0||(o(2,H=null),o(3,U=null))}function ae(){H&&(xi(Ts,g=H.geometry.coordinates[0],g),xi(ma,h=H.geometry.coordinates[1],h),xi(Zr,a={kind:"route"},a))}function $(){I=Gr(this.value),xh.set(I)}function Te(){E=Gr(this.value),wh.set(E)}return s.$$.update=()=>{s.$$.dirty&3&&I>=E&&(xi(xh,I=Math.max(0,E-1),I),xi(wh,E=Math.min(P,I+1),E))},[I,E,H,U,C,P,ie,se,ae,$,Te]}class VS extends Wt{constructor(i){super(),Gt(this,i,NS,OS,Nt,{})}}function y_(s){let i,o,a,h,g;function m(I){s[7](I)}let u={$$slots:{default:[jS]},$$scope:{ctx:s}};s[1]!==void 0&&(u.checked=s[1]),i=new _a({props:u}),gi.push(()=>hn(i,"checked",m));let w=s[1]&&v_();return{c(){it(i.$$.fragment),a=He(),w&&w.c(),h=Kn()},m(I,E){et(i,I,E),ke(I,a,E),w&&w.m(I,E),ke(I,h,E),g=!0},p(I,E){const C={};E&512&&(C.$$scope={dirty:E,ctx:I}),!o&&E&2&&(o=!0,C.checked=I[1],cn(()=>o=!1)),i.$set(C),I[1]?w?E&2&&be(w,1):(w=v_(),w.c(),be(w,1),w.m(h.parentNode,h)):w&&(ki(),Le(w,1,1,()=>{w=null}),Ti())},i(I){g||(be(i.$$.fragment,I),be(w),g=!0)},o(I){Le(i.$$.fragment,I),Le(w),g=!1},d(I){I&&(Se(a),Se(h)),tt(i,I),w&&w.d(I)}}}function jS(s){let i;return{c(){i=ft("Crossings")},m(o,a){ke(o,i,a)},d(o){o&&Se(i)}}}function v_(s){let i,o;return i=new by({props:{labelColors:Yu,itemsPerRow:1,swatchClass:"circle"}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function b_(s){let i,o,a,h,g;function m(I){s[8](I)}let u={$$slots:{default:[US]},$$scope:{ctx:s}};s[2]!==void 0&&(u.checked=s[2]),i=new _a({props:u}),gi.push(()=>hn(i,"checked",m));let w=s[2]&&x_();return{c(){it(i.$$.fragment),a=He(),w&&w.c(),h=Kn()},m(I,E){et(i,I,E),ke(I,a,E),w&&w.m(I,E),ke(I,h,E),g=!0},p(I,E){const C={};E&512&&(C.$$scope={dirty:E,ctx:I}),!o&&E&4&&(o=!0,C.checked=I[2],cn(()=>o=!1)),i.$set(C),I[2]?w?E&4&&be(w,1):(w=x_(),w.c(),be(w,1),w.m(h.parentNode,h)):w&&(ki(),Le(w,1,1,()=>{w=null}),Ti())},i(I){g||(be(i.$$.fragment,I),be(w),g=!0)},o(I){Le(i.$$.fragment,I),Le(w),g=!1},d(I){I&&(Se(a),Se(h)),tt(i,I),w&&w.d(I)}}}function US(s){let i;return{c(){i=ft("Gradient")},m(o,a){ke(o,i,a)},d(o){o&&Se(i)}}}function x_(s){let i,o,a,h;return i=new uc({props:{colorScale:xd,labels:{limits:wd}}}),{c(){it(i.$$.fragment),o=He(),a=ge("p"),a.innerHTML=`<img src="${G_}" alt="arrow"/>
            Arrows point uphill`},m(g,m){et(i,g,m),ke(g,o,m),ke(g,a,m),h=!0},i(g){h||(be(i.$$.fragment,g),h=!0)},o(g){Le(i.$$.fragment,g),h=!1},d(g){g&&(Se(o),Se(a)),tt(i,g)}}}function qS(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie,se;u=new by({props:{labelColors:{Footway:Ao.Footway,Crossing:Ao["Crossing(Signalized)"],"Walkable and easily crossable street (maybe no sidewalk)":Ao.WithTraffic,Severance:Ao.Severance},itemsPerRow:1}});let ae=s[4]&&y_(s),$=s[5]&&b_(s);return{c(){i=ge("div"),o=ge("details"),a=ge("summary"),a.textContent="Layers",h=He(),g=ge("button"),g.textContent="Zoom to fit",m=He(),it(u.$$.fragment),w=He(),I=ge("label"),E=ft(`Network opacity:
        `),C=ge("input"),P=He(),ae&&ae.c(),H=He(),$&&$.c(),te(g,"class","btn btn-secondary"),Bi(g,"margin-bottom","8px"),te(C,"class","form-control"),te(C,"type","range"),te(C,"min","0"),te(C,"max","100"),te(I,"class","form-label"),o.open=!0,Bi(i,"background","white"),Bi(i,"width","200px"),Bi(i,"padding","8px")},m(Te,Pe){ke(Te,i,Pe),oe(i,o),oe(o,a),oe(o,h),oe(o,g),oe(o,m),et(u,o,null),oe(o,w),oe(o,I),oe(I,E),oe(I,C),Ui(C,s[0]),oe(o,P),ae&&ae.m(o,null),oe(o,H),$&&$.m(o,null),U=!0,ie||(se=[At(g,"click",function(){sc(s[3])&&s[3].apply(this,arguments)}),At(C,"change",s[6]),At(C,"input",s[6])],ie=!0)},p(Te,Pe){s=Te,Pe&1&&Ui(C,s[0]),s[4]?ae?(ae.p(s,Pe),Pe&16&&be(ae,1)):(ae=y_(s),ae.c(),be(ae,1),ae.m(o,H)):ae&&(ki(),Le(ae,1,1,()=>{ae=null}),Ti()),s[5]?$?($.p(s,Pe),Pe&32&&be($,1)):($=b_(s),$.c(),be($,1),$.m(o,null)):$&&(ki(),Le($,1,1,()=>{$=null}),Ti())},i(Te){U||(be(u.$$.fragment,Te),be(ae),be($),U=!0)},o(Te){Le(u.$$.fragment,Te),Le(ae),Le($),U=!1},d(Te){Te&&Se(i),tt(u),ae&&ae.d(),$&&$.d(),ie=!1,xn(se)}}}function ZS(s){let i,o;return i=new hv({props:{position:"top-right",$$slots:{default:[qS]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&575&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function GS(s,i,o){let{zoomToFit:a}=i,{opacity:h}=i,{showCrossings:g}=i,{canShowCrossings:m}=i,{showGradient:u}=i,{canShowGradient:w}=i;function I(){h=Gr(this.value),o(0,h)}function E(P){g=P,o(1,g)}function C(P){u=P,o(2,u)}return s.$$set=P=>{"zoomToFit"in P&&o(3,a=P.zoomToFit),"opacity"in P&&o(0,h=P.opacity),"showCrossings"in P&&o(1,g=P.showCrossings),"canShowCrossings"in P&&o(4,m=P.canShowCrossings),"showGradient"in P&&o(2,u=P.showGradient),"canShowGradient"in P&&o(5,w=P.canShowGradient)},[h,g,u,a,m,w,I,E,C]}class WS extends Wt{constructor(i){super(),Gt(this,i,GS,ZS,Nt,{zoomToFit:3,opacity:0,showCrossings:1,canShowCrossings:4,showGradient:2,canShowGradient:5})}}function w_(s,i,o){const a=s.slice();return a[11]=i[o],a[12]=i,a[13]=o,a}function S_(s){const i=s[8][0].geometry.coordinates;s[9]=i[0],s[10]=i[1]}function k_(s){let i,o,a;return{c(){i=ge("a"),o=ft("?"),te(i,"href",a="https://wiki.openstreetmap.org/wiki/Tag:crossing%3D"+s[11]),te(i,"target","_blank")},m(h,g){ke(h,i,g),oe(i,o)},p(h,g){g&1&&a!==(a="https://wiki.openstreetmap.org/wiki/Tag:crossing%3D"+h[11])&&te(i,"href",a)},d(h){h&&Se(i)}}}function HS(s){let i=s[11]+"",o,a,h,g=s[11]!="unknown"&&k_(s);return{c(){o=ft(i),a=He(),g&&g.c(),h=He()},m(m,u){ke(m,o,u),ke(m,a,u),g&&g.m(m,u),ke(m,h,u)},p(m,u){u&1&&i!==(i=m[11]+"")&&rn(o,i),m[11]!="unknown"?g?g.p(m,u):(g=k_(m),g.c(),g.m(h.parentNode,h)):g&&(g.d(1),g=null)},d(m){m&&(Se(o),Se(a),Se(h)),g&&g.d(m)}}}function T_(s){let i,o,a;function h(m){s[5](m,s[11])}let g={$$slots:{default:[HS]},$$scope:{ctx:s}};return s[0][s[11]]!==void 0&&(g.checked=s[0][s[11]]),i=new _a({props:g}),gi.push(()=>hn(i,"checked",h)),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,u){s=m;const w={};u&16385&&(w.$$scope={dirty:u,ctx:s}),!o&&u&1&&(o=!0,w.checked=s[0][s[11]],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function XS(s){let i,o,a,h,g,m,u,w,I,E,C,P;m=new uc({props:{colorScale:Hs,labels:{limits:s[4]}}});let H=bn(Object.keys(s[0])),U=[];for(let se=0;se<H.length;se+=1)U[se]=T_(w_(s,H,se));const ie=se=>Le(U[se],1,1,()=>{U[se]=null});return{c(){i=ge("div"),o=ge("h2"),o.textContent="Crossings mode",a=He(),h=ge("p"),h.textContent=`This is only showing crossings over severances. For other streets, it's
      assumed that it's easy enough to cross the street anywhere, even without
      explicit crossings.`,g=He(),it(m.$$.fragment),u=He(),w=ge("hr"),I=He(),E=ge("p"),E.textContent="What crossings do you want to include for measuring distance?",C=He();for(let se=0;se<U.length;se+=1)U[se].c();te(i,"slot","sidebar")},m(se,ae){ke(se,i,ae),oe(i,o),oe(i,a),oe(i,h),oe(i,g),et(m,i,null),oe(i,u),oe(i,w),oe(i,I),oe(i,E),oe(i,C);for(let $=0;$<U.length;$+=1)U[$]&&U[$].m(i,null);P=!0},p(se,ae){if(ae&1){H=bn(Object.keys(se[0]));let $;for($=0;$<H.length;$+=1){const Te=w_(se,H,$);U[$]?(U[$].p(Te,ae),be(U[$],1)):(U[$]=T_(Te),U[$].c(),be(U[$],1),U[$].m(i,null))}for(ki(),$=H.length;$<U.length;$+=1)ie($);Ti()}},i(se){if(!P){be(m.$$.fragment,se);for(let ae=0;ae<H.length;ae+=1)be(U[ae]);P=!0}},o(se){Le(m.$$.fragment,se),U=U.filter(Boolean);for(let ae=0;ae<U.length;ae+=1)Le(U[ae]);P=!1},d(se){se&&Se(i),tt(m),Cs(U,se)}}}function KS(s){let i=Math.round(s[7].length)+"",o,a;return{c(){o=ft(i),a=ft("m")},m(h,g){ke(h,o,g),ke(h,a,g)},p(h,g){g&128&&i!==(i=Math.round(h[7].length)+"")&&rn(o,i)},d(h){h&&(Se(o),Se(a))}}}function JS(s){let i,o;return i=new Oh({props:{openOn:"hover",$$slots:{default:[KS,({props:a})=>({7:a}),({props:a})=>a?128:0]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&16512&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function YS(s){let i,o;return i=new Ro({props:{beforeId:"Road labels",paint:{"line-width":ec(5,10),"line-color":ns(["get","length"],s[4],Hs)},manageHoverState:!0,$$slots:{default:[JS]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&16384&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function QS(s){S_(s);let i,o,a,h,g,m,u,w,I,E,C,P,H,U;return i=new Bw({props:{properties:s[7]}}),{c(){it(i.$$.fragment),o=He(),a=ge("a"),h=ft("OSM"),m=ft(`,
          `),u=ge("a"),w=ft("Google StreetView"),E=ft(`,
          `),C=ge("a"),P=ft("Bing Streetside"),te(a,"href",g=s[7].url),te(a,"target","_blank"),te(u,"href",I=`http://maps.google.com/maps?q=&layer=c&cbll=${s[10]},${s[9]}&cbp=11,0,0,0,0`),te(u,"target","_blank"),te(C,"href",H=`https://www.bing.com/maps?cp=${s[10]}~${s[9]}&style=x`),te(C,"target","_blank")},m(ie,se){et(i,ie,se),ke(ie,o,se),ke(ie,a,se),oe(a,h),ke(ie,m,se),ke(ie,u,se),oe(u,w),ke(ie,E,se),ke(ie,C,se),oe(C,P),U=!0},p(ie,se){S_(ie);const ae={};se&128&&(ae.properties=ie[7]),i.$set(ae),(!U||se&128&&g!==(g=ie[7].url))&&te(a,"href",g),(!U||se&256&&I!==(I=`http://maps.google.com/maps?q=&layer=c&cbll=${ie[10]},${ie[9]}&cbp=11,0,0,0,0`))&&te(u,"href",I),(!U||se&256&&H!==(H=`https://www.bing.com/maps?cp=${ie[10]}~${ie[9]}&style=x`))&&te(C,"href",H)},i(ie){U||(be(i.$$.fragment,ie),U=!0)},o(ie){Le(i.$$.fragment,ie),U=!1},d(ie){ie&&(Se(o),Se(a),Se(m),Se(u),Se(E),Se(C)),tt(i,ie)}}}function $S(s){let i,o;return i=new Oh({props:{openOn:"click",$$slots:{default:[QS,({props:a,features:h})=>({7:a,8:h}),({props:a,features:h})=>(a?128:0)|(h?256:0)]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&16768&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function ek(s){let i,o;return i=new Y_({props:{paint:{"circle-radius":["step",["zoom"],0,12,3,14,5,15,7],"circle-color":["case",["in",["coalesce",["get","crossing"],"unknown"],["literal",s[1]]],"yellow","grey"],"circle-stroke-color":"black","circle-stroke-width":1},hoverCursor:"pointer",$$slots:{default:[$S]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&2&&(g.paint={"circle-radius":["step",["zoom"],0,12,3,14,5,15,7],"circle-color":["case",["in",["coalesce",["get","crossing"],"unknown"],["literal",a[1]]],"yellow","grey"],"circle-stroke-color":"black","circle-stroke-width":1}),h&16384&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function tk(s){let i,o,a,h,g;return o=new ds({props:{data:JSON.parse(zo(s[2]).getCrossingDistances(s[1])),generateId:!0,$$slots:{default:[YS]},$$scope:{ctx:s}}}),h=new ds({props:{data:s[3],$$slots:{default:[ek]},$$scope:{ctx:s}}}),{c(){i=ge("div"),it(o.$$.fragment),a=He(),it(h.$$.fragment),te(i,"slot","map")},m(m,u){ke(m,i,u),et(o,i,null),oe(i,a),et(h,i,null),g=!0},p(m,u){const w={};u&6&&(w.data=JSON.parse(zo(m[2]).getCrossingDistances(m[1]))),u&16384&&(w.$$scope={dirty:u,ctx:m}),o.$set(w);const I={};u&16386&&(I.$$scope={dirty:u,ctx:m}),h.$set(I)},i(m){g||(be(o.$$.fragment,m),be(h.$$.fragment,m),g=!0)},o(m){Le(o.$$.fragment,m),Le(h.$$.fragment,m),g=!1},d(m){m&&Se(i),tt(o),tt(h)}}}function ik(s){let i,o;return i=new ya({props:{$$slots:{map:[tk],sidebar:[XS]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&16391&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function nk(s,i,o){let a,h;Pt(s,Cr,E=>o(2,h=E));let g=JSON.parse(h.getCrossings()),m=u();function u(){let E={};for(let C of g.features){let P=C.properties.crossing||"unknown";E[P]=!0}return E}let w=[1,100,200,400,800,5e3];function I(E,C){s.$$.not_equal(m[C],E)&&(m[C]=E,o(0,m))}return s.$$.update=()=>{s.$$.dirty&1&&o(1,a=Object.keys(m).filter(E=>m[E]))},[m,a,h,g,w,I]}class rk extends Wt{constructor(i){super(),Gt(this,i,nk,ik,Nt,{})}}function sk(s){let i,o,a,h;return i=new Ro({props:{id:"network",beforeId:"Road labels",layout:{visibility:s[0]?"visible":"none"},paint:{"line-width":5,"line-color":s[2]?ns(["abs",["get","gradient"]],wd,xd):Ll(["get","kind"],Ao,"yellow"),"line-opacity":s[1]/100}}}),a=new sb({props:{id:"gradient-arrows",beforeId:"Road labels",minzoom:12,filter:[">",["abs",["get","gradient"]],3],layout:{"icon-image":"chevron","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["<",["get","gradient"],0],180,0],visibility:s[0]&&s[2]?"visible":"none"}}}),{c(){it(i.$$.fragment),o=He(),it(a.$$.fragment)},m(g,m){et(i,g,m),ke(g,o,m),et(a,g,m),h=!0},p(g,m){const u={};m&1&&(u.layout={visibility:g[0]?"visible":"none"}),m&6&&(u.paint={"line-width":5,"line-color":g[2]?ns(["abs",["get","gradient"]],wd,xd):Ll(["get","kind"],Ao,"yellow"),"line-opacity":g[1]/100}),i.$set(u);const w={};m&5&&(w.layout={"icon-image":"chevron","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["<",["get","gradient"],0],180,0],visibility:g[0]&&g[2]?"visible":"none"}),a.$set(w)},i(g){h||(be(i.$$.fragment,g),be(a.$$.fragment,g),h=!0)},o(g){Le(i.$$.fragment,g),Le(a.$$.fragment,g),h=!1},d(g){g&&Se(o),tt(i,g),tt(a,g)}}}function ok(s){let i,o;return i=new ds({props:{data:JSON.parse(zo(s[3]).render()),$$slots:{default:[sk]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&8&&(g.data=JSON.parse(zo(a[3]).render())),h&23&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function ak(s,i,o){let a;Pt(s,Cr,u=>o(3,a=u));let{show:h}=i,{opacity:g}=i,{showGradient:m}=i;return s.$$set=u=>{"show"in u&&o(0,h=u.show),"opacity"in u&&o(1,g=u.opacity),"showGradient"in u&&o(2,m=u.showGradient)},[h,g,m,a]}class lk extends Wt{constructor(i){super(),Gt(this,i,ak,ok,Nt,{show:0,opacity:1,showGradient:2})}}function uk(s){let i,o;return i=new Y_({props:{id:"crossings",beforeId:"Road labels",layout:{visibility:s[0]?"visible":"none"},paint:{"circle-radius":["step",["zoom"],0,12,3,14,5,15,7],"circle-color":Ll(["get","kind"],Yu,"red"),"circle-stroke-color":"black","circle-stroke-width":1}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&1&&(g.layout={visibility:a[0]?"visible":"none"}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function ck(s){let i,o;return i=new ds({props:{data:JSON.parse(zo(s[1]).getCrossings()),$$slots:{default:[uk]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&2&&(g.data=JSON.parse(zo(a[1]).getCrossings())),h&5&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function hk(s,i,o){let a;Pt(s,Cr,g=>o(1,a=g));let{show:h}=i;return s.$$set=g=>{"show"in g&&o(0,h=g.show)},[h,a]}class fk extends Wt{constructor(i){super(),Gt(this,i,hk,ck,Nt,{show:0})}}function C_(s,i,o){const a=s.slice();return a[21]=i[o][0],a[22]=i[o][1],a}function I_(s,i,o){const a=s.slice();return a[25]=i[o][0],a[26]=i[o][1],a}function E_(s){let i,o=s[26]+"",a,h;return{c(){i=ge("option"),a=ft(o),i.__value=h=s[25],Ui(i,i.__value)},m(g,m){ke(g,i,m),oe(i,a)},p(g,m){m&4&&o!==(o=g[26]+"")&&rn(a,o),m&4&&h!==(h=g[25])&&(i.__value=h,Ui(i,i.__value))},d(g){g&&Se(i)}}}function M_(s){let i,o,a=bn(s[22]),h=[];for(let g=0;g<a.length;g+=1)h[g]=E_(I_(s,a,g));return{c(){i=ge("optgroup");for(let g=0;g<h.length;g+=1)h[g].c();te(i,"label",o=s[21])},m(g,m){ke(g,i,m);for(let u=0;u<h.length;u+=1)h[u]&&h[u].m(i,null)},p(g,m){if(m&4){a=bn(g[22]);let u;for(u=0;u<a.length;u+=1){const w=I_(g,a,u);h[u]?h[u].p(w,m):(h[u]=E_(w),h[u].c(),h[u].m(i,null))}for(;u<h.length;u+=1)h[u].d(1);h.length=a.length}m&4&&o!==(o=g[21])&&te(i,"label",o)},d(g){g&&Se(i),Cs(h,g)}}}function dk(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie,se,ae,$,Te,Pe,ve,De,Ae,B,Z,Q,D,N;i=new Pw({props:{loading:s[1]}});let ee=bn(s[2]),me=[];for(let ne=0;ne<ee.length;ne+=1)me[ne]=M_(C_(s,ee,ne));return $=new U2({props:{map:s[5]}}),$.$on("gotXml",s[8]),$.$on("loading",s[12]),$.$on("error",s[13]),{c(){it(i.$$.fragment),o=He(),a=ge("div"),h=ge("label"),g=ft(`Load an example:
    `),m=ge("select"),u=ge("option"),u.textContent="Custom file loaded";for(let ne=0;ne<me.length;ne+=1)me[ne].c();w=He(),I=ge("p"),I.textContent="or...",E=He(),C=ge("div"),P=ge("label"),H=ft(`Load an osm.xml or a .pbf file:
    `),U=ge("input"),ie=He(),se=ge("p"),se.textContent="or...",ae=He(),it($.$$.fragment),Te=He(),Pe=ge("p"),Pe.textContent="or...",ve=He(),De=ge("div"),Ae=ge("label"),B=ft(`Load a pre-built .bin file:
    `),Z=ge("input"),u.__value="",Ui(u,u.__value),te(m,"class","form-select"),s[0]===void 0&&Ml(()=>s[10].call(m)),te(I,"class","fst-italic my-3"),te(U,"class","form-control"),te(U,"type","file"),te(P,"class","form-label"),te(se,"class","fst-italic my-3"),te(Pe,"class","fst-italic my-3"),te(Z,"class","form-control"),te(Z,"type","file"),te(Ae,"class","form-label")},m(ne,pe){et(i,ne,pe),ke(ne,o,pe),ke(ne,a,pe),oe(a,h),oe(h,g),oe(h,m),oe(m,u);for(let Ce=0;Ce<me.length;Ce+=1)me[Ce]&&me[Ce].m(m,null);El(m,s[0],!0),ke(ne,w,pe),ke(ne,I,pe),ke(ne,E,pe),ke(ne,C,pe),oe(C,P),oe(P,H),oe(P,U),s[11](U),ke(ne,ie,pe),ke(ne,se,pe),ke(ne,ae,pe),et($,ne,pe),ke(ne,Te,pe),ke(ne,Pe,pe),ke(ne,ve,pe),ke(ne,De,pe),oe(De,Ae),oe(Ae,B),oe(Ae,Z),s[14](Z),Q=!0,D||(N=[At(m,"change",s[10]),At(U,"change",s[6]),At(Z,"change",s[7])],D=!0)},p(ne,[pe]){const Ce={};if(pe&2&&(Ce.loading=ne[1]),i.$set(Ce),pe&4){ee=bn(ne[2]);let qe;for(qe=0;qe<ee.length;qe+=1){const nt=C_(ne,ee,qe);me[qe]?me[qe].p(nt,pe):(me[qe]=M_(nt),me[qe].c(),me[qe].m(m,null))}for(;qe<me.length;qe+=1)me[qe].d(1);me.length=ee.length}pe&5&&El(m,ne[0]);const fe={};pe&32&&(fe.map=ne[5]),$.$set(fe)},i(ne){Q||(be(i.$$.fragment,ne),be($.$$.fragment,ne),Q=!0)},o(ne){Le(i.$$.fragment,ne),Le($.$$.fragment,ne),Q=!1},d(ne){ne&&(Se(o),Se(a),Se(w),Se(I),Se(E),Se(C),Se(ie),Se(se),Se(ae),Se(Te),Se(Pe),Se(ve),Se(De)),tt(i,ne),Cs(me,ne),s[11](null),tt($,ne),s[14](null),D=!1,xn(N)}}}function pk(s,i,o){let a,h,g;Pt(s,xl,B=>o(16,a=B)),Pt(s,Cr,B=>o(17,h=B)),Pt(s,hc,B=>o(5,g=B));let m=!1,u="",w="",I=!1,E=[];ac(async()=>{try{let Z=await fetch("osm/areas.json");if(Z.ok)I=!0,console.log("Using local cache, not od2net.org"),o(2,E=await Z.json());else{let Q=await fetch("https://assets.od2net.org/severance_pbfs/areas.json");o(2,E=await Q.json())}}catch{}let B=new URLSearchParams(window.location.search).get("study_area");B&&o(0,u=B),o(9,m=!0)});let C;async function P(B){try{ie(new Uint8Array(await C.files[0].arrayBuffer())),o(0,u="")}catch(Z){window.alert(`Couldn't open this file: ${Z}`)}o(1,w="")}let H;async function U(B){try{o(1,w="Deserializing binary file");let Z=await H.files[0].arrayBuffer();console.time("load");let Q=!1;xi(Cr,h=new km(Q,new Uint8Array(Z),a),h),console.timeEnd("load"),o(0,u="")}catch(Z){window.alert(`Couldn't open this file: ${Z}`)}o(1,w="")}function ie(B){o(1,w="Building map model from OSM input"),console.time("load");let Z=!0;xi(Cr,h=new km(Z,B,a),h),console.timeEnd("load")}function se(B){try{ie(new Uint8Array(new TextEncoder().encode(B.detail.xml))),o(0,u="")}catch(Z){window.alert(`Couldn't import from Overpass: ${Z}`)}o(1,w="")}async function ae(B,Z){if(!Z)return;let Q=new URL(window.location.href);if(B==""){Q.searchParams.delete("study_area"),window.history.replaceState(null,"",Q.toString());return}Q.searchParams.set("study_area",B),window.history.replaceState(null,"",Q.toString()),I?await $(`osm/${B}.pbf`):await $(`https://assets.od2net.org/severance_pbfs/${B}.pbf`)}async function $(B){try{o(1,w=`Downloading ${B}`);let Z=await fetch(B);ie(new Uint8Array(await Z.arrayBuffer()))}catch(Z){window.alert(`Couldn't open from URL ${B}: ${Z}`)}o(1,w="")}function Te(){u=Cd(this),o(0,u),o(2,E)}function Pe(B){gi[B?"unshift":"push"](()=>{C=B,o(3,C)})}const ve=B=>o(1,w=B.detail),De=B=>window.alert(B.detail);function Ae(B){gi[B?"unshift":"push"](()=>{H=B,o(4,H)})}return s.$$.update=()=>{s.$$.dirty&513&&ae(u,m)},[u,w,E,C,H,g,P,U,se,m,Te,Pe,ve,De,Ae]}class mk extends Wt{constructor(i){super(),Gt(this,i,pk,dk,Nt,{})}}function gk(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie,se,ae,$,Te,Pe,ve,De,Ae,B,Z,Q,D,N,ee,me,ne,pe,Ce,fe,qe,nt,lt,at,ut,St,It;return ut=E1(s[4][0]),{c(){i=ge("h1"),i.textContent="Import profile",o=He(),a=ge("p"),a.innerHTML=`Street design and OpenStreetMap tagging conventions both vary around the
    world. This tool needs to identify &quot;severance&quot; roads that&#39;re difficult to
    cross. Pick a profile below (or <a href="https://github.com/a-b-street/severance_snape/issues/9" target="_blank">help make a new one</a>).`,h=He(),g=ge("fieldset"),m=ge("div"),u=ge("label"),w=ge("input"),I=He(),E=ge("u"),E.textContent="SeparateWays",C=ft(`: if sidewalks are tagged as
        `),P=ge("a"),P.textContent="separate ways",H=ft(" in your area"),U=He(),ie=ge("div"),se=ge("label"),ae=ge("input"),$=He(),Te=ge("u"),Te.textContent="SidewalksOnHighways",Pe=ft(`: When a road in OSM doesn't explicitly
        specify sidewalks, assume they exist`),ve=He(),De=ge("div"),Ae=ge("label"),B=ge("input"),Z=He(),Q=ge("u"),Q.textContent="USA",D=ft(`: An attempt to simplify the classification rules, tuned for
        some USA examples. Mostly uses the `),N=ge("i"),N.textContent="highway",ee=ft(" tag."),me=He(),ne=ge("div"),pe=ge("label"),Ce=ge("input"),fe=He(),qe=ge("u"),qe.textContent="USA with shoulders",nt=ft(`: A variation that treats roads with a shoulder
        as walkable, even if their speed/classifiation would mean they're
        severances in the USA profile.`),lt=He(),at=ge("button"),at.textContent="Done",te(w,"class","form-check-input"),te(w,"type","radio"),w.__value="SeparateWays",Ui(w,w.__value),te(P,"href","https://wiki.openstreetmap.org/wiki/Sidewalks#Sidewalk_as_separate_way"),te(P,"target","_blank"),te(u,"class","form-check-label"),te(m,"class","form-check"),te(ae,"class","form-check-input"),te(ae,"type","radio"),ae.__value="SidewalksOnHighways",Ui(ae,ae.__value),te(se,"class","form-check-label"),te(ie,"class","form-check"),te(B,"class","form-check-input"),te(B,"type","radio"),B.__value="USA",Ui(B,B.__value),te(Ae,"class","form-check-label"),te(De,"class","form-check"),te(Ce,"class","form-check-input"),te(Ce,"type","radio"),Ce.__value="USAShoulders",Ui(Ce,Ce.__value),te(pe,"class","form-check-label"),te(ne,"class","form-check"),te(at,"class","btn btn-primary"),ut.p(w,ae,B,Ce)},m(st,Lt){ke(st,i,Lt),ke(st,o,Lt),ke(st,a,Lt),ke(st,h,Lt),ke(st,g,Lt),oe(g,m),oe(m,u),oe(u,w),w.checked=w.__value===s[1],oe(u,I),oe(u,E),oe(u,C),oe(u,P),oe(u,H),oe(g,U),oe(g,ie),oe(ie,se),oe(se,ae),ae.checked=ae.__value===s[1],oe(se,$),oe(se,Te),oe(se,Pe),oe(g,ve),oe(g,De),oe(De,Ae),oe(Ae,B),B.checked=B.__value===s[1],oe(Ae,Z),oe(Ae,Q),oe(Ae,D),oe(Ae,N),oe(Ae,ee),oe(g,me),oe(g,ne),oe(ne,pe),oe(pe,Ce),Ce.checked=Ce.__value===s[1],oe(pe,fe),oe(pe,qe),oe(pe,nt),ke(st,lt,Lt),ke(st,at,Lt),St||(It=[At(w,"change",s[3]),At(ae,"change",s[5]),At(B,"change",s[6]),At(Ce,"change",s[7]),At(at,"click",s[8])],St=!0)},p(st,Lt){Lt&2&&(w.checked=w.__value===st[1]),Lt&2&&(ae.checked=ae.__value===st[1]),Lt&2&&(B.checked=B.__value===st[1]),Lt&2&&(Ce.checked=Ce.__value===st[1])},d(st){st&&(Se(i),Se(o),Se(a),Se(h),Se(g),Se(lt),Se(at)),ut.r(),St=!1,xn(It)}}}function _k(s){let i,o,a,h,g,m,u,w,I,E;function C(H){s[9](H)}let P={$$slots:{default:[gk]},$$scope:{ctx:s}};return s[0]!==void 0&&(P.show=s[0]),m=new Bd({props:P}),gi.push(()=>hn(m,"show",C)),{c(){i=ge("button"),o=ft("Change import profile ("),a=ft(s[1]),h=ft(")"),g=He(),it(m.$$.fragment),te(i,"class","btn btn-secondary mb-3")},m(H,U){ke(H,i,U),oe(i,o),oe(i,a),oe(i,h),ke(H,g,U),et(m,H,U),w=!0,I||(E=At(i,"click",s[2]),I=!0)},p(H,[U]){(!w||U&2)&&rn(a,H[1]);const ie={};U&1027&&(ie.$$scope={dirty:U,ctx:H}),!u&&U&1&&(u=!0,ie.show=H[0],cn(()=>u=!1)),m.$set(ie)},i(H){w||(be(m.$$.fragment,H),w=!0)},o(H){Le(m.$$.fragment,H),w=!1},d(H){H&&(Se(i),Se(g)),tt(m,H),I=!1,E()}}}function yk(s,i,o){let a;Pt(s,xl,H=>o(1,a=H));let h=!1;const g=[[]],m=()=>o(0,h=!0);function u(){a=this.__value,xl.set(a)}function w(){a=this.__value,xl.set(a)}function I(){a=this.__value,xl.set(a)}function E(){a=this.__value,xl.set(a)}const C=()=>o(0,h=!1);function P(H){h=H,o(0,h)}return[h,a,m,u,g,w,I,E,C,P]}class vk extends Wt{constructor(i){super(),Gt(this,i,yk,_k,Nt,{})}}function bk(s){let i;return{c(){i=ge("div"),te(i,"slot","top")},m(o,a){ke(o,i,a)},p:Tt,d(o){o&&Se(i)}}}function xk(s){let i;return{c(){i=ge("p"),i.textContent="Waiting for MapLibre and WASM to load..."},m(o,a){ke(o,i,a)},i:Tt,o:Tt,d(o){o&&Se(i)}}}function wk(s){let i,o;return i=new mk({}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Sk(s){let i,o,a,h,g,m,u,w;h=new vk({});const I=[wk,xk],E=[];function C(P,H){return P[1]&&P[0]?0:1}return m=C(s),u=E[m]=I[m](s),{c(){i=ge("div"),o=ge("h2"),o.textContent="Choose your study area",a=He(),it(h.$$.fragment),g=He(),u.c(),te(i,"slot","sidebar")},m(P,H){ke(P,i,H),oe(i,o),oe(i,a),et(h,i,null),oe(i,g),E[m].m(i,null),w=!0},p(P,H){let U=m;m=C(P),m!==U&&(ki(),Le(E[U],1,1,()=>{E[U]=null}),Ti(),u=E[m],u||(u=E[m]=I[m](P),u.c()),be(u,1),u.m(i,null))},i(P){w||(be(h.$$.fragment,P),be(u),w=!0)},o(P){Le(h.$$.fragment,P),Le(u),w=!1},d(P){P&&Se(i),tt(h),E[m].d()}}}function kk(s){let i,o,a;return o=new B2({}),{c(){i=ge("div"),it(o.$$.fragment),te(i,"slot","map")},m(h,g){ke(h,i,g),et(o,i,null),a=!0},p:Tt,i(h){a||(be(o.$$.fragment,h),a=!0)},o(h){Le(o.$$.fragment,h),a=!1},d(h){h&&Se(i),tt(o)}}}function Tk(s){let i,o;return i=new ya({props:{$$slots:{map:[kk],sidebar:[Sk],top:[bk]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&11&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Ck(s,i,o){let a,h;Pt(s,Cr,m=>o(2,a=m)),Pt(s,hc,m=>o(1,h=m));let{wasmReady:g}=i;return xi(Cr,a=null,a),s.$$set=m=>{"wasmReady"in m&&o(0,g=m.wasmReady)},[g,h]}class Ik extends Wt{constructor(i){super(),Gt(this,i,Ck,Tk,Nt,{wasmReady:0})}}function L_(s,i,o){const a=s.slice();return a[9]=i[o],a[11]=o,a}function P_(s){let i;return{c(){i=ge("li"),i.textContent=`${s[9]}`,Bi(i,"color",s[2][s[11]%s[2].length])},m(o,a){ke(o,i,a)},p:Tt,d(o){o&&Se(i)}}}function Ek(s){let i,o,a,h,g,m,u,w,I=bn(s[1].components),E=[];for(let C=0;C<I.length;C+=1)E[C]=P_(L_(s,I,C));return{c(){i=ge("div"),o=ge("h2"),o.textContent="Network disconnections",a=He(),h=ge("p"),h.innerHTML=`This shows where the pedestrian network is disconnected, according to the
      import profile. If there are unexpected cases here, it could either be a
      problem with OSM data, the import profile, or truly reality. Severances
      are <b>not</b> shown.`,g=He(),m=ge("p"),m.textContent="Component sizes:",u=He(),w=ge("ul");for(let C=0;C<E.length;C+=1)E[C].c();te(i,"slot","sidebar")},m(C,P){ke(C,i,P),oe(i,o),oe(i,a),oe(i,h),oe(i,g),oe(i,m),oe(i,u),oe(i,w);for(let H=0;H<E.length;H+=1)E[H]&&E[H].m(w,null)},p(C,P){if(P&6){I=bn(C[1].components);let H;for(H=0;H<I.length;H+=1){const U=L_(C,I,H);E[H]?E[H].p(U,P):(E[H]=P_(U),E[H].c(),E[H].m(w,null))}for(;H<E.length;H+=1)E[H].d(1);E.length=I.length}},d(C){C&&Se(i),Cs(E,C)}}}function Mk(s){let i,o;return i=new Ro({props:{id:"disconnections",paint:{"line-width":ec(5,10),"line-color":s[3](s[0])},manageHoverState:!0,hoverCursor:"pointer"}}),i.$on("click",s[4]),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&1&&(g.paint={"line-width":ec(5,10),"line-color":a[3](a[0])}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Lk(s){let i,o,a,h,g;return o=new Ld({}),o.$on("click",s[5]),h=new ds({props:{data:s[1],generateId:!0,$$slots:{default:[Mk]},$$scope:{ctx:s}}}),{c(){i=ge("div"),it(o.$$.fragment),a=He(),it(h.$$.fragment),te(i,"slot","map")},m(m,u){ke(m,i,u),et(o,i,null),oe(i,a),et(h,i,null),g=!0},p(m,u){const w={};u&4097&&(w.$$scope={dirty:u,ctx:m}),h.$set(w)},i(m){g||(be(o.$$.fragment,m),be(h.$$.fragment,m),g=!0)},o(m){Le(o.$$.fragment,m),Le(h.$$.fragment,m),g=!1},d(m){m&&Se(i),tt(o),tt(h)}}}function Pk(s){let i,o;return i=new ya({props:{$$slots:{map:[Lk],sidebar:[Ek]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,[h]){const g={};h&4097&&(g.$$scope={dirty:h,ctx:a}),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Ak(s,i,o){let a,h;Pt(s,hc,P=>o(6,a=P)),Pt(s,Cr,P=>o(7,h=P));let g=JSON.parse(h.findConnectedComponents()),m=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],u=Ll(["to-string",["%",["get","component"],m.length]],Object.fromEntries(m.map((P,H)=>[H.toString(),P])),"black"),w=null;function I(P){return P==null?u:["case",["==",["get","component"],P],u,"black"]}function E(P){o(0,w=P.detail.features[0].properties.component)}function C(P){a.queryRenderedFeatures(P.detail.point,{layers:["disconnections"]}).length==0&&o(0,w=null)}return[w,g,m,I,E,C]}class zk extends Wt{constructor(i){super(),Gt(this,i,Ak,Pk,Nt,{})}}function A_(s){let i,o,a;function h(m){s[2](m)}let g={$$slots:{default:[Dk]},$$scope:{ctx:s}};return s[0]!==void 0&&(g.show=s[0]),i=new Bd({props:g}),gi.push(()=>hn(i,"show",h)),{c(){it(i.$$.fragment)},m(m,u){et(i,m,u),a=!0},p(m,u){const w={};u&9&&(w.$$scope={dirty:u,ctx:m}),!o&&u&1&&(o=!0,w.show=m[0],cn(()=>o=!1)),i.$set(w)},i(m){a||(be(i.$$.fragment,m),a=!0)},o(m){Le(i.$$.fragment,m),a=!1},d(m){tt(i,m)}}}function Dk(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie,se,ae,$,Te,Pe,ve;return{c(){i=ge("h1"),i.textContent="Severance Snape",o=He(),a=ge("p"),a.innerHTML=`This is an <b>experimental</b> tool to study &quot;severances&quot; for people walking.
      In some places, crossing a big road (a &quot;severance&quot;) might be easy -- there&#39;s
      a zebra or signalized crossing right on the &quot;desire line&quot; where someone might
      want to cross. But often, a person might have to walk a few blocks to reach
      the nearest crossing -- and then they might have to go up or down stairs to
      cross on a bridge or a tunnel!`,h=He(),g=ge("p"),g.textContent=`This tool quantifies just how bad this crossing is with a "detour factor"
      -- the ratio of the length to cross in a straight line and the length of
      the actual path, according to OSM data. A score close to 1 is great, and a
      score of 4 means the actual path is 4 times the length of the straight
      desire line.`,m=He(),u=ge("p"),u.innerHTML=`This tool is <b>experimental</b>, so there will be bugs both with OSM data
      and what the tool shows!`,w=He(),I=ge("p"),I.textContent="To use this tool, you need to:",E=He(),C=ge("ol"),C.innerHTML=`<li>Choose your study area to analyze</li> <li>Check the severances that show up -- they&#39;re inferred from OSM data and
        might not be correct</li> <li>Use the <b>Route mode</b> to explore the detour factor between any two points
        you choose</li> <li>Use the <b>Score mode</b> to visualize the detour factor everywhere, looking
        for places easy and hard to cross</li>`,P=He(),H=ge("p"),H.innerHTML=`This tool aims to complement an &quot;area porosity&quot; analysis, defined in <a href="https://content.tfl.gov.uk/lcds-chapter2-toolsandtechniques.pdf" target="_blank">section 2.3.5 of TfL&#39;s Cycling Design Standards</a>. That definition of porosity just counts the number of crossings per
      area, and isn&#39;t very detailed about how far you have to walk to a crossing
      in that area.`,U=He(),ie=ge("p"),ie.innerHTML=`This <a href="https://github.com/dabreegster/severance_snape/" target="_blank">open source</a>
      tool is created by
      <a href="https://abstreet.uk" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a> data.`,se=He(),ae=ge("details"),ae.innerHTML='<summary>Changelog</summary> <p><a href="https://github.com/dabreegster/severance_snape/commits/" target="_blank">GitHub</a> has more detail; this is a summary</p> <ul><li>17 February - use Pico for styling</li> <li>21 January - fix shortest route calculations</li></ul>',$=He(),Te=ge("button"),Te.textContent="Start!",te(Te,"class","btn btn-primary")},m(De,Ae){ke(De,i,Ae),ke(De,o,Ae),ke(De,a,Ae),ke(De,h,Ae),ke(De,g,Ae),ke(De,m,Ae),ke(De,u,Ae),ke(De,w,Ae),ke(De,I,Ae),ke(De,E,Ae),ke(De,C,Ae),ke(De,P,Ae),ke(De,H,Ae),ke(De,U,Ae),ke(De,ie,Ae),ke(De,se,Ae),ke(De,ae,Ae),ke(De,$,Ae),ke(De,Te,Ae),Pe||(ve=At(Te,"click",s[1]),Pe=!0)},p:Tt,d(De){De&&(Se(i),Se(o),Se(a),Se(h),Se(g),Se(m),Se(u),Se(w),Se(I),Se(E),Se(C),Se(P),Se(H),Se(U),Se(ie),Se(se),Se(ae),Se($),Se(Te)),Pe=!1,ve()}}}function Rk(s){let i,o,a=s[0]&&A_(s);return{c(){a&&a.c(),i=Kn()},m(h,g){a&&a.m(h,g),ke(h,i,g),o=!0},p(h,[g]){h[0]?a?(a.p(h,g),g&1&&be(a,1)):(a=A_(h),a.c(),be(a,1),a.m(i.parentNode,i)):a&&(ki(),Le(a,1,1,()=>{a=null}),Ti())},i(h){o||(be(a),o=!0)},o(h){Le(a),o=!1},d(h){h&&Se(i),a&&a.d(h)}}}function Bk(s,i,o){let a;Pt(s,Qu,m=>o(0,a=m));const h=()=>xi(Qu,a=!1,a);function g(m){a=m,Qu.set(a)}return[a,h,g]}class Fk extends Wt{constructor(i){super(),Gt(this,i,Bk,Rk,Nt,{})}}function Ok(s){let i,o,a;return o=new PS({}),{c(){i=ge("div"),it(o.$$.fragment),te(i,"slot","top")},m(h,g){ke(h,i,g),et(o,i,null),a=!0},p:Tt,i(h){a||(be(o.$$.fragment,h),a=!0)},o(h){Le(o.$$.fragment,h),a=!1},d(h){h&&Se(i),tt(o)}}}function Nk(s){let i,o,a,h;return{c(){i=ge("div"),o=ge("h1"),o.textContent="Severance Snape",a=He(),h=ge("div"),te(i,"slot","left")},m(g,m){ke(g,i,m),oe(i,o),oe(i,a),oe(i,h),s[20](h)},p:Tt,d(g){g&&Se(i),s[20](null)}}}function z_(s){let i,o,a,h,g;function m(E){s[14](E)}function u(E){s[15](E)}function w(E){s[16](E)}let I={zoomToFit:s[10],canShowCrossings:s[9].kind!="disconnected"&&s[9].kind!="crossings",canShowGradient:s[9].kind!="debug"&&s[9].kind!="disconnected"&&s[9].kind!="crossings"};return s[6]!==void 0&&(I.opacity=s[6]),s[7]!==void 0&&(I.showCrossings=s[7]),s[8]!==void 0&&(I.showGradient=s[8]),i=new WS({props:I}),gi.push(()=>hn(i,"opacity",m)),gi.push(()=>hn(i,"showCrossings",u)),gi.push(()=>hn(i,"showGradient",w)),{c(){it(i.$$.fragment)},m(E,C){et(i,E,C),g=!0},p(E,C){const P={};C&512&&(P.canShowCrossings=E[9].kind!="disconnected"&&E[9].kind!="crossings"),C&512&&(P.canShowGradient=E[9].kind!="debug"&&E[9].kind!="disconnected"&&E[9].kind!="crossings"),!o&&C&64&&(o=!0,P.opacity=E[6],cn(()=>o=!1)),!a&&C&128&&(a=!0,P.showCrossings=E[7],cn(()=>a=!1)),!h&&C&256&&(h=!0,P.showGradient=E[8],cn(()=>h=!1)),i.$set(P)},i(E){g||(be(i.$$.fragment,E),g=!0)},o(E){Le(i.$$.fragment,E),g=!1},d(E){tt(i,E)}}}function D_(s){let i,o;return i=new Ik({props:{wasmReady:s[4]}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&16&&(g.wasmReady=a[4]),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function R_(s){let i,o,a,h,g,m,u,w,I,E;i=new ds({props:{data:JSON.parse(s[3].getInvertedBoundary()),$$slots:{default:[Vk]},$$scope:{ctx:s}}}),a=new lk({props:{show:s[9].kind!="debug"&&s[9].kind!="disconnected"&&s[9].kind!="crossings",opacity:s[6],showGradient:s[8]}}),g=new fk({props:{show:s[7]&&s[9].kind!="disconnected"&&s[9].kind!="crossings"}});const C=[Wk,Gk,Zk,qk,Uk,jk],P=[];function H(U,ie){return U[9].kind=="route"?0:U[9].kind=="isochrone"?1:U[9].kind=="score"?2:U[9].kind=="crossings"?3:U[9].kind=="debug"?4:U[9].kind=="disconnected"?5:-1}return~(u=H(s))&&(w=P[u]=C[u](s)),{c(){it(i.$$.fragment),o=He(),it(a.$$.fragment),h=He(),it(g.$$.fragment),m=He(),w&&w.c(),I=Kn()},m(U,ie){et(i,U,ie),ke(U,o,ie),et(a,U,ie),ke(U,h,ie),et(g,U,ie),ke(U,m,ie),~u&&P[u].m(U,ie),ke(U,I,ie),E=!0},p(U,ie){const se={};ie&8&&(se.data=JSON.parse(U[3].getInvertedBoundary())),ie&16777216&&(se.$$scope={dirty:ie,ctx:U}),i.$set(se);const ae={};ie&512&&(ae.show=U[9].kind!="debug"&&U[9].kind!="disconnected"&&U[9].kind!="crossings"),ie&64&&(ae.opacity=U[6]),ie&256&&(ae.showGradient=U[8]),a.$set(ae);const $={};ie&640&&($.show=U[7]&&U[9].kind!="disconnected"&&U[9].kind!="crossings"),g.$set($);let Te=u;u=H(U),u===Te?~u&&P[u].p(U,ie):(w&&(ki(),Le(P[Te],1,1,()=>{P[Te]=null}),Ti()),~u?(w=P[u],w?w.p(U,ie):(w=P[u]=C[u](U),w.c()),be(w,1),w.m(I.parentNode,I)):w=null)},i(U){E||(be(i.$$.fragment,U),be(a.$$.fragment,U),be(g.$$.fragment,U),be(w),E=!0)},o(U){Le(i.$$.fragment,U),Le(a.$$.fragment,U),Le(g.$$.fragment,U),Le(w),E=!1},d(U){U&&(Se(o),Se(h),Se(m),Se(I)),tt(i,U),tt(a,U),tt(g,U),~u&&P[u].d(U)}}}function Vk(s){let i,o;return i=new Q_({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p:Tt,i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function jk(s){let i,o;return i=new zk({}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p:Tt,i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Uk(s){let i,o;return i=new $2({props:{opacity:s[6]}}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p(a,h){const g={};h&64&&(g.opacity=a[6]),i.$set(g)},i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function qk(s){let i,o;return i=new rk({}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p:Tt,i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Zk(s){let i,o;return i=new VS({}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p:Tt,i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Gk(s){let i,o;return i=new IS({}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p:Tt,i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Wk(s){let i,o;return i=new pS({}),{c(){it(i.$$.fragment)},m(a,h){et(i,a,h),o=!0},p:Tt,i(a){o||(be(i.$$.fragment,a),o=!0)},o(a){Le(i.$$.fragment,a),o=!1},d(a){tt(i,a)}}}function Hk(s){let i,o,a,h,g,m,u,w,I,E,C,P,H,U,ie;i=new dw({props:{map:s[0]}}),a=new sw({props:{map:s[0]}});function se(ve){s[13](ve)}let ae={choice:"Maptiler Dataviz",bottom:"80px"};s[5]!==void 0&&(ae.style=s[5]),g=new fb({props:ae}),gi.push(()=>hn(g,"style",se)),w=new iw({props:{map:s[0],apiKey:G2,country:void 0}});let $=s[9].kind!="title"&&z_(s),Te=s[9].kind=="title"&&D_(s),Pe=s[3]&&R_(s);return{c(){it(i.$$.fragment),o=He(),it(a.$$.fragment),h=He(),it(g.$$.fragment),u=He(),it(w.$$.fragment),I=He(),$&&$.c(),E=He(),C=ge("div"),P=He(),Te&&Te.c(),H=He(),Pe&&Pe.c(),U=Kn()},m(ve,De){et(i,ve,De),ke(ve,o,De),et(a,ve,De),ke(ve,h,De),et(g,ve,De),ke(ve,u,De),et(w,ve,De),ke(ve,I,De),$&&$.m(ve,De),ke(ve,E,De),ke(ve,C,De),s[17](C),ke(ve,P,De),Te&&Te.m(ve,De),ke(ve,H,De),Pe&&Pe.m(ve,De),ke(ve,U,De),ie=!0},p(ve,De){const Ae={};De&1&&(Ae.map=ve[0]),i.$set(Ae);const B={};De&1&&(B.map=ve[0]),a.$set(B);const Z={};!m&&De&32&&(m=!0,Z.style=ve[5],cn(()=>m=!1)),g.$set(Z);const Q={};De&1&&(Q.map=ve[0]),w.$set(Q),ve[9].kind!="title"?$?($.p(ve,De),De&512&&be($,1)):($=z_(ve),$.c(),be($,1),$.m(E.parentNode,E)):$&&(ki(),Le($,1,1,()=>{$=null}),Ti()),ve[9].kind=="title"?Te?(Te.p(ve,De),De&512&&be(Te,1)):(Te=D_(ve),Te.c(),be(Te,1),Te.m(H.parentNode,H)):Te&&(ki(),Le(Te,1,1,()=>{Te=null}),Ti()),ve[3]?Pe?(Pe.p(ve,De),De&8&&be(Pe,1)):(Pe=R_(ve),Pe.c(),be(Pe,1),Pe.m(U.parentNode,U)):Pe&&(ki(),Le(Pe,1,1,()=>{Pe=null}),Ti())},i(ve){ie||(be(i.$$.fragment,ve),be(a.$$.fragment,ve),be(g.$$.fragment,ve),be(w.$$.fragment,ve),be($),be(Te),be(Pe),ie=!0)},o(ve){Le(i.$$.fragment,ve),Le(a.$$.fragment,ve),Le(g.$$.fragment,ve),Le(w.$$.fragment,ve),Le($),Le(Te),Le(Pe),ie=!1},d(ve){ve&&(Se(o),Se(h),Se(u),Se(I),Se(E),Se(C),Se(P),Se(H),Se(U)),tt(i,ve),tt(a,ve),tt(g,ve),tt(w,ve),$&&$.d(ve),s[17](null),Te&&Te.d(ve),Pe&&Pe.d(ve)}}}function Xk(s){let i,o,a,h;function g(u){s[18](u)}let m={style:s[5],hash:!0,images:[{id:"chevron",url:G_}],$$slots:{default:[Hk]},$$scope:{ctx:s}};return s[0]!==void 0&&(m.map=s[0]),o=new Fv({props:m}),gi.push(()=>hn(o,"map",g)),o.$on("error",s[19]),{c(){i=ge("div"),it(o.$$.fragment),te(i,"slot","main"),Bi(i,"position","relative"),Bi(i,"width","100%"),Bi(i,"height","100vh")},m(u,w){ke(u,i,w),et(o,i,null),h=!0},p(u,w){const I={};w&32&&(I.style=u[5]),w&16778237&&(I.$$scope={dirty:w,ctx:u}),!a&&w&1&&(a=!0,I.map=u[0],cn(()=>a=!1)),o.$set(I)},i(u){h||(be(o.$$.fragment,u),h=!0)},o(u){Le(o.$$.fragment,u),h=!1},d(u){u&&Se(i),tt(o)}}}function Kk(s){let i,o,a,h;return i=new Fk({}),a=new xw({props:{$$slots:{main:[Xk],left:[Nk],top:[Ok]},$$scope:{ctx:s}}}),{c(){it(i.$$.fragment),o=He(),it(a.$$.fragment)},m(g,m){et(i,g,m),ke(g,o,m),et(a,g,m),h=!0},p(g,[m]){const u={};m&16778239&&(u.$$scope={dirty:m,ctx:g}),a.$set(u)},i(g){h||(be(i.$$.fragment,g),be(a.$$.fragment,g),h=!0)},o(g){Le(i.$$.fragment,g),Le(a.$$.fragment,g),h=!1},d(g){g&&Se(o),tt(i,g),tt(a,g)}}}function Jk(){let s=new URLSearchParams(window.location.search).get("mode")||"";return["score","route","isochrone","crossings","debug","disconnected"].includes(s)?{kind:s}:{kind:"route"}}function Yk(s,i,o){let a,h,g,m;Pt(s,kd,D=>o(11,a=D)),Pt(s,Sd,D=>o(12,h=D)),Pt(s,Cr,D=>o(3,g=D)),Pt(s,Zr,D=>o(9,m=D));let u=!1;ac(async()=>{await H_(),o(4,u=!0)});let w=!window.location.hash,I=Jk(),E,C=rc["Maptiler Dataviz"],P=100,H=!0,U=!1;function ie(){E&&g&&E.fitBounds(Array.from(g.getBounds()),{animate:!1})}function se(D){g&&(console.log(`New map model loaded. Starting in ${I.kind}`),w&&ie(),w=!0,xi(Zr,m=I,m),I={kind:"route"})}let ae,$;function Te(D){C=D,o(5,C)}function Pe(D){P=D,o(6,P)}function ve(D){H=D,o(7,H)}function De(D){U=D,o(8,U)}function Ae(D){gi[D?"unshift":"push"](()=>{$=D,o(2,$),o(11,a)})}function B(D){E=D,o(0,E)}const Z=D=>{console.log(D.detail.error)};function Q(D){gi[D?"unshift":"push"](()=>{ae=D,o(1,ae),o(12,h)})}return s.$$.update=()=>{s.$$.dirty&1&&E&&hc.set(E),s.$$.dirty&8&&se(),s.$$.dirty&4098&&ae&&h&&(o(1,ae.innerHTML="",ae),ae.appendChild(h)),s.$$.dirty&2052&&$&&a&&(o(2,$.innerHTML="",$),$.appendChild(a))},[E,ae,$,g,u,C,P,H,U,m,ie,a,h,Te,Pe,ve,De,Ae,B,Z,Q]}class Qk extends Wt{constructor(i){super(),Gt(this,i,Yk,Kk,Nt,{})}}new Qk({target:document.getElementById("app")});
